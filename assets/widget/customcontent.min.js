var SvgLoader=Backbone.View.extend({initialize:function(id,type){this.svgID=id,this.type=type},loadSVG:function(thisArg,callback){var url=(this.type===SymbolType.SHAPE?URLPaths.SVG_SHAPE_URL:URLPaths.SVG_ICON_URL)+this.svgID+".svg?t="+LinkIconVersion;$.ajax({url:url,dataType:"text",success:function(svg){callback&&"function"==typeof callback&&callback.call(thisArg,svg)}})}});SvgLoader.loadedIcons=null,SvgLoader.loadedShapes=null,SvgLoader.addLoadedIcon=function(iconId,iconBody){SvgLoader.loadedIcons[iconId]=iconBody},SvgLoader.addLoadedShape=function(shapeId,shapeBody){SvgLoader.loadedShapes[shapeId]=shapeBody},SvgLoader.getLoadedIcons=function(){return SvgLoader.loadedIcons||(SvgLoader.loadedIcons=SvgLoader.getLoadedSvgs("icons")),SvgLoader.loadedIcons},SvgLoader.getLoadedShapes=function(){return SvgLoader.loadedShapes||(SvgLoader.loadedShapes=SvgLoader.getLoadedSvgs("shapes")),SvgLoader.loadedShapes},SvgLoader.getLoadedSvgs=function(type){var widgetModel=FSWidgetModel.gi(),collectionHash="function"==typeof window[type+"_"+widgetModel.get("collectionHash")]?window[type+"_"+widgetModel.get("collectionHash")]():{};return widgetModel.get("isDownload")?collectionHash:{}};var LinkAction={GO_TO_URL:0,GO_TO_PREV_PAGE:1,GO_TO_NEXT_PAGE:2,GO_TO_FIRST_PAGE:3,GO_TO_LAST_PAGE:4,GO_TO_PAGE:5,DOWNLOAD_PDF:6,GO_TO_FLIPSNACK_PROFILE:7,SEND_EMAIL:8,BLANK:9,VIDEO:10,AUDIO:11,CAPTION:12,PAYPAL:13,FORM:14,SHAPE:15,IMAGE:16,LIST:17,VIDEO_WIDGET:23,TAG:24,EMBED:101},PremiumTypeLinks=[23,29,30,31,33,34,35,46,48],PremiumActionLinks=[6],FEATURES={WIDGET_MEDIA:"WIDGET_MEDIA",DOWNLOAD_PDF:"DOWNLOAD_PDF",WIDGET_FORMS:"WIDGET_FORMS",WIDGET_TAGS:"WIDGET_TAGS",EMBED:"EMBED",PRODUCT_TAG:"PRODUCT_TAG"},ElementActionToFeature={6:FEATURES.DOWNLOAD_PDF,10:FEATURES.WIDGET_MEDIA,11:FEATURES.WIDGET_MEDIA,23:FEATURES.WIDGET_MEDIA,14:FEATURES.WIDGET_FORMS,24:FEATURES.WIDGET_TAGS,12:FEATURES.WIDGET_TAGS,29:FEATURES.PRODUCT_TAG,101:FEATURES.EMBED},TagType={VIDEO:0,IMAGE:1,LINK:2,TEXT:3},EDITOR_DEFAULTS={width:735,height:682,CUSTOM_BUTTON_WITH_LABEL_DEFAULT_FONT_SIZE:12,CUSTOM_BUTTON_WITH_LABEL_DEFAULT_WIDTH:46,CUSTOM_BUTTON_WITH_LABEL_DEFAULT_HEIGHT:24,CUSTOM_BUTTON_WITH_LABEL_DEFAULT_ICON_SIZE:.45,CUSTOM_BUTTON_WITH_LABEL_DEFAULT_MARGIN_RIGHT:8,CUSTOM_BUTTON_WITH_LABEL_DEFAULT_MARGIN_LEFT:3.5,CUSTOM_BUTTON_WITH_LABEL_DEFAULT_PADDING_LEFT:2.4,CUSTOM_BUTTON_WITH_NEW_LABEL_DEFAULT_FONT_SIZE:9},ImageElementType={UPLOAD:"upload",TEXTURE:"texture",STOCK:"stock",COLOR:"color"},ImageElementScale={NONE:"none",SCALE_CROP:"scaleCrop",SCALE:"scale",TILE:"tile"},SymbolType={SHAPE:"svg",ICON:"icon"},VIDEO_POPIN_DEFAULTS={WIDTH:1280,HEIGHT:720,MARGINS:44},PhotoProviders={COLLECTION:"collection",UNSPLASH:"unsplash",PEXELS:"pexels",PIXABAY:"pixabay",EXTERNAL:"external"},LinkIconVersion="15",InteractOptions={LINK:"link",PAGE:"page",POPIN:"popin"},InteractionPopinTrigger={CLICK:"click",HOVER:"hover"},InteractionPopinPosition={TOP_LEFT:"top-left",TOP:"top",TOP_RIGHT:"top-right",RIGHT:"right",BOTTOM_RIGHT:"bottom-right",BOTTOM:"bottom",BOTTOM_LEFT:"bottom-left",LEFT:"left"},InteractionPopinContent={TITLE_FONT_SIZE:16,DESCRIPTION_FONT_SIZE:14,DESCRIPTION_MARGIN:10,CONTENT_PADDING:15,MARGIN:7},GoToActions={GO_TO_PREV_PAGE:"previous",GO_TO_NEXT_PAGE:"next",GO_TO_FIRST_PAGE:"first",GO_TO_LAST_PAGE:"last",GO_TO_PAGE:"custom"},TEXT_WRAP_TYPES={WRAP:"wrap",CLIP:"clip"},CustomContentEvent={GO_TO_URL:"goToUrl",PAYPAL_POPIN:"paypalPopin",SHOW_CUSTOM_TOOLTIP:"showCustomTooltip",HIDE_CUSTOM_TOOLTIP:"hideCustomTooltip",MOVE_CUSTOM_TOOLTIP:"moveCustomTooltip",PLAY_AUDIO:"playAudio",STOP_AUDIO:"stopAudio",AUDIO_STARTED:"audioStarted",AUDIO_STOPPED:"audioStopped",CAPTION_OPENED:"captionOpened",CAPTION_CLOSED:"captionClosed",CUSTOM_CONTENT_CLICK:"customContentClick",VIDEO_EMBED_SIZE:"videoEmbedSize",SHOW_CUSTOM_INTERACTION_POPIN:"showCustomInteractionPopin",HIDE_CUSTOM_INTERACTION_POPIN:"hideCustomInteractionPopin",TOGGLE_CUSTOM_INTERACTION_POPIN:"toggleCustomInteractionPopin",CUSTOM_INTERACTION_POPIN_DISPLAYED:"customInteractionPopinDisplayed",CUSTOM_INTERACTION_POPIN_HIDDEN:"customInteractionPopinHidden"},CustomContentTemplates={button:'<a class="btn"><div class="ico" /><div class="label" /></a><div class="hover" />',videoIframe:'<% if (src) { %><% if (provider !== "other") { %><iframe style="display: block" src="<%= src %>" frameborder="0" <% if (width) { %>width="<%= width %>"<% } %><% if (height) { %>height="<%= height %>"<% } %>></iframe><% } else { %><video <%= params %> src="<%= src %>" poster="<%= poster %>" disablepictureinpicture controlslist="nodownload" <% if (width) { %>width="100%"<% } %><% if (height) { %>height="100%"<% } %>/><% } %><% } %>',text:'<a class="no-decoration"><div class="inner"><%- text %></div></a>',textBox:'<a class="no-decoration"><div class="inner"><%= textContent %></div></a>',shape:'<a><div style=""></div></a>',interaction:'<a class="interaction-link" />',tag:'<div class="tag"><div class="color-ring" /><img class="image" /><iframe class="video" /></div>',productTag:'<div class="tag product-tag"><div class="color-ring"><div class="inner-tag" /></div></div>',tagTooltip:'<div class="content"><div class="content-media"><div class="tooltip-img"><img /><div class="play-btn"><div /></div></div><div class="tooltip-title" /></div><div class="content-text"><div class="tooltip-text" /><div class="tooltip-link"><a /></div></div></div><div class="arrow" />',hiperLink:'<div class="hiperlink" />',tooltip:'<div class="content"><span class="tooltip-text"><%- tooltipText %></span></div>',galleryItem:"<div></div>",paypalPopin:'<div class="content"><div class="slideshow"><div class="slider"></div><a class="prev"></a><a class="next"></a></div><div class="info"><div class="popin-title shortTitle"><%- item_name %></div><div class="popin-title longTitle"><%- item_name %></div><div class="price"><label>Price:</label> <b><%- currencySign %><%- price %></b></div><div class="stock"><span class="success">In stock</span><span class="error">Out of stock</span></div><div class="description"><%- item_description %></div><form class="orderForm" action=""><label>Quantity:</label><input class="input-text quantity" type="number" value="1" min="1" name="quantity"><span class="error smaller-text quantityError">Quantity must be 1 or greater.</span></form><div class="shippingCost">Shipping cost not included.</div><div class="paypalDelivery">Delivery time: <%- delivery %> days.</div><div><a class="btn-contact">Contact seller</a><a class="btn-paypal"></a></div></div></div><form class="content gray contact-form"><div class="title">Contact seller</div><div class="row"><div class="col col1"><label>Your email:</label></div><div class="col col2"><input type="text" class="emailAddress" name="email" value="" placeholder="name@address.com"></div><div class="col col3 smaller-text"><span class="error emailAddressError">Invalid email address.</span></div></div><div class="row"><div class="col col1"><label>Message:</label></div><div class="col col2"><textarea class="mailMessage" placeholder="Message goes here..."></textarea></div><div class="col col3 smaller-text"><span class="error mailMessageError">Specify message.</span></div></div><div class="infoMessageSent smaller-text success">Message sent</div><a class="btn sendMail">SEND</a></form>',embedPlaceHolder:'<div class="embed-icon"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="40" viewBox="0 0 54 40"><path fill="#6F7685" fill-rule="evenodd" d="M6.963 20.053L18 25.349v7.378L0 23.11v-6.218l18-9.618v7.378L6.963 20.053zM24.28 40H18L29.824 0H36L24.28 40zm22.488-20.053L36 14.598V7.273l18 9.618v6.192l-18 9.644v-7.352l10.768-5.428z"/></svg></div>',embedIframe:'<iframe width="100%" height="100%" type="text/html" sandbox="allow-scripts allow-same-origin allow-presentation allow-forms" src="<%- baseUrl %><%- htmlSources %>iframeContainer.html?iframe=<%- content %>" frameborder="0" fs="0"></iframe>',interactionPopin:'<div class="content"><div class="interaction-popin-title"><%- interaction.title %></div><div class="interaction-popin-description"><%= interaction.description %></div><div class="interaction-popin-img"><img /><div class="play-btn"><div /></div></div><div class="interaction-popin-video" /></div>'},CustomContentView=Backbone.View.extend({className:"custom-content",initialize:function(){this.elements=[],this.audioPlayer=null,this.listenTo(this.model,"change",this.onModelChange),this.countLoadedElements=0,this.customInteractionPopin=null,this.isDoublePageLayout=FSWidgetModel.gi().flipCollection.get("isDoublePageLayout"),this.isSinglePageLayout=FSWidgetModel.gi().widgetSettings.get("contentLayout")===ContentLayout.SINGLE_PAGE,this.isSmartViewLayout=FSWidgetModel.gi().widgetSettings.get("contentLayout")===ContentLayout.SMART_VIEW,this.offsetX=0,this.offsetY=0,Backbone.Mediator.sub("click",this.hideCustomInteractionPopin,this)},render:function(){var generatedElem,interaction,a=this.model.attributes,self=this,oldEditorScaling=this.model.get("oldEditorScaling"),hasCustomInteractionPopin=!1,realScale=this.model.get("pageWidth")/this.model.get("pageModel").get("width"),interactionModel={},pageValues=this.calculatePageValues();return this.setPosition(),_.each(a.elements,function(elem,index){var isPublisher=FSWidgetModel.gi().get("collectionData").publisher,premiumLayouts=FSWidgetModel.gi().get("premiumLayouts"),pageId=elem.pid||a.pageModel.get("pID");!FSUtils.hasAccessToElement(elem,FSWidgetModel.gi().get("collectionData").features)||elem.layoutID&&!FSUtils.elementCanBeDisplayed(elem.layoutID,premiumLayouts,isPublisher)||(elem.elementPageIndex=a.page,elem.pid=pageId,elem.index=index,elem.scale=a.scale,elem.oldEditorScaling=oldEditorScaling,elem.currentPageWidth=pageValues.currentPageWidth,elem.currentPageHeight=pageValues.currentPageHeight,elem.pageOffset={x:self.offsetX,y:self.offsetY},elem.pageNumber=self.model.get("page")+1,elem.sourcePage===SourcePage.LEFT&&pageValues.leftPageData&&(elem.leftPageData={offset:pageValues.leftPageOffset,size:pageValues.leftPageSize},elem.scale=pageValues.leftPageData.scale,elem.oldEditorScaling=pageValues.leftPageData.oldEditorScaling),elem.sourcePage===SourcePage.RIGHT&&pageValues.rightPageData&&(elem.rightPageData={offset:pageValues.rightPageOffset,size:pageValues.rightPageSize},elem.scale=pageValues.rightPageData.scale,elem.oldEditorScaling=pageValues.rightPageData.oldEditorScaling),pageValues.leftPageData&&(elem.leftPageWidth=pageValues.leftPageSize.width*pageValues.leftPageData.scale),(generatedElem=self.generateElement(elem,a.imageElements))&&(self.elements.push(generatedElem),self.$el.append(generatedElem.render().$el),interactionModel=_.extend({realScale:realScale},generatedElem.model.attributes),(interaction=self.setInteraction(interactionModel))&&(self.elements.push(interaction),self.$el.append(interaction.render().$el),generatedElem.model.attributes.interaction.interactionType===InteractOptions.POPIN&&(hasCustomInteractionPopin=!0),hasCustomInteractionPopin&&(self.listenTo(interaction,CustomContentEvent.SHOW_CUSTOM_INTERACTION_POPIN,self.showCustomInteractionPopin),self.listenTo(interaction,CustomContentEvent.HIDE_CUSTOM_INTERACTION_POPIN,self.hideCustomInteractionPopin),self.listenTo(interaction,CustomContentEvent.TOGGLE_CUSTOM_INTERACTION_POPIN,self.toggleCustomInteractionPopin)))))}),hasCustomInteractionPopin&&(this.customInteractionPopin=new InteractionPopin({model:new InteractionPopinModel}),this.$el.append('<div class="interaction-popin-container" />'),this.$el.find(".interaction-popin-container").append(this.customInteractionPopin.render().$el)),0===a.imageElements&&this.displayPageElements(ContentLoaderStatus.COMPLETE),this},displayPageElements:function(status){status!==ContentLoaderStatus.COMPLETE&&status!==ContentLoaderStatus.ERROR||this.model.set("status",ContentLoaderStatus.COMPLETE)},onModelChange:function(){this.setPosition()},setPosition:function(){var newSize=FSUtils.calculateScaledSize(this.model.get("pageModel").get("width"),this.model.get("pageModel").get("height"),this.model.get("pageWidth"),this.model.get("pageHeight"),!0);this.offsetX=(this.model.get("pageWidth")-newSize.width)/2,this.offsetY=(this.model.get("pageHeight")-newSize.height)/2;var css={width:newSize.width+"px",height:newSize.height+"px",top:(this.model.get("pageHeight")-newSize.height)/2+"px",left:(this.model.get("pageWidth")-newSize.width)/2+"px"};this.$el.css(css)},setInteraction:function(elementAttributes){if(elementAttributes.interaction&&elementAttributes.interaction.interactionType)return new InteractionView({model:new InteractionModel(elementAttributes)})},generateElement:function(element,imageElements){var view=!1;switch(element.type){case ElementType.FORM:case ElementType.GROUP:break;case ElementType.TAG:element.tagType=parseInt(element.tagType,10),view=new TagView({model:new ButtonModel(element)});break;case ElementType.VIDEO:view=new VideoWidgetView({model:new ButtonModel(element)});break;case ElementType.PLAY:view=new VideoButtonView({model:new ButtonModel(element)});break;case ElementType.TEXT:view=new TextView({model:new TextModel(element)});break;case ElementType.TEXT_BOX:view=new TextBoxView({model:new TextBoxModel(element)});break;case ElementType.SHAPES:view=new ShapeView({model:new ButtonModel(element)});break;case ElementType.IMAGE:var imageModel=new ImageElementModel(element);this.listenTo(imageModel,"change:status",function(){this.countLoadedElements++,this.countLoadedElements===imageElements&&this.displayPageElements(imageModel.get("status"))}),view=new ImageElementView({model:imageModel});break;case ElementType.AUDIO:view=new AudioButton({model:new ButtonModel(element)}),this.audioPlayer=AudioPlayer.gi();break;case ElementType.MASKED:view=new ImageMaskView({model:new ImageMaskModel(element)});break;case ElementType.EMBED:view=new EmbedElemetView({model:new EmbedElementModel(element)});break;case ElementType.PRODUCT_TAG:view=new ProductTagView({model:new ProductTagModel(element)});break;default:if(FSWidgetModel.gi().get("isDownload")&&_.contains([ElementType.PAYPAL,ElementType.PAYPAL_TOOLTIP],element.type))break;view=new CustomButton({model:new ButtonModel(element)})}return view},hide:function(){this.$el.hide()},resize:function(scale){if(this.model.get("scale")!==scale){var self=this,realScale=this.model.get("pageWidth")/this.model.get("pageModel").get("width"),pageValues=this.calculatePageValues();this.model.set({currentPageWidth:this.model.get("pageWidth"),currentPageHeight:this.model.get("pageHeight"),scale:scale}),_.each(this.elements,function(elem){var interaction=elem.model.get("interaction"),pageScale=scale;elem.model.set({currentPageWidth:self.model.get("pageWidth"),currentPageHeight:self.model.get("pageHeight"),pageOffset:{x:self.offsetX,y:self.offsetY}}),elem.model.get("sourcePage")===SourcePage.LEFT&&pageValues.leftPageData&&(pageScale=pageValues.leftPageData.scale,elem.model.set({oldEditorScaling:pageValues.leftPageData.oldEditorScaling,leftPageData:{offset:pageValues.leftPageOffset,size:pageValues.leftPageSize}})),elem.model.get("sourcePage")===SourcePage.RIGHT&&pageValues.rightPageData&&(pageScale=pageValues.rightPageData.scale,elem.model.set({oldEditorScaling:pageValues.rightPageData.oldEditorScaling,rightPageData:{offset:pageValues.rightPageOffset,size:pageValues.rightPageSize}})),elem.resize(pageScale),interaction&&(elem.model.set("realScale",realScale,{silent:!0}),interaction.interactionType===InteractOptions.POPIN&&self.customInteractionPopin&&elem.cid===self.customInteractionPopin.model.get("cid")&&self.customInteractionPopin.model.set({realScale:realScale,scale:pageScale,x:elem.model.get("x"),y:elem.model.get("y"),w:elem.model.get("w"),h:elem.model.get("h")}))})}},remove:function(){_.each(this.elements,function(elem){elem.remove()}),this.elements=[],this.countLoadedElements=0,this.customInteractionPopin&&(this.customInteractionPopin.remove(),this.customInteractionPopin=null),Backbone.View.prototype.remove.apply(this,arguments)},empty:function(){this.$el.empty()},delegateEvents:function(){Backbone.View.prototype.delegateEvents.apply(this,arguments),_.each(this.elements,function(elem){elem.delegateEvents()})},start:function(turnState){var elem,i=0,len=this.elements.length;switch(turnState=turnState||"turning"){case"turning":break;case"end":this.delegateEvents()}for(;i<len;i++)"function"==typeof(elem=this.elements[i]).start&&elem.start(turnState)},stop:function(){for(var elem,i=0,len=this.elements.length;i<len;i++)"function"==typeof(elem=this.elements[i]).stop&&elem.stop()},showCustomInteractionPopin:function(data){this.customInteractionPopin&&(this.customInteractionPopin.model.get("isDisplayed")&&this.customInteractionPopin.model.get("cid")!==data.cid&&this.customInteractionPopin.hide(),this.customInteractionPopin.model.get("isDisplayed")||(this.customInteractionPopin.model.set(data),this.customInteractionPopin.show()))},hideCustomInteractionPopin:function(){this.customInteractionPopin&&this.customInteractionPopin.hide()},toggleCustomInteractionPopin:function(data){this.customInteractionPopin&&(this.customInteractionPopin.model.get("isDisplayed")&&this.customInteractionPopin.model.get("cid")===data.cid?this.customInteractionPopin.hide():(this.customInteractionPopin.model.set(data),this.customInteractionPopin.show()))},calculatePageValues:function(){var leftPageOffset,leftPageSize,rightPageOffset,rightPageSize,originalFirstPageWidth=this.model.get("firstPageWidth"),originalFirstPageHeight=this.model.get("firstPageHeight"),originalPageWidth=this.model.get("pageModel").get("width"),originalPageHeight=this.model.get("pageModel").get("height"),currentPageWidth=this.model.get("pageWidth"),currentPageHeight=this.model.get("pageHeight"),leftPageData=this.model.get("leftPageModel"),rightPageData=this.model.get("rightPageModel");if(originalFirstPageWidth!==originalPageWidth||originalFirstPageHeight!==originalPageHeight){var newSize=FSUtils.calculateScaledSize(originalPageWidth,originalPageHeight,currentPageWidth,currentPageHeight,!0);this.offsetX=(currentPageWidth-newSize.width)/2,this.offsetY=(currentPageHeight-newSize.height)/2}if(leftPageData){var leftPageOriginalWidth=leftPageData.pageModel.get("width"),leftPageOriginalHeight=leftPageData.pageModel.get("height"),leftPageWidth=leftPageData.pageWidth,leftPageHeight=leftPageData.pageHeight;leftPageOffset={x:(leftPageWidth-(leftPageSize=FSUtils.calculateScaledSize(leftPageOriginalWidth,leftPageOriginalHeight,leftPageWidth,leftPageHeight,!0)).width)/2*leftPageData.widgetZoom,y:(leftPageHeight-leftPageSize.height)/2*leftPageData.widgetZoom},leftPageSize={width:leftPageSize.width*leftPageData.widgetZoom,height:leftPageSize.height*leftPageData.widgetZoom}}else if(rightPageData){var rightPageOriginalWidth=rightPageData.pageModel.get("width"),rightPageOriginalHeight=rightPageData.pageModel.get("height"),rightPageWidth=rightPageData.pageWidth,rightPageHeight=rightPageData.pageHeight;rightPageOffset={x:(rightPageWidth-(rightPageSize=FSUtils.calculateScaledSize(rightPageOriginalWidth,rightPageOriginalHeight,rightPageWidth,rightPageHeight,!0)).width)/2*rightPageData.widgetZoom,y:(rightPageHeight-rightPageSize.height)/2*rightPageData.widgetZoom},rightPageSize={width:rightPageSize.width*rightPageData.widgetZoom,height:rightPageSize.height*rightPageData.widgetZoom}}return{currentPageHeight:currentPageHeight,currentPageWidth:currentPageWidth,leftPageSize:leftPageSize,rightPageSize:rightPageSize,leftPageOffset:leftPageOffset,rightPageOffset:rightPageOffset,leftPageData:leftPageData,rightPageData:rightPageData}}});Backbone.Mediator.pub(WidgetEvent.CUSTOM_VIEW_LOADED);var CustomContentModel=Backbone.Model.extend({defaults:{scale:1,oldEditorScaling:1,type:0,x:0,y:0,w:0,h:0,ox:0,oy:0,ow:0,oh:0,status:ContentLoaderStatus.IDLE,sourcePage:"",pageWidth:0,offset:0,pageOffset:{x:0,y:0}},initialize:function(){var bounds=this.get("bounds").split(",");this.set({ox:parseFloat(bounds[0]),oy:parseFloat(bounds[1]),ow:parseFloat(bounds[2]),oh:parseFloat(bounds[3])},{silent:!0}),this.setBounds(),Backbone.Mediator.sub(WidgetEvent.RESIZE,this.setBounds,this)},setBounds:function(){var bounds={x:this.get("ox")*this.get("scale"),y:this.get("oy")*this.get("scale"),w:this.get("ow")*this.get("scale"),h:this.get("oh")*this.get("scale")},sourcePage=this.get("sourcePage");this.get("leftPageWidth")&&this.set("offset",-this.get("leftPageWidth")),sourcePage&&(sourcePage===SourcePage.LEFT&&this.get("leftPageData")?(bounds.x=this.get("ox")*this.get("scale")-this.get("pageOffset").x-this.get("leftPageData").size.width-this.get("leftPageData").offset.x,bounds.y=this.get("oy")*this.get("scale")-this.get("pageOffset").y+this.get("leftPageData").offset.y):sourcePage===SourcePage.RIGHT&&this.get("rightPageData")&&(bounds.x=this.get("currentPageWidth")+this.get("pageOffset").x+this.get("rightPageData").offset.x+this.get("ox")*this.get("scale"),bounds.y=this.get("oy")*this.get("scale")-this.get("pageOffset").y+this.get("rightPageData").offset.y),this.set("offset",-this.get("currentPageWidth"))),this.set(bounds)},destroy:function(){Backbone.Mediator.unsubscribe(WidgetEvent.RESIZE,this.setBounds,this)}}),ButtonModel=CustomContentModel.extend({defaults:{scale:1,oldEditorScaling:1,action:0,tooltip:!1,label:!1,color:"807F7D",alpha:1,url:"",icon:!1,state:"default",rotation:0,radius:DEFAULT_BORDER_RADIUS}}),CaptionModel=Backbone.Model.extend({defaults:{scale:1,textPosition:"left",x:0,y:0,w:0,h:0,tw:0,th:0,otw:0,oth:0},initialize:function(){var bounds=this.get("textboxSize").split(",");this.set("otw",bounds[0]),this.set("oth",bounds[1]),this.setBounds(),Backbone.Mediator.sub(WidgetEvent.RESIZE,this.setBounds,this)},setBounds:function(){this.set("tw",this.get("otw")*this.get("scale")),this.set("th",this.get("oth")*this.get("scale"))},destroy:function(){Backbone.Mediator.unsubscribe(WidgetEvent.RESIZE,this.setBounds,this)}}),ImageElementModel=ButtonModel.extend({defaults:_.extend({},ButtonModel.prototype.defaults,{src:"",subType:ImageElementType.UPLOAD,scaleMode:ImageElementScale.SCALE_CROP,rotation:0,radius:DEFAULT_BORDER_RADIUS,status:ContentLoaderStatus.IDLE}),getImageURL:function(src,type){var url="",accountId=FSWidgetModel.gi().get("accountId"),externalLibraryURL=FSUtils.getUserExternalLibraryURL(accountId);switch(type){case ImageElementType.UPLOAD:url=URLPaths.HYPERLINK_UPLOADED_IMAGES_PATH+src;break;case ImageElementType.STOCK:url=this.get("provider")?this.get("provider")===PhotoProviders.EXTERNAL?externalLibraryURL+src:URLPaths.HYPERLINK_PROVIDERS_IMAGES_PATH+src:URLPaths.HYPERLINK_STOCK_IMAGES_PATH+src;break;default:url=URLPaths.HYPERLINK_TEXTURE_IMAGES_PATH+src}return url}}),ImageMaskModel=ImageElementModel.extend({defaults:_.extend({},ImageElementModel.prototype.defaults,{shape:0,imageBounds:"",oimgx:0,oimgy:0,oimgw:0,oimgh:0,imgx:0,imgy:0,imgw:1,imgh:1}),initialize:function(){var imgBounds=this.get("imageBounds").split(",");this.set({oimgx:parseInt(imgBounds[0],10),oimgy:parseInt(imgBounds[1],10),oimgw:parseInt(imgBounds[2],10),oimgh:parseInt(imgBounds[3],10)},{silent:!0}),ImageElementModel.prototype.initialize.apply(this,arguments)},setBounds:function(){this.set({imgx:this.get("oimgx")*this.get("scale"),imgy:this.get("oimgy")*this.get("scale"),imgw:this.get("oimgw")*this.get("scale"),imgh:this.get("oimgh")*this.get("scale")}),ImageElementModel.prototype.setBounds.apply(this,arguments)}}),InteractionModel=CustomContentModel.extend({}),InteractionPopinModel=CustomContentModel.extend({defaults:{isDisplayed:!1},initialize:function(){this.processText(),this.listenTo(this,"change",this.processText)},processText:function(){var interaction=this.get("interaction");interaction&&interaction.description&&interaction.description.length&&(interaction.description=interaction.description.replace(/\n/gi,"<br>"),this.set("interaction",interaction,{silent:!0}))}}),EmbedElementModel=CustomContentModel.extend({defaults:{scale:1,action:101,alpha:1,rotation:0}}),TextModel=ButtonModel.extend({initialize:function(){this.set({oFontSize:this.get("fontSize"),lineHeight:this.get("lineHeight")||0===this.get("lineHeight")?this.get("lineHeight"):DEFAULT_TEXT_LINE_HEIGHT,letterSpacing:this.get("letterSpacing")||0===this.get("letterSpacing")?this.get("letterSpacing"):DEFAULT_TEXT_LETTER_SPACING},{silent:!0}),ButtonModel.prototype.initialize.apply(this,arguments)},setBounds:function(){ButtonModel.prototype.setBounds.apply(this,arguments),this.set({fontSize:this.get("oFontSize")*this.get("scale")})}}),TextBoxModel=TextModel.extend({setBounds:function(){ButtonModel.prototype.setBounds.apply(this,arguments),this.get("oFontSize")&&this.set({fontSize:this.get("oFontSize")})}}),ProductTagModel=CustomContentModel.extend({defaults:{action:29,color:"4e5565",alpha:1,rotation:0,title:"",description:"",price:"",discountPrice:"",url:"",buttonLabel:""}}),VideoEmbedModel=Backbone.Model.extend({defaults:{autoPlay:0,width:0,height:0,youtubeIframeURL:"https://www.youtube.com/embed/",youtubeVideoHash:"",youtubeVideoParams:"?wmode=opaque&fs=0",vimeoIframeUrl:"https://player.vimeo.com/video/",vimeoVideoID:"",vimeoVideoParams:"?api=1&player_id=fs_videoPlayerIframe_",mobile:0,poster:""},initialize:function(){this.set({provider:FSUtils.getVideoProvider(this.get("url")),hash:FSUtils.getVideoHash(this.get("url")),extraParams:FSUtils.getVideoExtraParams(this.get("url")),autoPlay:FSUtils.getVideoParam(FSUtils.getVideoExtraParams(this.get("url")),"autoplay"),mobile:FSUtils.isMobileDevice()},{silent:!0}),this.set({src:this.getSrc(),params:this.getParamsForHtml5()},{silent:!0})},valid:function(){return this.get("provider")===VideoProvider.OTHER?this.has("src"):this.get("hash")&&this.get("hash").length>0&&this.has("src")&&!1!==this.get("src")},getParamsForHtml5:function(){var paramsString,validParams,htmlParams="",withOptions=0;return this.get("provider")!==VideoProvider.OTHER?"":(paramsString=FSUtils.getVideoExtraParams(this.get("url")).split("&"),validParams=["muted","autoplay","loop","controls"],paramsString.forEach(function(p){var param=p.split("=");validParams.includes(param[0])&&(withOptions+=1,parseInt(param[1],10)>0&&(htmlParams+=param[0]+" "))}),withOptions<4&&(htmlParams+=" controls"),htmlParams)},getSrc:function(){var src="";switch(this.get("provider")){case VideoProvider.YOUTUBE:src=this.get("youtubeIframeURL")+this.get("hash")+this.get("youtubeVideoParams")+"&"+this.get("extraParams")+"&enablejsapi=1";break;case VideoProvider.VIMEO:src=this.get("vimeoIframeUrl")+this.get("hash")+this.get("vimeoVideoParams")+"&"+this.get("extraParams");break;case VideoProvider.OTHER:src=this.get("url")}return!!src&&src+(1===this.get("autoPlay")?"&autoplay=1":"")}}),CustomTooltipView=Backbone.View.extend({template:_.template(CustomContentTemplates.tooltip),className:"custom-tooltip",initialize:function(){Backbone.Mediator.sub(CustomContentEvent.SHOW_CUSTOM_TOOLTIP,this.showTooltip,this),Backbone.Mediator.sub(CustomContentEvent.HIDE_CUSTOM_TOOLTIP,this.hideTooltip,this),Backbone.Mediator.sub(CustomContentEvent.MOVE_CUSTOM_TOOLTIP,this.moveTooltip,this),Backbone.Mediator.sub(WidgetEvent.PAGE_CHANGED,this.hideTooltip,this),Backbone.Mediator.sub(WidgetEvent.ITEM_CHANGED,this.hideTooltip,this)},render:function(tooltipText){return this.$el.html(tooltipText),this},showTooltip:function(text){this.render(text),this.$el.show()},hideTooltip:function(){this.$el.hide()},moveTooltip:function(e){var docView=$("#docView");this.$el.css({top:e.pageY+20,left:e.pageX+15}),this.$el.offset().top+this.$el.outerHeight()>docView.offset().top+docView.outerHeight()&&this.$el.css({top:e.pageY-this.$el.outerHeight()-20}),this.$el.offset().left+this.$el.outerWidth()>docView.offset().left+docView.outerWidth()&&this.$el.css({left:e.pageX-this.$el.outerWidth()-15})}}),GalleryImage=Backbone.View.extend({initialize:function(src){this.src=src},render:function(){return this.$el.css({backgroundImage:"url("+this.src+")"}),this}}),PaypalPopin=Backbone.View.extend({template:_.template(CustomContentTemplates.paypalPopin),className:"paypal-content",events:{"click .btn-contact":"showContactForm","click .sendMail":"sendMail","click .prev":"prevImg","click .next":"nextImg","change .quantity":"checkQuantity","change .emailAddress":"checkEmailAddress","change .mailMessage":"checkMailMessage","keydown .quantity":"onKeyDownQuantity","focus .emailAddress":"onFocusEmailAddress","focus .mailMessage":"onFocusMailMessage","keydown .emailAddress":"onKeyDown","keydown .mailMessage":"onKeyDown","click .btn-paypal":"sendPaypalRequest"},initialize:function(attributes){this.attributes=attributes,this.listenTo(FSWidgetModel.gi().widgetState,"change:displayState",this.onExitFullScreen)},render:function(){switch(this.attributes.currency){case"EUR":this.attributes.currencySign="€";break;case"GBP":this.attributes.currencySign="£";break;default:this.attributes.currencySign="$"}return this.$el.html(this.template(this.attributes)),this.attributes.stock>0?(this.$el.find(".stock .error").hide(),this.$el.find(".stock .success").show()):(this.$el.find(".stock .error").show(),this.$el.find(".stock .success").hide()),1!==parseInt(this.attributes.contact,10)&&this.$el.find(".btn-contact").addClass("hidden"),this.sellerEmail=this.attributes.business,this.productName=this.attributes.item_name,this.price=this.attributes.price,this.currency=this.attributes.currency,this.paypalHash=this.attributes.hash,this.quantity=1,this.error=!1,this.setGallery(),this},setGallery:function(){var images,img,i,slider=this.$el.find(".slider");if(void 0!==this.attributes.images&&0!==this.attributes.images.length&&(images=this.attributes.images.split(","),this.imagesCount=images.length,this.currentImage=1,this.imagesCount>0)){for(slider.css({width:100*this.imagesCount+"%"}),i=0;i<this.imagesCount;i++)img=new GalleryImage(FlipSnackEmbed.urls.uploadPath+images[i]),slider.append(img.render().$el);this.imagesCount>1&&this.$el.find("a").show()}},prevImg:function(){this.currentImage>1&&(this.currentImage--,this.$el.find(".slider").animate({left:this.$el.find(".slideshow").width()*(this.currentImage-1)*-1}),this.$el.find(".next").css({opacity:1}),1===this.currentImage&&this.$el.find(".prev").css({opacity:.4}))},nextImg:function(){this.currentImage<this.imagesCount&&(this.currentImage++,this.$el.find(".slider").animate({left:this.$el.find(".slideshow").width()*(this.currentImage-1)*-1}),this.$el.find(".prev").css({opacity:1}),this.currentImage===this.imagesCount&&this.$el.find(".next").css({opacity:.4}))},setContent:function(html){},showModal:function(){Backbone.Mediator.pub(WidgetEvent.POPIN_OPEN,this.render().el)},showContactForm:function(){this.$el.find(".contact-form").slideToggle()},sendMail:function(){var contactForm,validEmail=this.checkEmailAddress(),validMsg=this.checkMailMessage();validEmail&&validMsg&&(Backbone.Mediator.pub(WidgetEvent.SEND_SQS_MAIL,{fromEmail:this.$el.find(".emailAddress").val(),message:this.$el.find(".mailMessage").val(),toEmail:this.attributes.business,productName:this.attributes.item_name,collectionHash:FSWidgetModel.gi().get("collectionHash"),collectionTitle:FSWidgetModel.gi().get("collectionData").title}),this.$el.find(".infoMessageSent").show(),contactForm=this.$el.find(".contact-form"),setTimeout(function(){contactForm.slideUp(),contactForm.find(".infoMessageSent").hide(),contactForm.find(".mailMessage").val("")},1e3))},checkEmailAddress:function(){var email=this.$el.find(".emailAddress").val();return email&&email.length>0&&FSUtils.isEmailValid(email)?(this.$el.find(".emailAddress").removeClass("error"),this.$el.find(".emailAddressError").hide(),!0):(this.$el.find(".emailAddress").addClass("error"),this.$el.find(".emailAddressError").show(),!1)},checkMailMessage:function(){var msg=this.$el.find(".mailMessage").val();return msg&&msg.length>0?(this.$el.find(".mailMessage").removeClass("error"),this.$el.find(".mailMessageError").hide(),!0):(this.$el.find(".mailMessage").addClass("error"),this.$el.find(".mailMessageError").show(),!1)},checkQuantity:function(){var i,quantity=this.$el.find(".quantity"),quantityError=this.$el.find(".quantityError"),orderForm=this.$el.find(".orderForm"),val=quantity.val();for(this.error=!1,i=0;i<val.length;i++)"0"===val[i]&&"0"!==val[i]&&(val=val.split(val[i],val.substring(1,val.length))[1]);return quantity.val(parseInt(val,10)),this.quantity=parseInt(val,10),parseInt(val,10)>0&&!isNaN(val)&&parseInt(val,10)<=parseInt(this.attributes.stock,10)?(quantity.removeClass("error"),quantityError.hide(),orderForm.removeClass("error"),!0):(0!==parseInt(val,10)&&val?parseInt(val,10)>parseInt(this.attributes.stock,10)&&quantityError.html("Not enough in stock"):quantityError.html("Quantity must be 1 or more."),quantity.addClass("error"),quantityError.show(),orderForm.addClass("error"),this.error=!0,!1)},onExitFullScreen:function(){FSWidgetModel.gi().widgetState.get("displayState")===DisplayState.NORMAL&&Backbone.Mediator.pub(WidgetEvent.POPIN_CLOSE)},onKeyDownQuantity:function(e){this.onKeyDown(e),37!==e.keyCode&&39!==e.keyCode&&8!==e.keyCode&&46!==e.keyCode&&(e.keyCode<48||e.keyCode>105||e.keyCode>57&&e.keyCode<96)&&e.preventDefault(),e.stopPropagation()},onKeyDown:function(e){13===e.keyCode&&e.preventDefault(),e.stopPropagation()},onFocusEmailAddress:function(){var emailAddress=this.$el.find(".emailAddress");emailAddress.hasClass("error")&&(emailAddress.removeClass("error"),this.$el.find(".emailAddressError").hide())},onFocusMailMessage:function(){var mailMessage=this.$el.find(".mailMessage");mailMessage.hasClass("error")&&(mailMessage.removeClass("error"),this.$el.find(".mailMessageError").hide())},sendPaypalRequest:function(){var url=URLPaths.PAYPAL_URL;return!this.error&&(url+="?"+("cmd=_xclick&business="+encodeURIComponent(this.sellerEmail)+"&item_name="+encodeURIComponent(this.productName.replace(/[^a-zA-Z0-9\s]+/g,""))+"&amount="+encodeURIComponent(this.price)+"&currency_code="+encodeURIComponent(this.currency)+"&quantity="+encodeURIComponent(this.quantity)+"&notify_url="+encodeURIComponent(URLPaths.PAYPAL_NOTIFY_URL)+"&custom="+encodeURIComponent(URLPaths.collectionHashId+","+this.paypalHash)),window.open(url,"_blank"),!0)}}),CustomButton=Backbone.View.extend({events:function(){return FSUtils.isMobileDevice()?{"touchend .btn":"onClick"}:{"click .btn":"onClick","click .hover":"onClick","mouseover .btn":"mouseOver","mouseover .hover":"mouseOver","mousemove .btn":"mouseMove","mousemove .hover":"mouseMove","mouseout .btn":"mouseOut","mouseout .hover":"mouseOut"}},template:_.template(CustomContentTemplates.button),className:"customBtn custom-element",initialize:function(){var type=this.model.get("type"),tooltip=this.model.get("tooltip"),tooltipButtons=[ElementType.CART_TOOLTIP,ElementType.PAYPAL_TOOLTIP,ElementType.CREDIT_CARD_TOOLTIP,ElementType.CART_WITH_LABEL,ElementType.CREDIT_CARD_WITH_LABEL];this.isMobileDevice=FSUtils.isMobileDevice(),this.tooltip=tooltip&&""!==tooltip,this.$button=void 0,this.$hover=void 0,this.tooltip&&tooltipButtons.indexOf(type)>=0&&(this.model.set("label",tooltip),this.tooltip=!1),this.listenTo(this.model,"change:state",this.setIcon),this.listenTo(this.model,"change:w",this.onModelChangeWidth),this.listenTo(this.model,"change:h",this.onModelChangeHeight),Backbone.Mediator.sub(WidgetEvent.RESIZE,this.onResize,this)},isGoToUrlAction:function(notEmptyUrl){var isGoToUrlAction=this.model.get("action")===LinkAction.GO_TO_URL;return void 0!==notEmptyUrl&&notEmptyUrl?isGoToUrlAction&&""!==this.model.get("url"):isGoToUrlAction},isGoToProfileAction:function(){return this.model.get("action")===LinkAction.GO_TO_FLIPSNACK_PROFILE},setLinkUrl:function(){var isGoToUrlAction=this.isGoToUrlAction(!0),isGoToProfileAction=this.isGoToProfileAction();(isGoToUrlAction||isGoToProfileAction)&&(isGoToUrlAction?this.$el.find("a.btn").attr({href:this.model.get("url"),target:this.model.get("target")||"_blank",rel:"nofollow noopener noreferrer"}):isGoToProfileAction&&this.$el.find("a.btn").attr({href:FlipSnackEmbed.urls.siteURL+"/"+this.model.get("username")+"/",target:"_blank"}))},render:function(){var borderRadius=this.model.get("radius")+"px";return this.$el.html(this.template(this.model.attributes)).css(this.getCssObj()),"rounded"===this.model.get("shape")&&(this.$el.addClass("rounded"),borderRadius="50%"),this.$button=this.$el.find(".btn"),this.$hover=this.$el.find(".hover"),this.$button.css({background:"rgba("+this.hexToRgba(this.model.get("color"),this.model.get("alpha"))+")",height:"100%",borderRadius:borderRadius}),this.setLinkUrl(),this.model.get("action")===LinkAction.CAPTION&&this.$el.addClass("caption-button"),this.setHover(),this.setIcon(),this},getCssObj:function(){var style={left:this.model.get("x"),top:this.model.get("y"),width:this.model.get("w"),height:this.model.get("h")};return this.model.get("action")!==LinkAction.CAPTION&&(style.opacity=this.model.get("alpha")||0===this.model.get("alpha")?this.model.get("alpha"):1),style},hexToRgba:function(hex,a){var fullHex=3===hex.length?hex[0]+hex[0]+hex[1]+hex[1]+hex[2]+hex[2]:hex,bigint=parseInt(fullHex,16);return(bigint>>16&255)+","+(bigint>>8&255)+","+(255&bigint)+","+a},setIcon:function(){var sl,_this,icon=this.model.get("icon"),state=this.model.get("state"),iconId=icon&&icon[state]&&icon[state].id?"icon_"+icon[state].id:null;this.model.get("type")!==ElementType.OUTLINE&&iconId?SvgLoader.getLoadedIcons()[iconId]?this.renderIcon($(SvgLoader.getLoadedIcons()[iconId])):(sl=new SvgLoader(iconId),_this=this,sl.loadSVG(_this,function(svgString){SvgLoader.addLoadedIcon(iconId,svgString),_this.renderIcon($(svgString))})):this.$el.find(".ico").empty()},renderIcon:function(ico){ico.css({fill:"ffffff"===this.model.get("color")||"fff"===this.model.get("color")?"#000":"#fff",opacity:this.model.get("alpha")||0===this.model.get("alpha")?this.model.get("alpha"):1}),this.$el.find(".ico").empty().append(ico),this.model.get("label")&&this.setIconSize(),this.setLabel(),this.model.get("label")&&this.setIconLeft()},setIconSize:function(){this.$el.find(".ico").css("width",this.getIconSize()+"px")},getIconSize:function(){var scale=Math.min(this.model.get("w")/EDITOR_DEFAULTS.CUSTOM_BUTTON_WITH_LABEL_DEFAULT_WIDTH,this.model.get("h")/EDITOR_DEFAULTS.CUSTOM_BUTTON_WITH_LABEL_DEFAULT_HEIGHT)*EDITOR_DEFAULTS.CUSTOM_BUTTON_WITH_LABEL_DEFAULT_ICON_SIZE;return Math.ceil(EDITOR_DEFAULTS.CUSTOM_BUTTON_WITH_LABEL_DEFAULT_WIDTH*scale)},setLabel:function(){var label=this.model.get("label");label?(this.$el.find(".label").css({fontFamily:"Arial",lineHeight:this.model.get("h")+"px",color:"ffffff"===this.model.get("color")?"#000":"#fff"}).append(label),this.setPadding(),this.setFontSize(),this.$el.addClass("with-label")):this.$el.find(".label").remove()},getFontSize:function(){var fontSize=[ElementType.CART_WITH_LABEL,ElementType.CREDIT_CARD_WITH_LABEL].indexOf(this.model.get("type"))>-1?EDITOR_DEFAULTS.CUSTOM_BUTTON_WITH_NEW_LABEL_DEFAULT_FONT_SIZE:EDITOR_DEFAULTS.CUSTOM_BUTTON_WITH_LABEL_DEFAULT_FONT_SIZE;return Math.min(this.model.get("w")/EDITOR_DEFAULTS.CUSTOM_BUTTON_WITH_LABEL_DEFAULT_WIDTH,this.model.get("h")/EDITOR_DEFAULTS.CUSTOM_BUTTON_WITH_LABEL_DEFAULT_HEIGHT)*fontSize},setFontSize:function(){this.$el.find(".label").css("font-size",this.getFontSize()+"px")},getPadding:function(){return Math.ceil(Math.min(this.model.get("w"),this.model.get("h"))/2*2.4)},setPadding:function(){this.$el.find(".label").css("padding-left",this.getPadding()+"px")},getIconLeft:function(){return Math.min(this.$el.find(".ico svg").outerWidth(),this.$el.find(".ico svg").outerHeight())/2},setIconLeft:function(){this.$el.find(".ico").css("left",parseInt(this.getIconLeft()+"px",10))},onClick:function(){var selectedPage,newPageIndex,model,fnc,a=this.model.attributes,totalPages=FSWidgetModel.gi().widgetState.get("currentItem").get("noOfPages");switch(a.action){case LinkAction.GO_TO_URL:Tracker.ga(FSWidgetModel.gi().get("collectionHash"),"Click","Page "+(a.elementPageIndex+1)+": "+a.url,a.eID);break;case LinkAction.PAYPAL:FSWidgetModel.gi().widgetState.get("displayState")!==DisplayState.FULLSCREEN&&Backbone.Mediator.pub(WidgetEvent.ENTER_FULLSCREEN),this.popin&&(this.popin.remove(),this.popin=null),this.popin=new PaypalPopin(a),this.popin.showModal();break;case LinkAction.GO_TO_PREV_PAGE:Backbone.Mediator.pub(WidgetEvent.PREV_PAGE);break;case LinkAction.GO_TO_NEXT_PAGE:Backbone.Mediator.pub(WidgetEvent.NEXT_PAGE);break;case LinkAction.GO_TO_FIRST_PAGE:Backbone.Mediator.pub(WidgetEvent.CHANGE_PAGE,0);break;case LinkAction.GO_TO_LAST_PAGE:Backbone.Mediator.pub(WidgetEvent.CHANGE_PAGE,totalPages-1);break;case LinkAction.GO_TO_PAGE:selectedPage=parseInt(a.page||1,10)-1,newPageIndex=FSWidgetModel.gi().singlePageView||selectedPage%2!=0?selectedPage:selectedPage-1,newPageIndex=Math.min(Math.max(0,newPageIndex),totalPages-1),FSWidgetModel.gi().arabicStyle&&(newPageIndex=totalPages-newPageIndex-1),Backbone.Mediator.pub(WidgetEvent.CHANGE_PAGE,newPageIndex);break;case LinkAction.DOWNLOAD_PDF:if(FlipSnackEmbed.isEditor)return model=new Backbone.Model({action:"download"}),FSWidgetModel.gi().sendMessage(model),!1;this.registerDownloadEvent(),fnc="getCollectionDownloadLink",window.open(FSWidgetModel.gi()[fnc](),"_blank");break;case LinkAction.CAPTION:this.setCaptionState();break;case LinkAction.SEND_EMAIL:a.email&&Backbone.Mediator.pub(WidgetEvent.SEND_EMAIL,a.email)}return this.registerClickEvent(),this.sendClickNotification(),!0},registerDownloadEvent:function(){var collectionHasMergePdfs=FSWidgetModel.gi().widgetSettings.get("mergePdfs"),collectionHasOneItem=1===FSWidgetModel.gi().flipCollection.get("noOfItems"),eventType=collectionHasMergePdfs||collectionHasOneItem?Stats.TYPE.DOWNLOAD_COLLECTION:Stats.TYPE.DOWNLOAD_ITEM;Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:eventType})},registerClickEvent:function(){Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:Stats.TYPE.CLICK_ELEMENT,pid:this.model.get("pid"),elid:this.model.get("eID")})},sendClickNotification:function(){Backbone.Mediator.pub(CustomContentEvent.CUSTOM_CONTENT_CLICK,this.model)},setCaptionState:function(){"default"===this.model.get("state")?(this.model.set("state","active"),this.showCaption()):(this.model.set("state","default"),this.hideCaption())},mouseOver:function(e){!this.isMobileDevice&&this.tooltip&&(this.model.get("type")!==ElementType.OUTLINE||this.model.get("type")===ElementType.OUTLINE&&this.model.get("action")===LinkAction.GO_TO_FLIPSNACK_PROFILE)&&(this.mouseMove(e),Backbone.Mediator.pub(CustomContentEvent.SHOW_CUSTOM_TOOLTIP,this.model.get("tooltip"))),this.showHover()},mouseMove:function(e){!this.isMobileDevice&&this.tooltip&&Backbone.Mediator.pub(CustomContentEvent.MOVE_CUSTOM_TOOLTIP,e)},mouseOut:function(){!this.isMobileDevice&&this.tooltip&&Backbone.Mediator.pub(CustomContentEvent.HIDE_CUSTOM_TOOLTIP),this.hideHover()},showHover:function(){this.$hover.show()},hideHover:function(){this.$hover.hide()},showCaption:function(){this.caption||(this.caption=new CaptionView({model:new CaptionModel(this.model.attributes)}),this.$el.append(this.caption.render().el),this.caption.checkPosition()),this.caption.$el.show(),Backbone.Mediator.pub(CustomContentEvent.CAPTION_OPENED)},hideCaption:function(){this.caption&&(this.caption.$el.hide(),Backbone.Mediator.pub(CustomContentEvent.CAPTION_CLOSED))},resize:function(scale){var borderRadius=this.model.get("radius")*scale+"px";this.model.get("type")===ElementType.CAPTION&&"rounded"===this.model.get("shape")&&(borderRadius="50%"),this.model.set("scale",scale),this.model.setBounds(),this.model.get("action")===LinkAction.CAPTION&&this.caption&&(this.caption.remove(),this.caption=null,2===this.model.get("state")&&this.showCaption()),this.$el.css(this.getCssObj()).find(".label").css({lineHeight:this.model.get("h")+"px"}),this.$button.css({borderRadius:borderRadius})},setHover:function(){this.$hover.css({opacity:.7,background:"#ffffff",height:"100%",position:"relative"}).hide()},onResize:function(){var _this=this;window.setTimeout(function(){_this.setHover()},100),this.model.get("label")&&(this.onModelChangeWidth(),this.onModelChangeHeight())},onModelChangeWidth:function(){this.model.get("label")&&(this.setIconSize(),this.setPadding(),this.setIconLeft())},onModelChangeHeight:function(){this.model.get("label")&&this.setFontSize()},start:function(turnState){"turning"===turnState&&this.model.get("label")&&(this.onModelChangeWidth(),this.onModelChangeHeight())},remove:function(){this.$button.off(),this.$button=void 0,this.$hover.off(),this.$hover=void 0,this.$el.off(),this.off(),Backbone.Mediator.unsubscribe(WidgetEvent.RESIZE,this.onResize,this),Backbone.View.prototype.remove.apply(this,arguments)}}),AudioButton=CustomButton.extend({initialize:function(){this.isPlaying=!1,CustomButton.prototype.initialize.apply(this,arguments),Backbone.Mediator.sub(CustomContentEvent.AUDIO_STARTED,this.audioStarted,this),Backbone.Mediator.sub(CustomContentEvent.AUDIO_STOPPED,this.audioStopped,this),this.model.set("state","active",{silent:!0})},onClick:function(){"string"==typeof this.model.get("hash")&&this.model.get("hash").length>0&&(this.isPlaying?Backbone.Mediator.pub(CustomContentEvent.STOP_AUDIO,{pageIndex:this.model.get("elementPageIndex"),customElementIndex:this.model.get("index"),audioHash:this.model.get("hash")}):Backbone.Mediator.pub(CustomContentEvent.PLAY_AUDIO,{pageIndex:this.model.get("elementPageIndex"),customElementIndex:this.model.get("index"),audioHash:this.model.get("hash")})),this.registerClickEvent(),this.sendClickNotification()},registerClickEvent:function(){Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:Stats.TYPE.CLICK_ELEMENT,pid:this.model.get("pid"),elid:this.model.get("eID")})},sendClickNotification:function(){Backbone.Mediator.pub(CustomContentEvent.CUSTOM_CONTENT_CLICK,this.model)},audioStarted:function(obj){this.isCurrentButton(obj)&&(this.isPlaying=!0,this.model.set("state","default"))},audioStopped:function(obj){this.isCurrentButton(obj)&&(this.isPlaying=!1,this.model.set("state","active"))},isCurrentButton:function(obj){return obj.pageIndex===this.model.get("elementPageIndex")&&obj.customElementIndex===this.model.get("index")&&obj.audioHash===this.model.get("hash")},stop:function(){Backbone.Mediator.pub(CustomContentEvent.STOP_AUDIO,{pageIndex:this.model.get("elementPageIndex"),customElementIndex:this.model.get("index"),audioHash:this.model.get("hash")})},remove:function(){Backbone.Mediator.sub(CustomContentEvent.AUDIO_STARTED,this.audioStarted,this),Backbone.Mediator.sub(CustomContentEvent.AUDIO_STOPPED,this.audioStopped,this),CustomButton.prototype.remove.apply(this,arguments)}}),VideoButtonView=CustomButton.extend({events:function(){var parentEvents=CustomButton.prototype.events;return _.isFunction(parentEvents)&&(parentEvents=parentEvents()),_.extend({},parentEvents,{"click .btn":"onClick"})},initialize:function(){var videoSize=this.getVideoSize(),width=videoSize.width,height=videoSize.height,isGenericVideo=FSUtils.getVideoProvider(this.model.get("ytlink"))===VideoProvider.OTHER;CustomButton.prototype.initialize.apply(this,arguments),this.videoEmbed=new VideoEmbed({model:new VideoEmbedModel({url:this.model.get("ytlink"),width:width,height:height,x:0,y:0,skipResize:!0,autoPlay:!isGenericVideo,genericVideoButton:isGenericVideo})}),Backbone.Mediator.sub(WidgetEvent.RESIZE,this.onResize,this)},getVideoSize:function(){var clientWidth=FSWidgetModel.gi().get("width")-VIDEO_POPIN_DEFAULTS.MARGINS,clientHeight=FSWidgetModel.gi().get("height")-VIDEO_POPIN_DEFAULTS.MARGINS,videoSize=this.model.get("size").split(","),customWidth=videoSize[0]>clientWidth?clientWidth:videoSize[0],customHeight=videoSize[1]>clientHeight?clientHeight:videoSize[1];return"fullscreen"===this.model.get("size")?{width:clientWidth,height:clientHeight}:{width:customWidth,height:customHeight}},onClick:function(){this.model.get("ytlink")&&this.videoEmbed.model.valid()&&Backbone.Mediator.pub(WidgetEvent.POPIN_OPEN,this.videoEmbed.render().$el,this.videoEmbed.model.attributes),this.registerClickEvent(),this.sendClickNotification()},registerClickEvent:function(){Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:Stats.TYPE.CLICK_ELEMENT,pid:this.model.get("pid"),elid:this.model.get("eID")})},sendClickNotification:function(){Backbone.Mediator.pub(CustomContentEvent.CUSTOM_CONTENT_CLICK,this.model)},onResize:function(){var videoSize=this.getVideoSize();this.videoEmbed.model.set({width:videoSize.width+"px",height:videoSize.height+"px"}),Backbone.Mediator.pub(WidgetEvent.POPIN_RESIZE)}});VideoButtonView.DEFAULT_VIDEO_WIDTH=853,VideoButtonView.DEFAULT_VIDEO_HEIGHT=480;var CaptionView=Backbone.View.extend({className:"caption custom-element",events:{"click .caption":"onClick"},render:function(){var o=this.model.attributes,modelFontFamily=this.model.get("fontFamily"),fontFamily=FontManager.gi().getFontFamily(modelFontFamily),fontWeight=FontManager.gi().getFontWeight(modelFontFamily,this.model.get("fontWeight")),fontStyle=FontManager.gi().getFontStyle(modelFontFamily);return this.css={fontFamily:'"'+fontFamily+'",Helvetica,Arial,sans-serif',fontSize:o.fontSize*o.scale,fontWeight:fontWeight,width:o.tw,padding:Math.floor(10*o.scale)+"px "+Math.floor(14*o.scale)+"px",fontStyle:fontStyle},this.setPosition(),this.$el.html(this.getCaptionText()).css(this.css),this},getCaptionText:function(){return this.model.get("text")+this.getUrlHtml()},getUrlHtml:function(){return this.model.get("url")&&""!==this.model.get("url")?'<br /><a href="'+this.model.get("url")+'" target="_blank" rel="nofollow noopener noreferrer">Open link</a>':""},setPosition:function(){var a=this.model.attributes;switch(a.textPosition){case"left":a.tw>a.x&&a.tw+a.x+a.w<FlipView.gi().docView.pageWidth?(this.model.set("textPosition","right"),this.setPosition()):(a.th+a.y>FlipView.gi().docView.pageHeight?this.css.bottom=0:this.css.top=0,this.css.right=a.w+1);break;case"right":a.tw+a.x+a.w>FlipView.gi().docView.pageWidth&&a.tw<a.x?(this.model.set("textPosition","left"),this.setPosition()):(a.th+a.y>FlipView.gi().docView.pageHeight?this.css.bottom=0:this.css.top=0,this.css.left=a.w+1);break;case"top":a.th>a.y&&a.th+a.y+a.h<FlipView.gi().docView.pageHeight?(this.model.set("textPosition","bottom"),this.setPosition()):(a.tw>a.x?this.css.left=0:this.css.right=0,this.css.bottom=a.h+1);break;case"bottom":a.th+a.y+a.h>FlipView.gi().docView.pageHeight&&a.th<a.y?(this.model.set("textPosition","top"),this.setPosition()):(a.tw+a.x>FlipView.gi().docView.pageWidth?this.css.right=0:this.css.left=0,this.css.top=a.h+1)}},checkPosition:function(){},onClick:function(){this.sendClickNotification()},sendClickNotification:function(){Backbone.Mediator.pub(CustomContentEvent.CUSTOM_CONTENT_CLICK,this.model)}}),TagView=Backbone.View.extend({events:{click:"onClick",mouseover:"mouseOverContainer",mouseout:"mouseOutContainer"},template:_.template(CustomContentTemplates.tag),className:"custom-tag custom-element",initialize:function(){this.newEditor=FSWidgetModel.gi().widgetSettings.get("editorVersion")&&2===parseInt(FSWidgetModel.gi().widgetSettings.get("editorVersion"),10),this.tagTooltip=new TagTooltipView({model:new Backbone.Model({newEditor:this.newEditor,scale:this.model.get("scale")})}),this.youtubeIframeURL="https://www.youtube.com/embed/",this.youtubeVideoHash="",this.youtubeVideoParams="?wmode=opaque&rel=0",this.vimeoIframeUrl="https://player.vimeo.com/video/",this.vimeoVideoID="",this.vimeoVideoParams="?api=1&player_id=fs_videoPlayerIframe_",this.dimensions={w:this.newEditor?this.model.get("w")/this.model.get("scale"):19,h:this.newEditor?this.model.get("h")/this.model.get("scale"):19},Backbone.Mediator.sub(WidgetEvent.BEFORE_POPIN_CLOSE,this.onPopinClose,this),Backbone.Mediator.sub(WidgetEvent.RESIZE,this.onResize,this)},render:function(){return this.$el.html(this.template(this.model.attributes)).append(this.tagTooltip.render().$el),this.tag=this.$el.find(".tag"),this.colorRing=this.tag.find(".color-ring"),this.extension=this.$el.find(".tag-ext"),this.setCSS(),this},setCSS:function(){var a=this.model.attributes;this.$el.css({left:a.x,top:a.y,width:this.dimensions.w*a.scale,height:this.dimensions.h*a.scale}),this.colorRing.css({border:this.dimensions.w/4*a.scale+"px solid #"+a.color,left:2*a.scale,top:2*a.scale,width:(this.dimensions.w-4)*a.scale,height:(this.dimensions.h-4)*a.scale,opacity:this.model.get("alpha")||0===this.model.get("alpha")?this.model.get("alpha"):1})},resize:function(scale){scale!==this.model.get("scale")&&(this.model.set("scale",scale),this.model.setBounds(),this.setCSS())},onClick:function(){var maxWidth,maxHeight,iFrame,src,self=this,a=this.model.attributes;switch(maxWidth=FSWidgetModel.gi().get("width")-VIDEO_POPIN_DEFAULTS.MARGINS,maxHeight=FSWidgetModel.gi().get("height")-VIDEO_POPIN_DEFAULTS.MARGINS,a.tagType){case TagType.VIDEO:iFrame=$('<iframe class="video"></iframe>'),(src=this.getVideoSrc(a.tagUrl))&&(iFrame.attr({src:src+"?rel=0&amp;autoplay=1",allowfullscreen:"allowfullscreen",frameborder:"0"}).css({position:"relative",zIndex:1,display:"block"}),this.resizeVideo(iFrame,maxWidth,maxHeight),Backbone.Mediator.pub(WidgetEvent.POPIN_OPEN,iFrame,maxWidth,maxHeight),this.positionPopinCloseButton());break;case TagType.IMAGE:$('<img class="image"/>').on("load",function(){self.originalImageWidth=this.width,self.originalImageHeight=this.height,self.resizeImage(this,maxWidth,maxHeight),Backbone.Mediator.pub(WidgetEvent.POPIN_OPEN,this,this.width,this.height)}).css({padding:"9px"}).attr("src",URLPaths.UPLOADS_PATH+a.thumbHash);break;default:a.tagUrl&&Backbone.Mediator.pub(WidgetEvent.HYPERLINK,a.tagUrl,"_blank")}this.registerClickEvent()},registerClickEvent:function(){Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:Stats.TYPE.CLICK_ELEMENT,pid:this.model.get("pid"),elid:this.model.get("eID")})},getVideoSrc:function(url){var hash=FSUtils.getVideoHash(url);if(hash.length){if(url.indexOf("youtube.com/")>-1||url.indexOf("youtu.be/")>-1)return this.youtubeIframeURL+hash+this.youtubeVideoParams;if(url.indexOf("vimeo.com/")>-1)return this.vimeoIframeUrl+hash+this.vimeoVideoParams}return!1},mouseOverContainer:function(){this.tagTooltip.showTooltip(this.model.attributes),this.model.attributes.tagVideoTitle&&this.$el.find(".tooltip-title").text(this.model.attributes.text?this.model.attributes.text:this.model.attributes.tagVideoTitle),this.model.attributes.tagType===TagType.VIDEO&&(this.model.attributes.tagVideoTitle||this.$el.find(".tooltip-title").hide(),this.model.attributes.url||this.$el.find(".tooltip-link").hide()),this.model.attributes.tagType!==TagType.TEXT&&this.model.attributes.tagType!==TagType.LINK||(this.model.attributes.tagUrl||this.$el.find(".tooltip-link").hide(),this.model.attributes.text||this.$el.find(".tooltip-text").hide(),this.model.attributes.tagUrl||this.model.attributes.text||this.$el.find(".content-text").hide()),(isNaN(this.model.attributes.tagType)||(void 0===this.model.get("text")||0===this.model.get("text").length)&&0===this.model.get("tagUrl").length&&0===this.model.get("tagVideoTitle").length)&&(this.$el.find(".content-text").hide(),this.$el.find(".tag-tooltip").hide())},mouseOutContainer:function(){this.tagTooltip.hideTooltip()},resizeImage:function(img,maxWidth,maxHeight){var wRatio,hRatio,nw,nh;this.originalImageWidth<=maxWidth&&this.originalImageHeight<=maxHeight||((wRatio=this.originalImageWidth/maxWidth)>(hRatio=this.originalImageHeight/maxHeight)?(nw=maxWidth,nh=this.originalImageHeight/wRatio):(nh=maxHeight,nw=this.originalImageWidth/hRatio),this.setImageAttributes(img,nw,nh))},setImageAttributes:function(img,width,height){img.setAttribute("width",width+"px"),img.setAttribute("height",height+"px")},resizeVideo:function(video,maxWidth,maxHeight){var iFrameWidth=maxWidth>VIDEO_POPIN_DEFAULTS.WIDTH?VIDEO_POPIN_DEFAULTS.WIDTH:maxWidth,iFrameHeight=maxHeight>VIDEO_POPIN_DEFAULTS.HEIGHT?VIDEO_POPIN_DEFAULTS.HEIGHT:maxHeight;video.attr("width",iFrameWidth+"px"),video.attr("height",iFrameHeight+"px")},unfocusTagOnPage:function(){this.mouseOutContainer(),this.mouseOutCircle(),this.colorRing.hide()},onPopinClose:function(el){var tagType=this.model.get("tagType");tagType===TagType.VIDEO&&el.find("iframe").remove(),tagType===TagType.IMAGE&&(this.originalImageWidth=!1,this.originalImageHeight=!1)},positionPopinCloseButton:function(){this.$el.find(".btn-x").css("z-index",2)},onResize:function(){var maxWidth=FSWidgetModel.gi().get("width")-VIDEO_POPIN_DEFAULTS.MARGINS,maxHeight=FSWidgetModel.gi().get("height")-VIDEO_POPIN_DEFAULTS.MARGINS,img=this.$el.find(".popin-content .image"),video=this.$el.find(".popin-content .video");this.model.get("tagType")===TagType.IMAGE&&this.originalImageWidth&&this.originalImageHeight&&this.resizeImage(img[0],maxWidth,maxHeight),this.model.get("tagType")===TagType.VIDEO&&this.resizeVideo(video,maxWidth,maxHeight),Backbone.Mediator.pub(WidgetEvent.POPIN_RESIZE)}}),TagTooltipView=Backbone.View.extend({template:_.template(CustomContentTemplates.tagTooltip),className:"tag-tooltip",initialize:function(){this.initialized=!1,this.scale=!1,this.newEditor=this.model.get("newEditor")},render:function(){return this.$el.html(this.template()),this},setTooltip:function(a){var self=this;switch(a.tagType){case TagType.VIDEO:this.$el.find(".tooltip-title").html(a.text),this.$el.find(".content-media").show(),this.$el.find(".content-text").hide(),this.$el.find(".tooltip-img img").on("load",function(){self.tooltipReady(a)}).attr("src",a.tagVideoThumb);break;case TagType.IMAGE:this.$el.find(".tooltip-title").html(a.text),this.$el.find(".content-media").show(),this.$el.find(".content-text").hide(),this.$el.find(".play-btn").hide(),this.$el.find(".tooltip-img img").on("load",function(){self.tooltipReady(a)}).attr("src",URLPaths.UPLOADS_PATH+a.thumbHash);break;default:this.$el.find(".tooltip-text").html(a.text),this.$el.find(".tooltip-link a").html(a.tagUrl),this.$el.find(".content-media").hide(),this.$el.find(".content-text").show(),this.tooltipReady(a)}},tooltipReady:function(a){var dimensions={w:this.newEditor?a.w:19,h:this.newEditor?a.h:19};a.y<this.$el.height()&&this.$el.addClass("bellow").css({top:dimensions.h,bottom:"auto"}),this.$el.css({opacity:1})},showTooltip:function(a){var width,left,moveRight,dimensions_w=this.newEditor?a.w:19,dimensions_h=this.newEditor?a.h:19,offset=a.offset?-1*a.offset:0,xOffset=a.pageOffset?a.pageOffset.x:0;this.scale!==a.scale&&(left=dimensions_w/2-(width=a.tagPreviewWidth*a.scale)/2,moveRight=0,a.x+xOffset+offset<-1*left&&(moveRight=left+a.x+xOffset+offset-2*a.scale),a.x+xOffset+left+width>a.currentPageWidth&&(moveRight=a.x+xOffset+left+(width-a.currentPageWidth)+2*a.scale),this.$el.find(".content > div").css({right:moveRight}),this.$el.css({fontSize:10*a.scale,width:width,left:left,bottom:dimensions_h-3,opacity:0}).show(),this.$el.find(".content > div > div").css({padding:9*a.scale}),this.$el.find(".tooltip-title").css({paddingTop:0}),this.$el.find(".play-btn").css({border:2*a.scale+"px solid #979797",borderRadius:8*a.scale,width:46*a.scale,height:30*a.scale,marginLeft:46*a.scale*-1/2,marginTop:30*a.scale*-1/2}),this.$el.find(".play-btn div").css({width:0,height:0,borderTop:8*a.scale+"px solid transparent",borderBottom:8*a.scale+"px solid transparent",borderLeft:13*a.scale+"px solid #464646",marginLeft:-6*a.scale,marginTop:-8*a.scale})),this.initialized?this.tooltipReady(a):this.setTooltip(a)},hideTooltip:function(){this.$el.hide()}}),TextView=Backbone.View.extend({events:{click:"onClick"},template:_.template(CustomContentTemplates.text),className:"text-element custom-element",initialize:function(){Backbone.Mediator.sub(WidgetEvent.PREV_PAGE,function(){this.setCSS()},this),Backbone.Mediator.sub(WidgetEvent.NEXT_PAGE,function(){this.setCSS()},this)},resize:function(scale){scale!==this.model.get("scale")&&(this.model.set("scale",scale),this.model.setBounds(),this.setCSS())},setCSS:function(){this.$el.width(this.model.get("w")).css({left:this.model.get("x")+"px",top:this.model.get("y")+"px",opacity:this.model.get("alpha"),transform:"rotate("+this.model.get("rotation")+"deg)"}),this.$el.find(".inner").css({width:this.model.get("ow")+"px",fontSize:this.model.get("oFontSize")+"px",lineHeight:this.model.get("lineHeight"),letterSpacing:this.model.get("letterSpacing"),transformOrigin:"left top 0",transform:"translateY(0em) scale("+this.model.get("scale")+")",textAlign:this.model.get("textAlign"),color:"#"+this.model.get("color")}),this.$el.height(this.$el.find(".inner").height()*this.model.get("scale"))},render:function(){var _this=this,modelFontFamily=this.model.get("fontFamily"),fontFamily=FontManager.gi().getFontFamily(modelFontFamily),fontWeight=FontManager.gi().getFontWeight(modelFontFamily,this.model.get("fontWeight")),fontStyle=FontManager.gi().getFontStyle(modelFontFamily);return this.$el.css({fontFamily:'"'+fontFamily+'",Helvetica,Arial,sans-serif',fontWeight:fontWeight,fontStyle:fontStyle,transform:"rotate("+this.model.get("rotation")+"deg)"}).html(this.template(this.model.attributes)),this.setCSS(),this.model.get("url")&&this.$el.find("a").attr({href:this.model.get("url"),target:"_blank"}),setTimeout(function(){_this.$el.height(_this.$el.find(".inner").height()*_this.model.get("scale"))},100),this},onClick:function(){this.registerClickEvent(),this.sendClickNotification()},registerClickEvent:function(){Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:Stats.TYPE.CLICK_ELEMENT,pid:this.model.get("pid"),elid:this.model.get("eID")})},sendClickNotification:function(){Backbone.Mediator.pub(CustomContentEvent.CUSTOM_CONTENT_CLICK,this.model)}}),TextBoxView=Backbone.View.extend({events:{click:"onClick"},template:_.template(CustomContentTemplates.textBox),className:"text-box-element custom-element",initialize:function(){this.scaling=this.model.get("scale")*this.model.get("oldEditorScaling"),Backbone.Mediator.sub(WidgetEvent.PREV_PAGE,function(){this.setCSS()},this),Backbone.Mediator.sub(WidgetEvent.NEXT_PAGE,function(){this.setCSS()},this)},resize:function(scale){scale!==this.model.get("scale")&&(this.model.set("scale",scale),this.scaling=this.model.get("scale")*this.model.get("oldEditorScaling"),this.model.setBounds(),this.setCSS())},setCSS:function(){this.$el.css({left:this.model.get("x")+"px",top:this.model.get("y")+"px",width:this.model.get("w")+"px",height:this.model.get("h")+"px",transform:"rotate("+this.model.get("rotation")+"deg)",overflow:this.model.get("textWrap")&&this.model.get("textWrap")===TEXT_WRAP_TYPES.CLIP?"hidden":"unset"}),this.$el.find(".inner").css({lineHeight:0,textAlign:this.model.get("textAlign"),color:"#"+this.model.get("color"),width:this.model.get("w")/this.scaling+"px",height:this.model.get("h")/this.scaling+"px",transformOrigin:"left top 0",transform:"translateY(0em) scale("+this.scaling+")",fontSize:this.model.get("oFontSize"),letterSpacing:0})},render:function(){var modelFontFamily=this.model.get("fontFamily"),fontFamily=FontManager.gi().getFontFamily(modelFontFamily),fontWeight=FontManager.gi().getFontWeight(modelFontFamily,this.model.get("fontWeight")),fontStyle=FontManager.gi().getFontStyle(modelFontFamily),textContent=this.generateTextContent();return this.$el.css({fontFamily:'"'+fontFamily+'",Helvetica,Arial,sans-serif',fontWeight:fontWeight,fontStyle:fontStyle,transform:"rotate("+this.model.get("rotation")+"deg)"}).html(this.template({textContent:textContent})),this.setCSS(),this.model.get("url")&&this.$el.find("a").attr({href:this.model.get("url"),target:"_blank"}),this},onClick:function(){this.registerClickEvent(),this.sendClickNotification()},replaceWhiteSpace:function(text){return"string"==typeof text?text.replace(/(\s|&nbps;)(\s|&nbps;)/gi,String.fromCharCode(160,160)):text},generateTextContent:function(){var tag,texts,styles,result,div=document.createElement("div"),self=this;return this.model.get("nodes").forEach(function(n,k){if(tag=document.createElement(n.tag),texts=n.text.split("\n"),n.style&&(styles=Object.keys(n.style)).length&&styles.forEach(function(s){tag.style[s]="fontSize"===s||"letterSpacing"===s?n.style[s]+"px":n.style[s]}),1===texts.length)tag.appendChild(document.createTextNode(self.replaceWhiteSpace(texts[0])));else{const lastTextItem=texts.pop();for(var i=0;i<texts.length;i++)tag.appendChild(document.createTextNode(self.replaceWhiteSpace(texts[i]))),tag.appendChild(document.createElement("br"));tag.appendChild(document.createTextNode(self.replaceWhiteSpace(lastTextItem)))}tag.className+="fragment-"+k,div.appendChild(tag)}),result="<span>"+div.innerHTML+"</span>",div instanceof HTMLElement?result:"<span />"},registerClickEvent:function(){Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:Stats.TYPE.CLICK_ELEMENT,pid:this.model.get("pid"),elid:this.model.get("eID")})},sendClickNotification:function(){Backbone.Mediator.pub(CustomContentEvent.CUSTOM_CONTENT_CLICK,this.model)}}),VideoWidgetView=Backbone.View.extend({className:"video-widget custom-element",events:{click:"onClick"},initialize:function(){this.videoEmbed=new VideoEmbed({model:new VideoEmbedModel({url:this.getVideoUrl(),width:this.model.get("w"),height:this.model.get("h"),x:this.model.get("x"),y:this.model.get("y"),genericVideoButton:!1,poster:this.getThumbFromSrc()})})},getVideoUrl:function(){return this.model.get("src")?URLPaths.HYPERLINK_UPLOADED_IMAGES_PATH+this.model.get("src"):this.model.get("ytlink")},getThumbFromSrc:function(){if(this.model.get("src"))return URLPaths.HYPERLINK_UPLOADED_IMAGES_PATH+this.model.get("src").split("?")[0]+"_cover"},onClick:function(){this.registerClickEvent(),this.sendClickNotification()},sendClickNotification:function(){Backbone.Mediator.pub(CustomContentEvent.CUSTOM_CONTENT_CLICK,this.model)},registerClickEvent:function(){Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:Stats.TYPE.CLICK_ELEMENT,pid:this.model.get("pid"),elid:this.model.get("eID")})},resize:function(scale){scale!==this.model.get("scale")&&(this.model.set("scale",scale),this.model.setBounds(),this.setCSS())},setCSS:function(){this.$el.width(this.model.get("w")).height(this.model.get("h")).css({left:this.model.get("x")+"px",top:this.model.get("y")+"px"}),this.videoEmbed&&this.videoEmbed.model.set({width:this.model.get("w"),height:this.model.get("h")})},render:function(){return this.$el.css({display:this.videoEmbed.model.valid()?"block":"none"}),this.setCSS(),this},start:function(turnState){"end"===turnState&&this.$el.html(this.videoEmbed.render().$el)},stop:function(){this.videoEmbed.$el.empty()},remove:function(){this.videoEmbed&&(this.videoEmbed.remove(),this.videoEmbed=null),Backbone.View.prototype.remove.apply(this,arguments)}}),VideoEmbed=Backbone.View.extend({template:_.template(CustomContentTemplates.videoIframe),attributes:function(){return{class:"video-autoplay-"+this.model.get("autoPlay")}},initialize:function(){this.listenTo(this.model,"change:width",this.onChangeDimensions),this.listenTo(this.model,"change:height",this.onChangeDimensions)},autoPlayVideoMobile:function(){if(this.model.get("mobile")&&this.model.get("autoPlay")){var iframes=document.getElementsByClassName("video-autoplay-1");setTimeout(function(){for(var counter=0;counter<iframes.length;counter++){var iframe;iframes[counter]&&"IFRAME"!==iframes[counter].tagName.toUpperCase()&&(iframe=iframes[counter].getElementsByTagName("iframe")[0]),iframe.contentWindow.postMessage(JSON.stringify({event:"command",func:"playVideo",args:[],className:"video-autoplay-1"}),"*")}},1500)}},onChangeDimensions:function(){this.$("iframe").eq(0).attr({width:this.model.get("width"),height:this.model.get("height")})},render:function(){if(this.$el.html(this.template(this.model.attributes)),this.model.get("genericVideoButton")){var video=this.$el.find("video")[0];video&&video.addEventListener("loadedmetadata",function(){Backbone.Mediator.pub(CustomContentEvent.VIDEO_EMBED_SIZE,{videoWidth:this.videoWidth,videoHeight:this.videoHeight})})}else this.autoPlayVideoMobile();return this}}),ShapeView=Backbone.View.extend({template:_.template(CustomContentTemplates.shape),className:"shape-element custom-element",events:{click:"onClick"},initialize:function(){this.setCSS()},render:function(){return this.$el.html(this.template(this.model.attributes)),this.loadMaskShape(),this.setCSS(),this.model.get("url")&&this.$el.find("a").attr({href:this.model.get("url"),target:"_blank"}),this},loadMaskShape:function(){var sl,_this,shapeId=parseInt(this.model.get("shape"),10);(shapeId=0===shapeId?1:shapeId)&&(SvgLoader.getLoadedShapes()[shapeId]?this.renderSVG($(SvgLoader.getLoadedShapes()[shapeId])):(sl=new SvgLoader(shapeId,SymbolType.SHAPE),_this=this,sl.loadSVG(_this,function(svgString){SvgLoader.addLoadedShape(shapeId,svgString),_this.renderSVG(svgString)})))},decodeShadowFilter:function(shadow){var rgbaColor,scale=this.model.get("scale")/2;return shadow?(rgbaColor="rgba("+shadow.r+", "+shadow.g+", "+shadow.b+", "+shadow.a+")","drop-shadow("+shadow.x*scale+"px "+shadow.y*scale+"px "+shadow.blur*scale+"px "+rgbaColor+")"):""},getFilters:function(filters){var filter,returnModel="";for(filter in filters)filter===ShapeView.filterType.SHADOW&&(returnModel+=this.decodeShadowFilter(filters[filter]));return returnModel},getBorder:function(border,scale){return border?border.width*scale+"px solid "+border.color:null},renderSVG:function(svgHtml){var _this=this,scale=this.model.get("scale")/2,iconContainer=this.$el.find("div:first").eq(0),$icon=$(svgHtml),id="pattern-"+ ++ShapeView.patternIdCount,rotation=this.model.get("rotation")?parseInt(this.model.get("rotation"),10):0;$icon.css({border:this.getBorder(this.model.get("border"),scale),borderRadius:this.model.get("radius")*scale+"px",opacity:this.model.get("alpha"),filter:this.getFilters(this.model.get("filter"))}),this.model.get("repeat")&&($icon.find("pattern").attr("id",id),$icon.children("rect:first").attr("fill","url(#"+id+")")),$icon.attr("stroke")||"none"!==$icon.attr("fill")||$icon.attr("stroke","#"+_this.getColor()),$icon.find("path,pattern *").each(function(idx,elem){$(elem).attr("fill")&&"none"!==$(elem).attr("fill")&&$(elem).attr("fill","#"+_this.getColor())}),iconContainer.css({fill:"#"+_this.getColor()}),iconContainer.html($icon),this.patternHeight=parseFloat($icon.find("pattern svg").attr("height")),this.resizeSvg(scale),"number"==typeof rotation&&0!==rotation&&this.$el.css("transform","rotate("+rotation+"deg)")},getColor:function(){return"number"==typeof this.model.get("color")?"000000":this.model.get("color")},resize:function(scale){scale!==this.model.get("scale")&&(this.model.set("scale",scale),this.model.setBounds(),this.setCSS(),this.resizeSvg(scale/2))},resizeSvg:function(scale){var repeat=!!this.model.get("repeat")&&1===parseInt(this.model.get("repeat"),10),icon=this.$("svg:first").eq(0);icon.attr({width:repeat?"100%":this.model.get("w")+"px",height:this.model.get("h")>1?this.model.get("h")+"px":"1px"}),repeat&&icon.find("defs + rect").attr({transform:"scale("+this.model.get("h")/this.patternHeight+")",width:this.model.get("w")/(this.model.get("h")/this.patternHeight)+"px"}),icon.css({border:this.getBorder(this.model.get("border"),scale),borderRadius:this.model.get("radius")*scale+"px",filter:this.getFilters(this.model.get("filter")),opacity:this.model.get("alpha")}),this.$("div:first").eq(0).css({fill:"#"+this.getColor(),width:this.model.get("w")+"px",height:this.model.get("h")+"px",minHeight:"1px"})},setCSS:function(){this.$el.width(this.model.get("w")).height(this.model.get("h")).css({left:this.model.get("x")+"px",top:this.model.get("y")+"px"})},onClick:function(){this.registerClickEvent(),this.sendClickNotification()},registerClickEvent:function(){Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:Stats.TYPE.CLICK_ELEMENT,pid:this.model.get("pid"),elid:this.model.get("eID")})},sendClickNotification:function(){Backbone.Mediator.pub(CustomContentEvent.CUSTOM_CONTENT_CLICK,this.model)}});ShapeView.patternIdCount=0,ShapeView.filterType={SHADOW:"shadow",BLUR:"blur",VIGNETTE:"vignette",TINT:"hue-rotate",PRESET:"preset"};var ImageElementView=Backbone.View.extend({className:"image-element custom-element",events:{click:"onClick"},initialize:function(){this.image=null,this.preloadImage=new Image,this.imgSrcAppend=null,this.model.get("subType")!==ImageElementType.COLOR?this.model.get("w")&&this.model.get("h")?this.createImage():this.model.set("status",ContentLoaderStatus.ERROR):this.setColor(),this.resize(this.model.get("scale"))},decodeShadowFilter:function(shadow){var rgbaColor,scale=this.model.get("scale")/2;return shadow?(rgbaColor="rgba("+shadow.r+", "+shadow.g+", "+shadow.b+", "+shadow.a+")","drop-shadow("+shadow.x*scale+"px "+shadow.y*scale+"px "+shadow.blur*scale+"px "+rgbaColor+")"):""},getFilters:function(filters){var filter,returnModel="";for(filter in filters)if(Object.prototype.hasOwnProperty.call(filters,filter)&&filters)switch(filter){case ShapeView.filterType.BLUR:returnModel+=" "+filter+"("+parseFloat(filters[filter].toFixed(2))+"px)";break;case ShapeView.filterType.TINT:returnModel+=" "+filter+"("+filters[filter]+"turn)";break;case ShapeView.filterType.VIGNETTE:case ShapeView.filterType.SHADOW:case ShapeView.filterType.PRESET:returnModel+="";break;default:returnModel+=" "+filter+"("+filters[filter]+")"}return returnModel},getVignetteStyle:function(vignette,width,height){var blurRadius=Math.min(width,height)/2;return"0 0 "+blurRadius+"px "+blurRadius/4+"px rgba(0,0,0,"+Math.max(vignette,.01)+") inset"},getContainerFilter:function(filter){return this.decodeShadowFilter(filter)},getBorder:function(border,scale){return border?Math.ceil(border.width*scale)+"px solid "+border.color:null},render:function(){var rotation,cssObject,scale=this.model.get("scale")/2,overflow="unset";return this.$el.css({opacity:parseFloat(this.model.get("alpha"))}),this.image&&(rotation=parseInt(this.model.get("rotation"),10),this.model.get("filter")&&this.model.get("filter")[ShapeView.filterType.BLUR]&&(overflow="hidden"),cssObject={transform:"rotate("+rotation+"deg)","-webkit-transform":"rotate("+rotation+"deg)","-moz-transform":"rotate("+rotation+"deg)","-ms-transform":"rotate("+rotation+"deg)","-o-transform":"rotate("+rotation+"deg)",border:this.getBorder(this.model.get("border"),scale),borderRadius:this.model.get("radius")*scale+"px",filter:this.getFilters(this.model.get("filter"))},this.$el.css({overflow:overflow}),this.image.$el.css(cssObject),this.model.get("filter")&&this.model.get("filter")[ShapeView.filterType.SHADOW]&&this.$el.css({filter:this.getContainerFilter(this.model.get("filter")[ShapeView.filterType.SHADOW])}),this.model.get("filter")&&this.model.get("filter")[ShapeView.filterType.VIGNETTE]&&this.image.$el.find(".vignette-layer").css({boxShadow:this.getVignetteStyle(this.model.get("filter")[ShapeView.filterType.SHADOW],this.model.get("w"),this.model.get("h"))})),this.model.get("url")&&this.$el.find("a").attr({href:this.model.get("url"),target:"_blank"}),this},onClick:function(){this.registerClickEvent(),this.sendClickNotification()},registerClickEvent:function(){Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:Stats.TYPE.CLICK_ELEMENT,pid:this.model.get("pid"),elid:this.model.get("eID")})},sendClickNotification:function(){Backbone.Mediator.pub(CustomContentEvent.CUSTOM_CONTENT_CLICK,this.model)},resize:function(scale){this.model.set("scale",scale),this.model.setBounds(),this.$el.css({width:this.model.get("w")+"px",height:this.model.get("h")+"px",left:this.model.get("x")+"px",top:this.model.get("y")+"px"}),this.image&&(this.resizeImage(scale/2),this.loadImageSpecificSize(scale))},loadImageSpecificSize:function(){var imgSrcAppend=this.getImageSrcAppend();this.imgSrcAppend!==imgSrcAppend&&(this.imgSrcAppend=imgSrcAppend,this.loadImage(imgSrcAppend))},getImageSrcAppend:function(){var page=this.getPageDimensions(),imgType=null,imageOriginalWidth=this.image.model.get("width"),imageOriginalHeight=this.image.model.get("height"),cropData=this.image.model.get("cropData");return cropData&&cropData.width&&cropData.height&&(imageOriginalWidth/=cropData.width,imageOriginalHeight/=cropData.height),imgType=(imgType=this.image?FSUtils.getImageSizeType(imageOriginalWidth,imageOriginalHeight):FSUtils.getImageSizeType(page.width,page.height))===ImageTypes.THUMB?ImageTypes.SMALL:imgType,ImageSizeAppend[imgType]},getPageDimensions:function(){var scale=this.model.get("scale"),firstPage=FSWidgetModel.gi().getFirstPage();return{width:firstPage.get("width")*scale,height:firstPage.get("height")*scale}},loadImage:function(append){var self=this,imageLoaded=function(){self.image.$el.find(".fsw-simpleimage").attr("src",self.preloadImage.src)};this.preloadImage.removeEventListener("load",imageLoaded,this),this.preloadImage.addEventListener("load",imageLoaded,this),this.preloadImage.src=this.model.getImageURL(this.model.get("src")+append,this.model.get("subType"))},resizeImage:function(scale){if(this.image){var overflow="unset",imgWidth=this.model.get("w"),imgHeight=this.model.get("h"),rotation=parseInt(this.model.get("rotation"),10),editorVersion=FSWidgetModel.gi().widgetSettings.get("editorVersion");!(void 0===editorVersion||editorVersion<2)||90!==rotation&&270!==rotation||(imgWidth=this.model.get("h"),imgHeight=this.model.get("w"),this.image.$el.css({left:((this.model.get("w")-imgWidth)/2).toFixed(2)+"px",top:((this.model.get("h")-imgHeight)/2).toFixed(2)+"px"})),this.model.get("filter")&&this.model.get("filter")[ShapeView.filterType.BLUR]&&(overflow="hidden"),this.$el.css({overflow:overflow}),this.image.$el.css({border:this.getBorder(this.model.get("border"),scale),borderRadius:this.model.get("radius")*scale+"px",filter:this.getFilters(this.model.get("filter"))}),this.model.get("filter")&&this.model.get("filter").vignette&&this.image.$el.find(".vignette-layer").css({boxShadow:this.getVignetteStyle(this.model.get("filter").vignette,this.model.get("w"),this.model.get("h"))}),this.model.get("filter")&&this.model.get("filter")[ShapeView.filterType.SHADOW]&&this.$el.css({filter:this.getContainerFilter(this.model.get("filter")[ShapeView.filterType.SHADOW])}),this.image.model.set({width:imgWidth,height:imgHeight})}},createImage:function(){var isSpecialRotation=90===parseInt(this.model.get("rotation"),10)||270===parseInt(this.model.get("rotation"),10),scaleMode=this.model.get("scaleMode"),w=isSpecialRotation?this.model.get("h"):this.model.get("w"),h=isSpecialRotation?this.model.get("w"):this.model.get("h");scaleMode="none"===scaleMode?"stretch":scaleMode,this.image=new SimpleLoader({model:new SimpleLoaderModel({scaleMode:scaleMode,width:w,height:h,showPreloader:!1,cropData:this.model.get("cropData")?this.model.get("cropData").proportions:null})});var imgSizeSuffix=this.getImageSrcAppend(),imgSource=this.model.getImageURL(this.model.get("src")+imgSizeSuffix,this.model.get("subType"));this.image.model.set("source",imgSource),this.listenTo(this.image.model,"change:status",function(){var imageStatus=this.image.model.get("status");imageStatus===ContentLoaderStatus.ERROR&&null!==this.getImageSrcAppend()&&this.image.model.set("source",this.model.getImageURL(this.model.get("src"),this.model.get("subType"))),imageStatus!==ContentLoaderStatus.COMPLETE&&imageStatus!==ContentLoaderStatus.ERROR||this.model.set("status",imageStatus)}),"tile"!==scaleMode?this.$el.append(this.image.render().$el):this.image.model.get("status")!==ContentLoaderStatus.COMPLETE?this.listenTo(this.image.model,"change:status",this.createTile):this.createTile()},createTile:function(){var scaleW,scaleH,imgUrl;this.image.model.get("status")===ContentLoaderStatus.COMPLETE&&(scaleW=this.image.model.get("originalWidth")/this.model.get("ow")*100,scaleH=this.image.model.get("originalHeight")/this.model.get("oh")*100,imgUrl=this.model.getImageURL(this.model.get("src"),this.model.get("subType")),this.$el.css("background","url("+imgUrl+") repeat scroll 0% 0% / "+scaleW+"% "+scaleH+"%"))},setColor:function(){this.$el.css({backgroundColor:"#"+this.model.get("color")})},remove:function(){this.image&&(this.stopListening(this.image.model),this.image.remove(),this.image=null),Backbone.View.prototype.remove.apply(this,arguments)}}),InteractionPopin=Backbone.View.extend({template:_.template(CustomContentTemplates.interactionPopin),className:"interaction-popin",initialize:function(){this.listenTo(this.model,"change",this.setupPopin),this.displayTimeout=0},setupPopin:function(){if(!("isDisplayed"in this.model.changed)){var elemX=this.model.get("x"),elemY=this.model.get("y"),elemWidth=this.model.get("w"),elemHeight=this.model.get("h"),popinWidth=this.model.get("interaction").width,popinHeight=this.model.get("interaction").height,padding=InteractionPopinContent.CONTENT_PADDING,elemCss={};switch("cid"in this.model.changed&&this.$el.html(this.template(this.model.attributes)),this.$el.find(".content").css({width:popinWidth+"px",height:popinHeight+"px",padding:padding+"px"}),this.model.get("interaction").positionActionType){case InteractionPopinPosition.TOP:elemCss.left=elemX+(elemWidth-popinWidth)/2+"px",elemCss.top=elemY-InteractionPopinContent.MARGIN-popinHeight+"px",this.addCssClass("top");break;case InteractionPopinPosition.TOP_RIGHT:elemCss.left=elemX+elemWidth-popinWidth/2+"px",elemCss.top=elemY-InteractionPopinContent.MARGIN-popinHeight+"px",this.addCssClass("top");break;case InteractionPopinPosition.TOP_LEFT:elemCss.left=elemX-popinWidth/2+"px",elemCss.top=elemY-InteractionPopinContent.MARGIN-popinHeight+"px",this.addCssClass("top");break;case InteractionPopinPosition.BOTTOM:elemCss.left=elemX+(elemWidth-popinWidth)/2+"px",elemCss.top=elemY+elemHeight+InteractionPopinContent.MARGIN+"px",this.addCssClass("bottom");break;case InteractionPopinPosition.BOTTOM_RIGHT:elemCss.left=elemX+elemWidth-popinWidth/2+"px",elemCss.top=elemY+elemHeight+InteractionPopinContent.MARGIN+"px",this.addCssClass("bottom");break;case InteractionPopinPosition.BOTTOM_LEFT:elemCss.left=elemX-popinWidth/2+"px",elemCss.top=elemY+elemHeight+InteractionPopinContent.MARGIN+"px",this.addCssClass("bottom");break;case InteractionPopinPosition.LEFT:elemCss.left=elemX-InteractionPopinContent.MARGIN-popinWidth+"px",elemCss.top=elemY+(elemHeight-popinHeight)/2+"px",this.addCssClass("left");break;default:elemCss.left=elemX+elemWidth+InteractionPopinContent.MARGIN+"px",elemCss.top=elemY+(elemHeight-popinHeight)/2+"px",this.addCssClass("right")}this.$el.css(elemCss),this.$el.find(".interaction-popin-title").css({fontSize:InteractionPopinContent.TITLE_FONT_SIZE+"px"}),this.$el.find(".interaction-popin-description").css({fontSize:InteractionPopinContent.DESCRIPTION_FONT_SIZE+"px",margin:InteractionPopinContent.DESCRIPTION_MARGIN+"px 0"})}},render:function(){return this},show:function(){var self=this;clearTimeout(this.displayTimeout),this.$el.show(),this.model.set("isDisplayed",!0),this.displayTimeout=setTimeout(function(){self.$el.css("opacity",1)},30),Backbone.Mediator.pub(CustomContentEvent.CUSTOM_INTERACTION_POPIN_DISPLAYED)},hide:function(){var self=this;clearTimeout(this.displayTimeout),this.$el.css("opacity",0),this.model.set("isDisplayed",!1),this.displayTimeout=setTimeout(function(){self.$el.hide()},100),Backbone.Mediator.pub(CustomContentEvent.CUSTOM_INTERACTION_POPIN_HIDDEN)},addCssClass:function(className){this.$el.hasClass(className)||(this.$el.removeClass("bottom top right left"),this.$el.addClass(className))}}),InteractionView=Backbone.View.extend({className:"interaction",template:_.template(CustomContentTemplates.interaction),events:{"click .interaction-link":"setPageInteraction","mouseover .interaction-link":"onMouseOver","mouseout .interaction-link":"onMouseOut","mousemove .interaction-link":"onMouseMove","mouseup .interaction-link":"onMouseUp","mousedown .interaction-link":"onMouseDown","dragstart .interaction-link":"onDragStart"},initialize:function(){this.shouldOpenLink=!0,this.interaction=this.model.attributes.interaction,this.interactionType=this.interaction.interactionType,this.tooltip=this.interaction.popinTooltip,this.actionType=this.interaction.actionType,this.isMobileDevice=FSUtils.isMobileDevice(),this.hasTooltip=this.interaction.openActionType===InteractionPopinTrigger.CLICK&&this.tooltip&&this.tooltip.length>0,this.button=null,this.isPopinDisplayed=!1,Backbone.Mediator.sub(CustomContentEvent.CUSTOM_INTERACTION_POPIN_DISPLAYED,this.hideTooltip,this),Backbone.Mediator.sub(CustomContentEvent.CUSTOM_INTERACTION_POPIN_HIDDEN,this.canShowTooltip,this)},render:function(){const rotation=parseInt(this.model.get("rotation"),10);switch(this.$el.html(this.template()),this.$el.css({backgroundColor:this.model.get("interaction").color,opacity:0,transform:"rotate("+rotation+"deg)","-webkit-transform":"rotate("+rotation+"deg)","-moz-transform":"rotate("+rotation+"deg)","-ms-transform":"rotate("+rotation+"deg)","-o-transform":"rotate("+rotation+"deg)"}),this.setElementPosition(),this.button=this.$el.find("a"),this.interactionType){case InteractOptions.LINK:this.setLinkInteraction(this.button,this.interaction);break;case InteractOptions.PAGE:this.setPageTooltip(this.button,this.interaction);break;case InteractOptions.POPIN:this.interaction.openActionType===InteractionPopinTrigger.HOVER&&(this.button.off(),this.button.on("mouseenter",$.proxy(this,"showPopin")),this.button.on("mouseleave",$.proxy(this,"hidePopin")))}return this.$el.on("click",$.proxy(this,"onLinkClick")),this},resize:function(scale){this.model.set("scale",scale),this.model.setBounds(),this.setElementPosition()},setElementPosition:function(){this.$el.css({left:this.model.get("x"),top:this.model.get("y"),width:this.model.get("w"),height:this.model.get("h")})},setLinkInteraction:function(button,interaction){button.attr("target","_blank"),button.attr("href",interaction.url),button.attr("title",interaction.tooltip)},setPageTooltip:function(button,interaction){button.attr("title",interaction.actionTooltip)},hideTooltip:function(fromMouseOut){!this.isMobileDevice&&this.hasTooltip&&(Backbone.Mediator.pub(CustomContentEvent.HIDE_CUSTOM_TOOLTIP),fromMouseOut||(this.isPopinDisplayed=!0))},canShowTooltip:function(){!this.isMobileDevice&&this.hasTooltip&&(this.isPopinDisplayed=!1)},onMouseOver:function(){this.$el.css("opacity",this.model.get("interaction").alpha||.3),this.isMobileDevice||!this.hasTooltip||this.isPopinDisplayed||Backbone.Mediator.pub(CustomContentEvent.SHOW_CUSTOM_TOOLTIP,this.tooltip)},onMouseOut:function(){this.$el.css("opacity",0),this.hideTooltip(!0)},setShouldOpenLink:function(open){this.shouldOpenLink=open},onLinkClick:function(e){return!!this.shouldOpenLink||(e.preventDefault(),e.stopPropagation(),!1)},onMouseMove:function(e){this.setShouldOpenLink(!1),this.isMobileDevice||!this.hasTooltip||this.isPopinDisplayed||Backbone.Mediator.pub(CustomContentEvent.MOVE_CUSTOM_TOOLTIP,e),e.preventDefault()},onMouseUp:function(){this.$el.find("a")[0].removeEventListener("click",this.onLinkClick)},onDragStart:function(e){return e.preventDefault(),!1},onMouseDown:function(){this.setShouldOpenLink(!0)},setPageInteraction:function(event){var selectedPage,newPageIndex,totalPages=FSWidgetModel.gi().widgetState.get("currentItem").get("noOfPages");if(this.interactionType!==InteractOptions.LINK&&(event.preventDefault(),event.stopPropagation()),this.registerClickEvent(),this.sendClickNotification(),this.interactionType!==InteractOptions.POPIN||this.interaction.openActionType!==InteractionPopinTrigger.CLICK)switch(this.actionType){case GoToActions.GO_TO_PREV_PAGE:Backbone.Mediator.pub(WidgetEvent.PREV_PAGE);break;case GoToActions.GO_TO_NEXT_PAGE:Backbone.Mediator.pub(WidgetEvent.NEXT_PAGE);break;case GoToActions.GO_TO_FIRST_PAGE:Backbone.Mediator.pub(WidgetEvent.CHANGE_PAGE,0);break;case GoToActions.GO_TO_LAST_PAGE:Backbone.Mediator.pub(WidgetEvent.CHANGE_PAGE,totalPages-1);break;case GoToActions.GO_TO_PAGE:selectedPage=parseInt(this.interaction.pageNumber||1,10)-1,newPageIndex=FSWidgetModel.gi().singlePageView||selectedPage%2!=0?selectedPage:selectedPage-1,newPageIndex=Math.min(Math.max(0,newPageIndex),totalPages-1),FSWidgetModel.gi().arabicStyle&&(newPageIndex=totalPages-newPageIndex-1),Backbone.Mediator.pub(WidgetEvent.CHANGE_PAGE,newPageIndex)}else this.togglePopin()},showPopin:function(){var objData=_.extend({cid:this.cid},this.model.attributes);this.trigger(CustomContentEvent.SHOW_CUSTOM_INTERACTION_POPIN,objData)},hidePopin:function(){this.trigger(CustomContentEvent.HIDE_CUSTOM_INTERACTION_POPIN)},togglePopin:function(){var objData=_.extend({cid:this.cid},this.model.attributes);this.trigger(CustomContentEvent.TOGGLE_CUSTOM_INTERACTION_POPIN,objData)},registerClickEvent:function(){Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:Stats.TYPE.CLICK_ELEMENT,pid:this.model.get("pid"),elid:this.model.get("eID")})},sendClickNotification:function(){Backbone.Mediator.pub(CustomContentEvent.CUSTOM_CONTENT_CLICK,this.model)},remove:function(){this.button&&this.button.off(),Backbone.View.prototype.remove.apply(this,arguments)}}),AudioPlayer=Backbone.View.extend({initialize:function(){this.isPlaying=!1,this.audioPlayer=this.createAudioPlayer(),Backbone.Mediator.sub(CustomContentEvent.PLAY_AUDIO,this.playAudio,this),Backbone.Mediator.sub(CustomContentEvent.STOP_AUDIO,this.stopAudio,this)},createAudioPlayer:function(){var player=document.createElement("audio"),self=this;return player.id="audioPlayer",player.preload="auto",player.style.position="absolute",player.addEventListener("ended",function(){self.hAudioEnd()}),player},playAudio:function(obj){this.audioPlayer&&this.isPlaying&&this.stopAudio(),this.model.set("audioHash",obj.audioHash),this.model.set("pageIndex",obj.pageIndex),this.model.set("customElementIndex",obj.customElementIndex);var extension=FSWidgetModel.gi().get("isDownload")?".mp3":"";this.audioPlayer&&(this.audioPlayer.src=URLPaths.UPLOADS_PATH+this.model.get("audioHash")+extension,this.audioPlayer.play(),this.isPlaying=!0,Backbone.Mediator.pub(CustomContentEvent.AUDIO_STARTED,{pageIndex:this.model.get("pageIndex"),customElementIndex:this.model.get("customElementIndex"),audioHash:this.model.get("audioHash")}))},stopAudio:function(){this.audioPlayer&&this.isPlaying&&(this.audioPlayer.pause(),this.audioPlayer.currentTime=0,this.hAudioEnd())},hAudioEnd:function(){this.isPlaying=!1,Backbone.Mediator.pub(CustomContentEvent.AUDIO_STOPPED,{pageIndex:this.model.get("pageIndex"),customElementIndex:this.model.get("customElementIndex"),audioHash:this.model.get("audioHash")})}});AudioPlayer._instance=null,AudioPlayer.gi=function(){return AudioPlayer._instance||(AudioPlayer._instance=new AudioPlayer({model:new Backbone.Model})),AudioPlayer._instance};var ImageMaskView=Backbone.View.extend({className:"image-mask custom-element",events:{click:"onClick"},initialize:function(){this.clipPathID="mask_"+this.model.get("elementPageIndex")+"_"+this.model.get("index"),this.svg=null,this.path=null,this.svgimg=null,this.pathWidth=0,this.pathHeight=0,this.imgSrcAppend=null,this.preloadImage=new Image,this.loadMaskShape(),this.resize(this.model.get("scale"))},render:function(){return this},resize:function(scale){this.model.set("scale",scale),this.model.setBounds(),this.$el.css({width:this.model.get("w")+"px",height:this.model.get("h")+"px",left:this.model.get("x")+"px",top:this.model.get("y")+"px"}),this.svg&&(this.setShapeSize(),this.setImageSize())},createImage:function(){this.model.get("src").length>0&&(this.svgimg=document.createElementNS(ImageMaskView.SVG_NAMESPACE,"image"),this.svgimg.setAttribute("clip-path","url(#"+this.clipPathID+")"),this.svg.appendChild(this.svgimg))},loadMaskShape:function(){var sl,_this,shapeId=parseInt(this.model.get("shape"),10);(shapeId=0===shapeId?1:shapeId)&&(SvgLoader.getLoadedShapes()[shapeId]?this.renderShape($(SvgLoader.getLoadedShapes()[shapeId])):(sl=new SvgLoader(shapeId,SymbolType.SHAPE),_this=this,sl.loadSVG(_this,function(svgString){SvgLoader.addLoadedShape(shapeId,svgString),_this.renderShape(svgString)})))},renderShape:function(shapeStr){this.createMask($(shapeStr)),this.setShapeSize(),this.createImage(),this.setImageSize(),this.$el[0].appendChild(this.svg),this.$el.css("opacity",parseFloat(this.model.get("alpha")))},createMask:function(svgData){parseInt(this.model.get("rotation"),10);var mask,svg=document.createElementNS(ImageMaskView.SVG_NAMESPACE,"svg"),pathSize=svgData[0].attributes.viewBox.value.split(" ");svg.setAttribute("xmlns:xlink",ImageMaskView.XLINK_NAMESPACE),this.pathWidth=parseInt(pathSize[2],10),this.pathHeight=parseInt(pathSize[3],10),(mask=document.createElementNS(ImageMaskView.SVG_NAMESPACE,"clipPath")).setAttribute("id",this.clipPathID),svg.appendChild(mask),this.path=document.createElementNS(ImageMaskView.SVG_NAMESPACE,"path"),this.path.setAttribute("fill","#807F7D"),this.path.setAttribute("d",$(svgData).find("path").attr("d")),mask.appendChild(this.path),this.svg=svg},setShapeSize:function(){var pathScaleX,pathScaleY,strCss="",rotation=parseInt(this.model.get("rotation"),10),shapeWidth=this.model.get("w"),shapeHeight=this.model.get("h"),offset=Math.abs(shapeWidth-shapeHeight)/2,scaleX=shapeWidth/parseFloat(this.model.get("bounds").split(",")[2]),rounded=ImageMaskView.ROUNDED_RECTANGLE_RADIUS*scaleX;0===parseInt(this.model.get("shape"),10)&&"true"===this.model.get("roundedCorners")&&(strCss+="border-radius: "+rounded+"px;"),rotation>0&&(strCss+="transform: rotateZ("+rotation+"deg);",90!==rotation&&270!==rotation||FSWidgetModel.gi().widgetSettings.get("editorVersion")||(offset>0&&(strCss+="margin-left:"+(shapeWidth/shapeHeight>1?offset:-offset)+"px;margin-top:"+(shapeWidth/shapeHeight>1?-offset:offset)+"px;"),shapeWidth=this.model.get("h"),shapeHeight=this.model.get("w"))),this.svg.setAttribute("style",strCss),this.svg.setAttribute("width",shapeWidth.toString()),this.svg.setAttribute("height",shapeHeight.toString()),this.svg.setAttribute("viewbox","0 0 "+shapeWidth+" "+shapeHeight),pathScaleX=shapeWidth/this.pathWidth,pathScaleY=shapeHeight/this.pathHeight,this.path.setAttribute("transform","scale("+pathScaleX+", "+pathScaleY+")")},setImageSize:function(){this.svgimg.setAttribute("width",this.model.get("imgw").toString()),this.svgimg.setAttribute("height",this.model.get("imgh").toString()),this.svgimg.setAttribute("x",this.model.get("imgx").toString()),this.svgimg.setAttribute("y",this.model.get("imgy").toString()),this.loadImageSpecificSize()},onClick:function(){this.registerClickEvent(),this.sendClickNotification()},registerClickEvent:function(){Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:Stats.TYPE.CLICK_ELEMENT,pid:this.model.get("pid"),elid:this.model.get("eID")})},sendClickNotification:function(){Backbone.Mediator.pub(CustomContentEvent.CUSTOM_CONTENT_CLICK,this.model)},loadImageSpecificSize:function(){var imgSrcAppend=this.getImageSrcAppend();this.imgSrcAppend!==imgSrcAppend&&(this.imgSrcAppend=imgSrcAppend,this.loadImage(imgSrcAppend))},getImageSrcAppend:function(){var imgType=null;return imgType=(imgType=FSUtils.getImageSizeType(this.model.get("imgw"),this.model.get("imgh")))===ImageTypes.THUMB?ImageTypes.SMALL:imgType,ImageSizeAppend[imgType]},loadImage:function(append){var self=this,imageLoaded=function(){self.svgimg.setAttributeNS(ImageMaskView.XLINK_NAMESPACE,"href",self.preloadImage.src)},imageError=function(){self.preloadImage.removeEventListener("error",imageError,self),self.preloadImage.src=self.model.getImageURL(self.model.get("src"),self.model.get("subType"))};this.preloadImage.removeEventListener("load",imageLoaded,this),this.preloadImage.removeEventListener("error",imageError,this),this.preloadImage.addEventListener("load",imageLoaded,this),this.preloadImage.addEventListener("error",imageError,this),this.preloadImage.src=this.model.getImageURL(this.model.get("src")+append,this.model.get("subType"))}});ImageMaskView.SVG_NAMESPACE="http://www.w3.org/2000/svg",ImageMaskView.XLINK_NAMESPACE="http://www.w3.org/1999/xlink",ImageMaskView.ROUNDED_RECTANGLE_RADIUS=20;var EmbedElemetView=Backbone.View.extend({placeHolderTemplate:_.template(CustomContentTemplates.embedPlaceHolder),template:_.template(CustomContentTemplates.embedIframe),className:"embed-element custom-element",events:{click:"onClick"},initialize:function(){this.$iframe=null},onClick:function(){this.registerClickEvent(),this.sendClickNotification()},sendClickNotification:function(){Backbone.Mediator.pub(CustomContentEvent.CUSTOM_CONTENT_CLICK,this.model)},registerClickEvent:function(){Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:Stats.TYPE.CLICK_ELEMENT,pid:this.model.get("pid"),elid:this.model.get("eID")})},resize:function(scale){scale!==this.model.get("scale")&&(this.model.set("scale",scale),this.model.setBounds(),this.setCSS())},setCSS:function(){this.$el.width(this.model.get("w")).height(this.model.get("h")).css({left:this.model.get("x")+"px",top:this.model.get("y")+"px"})},render:function(){return this.model.get("content")&&this.model.get("content").length&&this.model.get("valid")?this.$el.html(this.template({content:encodeURIComponent(this.model.get("content")),baseUrl:FlipSnackEmbed.urls.baseUrl,htmlSources:FlipSnackEmbed.urls.htmlSources})):this.$el.html(this.placeHolderTemplate(this.model.attributes)),this.$iframe=this.$el.find("iframe"),this.$iframe&&this.$iframe.is("iframe")&&(this.$iframe.removeAttr("allowfullscreen"),this.$iframe.removeAttr("allow")),this.setCSS(),this},remove:function(){Backbone.View.prototype.remove.apply(this,arguments)}}),ProductTagView=Backbone.View.extend({template:_.template(CustomContentTemplates.productTag),className:"product-tag custom-tag custom-element",events:{click:"onClick"},onClick:function(){Backbone.Mediator.pub(WidgetEvent.OPEN_PRODUCT_TAG_POPIN,this.model.attributes),this.registerClickEvent(),this.sendClickNotification()},sendClickNotification:function(){Backbone.Mediator.pub(CustomContentEvent.CUSTOM_CONTENT_CLICK,this.model)},registerClickEvent:function(){Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:Stats.TYPE.CLICK_ELEMENT,pid:this.model.get("pid"),elid:this.model.get("eID")})},resize:function(scale){scale!==this.model.get("scale")&&(this.model.set("scale",scale),this.model.setBounds(),this.setCSS(),Backbone.Mediator.pub(WidgetEvent.SCALE_PRODUCT_TAG_POPIN,scale))},setCSS:function(){var a=this.model.attributes;this.$el.css({left:a.x,top:a.y,width:this.model.get("w"),height:this.model.get("h")}),this.colorRing.css({border:this.model.get("w")/6+"px solid #"+a.color,left:2,top:2,width:this.model.get("w")-4,height:this.model.get("h")-4,opacity:this.model.get("alpha")||0===this.model.get("alpha")?this.model.get("alpha"):1}),this.innerTag.css({background:"#"+a.color})},render:function(){return this.$el.html(this.template()),this.tag=this.$el.find(".tag"),this.animationRing=this.tag.find(".animation-ring"),this.colorRingHover=this.tag.find(".color-ring-hover"),this.colorRing=this.tag.find(".color-ring"),this.innerTag=this.tag.find(".inner-tag"),this.setCSS(),this},remove:function(){Backbone.View.prototype.remove.apply(this,arguments)}});
//# sourceMappingURL=maps/customcontent.min.js.map
