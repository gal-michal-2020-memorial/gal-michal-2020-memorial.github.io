!function(global,factory){"object"==typeof module&&"object"==typeof module.exports?module.exports=global.document?factory(global,!0):function(w){if(!w.document)throw new Error("jQuery requires a window with a document");return factory(w)}:factory(global)}("undefined"!=typeof window?window:this,function(window,noGlobal){var arr=[],document=window.document,slice=arr.slice,concat=arr.concat,push=arr.push,indexOf=arr.indexOf,class2type={},toString=class2type.toString,hasOwn=class2type.hasOwnProperty,support={},jQuery=function(selector,context){return new jQuery.fn.init(selector,context)},rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(all,letter){return letter.toUpperCase()};function isArrayLike(obj){var length=!!obj&&"length"in obj&&obj.length,type=jQuery.type(obj);return"function"!==type&&!jQuery.isWindow(obj)&&("array"===type||0===length||"number"==typeof length&&length>0&&length-1 in obj)}jQuery.fn=jQuery.prototype={jquery:"2.2.3",constructor:jQuery,selector:"",length:0,toArray:function(){return slice.call(this)},get:function(num){return null!=num?num<0?this[num+this.length]:this[num]:slice.call(this)},pushStack:function(elems){var ret=jQuery.merge(this.constructor(),elems);return ret.prevObject=this,ret.context=this.context,ret},each:function(callback){return jQuery.each(this,callback)},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem)}))},slice:function(){return this.pushStack(slice.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(i){var len=this.length,j=+i+(i<0?len:0);return this.pushStack(j>=0&&j<len?[this[j]]:[])},end:function(){return this.prevObject||this.constructor()},push:push,sort:arr.sort,splice:arr.splice},jQuery.extend=jQuery.fn.extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=!1;for("boolean"==typeof target&&(deep=target,target=arguments[i]||{},i++),"object"==typeof target||jQuery.isFunction(target)||(target={}),i===length&&(target=this,i--);i<length;i++)if(null!=(options=arguments[i]))for(name in options)src=target[name],target!==(copy=options[name])&&(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))?(copyIsArray?(copyIsArray=!1,clone=src&&jQuery.isArray(src)?src:[]):clone=src&&jQuery.isPlainObject(src)?src:{},target[name]=jQuery.extend(deep,clone,copy)):void 0!==copy&&(target[name]=copy));return target},jQuery.extend({expando:"jQuery"+("2.2.3"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(msg){throw new Error(msg)},noop:function(){},isFunction:function(obj){return"function"===jQuery.type(obj)},isArray:Array.isArray,isWindow:function(obj){return null!=obj&&obj===obj.window},isNumeric:function(obj){var realStringObj=obj&&obj.toString();return!jQuery.isArray(obj)&&realStringObj-parseFloat(realStringObj)+1>=0},isPlainObject:function(obj){var key;if("object"!==jQuery.type(obj)||obj.nodeType||jQuery.isWindow(obj))return!1;if(obj.constructor&&!hasOwn.call(obj,"constructor")&&!hasOwn.call(obj.constructor.prototype||{},"isPrototypeOf"))return!1;for(key in obj);return void 0===key||hasOwn.call(obj,key)},isEmptyObject:function(obj){var name;for(name in obj)return!1;return!0},type:function(obj){return null==obj?obj+"":"object"==typeof obj||"function"==typeof obj?class2type[toString.call(obj)]||"object":typeof obj},globalEval:function(code){var script,indirect=eval;(code=jQuery.trim(code))&&(1===code.indexOf("use strict")?((script=document.createElement("script")).text=code,document.head.appendChild(script).parentNode.removeChild(script)):indirect(code))},camelCase:function(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase()},each:function(obj,callback){var length,i=0;if(isArrayLike(obj))for(length=obj.length;i<length&&!1!==callback.call(obj[i],i,obj[i]);i++);else for(i in obj)if(!1===callback.call(obj[i],i,obj[i]))break;return obj},trim:function(text){return null==text?"":(text+"").replace(rtrim,"")},makeArray:function(arr,results){var ret=results||[];return null!=arr&&(isArrayLike(Object(arr))?jQuery.merge(ret,"string"==typeof arr?[arr]:arr):push.call(ret,arr)),ret},inArray:function(elem,arr,i){return null==arr?-1:indexOf.call(arr,elem,i)},merge:function(first,second){for(var len=+second.length,j=0,i=first.length;j<len;j++)first[i++]=second[j];return first.length=i,first},grep:function(elems,callback,invert){for(var matches=[],i=0,length=elems.length,callbackExpect=!invert;i<length;i++)!callback(elems[i],i)!==callbackExpect&&matches.push(elems[i]);return matches},map:function(elems,callback,arg){var length,value,i=0,ret=[];if(isArrayLike(elems))for(length=elems.length;i<length;i++)null!=(value=callback(elems[i],i,arg))&&ret.push(value);else for(i in elems)null!=(value=callback(elems[i],i,arg))&&ret.push(value);return concat.apply([],ret)},guid:1,proxy:function(fn,context){var tmp,args,proxy;if("string"==typeof context&&(tmp=fn[context],context=fn,fn=tmp),jQuery.isFunction(fn))return args=slice.call(arguments,2),(proxy=function(){return fn.apply(context||this,args.concat(slice.call(arguments)))}).guid=fn.guid=fn.guid||jQuery.guid++,proxy},now:Date.now,support:support}),"function"==typeof Symbol&&(jQuery.fn[Symbol.iterator]=arr[Symbol.iterator]),jQuery.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase()});var Sizzle=function(window){var i,support,Expr,getText,isXML,tokenize,compile,select,outermostContext,sortInput,hasDuplicate,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando="sizzle"+1*new Date,preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),sortOrder=function(a,b){return a===b&&(hasDuplicate=!0),0},MAX_NEGATIVE=1<<31,hasOwn={}.hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf=function(list,elem){for(var i=0,len=list.length;i<len;i++)if(list[i]===elem)return i;return-1},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",identifier="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",attributes="\\["+whitespace+"*("+identifier+")(?:"+whitespace+"*([*^$|!~]?=)"+whitespace+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+identifier+"))|)"+whitespace+"*\\]",pseudos=":("+identifier+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+attributes+")*)|.*)\\)|)",rwhitespace=new RegExp(whitespace+"+","g"),rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rattributeQuotes=new RegExp("="+whitespace+"*([^\\]'\"]*?)"+whitespace+"*\\]","g"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={ID:new RegExp("^#("+identifier+")"),CLASS:new RegExp("^\\.("+identifier+")"),TAG:new RegExp("^("+identifier+"|[*])"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),bool:new RegExp("^(?:"+booleans+")$","i"),needsContext:new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rsibling=/[+~]/,rescape=/'|\\/g,runescape=new RegExp("\\\\([\\da-f]{1,6}"+whitespace+"?|("+whitespace+")|.)","ig"),funescape=function(_,escaped,escapedWhitespace){var high="0x"+escaped-65536;return high!=high||escapedWhitespace?escaped:high<0?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,1023&high|56320)},unloadHandler=function(){setDocument()};try{push.apply(arr=slice.call(preferredDoc.childNodes),preferredDoc.childNodes),arr[preferredDoc.childNodes.length].nodeType}catch(e){push={apply:arr.length?function(target,els){push_native.apply(target,slice.call(els))}:function(target,els){for(var j=target.length,i=0;target[j++]=els[i++];);target.length=j-1}}}function Sizzle(selector,context,results,seed){var m,i,elem,nid,nidselect,match,groups,newSelector,newContext=context&&context.ownerDocument,nodeType=context?context.nodeType:9;if(results=results||[],"string"!=typeof selector||!selector||1!==nodeType&&9!==nodeType&&11!==nodeType)return results;if(!seed&&((context?context.ownerDocument||context:preferredDoc)!==document&&setDocument(context),context=context||document,documentIsHTML)){if(11!==nodeType&&(match=rquickExpr.exec(selector)))if(m=match[1]){if(9===nodeType){if(!(elem=context.getElementById(m)))return results;if(elem.id===m)return results.push(elem),results}else if(newContext&&(elem=newContext.getElementById(m))&&contains(context,elem)&&elem.id===m)return results.push(elem),results}else{if(match[2])return push.apply(results,context.getElementsByTagName(selector)),results;if((m=match[3])&&support.getElementsByClassName&&context.getElementsByClassName)return push.apply(results,context.getElementsByClassName(m)),results}if(support.qsa&&!compilerCache[selector+" "]&&(!rbuggyQSA||!rbuggyQSA.test(selector))){if(1!==nodeType)newContext=context,newSelector=selector;else if("object"!==context.nodeName.toLowerCase()){for((nid=context.getAttribute("id"))?nid=nid.replace(rescape,"\\$&"):context.setAttribute("id",nid=expando),i=(groups=tokenize(selector)).length,nidselect=ridentifier.test(nid)?"#"+nid:"[id='"+nid+"']";i--;)groups[i]=nidselect+" "+toSelector(groups[i]);newSelector=groups.join(","),newContext=rsibling.test(selector)&&testContext(context.parentNode)||context}if(newSelector)try{return push.apply(results,newContext.querySelectorAll(newSelector)),results}catch(qsaError){}finally{nid===expando&&context.removeAttribute("id")}}}return select(selector.replace(rtrim,"$1"),context,results,seed)}function createCache(){var keys=[];return function cache(key,value){return keys.push(key+" ")>Expr.cacheLength&&delete cache[keys.shift()],cache[key+" "]=value}}function markFunction(fn){return fn[expando]=!0,fn}function assert(fn){var div=document.createElement("div");try{return!!fn(div)}catch(e){return!1}finally{div.parentNode&&div.parentNode.removeChild(div),div=null}}function addHandle(attrs,handler){for(var arr=attrs.split("|"),i=arr.length;i--;)Expr.attrHandle[arr[i]]=handler}function siblingCheck(a,b){var cur=b&&a,diff=cur&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||MAX_NEGATIVE)-(~a.sourceIndex||MAX_NEGATIVE);if(diff)return diff;if(cur)for(;cur=cur.nextSibling;)if(cur===b)return-1;return a?1:-1}function createInputPseudo(type){return function(elem){return"input"===elem.nodeName.toLowerCase()&&elem.type===type}}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return("input"===name||"button"===name)&&elem.type===type}}function createPositionalPseudo(fn){return markFunction(function(argument){return argument=+argument,markFunction(function(seed,matches){for(var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;i--;)seed[j=matchIndexes[i]]&&(seed[j]=!(matches[j]=seed[j]))})})}function testContext(context){return context&&void 0!==context.getElementsByTagName&&context}for(i in support=Sizzle.support={},isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return!!documentElement&&"HTML"!==documentElement.nodeName},setDocument=Sizzle.setDocument=function(node){var hasCompare,parent,doc=node?node.ownerDocument||node:preferredDoc;return doc!==document&&9===doc.nodeType&&doc.documentElement?(docElem=(document=doc).documentElement,documentIsHTML=!isXML(document),(parent=document.defaultView)&&parent.top!==parent&&(parent.addEventListener?parent.addEventListener("unload",unloadHandler,!1):parent.attachEvent&&parent.attachEvent("onunload",unloadHandler)),support.attributes=assert(function(div){return div.className="i",!div.getAttribute("className")}),support.getElementsByTagName=assert(function(div){return div.appendChild(document.createComment("")),!div.getElementsByTagName("*").length}),support.getElementsByClassName=rnative.test(document.getElementsByClassName),support.getById=assert(function(div){return docElem.appendChild(div).id=expando,!document.getElementsByName||!document.getElementsByName(expando).length}),support.getById?(Expr.find.ID=function(id,context){if(void 0!==context.getElementById&&documentIsHTML){var m=context.getElementById(id);return m?[m]:[]}},Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId}}):(delete Expr.find.ID,Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){var node=void 0!==elem.getAttributeNode&&elem.getAttributeNode("id");return node&&node.value===attrId}}),Expr.find.TAG=support.getElementsByTagName?function(tag,context){return void 0!==context.getElementsByTagName?context.getElementsByTagName(tag):support.qsa?context.querySelectorAll(tag):void 0}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if("*"===tag){for(;elem=results[i++];)1===elem.nodeType&&tmp.push(elem);return tmp}return results},Expr.find.CLASS=support.getElementsByClassName&&function(className,context){if(void 0!==context.getElementsByClassName&&documentIsHTML)return context.getElementsByClassName(className)},rbuggyMatches=[],rbuggyQSA=[],(support.qsa=rnative.test(document.querySelectorAll))&&(assert(function(div){docElem.appendChild(div).innerHTML="<a id='"+expando+"'></a><select id='"+expando+"-\r\\' msallowcapture=''><option selected=''></option></select>",div.querySelectorAll("[msallowcapture^='']").length&&rbuggyQSA.push("[*^$]="+whitespace+"*(?:''|\"\")"),div.querySelectorAll("[selected]").length||rbuggyQSA.push("\\["+whitespace+"*(?:value|"+booleans+")"),div.querySelectorAll("[id~="+expando+"-]").length||rbuggyQSA.push("~="),div.querySelectorAll(":checked").length||rbuggyQSA.push(":checked"),div.querySelectorAll("a#"+expando+"+*").length||rbuggyQSA.push(".#.+[+~]")}),assert(function(div){var input=document.createElement("input");input.setAttribute("type","hidden"),div.appendChild(input).setAttribute("name","D"),div.querySelectorAll("[name=d]").length&&rbuggyQSA.push("name"+whitespace+"*[*^$|!~]?="),div.querySelectorAll(":enabled").length||rbuggyQSA.push(":enabled",":disabled"),div.querySelectorAll("*,:x"),rbuggyQSA.push(",.*:")})),(support.matchesSelector=rnative.test(matches=docElem.matches||docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector))&&assert(function(div){support.disconnectedMatch=matches.call(div,"div"),matches.call(div,"[s!='']:x"),rbuggyMatches.push("!=",pseudos)}),rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|")),rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|")),hasCompare=rnative.test(docElem.compareDocumentPosition),contains=hasCompare||rnative.test(docElem.contains)?function(a,b){var adown=9===a.nodeType?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!(!bup||1!==bup.nodeType||!(adown.contains?adown.contains(bup):a.compareDocumentPosition&&16&a.compareDocumentPosition(bup)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},sortOrder=hasCompare?function(a,b){if(a===b)return hasDuplicate=!0,0;var compare=!a.compareDocumentPosition-!b.compareDocumentPosition;return compare||(1&(compare=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1)||!support.sortDetached&&b.compareDocumentPosition(a)===compare?a===document||a.ownerDocument===preferredDoc&&contains(preferredDoc,a)?-1:b===document||b.ownerDocument===preferredDoc&&contains(preferredDoc,b)?1:sortInput?indexOf(sortInput,a)-indexOf(sortInput,b):0:4&compare?-1:1)}:function(a,b){if(a===b)return hasDuplicate=!0,0;var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(!aup||!bup)return a===document?-1:b===document?1:aup?-1:bup?1:sortInput?indexOf(sortInput,a)-indexOf(sortInput,b):0;if(aup===bup)return siblingCheck(a,b);for(cur=a;cur=cur.parentNode;)ap.unshift(cur);for(cur=b;cur=cur.parentNode;)bp.unshift(cur);for(;ap[i]===bp[i];)i++;return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0},document):document},Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)},Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document&&setDocument(elem),expr=expr.replace(rattributeQuotes,"='$1']"),support.matchesSelector&&documentIsHTML&&!compilerCache[expr+" "]&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr)))try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&11!==elem.document.nodeType)return ret}catch(e){}return Sizzle(expr,document,null,[elem]).length>0},Sizzle.contains=function(context,elem){return(context.ownerDocument||context)!==document&&setDocument(context),contains(context,elem)},Sizzle.attr=function(elem,name){(elem.ownerDocument||elem)!==document&&setDocument(elem);var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):void 0;return void 0!==val?val:support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null},Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)},Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;if(hasDuplicate=!support.detectDuplicates,sortInput=!support.sortStable&&results.slice(0),results.sort(sortOrder),hasDuplicate){for(;elem=results[i++];)elem===results[i]&&(j=duplicates.push(i));for(;j--;)results.splice(duplicates[j],1)}return sortInput=null,results},getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(nodeType){if(1===nodeType||9===nodeType||11===nodeType){if("string"==typeof elem.textContent)return elem.textContent;for(elem=elem.firstChild;elem;elem=elem.nextSibling)ret+=getText(elem)}else if(3===nodeType||4===nodeType)return elem.nodeValue}else for(;node=elem[i++];)ret+=getText(node);return ret},(Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){return match[1]=match[1].replace(runescape,funescape),match[3]=(match[3]||match[4]||match[5]||"").replace(runescape,funescape),"~="===match[2]&&(match[3]=" "+match[3]+" "),match.slice(0,4)},CHILD:function(match){return match[1]=match[1].toLowerCase(),"nth"===match[1].slice(0,3)?(match[3]||Sizzle.error(match[0]),match[4]=+(match[4]?match[5]+(match[6]||1):2*("even"===match[3]||"odd"===match[3])),match[5]=+(match[7]+match[8]||"odd"===match[3])):match[3]&&Sizzle.error(match[0]),match},PSEUDO:function(match){var excess,unquoted=!match[6]&&match[2];return matchExpr.CHILD.test(match[0])?null:(match[3]?match[2]=match[4]||match[5]||"":unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,!0))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)&&(match[0]=match[0].slice(0,excess),match[2]=unquoted.slice(0,excess)),match.slice(0,3))}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return"*"===nodeNameSelector?function(){return!0}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test("string"==typeof elem.className&&elem.className||void 0!==elem.getAttribute&&elem.getAttribute("class")||"")})},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);return null==result?"!="===operator:!operator||(result+="","="===operator?result===check:"!="===operator?result!==check:"^="===operator?check&&0===result.indexOf(check):"*="===operator?check&&result.indexOf(check)>-1:"$="===operator?check&&result.slice(-check.length)===check:"~="===operator?(" "+result.replace(rwhitespace," ")+" ").indexOf(check)>-1:"|="===operator&&(result===check||result.slice(0,check.length+1)===check+"-"))}},CHILD:function(type,what,argument,first,last){var simple="nth"!==type.slice(0,3),forward="last"!==type.slice(-4),ofType="of-type"===what;return 1===first&&0===last?function(elem){return!!elem.parentNode}:function(elem,context,xml){var cache,uniqueCache,outerCache,node,nodeIndex,start,dir=simple!==forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType,diff=!1;if(parent){if(simple){for(;dir;){for(node=elem;node=node[dir];)if(ofType?node.nodeName.toLowerCase()===name:1===node.nodeType)return!1;start=dir="only"===type&&!start&&"nextSibling"}return!0}if(start=[forward?parent.firstChild:parent.lastChild],forward&&useCache){for(diff=(nodeIndex=(cache=(uniqueCache=(outerCache=(node=parent)[expando]||(node[expando]={}))[node.uniqueID]||(outerCache[node.uniqueID]={}))[type]||[])[0]===dirruns&&cache[1])&&cache[2],node=nodeIndex&&parent.childNodes[nodeIndex];node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop();)if(1===node.nodeType&&++diff&&node===elem){uniqueCache[type]=[dirruns,nodeIndex,diff];break}}else if(useCache&&(diff=nodeIndex=(cache=(uniqueCache=(outerCache=(node=elem)[expando]||(node[expando]={}))[node.uniqueID]||(outerCache[node.uniqueID]={}))[type]||[])[0]===dirruns&&cache[1]),!1===diff)for(;(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop())&&((ofType?node.nodeName.toLowerCase()!==name:1!==node.nodeType)||!++diff||(useCache&&((uniqueCache=(outerCache=node[expando]||(node[expando]={}))[node.uniqueID]||(outerCache[node.uniqueID]={}))[type]=[dirruns,diff]),node!==elem)););return(diff-=last)===first||diff%first==0&&diff/first>=0}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);return fn[expando]?fn(argument):fn.length>1?(args=[pseudo,pseudo,"",argument],Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){for(var idx,matched=fn(seed,argument),i=matched.length;i--;)seed[idx=indexOf(seed,matched[i])]=!(matches[idx]=matched[i])}):function(elem){return fn(elem,0,args)}):fn}},pseudos:{not:markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){for(var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;i--;)(elem=unmatched[i])&&(seed[i]=!(matches[i]=elem))}):function(elem,context,xml){return input[0]=elem,matcher(input,null,xml,results),input[0]=null,!results.pop()}}),has:markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0}}),contains:markFunction(function(text){return text=text.replace(runescape,funescape),function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1}}),lang:markFunction(function(lang){return ridentifier.test(lang||"")||Sizzle.error("unsupported lang: "+lang),lang=lang.replace(runescape,funescape).toLowerCase(),function(elem){var elemLang;do{if(elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang"))return(elemLang=elemLang.toLowerCase())===lang||0===elemLang.indexOf(lang+"-")}while((elem=elem.parentNode)&&1===elem.nodeType);return!1}}),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:function(elem){return!1===elem.disabled},disabled:function(elem){return!0===elem.disabled},checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return"input"===nodeName&&!!elem.checked||"option"===nodeName&&!!elem.selected},selected:function(elem){return elem.parentNode&&elem.parentNode.selectedIndex,!0===elem.selected},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling)if(elem.nodeType<6)return!1;return!0},parent:function(elem){return!Expr.pseudos.empty(elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return"input"===name&&"button"===elem.type||"button"===name},text:function(elem){var attr;return"input"===elem.nodeName.toLowerCase()&&"text"===elem.type&&(null==(attr=elem.getAttribute("type"))||"text"===attr.toLowerCase())},first:createPositionalPseudo(function(){return[0]}),last:createPositionalPseudo(function(matchIndexes,length){return[length-1]}),eq:createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument]}),even:createPositionalPseudo(function(matchIndexes,length){for(var i=0;i<length;i+=2)matchIndexes.push(i);return matchIndexes}),odd:createPositionalPseudo(function(matchIndexes,length){for(var i=1;i<length;i+=2)matchIndexes.push(i);return matchIndexes}),lt:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;--i>=0;)matchIndexes.push(i);return matchIndexes}),gt:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;++i<length;)matchIndexes.push(i);return matchIndexes})}}).pseudos.nth=Expr.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})Expr.pseudos[i]=createInputPseudo(i);for(i in{submit:!0,reset:!0})Expr.pseudos[i]=createButtonPseudo(i);function setFilters(){}function toSelector(tokens){for(var i=0,len=tokens.length,selector="";i<len;i++)selector+=tokens[i].value;return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&"parentNode"===dir,doneName=done++;return combinator.first?function(elem,context,xml){for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements)return matcher(elem,context,xml)}:function(elem,context,xml){var oldCache,uniqueCache,outerCache,newCache=[dirruns,doneName];if(xml){for(;elem=elem[dir];)if((1===elem.nodeType||checkNonElements)&&matcher(elem,context,xml))return!0}else for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements){if((oldCache=(uniqueCache=(outerCache=elem[expando]||(elem[expando]={}))[elem.uniqueID]||(outerCache[elem.uniqueID]={}))[dir])&&oldCache[0]===dirruns&&oldCache[1]===doneName)return newCache[2]=oldCache[2];if(uniqueCache[dir]=newCache,newCache[2]=matcher(elem,context,xml))return!0}}}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){for(var i=matchers.length;i--;)if(!matchers[i](elem,context,xml))return!1;return!0}:matchers[0]}function condense(unmatched,map,filter,context,xml){for(var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=null!=map;i<len;i++)(elem=unmatched[i])&&(filter&&!filter(elem,context,xml)||(newUnmatched.push(elem),mapped&&map.push(i)));return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){return postFilter&&!postFilter[expando]&&(postFilter=setMatcher(postFilter)),postFinder&&!postFinder[expando]&&(postFinder=setMatcher(postFinder,postSelector)),markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||function(selector,contexts,results){for(var i=0,len=contexts.length;i<len;i++)Sizzle(selector,contexts[i],results);return results}(selector||"*",context.nodeType?[context]:context,[]),matcherIn=!preFilter||!seed&&selector?elems:condense(elems,preMap,preFilter,context,xml),matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher&&matcher(matcherIn,matcherOut,context,xml),postFilter)for(temp=condense(matcherOut,postMap),postFilter(temp,[],context,xml),i=temp.length;i--;)(elem=temp[i])&&(matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem));if(seed){if(postFinder||preFilter){if(postFinder){for(temp=[],i=matcherOut.length;i--;)(elem=matcherOut[i])&&temp.push(matcherIn[i]=elem);postFinder(null,matcherOut=[],temp,xml)}for(i=matcherOut.length;i--;)(elem=matcherOut[i])&&(temp=postFinder?indexOf(seed,elem):preMap[i])>-1&&(seed[temp]=!(results[temp]=elem))}}else matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut),postFinder?postFinder(null,results,matcherOut,xml):push.apply(results,matcherOut)})}function matcherFromTokens(tokens){for(var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext},implicitRelative,!0),matchAnyContext=addCombinator(function(elem){return indexOf(checkContext,elem)>-1},implicitRelative,!0),matchers=[function(elem,context,xml){var ret=!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml));return checkContext=null,ret}];i<len;i++)if(matcher=Expr.relative[tokens[i].type])matchers=[addCombinator(elementMatcher(matchers),matcher)];else{if((matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches))[expando]){for(j=++i;j<len&&!Expr.relative[tokens[j].type];j++);return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:" "===tokens[i-2].type?"*":""})).replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens(tokens=tokens.slice(j)),j<len&&toSelector(tokens))}matchers.push(matcher)}return elementMatcher(matchers)}return setFilters.prototype=Expr.filters=Expr.pseudos,Expr.setFilters=new setFilters,tokenize=Sizzle.tokenize=function(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached)return parseOnly?0:cached.slice(0);for(soFar=selector,groups=[],preFilters=Expr.preFilter;soFar;){for(type in matched&&!(match=rcomma.exec(soFar))||(match&&(soFar=soFar.slice(match[0].length)||soFar),groups.push(tokens=[])),matched=!1,(match=rcombinators.exec(soFar))&&(matched=match.shift(),tokens.push({value:matched,type:match[0].replace(rtrim," ")}),soFar=soFar.slice(matched.length)),Expr.filter)!(match=matchExpr[type].exec(soFar))||preFilters[type]&&!(match=preFilters[type](match))||(matched=match.shift(),tokens.push({value:matched,type:type,matches:match}),soFar=soFar.slice(matched.length));if(!matched)break}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)},compile=Sizzle.compile=function(selector,match){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){for(match||(match=tokenize(selector)),i=match.length;i--;)(cached=matcherFromTokens(match[i]))[expando]?setMatchers.push(cached):elementMatchers.push(cached);(cached=compilerCache(selector,function(elementMatchers,setMatchers){var bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,outermost){var elem,j,matcher,matchedCount=0,i="0",unmatched=seed&&[],setMatched=[],contextBackup=outermostContext,elems=seed||byElement&&Expr.find.TAG("*",outermost),dirrunsUnique=dirruns+=null==contextBackup?1:Math.random()||.1,len=elems.length;for(outermost&&(outermostContext=context===document||context||outermost);i!==len&&null!=(elem=elems[i]);i++){if(byElement&&elem){for(j=0,context||elem.ownerDocument===document||(setDocument(elem),xml=!documentIsHTML);matcher=elementMatchers[j++];)if(matcher(elem,context||document,xml)){results.push(elem);break}outermost&&(dirruns=dirrunsUnique)}bySet&&((elem=!matcher&&elem)&&matchedCount--,seed&&unmatched.push(elem))}if(matchedCount+=i,bySet&&i!==matchedCount){for(j=0;matcher=setMatchers[j++];)matcher(unmatched,setMatched,context,xml);if(seed){if(matchedCount>0)for(;i--;)unmatched[i]||setMatched[i]||(setMatched[i]=pop.call(results));setMatched=condense(setMatched)}push.apply(results,setMatched),outermost&&!seed&&setMatched.length>0&&matchedCount+setMatchers.length>1&&Sizzle.uniqueSort(results)}return outermost&&(dirruns=dirrunsUnique,outermostContext=contextBackup),unmatched};return bySet?markFunction(superMatcher):superMatcher}(elementMatchers,setMatchers))).selector=selector}return cached},select=Sizzle.select=function(selector,context,results,seed){var i,tokens,token,type,find,compiled="function"==typeof selector&&selector,match=!seed&&tokenize(selector=compiled.selector||selector);if(results=results||[],1===match.length){if((tokens=match[0]=match[0].slice(0)).length>2&&"ID"===(token=tokens[0]).type&&support.getById&&9===context.nodeType&&documentIsHTML&&Expr.relative[tokens[1].type]){if(!(context=(Expr.find.ID(token.matches[0].replace(runescape,funescape),context)||[])[0]))return results;compiled&&(context=context.parentNode),selector=selector.slice(tokens.shift().value.length)}for(i=matchExpr.needsContext.test(selector)?0:tokens.length;i--&&(token=tokens[i],!Expr.relative[type=token.type]);)if((find=Expr.find[type])&&(seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&testContext(context.parentNode)||context))){if(tokens.splice(i,1),!(selector=seed.length&&toSelector(tokens)))return push.apply(results,seed),results;break}}return(compiled||compile(selector,match))(seed,context,!documentIsHTML,results,!context||rsibling.test(selector)&&testContext(context.parentNode)||context),results},support.sortStable=expando.split("").sort(sortOrder).join("")===expando,support.detectDuplicates=!!hasDuplicate,setDocument(),support.sortDetached=assert(function(div1){return 1&div1.compareDocumentPosition(document.createElement("div"))}),assert(function(div){return div.innerHTML="<a href='#'></a>","#"===div.firstChild.getAttribute("href")})||addHandle("type|href|height|width",function(elem,name,isXML){if(!isXML)return elem.getAttribute(name,"type"===name.toLowerCase()?1:2)}),support.attributes&&assert(function(div){return div.innerHTML="<input/>",div.firstChild.setAttribute("value",""),""===div.firstChild.getAttribute("value")})||addHandle("value",function(elem,name,isXML){if(!isXML&&"input"===elem.nodeName.toLowerCase())return elem.defaultValue}),assert(function(div){return null==div.getAttribute("disabled")})||addHandle(booleans,function(elem,name,isXML){var val;if(!isXML)return!0===elem[name]?name.toLowerCase():(val=elem.getAttributeNode(name))&&val.specified?val.value:null}),Sizzle}(window);jQuery.find=Sizzle,jQuery.expr=Sizzle.selectors,jQuery.expr[":"]=jQuery.expr.pseudos,jQuery.uniqueSort=jQuery.unique=Sizzle.uniqueSort,jQuery.text=Sizzle.getText,jQuery.isXMLDoc=Sizzle.isXML,jQuery.contains=Sizzle.contains;var dir=function(elem,dir,until){for(var matched=[],truncate=void 0!==until;(elem=elem[dir])&&9!==elem.nodeType;)if(1===elem.nodeType){if(truncate&&jQuery(elem).is(until))break;matched.push(elem)}return matched},siblings=function(n,elem){for(var matched=[];n;n=n.nextSibling)1===n.nodeType&&n!==elem&&matched.push(n);return matched},rneedsContext=jQuery.expr.match.needsContext,rsingleTag=/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/,risSimple=/^.[^:#\[\.,]*$/;function winnow(elements,qualifier,not){if(jQuery.isFunction(qualifier))return jQuery.grep(elements,function(elem,i){return!!qualifier.call(elem,i,elem)!==not});if(qualifier.nodeType)return jQuery.grep(elements,function(elem){return elem===qualifier!==not});if("string"==typeof qualifier){if(risSimple.test(qualifier))return jQuery.filter(qualifier,elements,not);qualifier=jQuery.filter(qualifier,elements)}return jQuery.grep(elements,function(elem){return indexOf.call(qualifier,elem)>-1!==not})}jQuery.filter=function(expr,elems,not){var elem=elems[0];return not&&(expr=":not("+expr+")"),1===elems.length&&1===elem.nodeType?jQuery.find.matchesSelector(elem,expr)?[elem]:[]:jQuery.find.matches(expr,jQuery.grep(elems,function(elem){return 1===elem.nodeType}))},jQuery.fn.extend({find:function(selector){var i,len=this.length,ret=[],self=this;if("string"!=typeof selector)return this.pushStack(jQuery(selector).filter(function(){for(i=0;i<len;i++)if(jQuery.contains(self[i],this))return!0}));for(i=0;i<len;i++)jQuery.find(selector,self[i],ret);return(ret=this.pushStack(len>1?jQuery.unique(ret):ret)).selector=this.selector?this.selector+" "+selector:selector,ret},filter:function(selector){return this.pushStack(winnow(this,selector||[],!1))},not:function(selector){return this.pushStack(winnow(this,selector||[],!0))},is:function(selector){return!!winnow(this,"string"==typeof selector&&rneedsContext.test(selector)?jQuery(selector):selector||[],!1).length}});var rootjQuery,rquickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/;(jQuery.fn.init=function(selector,context,root){var match,elem;if(!selector)return this;if(root=root||rootjQuery,"string"==typeof selector){if(!(match="<"===selector[0]&&">"===selector[selector.length-1]&&selector.length>=3?[null,selector,null]:rquickExpr.exec(selector))||!match[1]&&context)return!context||context.jquery?(context||root).find(selector):this.constructor(context).find(selector);if(match[1]){if(context=context instanceof jQuery?context[0]:context,jQuery.merge(this,jQuery.parseHTML(match[1],context&&context.nodeType?context.ownerDocument||context:document,!0)),rsingleTag.test(match[1])&&jQuery.isPlainObject(context))for(match in context)jQuery.isFunction(this[match])?this[match](context[match]):this.attr(match,context[match]);return this}return(elem=document.getElementById(match[2]))&&elem.parentNode&&(this.length=1,this[0]=elem),this.context=document,this.selector=selector,this}return selector.nodeType?(this.context=this[0]=selector,this.length=1,this):jQuery.isFunction(selector)?void 0!==root.ready?root.ready(selector):selector(jQuery):(void 0!==selector.selector&&(this.selector=selector.selector,this.context=selector.context),jQuery.makeArray(selector,this))}).prototype=jQuery.fn,rootjQuery=jQuery(document);var rparentsprev=/^(?:parents|prev(?:Until|All))/,guaranteedUnique={children:!0,contents:!0,next:!0,prev:!0};function sibling(cur,dir){for(;(cur=cur[dir])&&1!==cur.nodeType;);return cur}jQuery.fn.extend({has:function(target){var targets=jQuery(target,this),l=targets.length;return this.filter(function(){for(var i=0;i<l;i++)if(jQuery.contains(this,targets[i]))return!0})},closest:function(selectors,context){for(var cur,i=0,l=this.length,matched=[],pos=rneedsContext.test(selectors)||"string"!=typeof selectors?jQuery(selectors,context||this.context):0;i<l;i++)for(cur=this[i];cur&&cur!==context;cur=cur.parentNode)if(cur.nodeType<11&&(pos?pos.index(cur)>-1:1===cur.nodeType&&jQuery.find.matchesSelector(cur,selectors))){matched.push(cur);break}return this.pushStack(matched.length>1?jQuery.uniqueSort(matched):matched)},index:function(elem){return elem?"string"==typeof elem?indexOf.call(jQuery(elem),this[0]):indexOf.call(this,elem.jquery?elem[0]:elem):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(selector,context){return this.pushStack(jQuery.uniqueSort(jQuery.merge(this.get(),jQuery(selector,context))))},addBack:function(selector){return this.add(null==selector?this.prevObject:this.prevObject.filter(selector))}}),jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&11!==parent.nodeType?parent:null},parents:function(elem){return dir(elem,"parentNode")},parentsUntil:function(elem,i,until){return dir(elem,"parentNode",until)},next:function(elem){return sibling(elem,"nextSibling")},prev:function(elem){return sibling(elem,"previousSibling")},nextAll:function(elem){return dir(elem,"nextSibling")},prevAll:function(elem){return dir(elem,"previousSibling")},nextUntil:function(elem,i,until){return dir(elem,"nextSibling",until)},prevUntil:function(elem,i,until){return dir(elem,"previousSibling",until)},siblings:function(elem){return siblings((elem.parentNode||{}).firstChild,elem)},children:function(elem){return siblings(elem.firstChild)},contents:function(elem){return elem.contentDocument||jQuery.merge([],elem.childNodes)}},function(name,fn){jQuery.fn[name]=function(until,selector){var matched=jQuery.map(this,fn,until);return"Until"!==name.slice(-5)&&(selector=until),selector&&"string"==typeof selector&&(matched=jQuery.filter(selector,matched)),this.length>1&&(guaranteedUnique[name]||jQuery.uniqueSort(matched),rparentsprev.test(name)&&matched.reverse()),this.pushStack(matched)}});var readyList,rnotwhite=/\S+/g;function completed(){document.removeEventListener("DOMContentLoaded",completed),window.removeEventListener("load",completed),jQuery.ready()}jQuery.Callbacks=function(options){options="string"==typeof options?function(options){var object={};return jQuery.each(options.match(rnotwhite)||[],function(_,flag){object[flag]=!0}),object}(options):jQuery.extend({},options);var firing,memory,fired,locked,list=[],queue=[],firingIndex=-1,fire=function(){for(locked=options.once,fired=firing=!0;queue.length;firingIndex=-1)for(memory=queue.shift();++firingIndex<list.length;)!1===list[firingIndex].apply(memory[0],memory[1])&&options.stopOnFalse&&(firingIndex=list.length,memory=!1);options.memory||(memory=!1),firing=!1,locked&&(list=memory?[]:"")},self={add:function(){return list&&(memory&&!firing&&(firingIndex=list.length-1,queue.push(memory)),function add(args){jQuery.each(args,function(_,arg){jQuery.isFunction(arg)?options.unique&&self.has(arg)||list.push(arg):arg&&arg.length&&"string"!==jQuery.type(arg)&&add(arg)})}(arguments),memory&&!firing&&fire()),this},remove:function(){return jQuery.each(arguments,function(_,arg){for(var index;(index=jQuery.inArray(arg,list,index))>-1;)list.splice(index,1),index<=firingIndex&&firingIndex--}),this},has:function(fn){return fn?jQuery.inArray(fn,list)>-1:list.length>0},empty:function(){return list&&(list=[]),this},disable:function(){return locked=queue=[],list=memory="",this},disabled:function(){return!list},lock:function(){return locked=queue=[],memory||(list=memory=""),this},locked:function(){return!!locked},fireWith:function(context,args){return locked||(args=[context,(args=args||[]).slice?args.slice():args],queue.push(args),firing||fire()),this},fire:function(){return self.fireWith(this,arguments),this},fired:function(){return!!fired}};return self},jQuery.extend({Deferred:function(func){var tuples=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],state="pending",promise={state:function(){return state},always:function(){return deferred.done(arguments).fail(arguments),this},then:function(){var fns=arguments;return jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(i,tuple){var fn=jQuery.isFunction(fns[i])&&fns[i];deferred[tuple[1]](function(){var returned=fn&&fn.apply(this,arguments);returned&&jQuery.isFunction(returned.promise)?returned.promise().progress(newDefer.notify).done(newDefer.resolve).fail(newDefer.reject):newDefer[tuple[0]+"With"](this===promise?newDefer.promise():this,fn?[returned]:arguments)})}),fns=null}).promise()},promise:function(obj){return null!=obj?jQuery.extend(obj,promise):promise}},deferred={};return promise.pipe=promise.then,jQuery.each(tuples,function(i,tuple){var list=tuple[2],stateString=tuple[3];promise[tuple[1]]=list.add,stateString&&list.add(function(){state=stateString},tuples[1^i][2].disable,tuples[2][2].lock),deferred[tuple[0]]=function(){return deferred[tuple[0]+"With"](this===deferred?promise:this,arguments),this},deferred[tuple[0]+"With"]=list.fireWith}),promise.promise(deferred),func&&func.call(deferred,deferred),deferred},when:function(subordinate){var progressValues,progressContexts,resolveContexts,i=0,resolveValues=slice.call(arguments),length=resolveValues.length,remaining=1!==length||subordinate&&jQuery.isFunction(subordinate.promise)?length:0,deferred=1===remaining?subordinate:jQuery.Deferred(),updateFunc=function(i,contexts,values){return function(value){contexts[i]=this,values[i]=arguments.length>1?slice.call(arguments):value,values===progressValues?deferred.notifyWith(contexts,values):--remaining||deferred.resolveWith(contexts,values)}};if(length>1)for(progressValues=new Array(length),progressContexts=new Array(length),resolveContexts=new Array(length);i<length;i++)resolveValues[i]&&jQuery.isFunction(resolveValues[i].promise)?resolveValues[i].promise().progress(updateFunc(i,progressContexts,progressValues)).done(updateFunc(i,resolveContexts,resolveValues)).fail(deferred.reject):--remaining;return remaining||deferred.resolveWith(resolveContexts,resolveValues),deferred.promise()}}),jQuery.fn.ready=function(fn){return jQuery.ready.promise().done(fn),this},jQuery.extend({isReady:!1,readyWait:1,holdReady:function(hold){hold?jQuery.readyWait++:jQuery.ready(!0)},ready:function(wait){(!0===wait?--jQuery.readyWait:jQuery.isReady)||(jQuery.isReady=!0,!0!==wait&&--jQuery.readyWait>0||(readyList.resolveWith(document,[jQuery]),jQuery.fn.triggerHandler&&(jQuery(document).triggerHandler("ready"),jQuery(document).off("ready"))))}}),jQuery.ready.promise=function(obj){return readyList||(readyList=jQuery.Deferred(),"complete"===document.readyState||"loading"!==document.readyState&&!document.documentElement.doScroll?window.setTimeout(jQuery.ready):(document.addEventListener("DOMContentLoaded",completed),window.addEventListener("load",completed))),readyList.promise(obj)},jQuery.ready.promise();var access=function(elems,fn,key,value,chainable,emptyGet,raw){var i=0,len=elems.length,bulk=null==key;if("object"===jQuery.type(key))for(i in chainable=!0,key)access(elems,fn,i,key[i],!0,emptyGet,raw);else if(void 0!==value&&(chainable=!0,jQuery.isFunction(value)||(raw=!0),bulk&&(raw?(fn.call(elems,value),fn=null):(bulk=fn,fn=function(elem,key,value){return bulk.call(jQuery(elem),value)})),fn))for(;i<len;i++)fn(elems[i],key,raw?value:value.call(elems[i],i,fn(elems[i],key)));return chainable?elems:bulk?fn.call(elems):len?fn(elems[0],key):emptyGet},acceptData=function(owner){return 1===owner.nodeType||9===owner.nodeType||!+owner.nodeType};function Data(){this.expando=jQuery.expando+Data.uid++}Data.uid=1,Data.prototype={register:function(owner,initial){var value=initial||{};return owner.nodeType?owner[this.expando]=value:Object.defineProperty(owner,this.expando,{value:value,writable:!0,configurable:!0}),owner[this.expando]},cache:function(owner){if(!acceptData(owner))return{};var value=owner[this.expando];return value||(value={},acceptData(owner)&&(owner.nodeType?owner[this.expando]=value:Object.defineProperty(owner,this.expando,{value:value,configurable:!0}))),value},set:function(owner,data,value){var prop,cache=this.cache(owner);if("string"==typeof data)cache[data]=value;else for(prop in data)cache[prop]=data[prop];return cache},get:function(owner,key){return void 0===key?this.cache(owner):owner[this.expando]&&owner[this.expando][key]},access:function(owner,key,value){var stored;return void 0===key||key&&"string"==typeof key&&void 0===value?void 0!==(stored=this.get(owner,key))?stored:this.get(owner,jQuery.camelCase(key)):(this.set(owner,key,value),void 0!==value?value:key)},remove:function(owner,key){var i,name,camel,cache=owner[this.expando];if(void 0!==cache){if(void 0===key)this.register(owner);else{jQuery.isArray(key)?name=key.concat(key.map(jQuery.camelCase)):(camel=jQuery.camelCase(key),name=key in cache?[key,camel]:(name=camel)in cache?[name]:name.match(rnotwhite)||[]),i=name.length;for(;i--;)delete cache[name[i]]}(void 0===key||jQuery.isEmptyObject(cache))&&(owner.nodeType?owner[this.expando]=void 0:delete owner[this.expando])}},hasData:function(owner){var cache=owner[this.expando];return void 0!==cache&&!jQuery.isEmptyObject(cache)}};var dataPriv=new Data,dataUser=new Data,rbrace=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,rmultiDash=/[A-Z]/g;function dataAttr(elem,key,data){var name;if(void 0===data&&1===elem.nodeType)if(name="data-"+key.replace(rmultiDash,"-$&").toLowerCase(),"string"==typeof(data=elem.getAttribute(name))){try{data="true"===data||"false"!==data&&("null"===data?null:+data+""===data?+data:rbrace.test(data)?jQuery.parseJSON(data):data)}catch(e){}dataUser.set(elem,key,data)}else data=void 0;return data}jQuery.extend({hasData:function(elem){return dataUser.hasData(elem)||dataPriv.hasData(elem)},data:function(elem,name,data){return dataUser.access(elem,name,data)},removeData:function(elem,name){dataUser.remove(elem,name)},_data:function(elem,name,data){return dataPriv.access(elem,name,data)},_removeData:function(elem,name){dataPriv.remove(elem,name)}}),jQuery.fn.extend({data:function(key,value){var i,name,data,elem=this[0],attrs=elem&&elem.attributes;if(void 0===key){if(this.length&&(data=dataUser.get(elem),1===elem.nodeType&&!dataPriv.get(elem,"hasDataAttrs"))){for(i=attrs.length;i--;)attrs[i]&&0===(name=attrs[i].name).indexOf("data-")&&(name=jQuery.camelCase(name.slice(5)),dataAttr(elem,name,data[name]));dataPriv.set(elem,"hasDataAttrs",!0)}return data}return"object"==typeof key?this.each(function(){dataUser.set(this,key)}):access(this,function(value){var data,camelKey;if(elem&&void 0===value)return void 0!==(data=dataUser.get(elem,key)||dataUser.get(elem,key.replace(rmultiDash,"-$&").toLowerCase()))?data:(camelKey=jQuery.camelCase(key),void 0!==(data=dataUser.get(elem,camelKey))?data:void 0!==(data=dataAttr(elem,camelKey,void 0))?data:void 0);camelKey=jQuery.camelCase(key),this.each(function(){var data=dataUser.get(this,camelKey);dataUser.set(this,camelKey,value),key.indexOf("-")>-1&&void 0!==data&&dataUser.set(this,key,value)})},null,value,arguments.length>1,null,!0)},removeData:function(key){return this.each(function(){dataUser.remove(this,key)})}}),jQuery.extend({queue:function(elem,type,data){var queue;if(elem)return type=(type||"fx")+"queue",queue=dataPriv.get(elem,type),data&&(!queue||jQuery.isArray(data)?queue=dataPriv.access(elem,type,jQuery.makeArray(data)):queue.push(data)),queue||[]},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type);"inprogress"===fn&&(fn=queue.shift(),startLength--),fn&&("fx"===type&&queue.unshift("inprogress"),delete hooks.stop,fn.call(elem,function(){jQuery.dequeue(elem,type)},hooks)),!startLength&&hooks&&hooks.empty.fire()},_queueHooks:function(elem,type){var key=type+"queueHooks";return dataPriv.get(elem,key)||dataPriv.access(elem,key,{empty:jQuery.Callbacks("once memory").add(function(){dataPriv.remove(elem,[type+"queue",key])})})}}),jQuery.fn.extend({queue:function(type,data){var setter=2;return"string"!=typeof type&&(data=type,type="fx",setter--),arguments.length<setter?jQuery.queue(this[0],type):void 0===data?this:this.each(function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type),"fx"===type&&"inprogress"!==queue[0]&&jQuery.dequeue(this,type)})},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type)})},clearQueue:function(type){return this.queue(type||"fx",[])},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){--count||defer.resolveWith(elements,[elements])};for("string"!=typeof type&&(obj=type,type=void 0),type=type||"fx";i--;)(tmp=dataPriv.get(elements[i],type+"queueHooks"))&&tmp.empty&&(count++,tmp.empty.add(resolve));return resolve(),defer.promise(obj)}});var pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,rcssNum=new RegExp("^(?:([+-])=|)("+pnum+")([a-z%]*)$","i"),cssExpand=["Top","Right","Bottom","Left"],isHidden=function(elem,el){return elem=el||elem,"none"===jQuery.css(elem,"display")||!jQuery.contains(elem.ownerDocument,elem)};function adjustCSS(elem,prop,valueParts,tween){var adjusted,scale=1,maxIterations=20,currentValue=tween?function(){return tween.cur()}:function(){return jQuery.css(elem,prop,"")},initial=currentValue(),unit=valueParts&&valueParts[3]||(jQuery.cssNumber[prop]?"":"px"),initialInUnit=(jQuery.cssNumber[prop]||"px"!==unit&&+initial)&&rcssNum.exec(jQuery.css(elem,prop));if(initialInUnit&&initialInUnit[3]!==unit){unit=unit||initialInUnit[3],valueParts=valueParts||[],initialInUnit=+initial||1;do{initialInUnit/=scale=scale||".5",jQuery.style(elem,prop,initialInUnit+unit)}while(scale!==(scale=currentValue()/initial)&&1!==scale&&--maxIterations)}return valueParts&&(initialInUnit=+initialInUnit||+initial||0,adjusted=valueParts[1]?initialInUnit+(valueParts[1]+1)*valueParts[2]:+valueParts[2],tween&&(tween.unit=unit,tween.start=initialInUnit,tween.end=adjusted)),adjusted}var rcheckableType=/^(?:checkbox|radio)$/i,rtagName=/<([\w:-]+)/,rscriptType=/^$|\/(?:java|ecma)script/i,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function getAll(context,tag){var ret=void 0!==context.getElementsByTagName?context.getElementsByTagName(tag||"*"):void 0!==context.querySelectorAll?context.querySelectorAll(tag||"*"):[];return void 0===tag||tag&&jQuery.nodeName(context,tag)?jQuery.merge([context],ret):ret}function setGlobalEval(elems,refElements){for(var i=0,l=elems.length;i<l;i++)dataPriv.set(elems[i],"globalEval",!refElements||dataPriv.get(refElements[i],"globalEval"))}wrapMap.optgroup=wrapMap.option,wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead,wrapMap.th=wrapMap.td;var div,input,rhtml=/<|&#?\w+;/;function buildFragment(elems,context,scripts,selection,ignored){for(var elem,tmp,tag,wrap,contains,j,fragment=context.createDocumentFragment(),nodes=[],i=0,l=elems.length;i<l;i++)if((elem=elems[i])||0===elem)if("object"===jQuery.type(elem))jQuery.merge(nodes,elem.nodeType?[elem]:elem);else if(rhtml.test(elem)){for(tmp=tmp||fragment.appendChild(context.createElement("div")),tag=(rtagName.exec(elem)||["",""])[1].toLowerCase(),wrap=wrapMap[tag]||wrapMap._default,tmp.innerHTML=wrap[1]+jQuery.htmlPrefilter(elem)+wrap[2],j=wrap[0];j--;)tmp=tmp.lastChild;jQuery.merge(nodes,tmp.childNodes),(tmp=fragment.firstChild).textContent=""}else nodes.push(context.createTextNode(elem));for(fragment.textContent="",i=0;elem=nodes[i++];)if(selection&&jQuery.inArray(elem,selection)>-1)ignored&&ignored.push(elem);else if(contains=jQuery.contains(elem.ownerDocument,elem),tmp=getAll(fragment.appendChild(elem),"script"),contains&&setGlobalEval(tmp),scripts)for(j=0;elem=tmp[j++];)rscriptType.test(elem.type||"")&&scripts.push(elem);return fragment}div=document.createDocumentFragment().appendChild(document.createElement("div")),(input=document.createElement("input")).setAttribute("type","radio"),input.setAttribute("checked","checked"),input.setAttribute("name","t"),div.appendChild(input),support.checkClone=div.cloneNode(!0).cloneNode(!0).lastChild.checked,div.innerHTML="<textarea>x</textarea>",support.noCloneChecked=!!div.cloneNode(!0).lastChild.defaultValue;var rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,rtypenamespace=/^([^.]*)(?:\.(.+)|)/;function returnTrue(){return!0}function returnFalse(){return!1}function safeActiveElement(){try{return document.activeElement}catch(err){}}function on(elem,types,selector,data,fn,one){var origFn,type;if("object"==typeof types){for(type in"string"!=typeof selector&&(data=data||selector,selector=void 0),types)on(elem,type,selector,data,types[type],one);return elem}if(null==data&&null==fn?(fn=selector,data=selector=void 0):null==fn&&("string"==typeof selector?(fn=data,data=void 0):(fn=data,data=selector,selector=void 0)),!1===fn)fn=returnFalse;else if(!fn)return elem;return 1===one&&(origFn=fn,(fn=function(event){return jQuery().off(event),origFn.apply(this,arguments)}).guid=origFn.guid||(origFn.guid=jQuery.guid++)),elem.each(function(){jQuery.event.add(this,types,fn,data,selector)})}jQuery.event={global:{},add:function(elem,types,handler,data,selector){var handleObjIn,eventHandle,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=dataPriv.get(elem);if(elemData)for(handler.handler&&(handler=(handleObjIn=handler).handler,selector=handleObjIn.selector),handler.guid||(handler.guid=jQuery.guid++),(events=elemData.events)||(events=elemData.events={}),(eventHandle=elemData.handle)||(eventHandle=elemData.handle=function(e){return void 0!==jQuery&&jQuery.event.triggered!==e.type?jQuery.event.dispatch.apply(elem,arguments):void 0}),t=(types=(types||"").match(rnotwhite)||[""]).length;t--;)type=origType=(tmp=rtypenamespace.exec(types[t])||[])[1],namespaces=(tmp[2]||"").split(".").sort(),type&&(special=jQuery.event.special[type]||{},type=(selector?special.delegateType:special.bindType)||type,special=jQuery.event.special[type]||{},handleObj=jQuery.extend({type:type,origType:origType,data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join(".")},handleObjIn),(handlers=events[type])||((handlers=events[type]=[]).delegateCount=0,special.setup&&!1!==special.setup.call(elem,data,namespaces,eventHandle)||elem.addEventListener&&elem.addEventListener(type,eventHandle)),special.add&&(special.add.call(elem,handleObj),handleObj.handler.guid||(handleObj.handler.guid=handler.guid)),selector?handlers.splice(handlers.delegateCount++,0,handleObj):handlers.push(handleObj),jQuery.event.global[type]=!0)},remove:function(elem,types,handler,selector,mappedTypes){var j,origCount,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=dataPriv.hasData(elem)&&dataPriv.get(elem);if(elemData&&(events=elemData.events)){for(t=(types=(types||"").match(rnotwhite)||[""]).length;t--;)if(type=origType=(tmp=rtypenamespace.exec(types[t])||[])[1],namespaces=(tmp[2]||"").split(".").sort(),type){for(special=jQuery.event.special[type]||{},handlers=events[type=(selector?special.delegateType:special.bindType)||type]||[],tmp=tmp[2]&&new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"),origCount=j=handlers.length;j--;)handleObj=handlers[j],!mappedTypes&&origType!==handleObj.origType||handler&&handler.guid!==handleObj.guid||tmp&&!tmp.test(handleObj.namespace)||selector&&selector!==handleObj.selector&&("**"!==selector||!handleObj.selector)||(handlers.splice(j,1),handleObj.selector&&handlers.delegateCount--,special.remove&&special.remove.call(elem,handleObj));origCount&&!handlers.length&&(special.teardown&&!1!==special.teardown.call(elem,namespaces,elemData.handle)||jQuery.removeEvent(elem,type,elemData.handle),delete events[type])}else for(type in events)jQuery.event.remove(elem,type+types[t],handler,selector,!0);jQuery.isEmptyObject(events)&&dataPriv.remove(elem,"handle events")}},dispatch:function(event){event=jQuery.event.fix(event);var i,j,ret,matched,handleObj,handlerQueue,args=slice.call(arguments),handlers=(dataPriv.get(this,"events")||{})[event.type]||[],special=jQuery.event.special[event.type]||{};if(args[0]=event,event.delegateTarget=this,!special.preDispatch||!1!==special.preDispatch.call(this,event)){for(handlerQueue=jQuery.event.handlers.call(this,event,handlers),i=0;(matched=handlerQueue[i++])&&!event.isPropagationStopped();)for(event.currentTarget=matched.elem,j=0;(handleObj=matched.handlers[j++])&&!event.isImmediatePropagationStopped();)event.rnamespace&&!event.rnamespace.test(handleObj.namespace)||(event.handleObj=handleObj,event.data=handleObj.data,void 0!==(ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args))&&!1===(event.result=ret)&&(event.preventDefault(),event.stopPropagation()));return special.postDispatch&&special.postDispatch.call(this,event),event.result}},handlers:function(event,handlers){var i,matches,sel,handleObj,handlerQueue=[],delegateCount=handlers.delegateCount,cur=event.target;if(delegateCount&&cur.nodeType&&("click"!==event.type||isNaN(event.button)||event.button<1))for(;cur!==this;cur=cur.parentNode||this)if(1===cur.nodeType&&(!0!==cur.disabled||"click"!==event.type)){for(matches=[],i=0;i<delegateCount;i++)void 0===matches[sel=(handleObj=handlers[i]).selector+" "]&&(matches[sel]=handleObj.needsContext?jQuery(sel,this).index(cur)>-1:jQuery.find(sel,this,null,[cur]).length),matches[sel]&&matches.push(handleObj);matches.length&&handlerQueue.push({elem:cur,handlers:matches})}return delegateCount<handlers.length&&handlerQueue.push({elem:this,handlers:handlers.slice(delegateCount)}),handlerQueue},props:"altKey bubbles cancelable ctrlKey currentTarget detail eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(event,original){return null==event.which&&(event.which=null!=original.charCode?original.charCode:original.keyCode),event}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(event,original){var eventDoc,doc,body,button=original.button;return null==event.pageX&&null!=original.clientX&&(doc=(eventDoc=event.target.ownerDocument||document).documentElement,body=eventDoc.body,event.pageX=original.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0),event.pageY=original.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)),event.which||void 0===button||(event.which=1&button?1:2&button?3:4&button?2:0),event}},fix:function(event){if(event[jQuery.expando])return event;var i,prop,copy,type=event.type,originalEvent=event,fixHook=this.fixHooks[type];for(fixHook||(this.fixHooks[type]=fixHook=rmouseEvent.test(type)?this.mouseHooks:rkeyEvent.test(type)?this.keyHooks:{}),copy=fixHook.props?this.props.concat(fixHook.props):this.props,event=new jQuery.Event(originalEvent),i=copy.length;i--;)event[prop=copy[i]]=originalEvent[prop];return event.target||(event.target=document),3===event.target.nodeType&&(event.target=event.target.parentNode),fixHook.filter?fixHook.filter(event,originalEvent):event},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==safeActiveElement()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===safeActiveElement()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&jQuery.nodeName(this,"input"))return this.click(),!1},_default:function(event){return jQuery.nodeName(event.target,"a")}},beforeunload:{postDispatch:function(event){void 0!==event.result&&event.originalEvent&&(event.originalEvent.returnValue=event.result)}}}},jQuery.removeEvent=function(elem,type,handle){elem.removeEventListener&&elem.removeEventListener(type,handle)},jQuery.Event=function(src,props){if(!(this instanceof jQuery.Event))return new jQuery.Event(src,props);src&&src.type?(this.originalEvent=src,this.type=src.type,this.isDefaultPrevented=src.defaultPrevented||void 0===src.defaultPrevented&&!1===src.returnValue?returnTrue:returnFalse):this.type=src,props&&jQuery.extend(this,props),this.timeStamp=src&&src.timeStamp||jQuery.now(),this[jQuery.expando]=!0},jQuery.Event.prototype={constructor:jQuery.Event,isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue,e&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue,e&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=returnTrue,e&&e.stopImmediatePropagation(),this.stopPropagation()}},jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,related=event.relatedTarget,handleObj=event.handleObj;return related&&(related===this||jQuery.contains(this,related))||(event.type=handleObj.origType,ret=handleObj.handler.apply(this,arguments),event.type=fix),ret}}}),jQuery.fn.extend({on:function(types,selector,data,fn){return on(this,types,selector,data,fn)},one:function(types,selector,data,fn){return on(this,types,selector,data,fn,1)},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj)return handleObj=types.handleObj,jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler),this;if("object"==typeof types){for(type in types)this.off(type,selector,types[type]);return this}return!1!==selector&&"function"!=typeof selector||(fn=selector,selector=void 0),!1===fn&&(fn=returnFalse),this.each(function(){jQuery.event.remove(this,types,fn,selector)})}});var rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,rnoInnerhtml=/<script|<style|<link/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptTypeMasked=/^true\/(.*)/,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function manipulationTarget(elem,content){return jQuery.nodeName(elem,"table")&&jQuery.nodeName(11!==content.nodeType?content:content.firstChild,"tr")?elem.getElementsByTagName("tbody")[0]||elem.appendChild(elem.ownerDocument.createElement("tbody")):elem}function disableScript(elem){return elem.type=(null!==elem.getAttribute("type"))+"/"+elem.type,elem}function restoreScript(elem){var match=rscriptTypeMasked.exec(elem.type);return match?elem.type=match[1]:elem.removeAttribute("type"),elem}function cloneCopyEvent(src,dest){var i,l,type,pdataOld,pdataCur,udataOld,udataCur,events;if(1===dest.nodeType){if(dataPriv.hasData(src)&&(pdataOld=dataPriv.access(src),pdataCur=dataPriv.set(dest,pdataOld),events=pdataOld.events))for(type in delete pdataCur.handle,pdataCur.events={},events)for(i=0,l=events[type].length;i<l;i++)jQuery.event.add(dest,type,events[type][i]);dataUser.hasData(src)&&(udataOld=dataUser.access(src),udataCur=jQuery.extend({},udataOld),dataUser.set(dest,udataCur))}}function domManip(collection,args,callback,ignored){args=concat.apply([],args);var fragment,first,scripts,hasScripts,node,doc,i=0,l=collection.length,iNoClone=l-1,value=args[0],isFunction=jQuery.isFunction(value);if(isFunction||l>1&&"string"==typeof value&&!support.checkClone&&rchecked.test(value))return collection.each(function(index){var self=collection.eq(index);isFunction&&(args[0]=value.call(this,index,self.html())),domManip(self,args,callback,ignored)});if(l&&(first=(fragment=buildFragment(args,collection[0].ownerDocument,!1,collection,ignored)).firstChild,1===fragment.childNodes.length&&(fragment=first),first||ignored)){for(hasScripts=(scripts=jQuery.map(getAll(fragment,"script"),disableScript)).length;i<l;i++)node=fragment,i!==iNoClone&&(node=jQuery.clone(node,!0,!0),hasScripts&&jQuery.merge(scripts,getAll(node,"script"))),callback.call(collection[i],node,i);if(hasScripts)for(doc=scripts[scripts.length-1].ownerDocument,jQuery.map(scripts,restoreScript),i=0;i<hasScripts;i++)node=scripts[i],rscriptType.test(node.type||"")&&!dataPriv.access(node,"globalEval")&&jQuery.contains(doc,node)&&(node.src?jQuery._evalUrl&&jQuery._evalUrl(node.src):jQuery.globalEval(node.textContent.replace(rcleanScript,"")))}return collection}function remove(elem,selector,keepData){for(var node,nodes=selector?jQuery.filter(selector,elem):elem,i=0;null!=(node=nodes[i]);i++)keepData||1!==node.nodeType||jQuery.cleanData(getAll(node)),node.parentNode&&(keepData&&jQuery.contains(node.ownerDocument,node)&&setGlobalEval(getAll(node,"script")),node.parentNode.removeChild(node));return elem}jQuery.extend({htmlPrefilter:function(html){return html.replace(rxhtmlTag,"<$1></$2>")},clone:function(elem,dataAndEvents,deepDataAndEvents){var i,l,srcElements,destElements,src,dest,nodeName,clone=elem.cloneNode(!0),inPage=jQuery.contains(elem.ownerDocument,elem);if(!(support.noCloneChecked||1!==elem.nodeType&&11!==elem.nodeType||jQuery.isXMLDoc(elem)))for(destElements=getAll(clone),i=0,l=(srcElements=getAll(elem)).length;i<l;i++)src=srcElements[i],"input"===(nodeName=(dest=destElements[i]).nodeName.toLowerCase())&&rcheckableType.test(src.type)?dest.checked=src.checked:"input"!==nodeName&&"textarea"!==nodeName||(dest.defaultValue=src.defaultValue);if(dataAndEvents)if(deepDataAndEvents)for(srcElements=srcElements||getAll(elem),destElements=destElements||getAll(clone),i=0,l=srcElements.length;i<l;i++)cloneCopyEvent(srcElements[i],destElements[i]);else cloneCopyEvent(elem,clone);return(destElements=getAll(clone,"script")).length>0&&setGlobalEval(destElements,!inPage&&getAll(elem,"script")),clone},cleanData:function(elems){for(var data,elem,type,special=jQuery.event.special,i=0;void 0!==(elem=elems[i]);i++)if(acceptData(elem)){if(data=elem[dataPriv.expando]){if(data.events)for(type in data.events)special[type]?jQuery.event.remove(elem,type):jQuery.removeEvent(elem,type,data.handle);elem[dataPriv.expando]=void 0}elem[dataUser.expando]&&(elem[dataUser.expando]=void 0)}}}),jQuery.fn.extend({domManip:domManip,detach:function(selector){return remove(this,selector,!0)},remove:function(selector){return remove(this,selector)},text:function(value){return access(this,function(value){return void 0===value?jQuery.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=value)})},null,value,arguments.length)},append:function(){return domManip(this,arguments,function(elem){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||manipulationTarget(this,elem).appendChild(elem)})},prepend:function(){return domManip(this,arguments,function(elem){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var target=manipulationTarget(this,elem);target.insertBefore(elem,target.firstChild)}})},before:function(){return domManip(this,arguments,function(elem){this.parentNode&&this.parentNode.insertBefore(elem,this)})},after:function(){return domManip(this,arguments,function(elem){this.parentNode&&this.parentNode.insertBefore(elem,this.nextSibling)})},empty:function(){for(var elem,i=0;null!=(elem=this[i]);i++)1===elem.nodeType&&(jQuery.cleanData(getAll(elem,!1)),elem.textContent="");return this},clone:function(dataAndEvents,deepDataAndEvents){return dataAndEvents=null!=dataAndEvents&&dataAndEvents,deepDataAndEvents=null==deepDataAndEvents?dataAndEvents:deepDataAndEvents,this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents)})},html:function(value){return access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(void 0===value&&1===elem.nodeType)return elem.innerHTML;if("string"==typeof value&&!rnoInnerhtml.test(value)&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=jQuery.htmlPrefilter(value);try{for(;i<l;i++)1===(elem=this[i]||{}).nodeType&&(jQuery.cleanData(getAll(elem,!1)),elem.innerHTML=value);elem=0}catch(e){}}elem&&this.empty().append(value)},null,value,arguments.length)},replaceWith:function(){var ignored=[];return domManip(this,arguments,function(elem){var parent=this.parentNode;jQuery.inArray(this,ignored)<0&&(jQuery.cleanData(getAll(this)),parent&&parent.replaceChild(elem,this))},ignored)}}),jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){for(var elems,ret=[],insert=jQuery(selector),last=insert.length-1,i=0;i<=last;i++)elems=i===last?this:this.clone(!0),jQuery(insert[i])[original](elems),push.apply(ret,elems.get());return this.pushStack(ret)}});var iframe,elemdisplay={HTML:"block",BODY:"block"};function actualDisplay(name,doc){var elem=jQuery(doc.createElement(name)).appendTo(doc.body),display=jQuery.css(elem[0],"display");return elem.detach(),display}function defaultDisplay(nodeName){var doc=document,display=elemdisplay[nodeName];return display||("none"!==(display=actualDisplay(nodeName,doc))&&display||((doc=(iframe=(iframe||jQuery("<iframe frameborder='0' width='0' height='0'/>")).appendTo(doc.documentElement))[0].contentDocument).write(),doc.close(),display=actualDisplay(nodeName,doc),iframe.detach()),elemdisplay[nodeName]=display),display}var rmargin=/^margin/,rnumnonpx=new RegExp("^("+pnum+")(?!px)[a-z%]+$","i"),getStyles=function(elem){var view=elem.ownerDocument.defaultView;return view&&view.opener||(view=window),view.getComputedStyle(elem)},swap=function(elem,options,callback,args){var ret,name,old={};for(name in options)old[name]=elem.style[name],elem.style[name]=options[name];for(name in ret=callback.apply(elem,args||[]),options)elem.style[name]=old[name];return ret},documentElement=document.documentElement;function curCSS(elem,name,computed){var width,minWidth,maxWidth,ret,style=elem.style;return""!==(ret=(computed=computed||getStyles(elem))?computed.getPropertyValue(name)||computed[name]:void 0)&&void 0!==ret||jQuery.contains(elem.ownerDocument,elem)||(ret=jQuery.style(elem,name)),computed&&!support.pixelMarginRight()&&rnumnonpx.test(ret)&&rmargin.test(name)&&(width=style.width,minWidth=style.minWidth,maxWidth=style.maxWidth,style.minWidth=style.maxWidth=style.width=ret,ret=computed.width,style.width=width,style.minWidth=minWidth,style.maxWidth=maxWidth),void 0!==ret?ret+"":ret}function addGetHookIf(conditionFn,hookFn){return{get:function(){if(!conditionFn())return(this.get=hookFn).apply(this,arguments);delete this.get}}}!function(){var pixelPositionVal,boxSizingReliableVal,pixelMarginRightVal,reliableMarginLeftVal,container=document.createElement("div"),div=document.createElement("div");function computeStyleTests(){div.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",div.innerHTML="",documentElement.appendChild(container);var divStyle=window.getComputedStyle(div);pixelPositionVal="1%"!==divStyle.top,reliableMarginLeftVal="2px"===divStyle.marginLeft,boxSizingReliableVal="4px"===divStyle.width,div.style.marginRight="50%",pixelMarginRightVal="4px"===divStyle.marginRight,documentElement.removeChild(container)}div.style&&(div.style.backgroundClip="content-box",div.cloneNode(!0).style.backgroundClip="",support.clearCloneStyle="content-box"===div.style.backgroundClip,container.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",container.appendChild(div),jQuery.extend(support,{pixelPosition:function(){return computeStyleTests(),pixelPositionVal},boxSizingReliable:function(){return null==boxSizingReliableVal&&computeStyleTests(),boxSizingReliableVal},pixelMarginRight:function(){return null==boxSizingReliableVal&&computeStyleTests(),pixelMarginRightVal},reliableMarginLeft:function(){return null==boxSizingReliableVal&&computeStyleTests(),reliableMarginLeftVal},reliableMarginRight:function(){var ret,marginDiv=div.appendChild(document.createElement("div"));return marginDiv.style.cssText=div.style.cssText="-webkit-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",marginDiv.style.marginRight=marginDiv.style.width="0",div.style.width="1px",documentElement.appendChild(container),ret=!parseFloat(window.getComputedStyle(marginDiv).marginRight),documentElement.removeChild(container),div.removeChild(marginDiv),ret}}))}();var rdisplayswap=/^(none|table(?!-c[ea]).+)/,cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:"0",fontWeight:"400"},cssPrefixes=["Webkit","O","Moz","ms"],emptyStyle=document.createElement("div").style;function vendorPropName(name){if(name in emptyStyle)return name;for(var capName=name[0].toUpperCase()+name.slice(1),i=cssPrefixes.length;i--;)if((name=cssPrefixes[i]+capName)in emptyStyle)return name}function setPositiveNumber(elem,value,subtract){var matches=rcssNum.exec(value);return matches?Math.max(0,matches[2]-(subtract||0))+(matches[3]||"px"):value}function augmentWidthOrHeight(elem,name,extra,isBorderBox,styles){for(var i=extra===(isBorderBox?"border":"content")?4:"width"===name?1:0,val=0;i<4;i+=2)"margin"===extra&&(val+=jQuery.css(elem,extra+cssExpand[i],!0,styles)),isBorderBox?("content"===extra&&(val-=jQuery.css(elem,"padding"+cssExpand[i],!0,styles)),"margin"!==extra&&(val-=jQuery.css(elem,"border"+cssExpand[i]+"Width",!0,styles))):(val+=jQuery.css(elem,"padding"+cssExpand[i],!0,styles),"padding"!==extra&&(val+=jQuery.css(elem,"border"+cssExpand[i]+"Width",!0,styles)));return val}function getWidthOrHeight(elem,name,extra){var valueIsBorderBox=!0,val="width"===name?elem.offsetWidth:elem.offsetHeight,styles=getStyles(elem),isBorderBox="border-box"===jQuery.css(elem,"boxSizing",!1,styles);if(document.msFullscreenElement&&window.top!==window&&elem.getClientRects().length&&(val=Math.round(elem.getBoundingClientRect()[name])),val<=0||null==val){if(((val=curCSS(elem,name,styles))<0||null==val)&&(val=elem.style[name]),rnumnonpx.test(val))return val;valueIsBorderBox=isBorderBox&&(support.boxSizingReliable()||val===elem.style[name]),val=parseFloat(val)||0}return val+augmentWidthOrHeight(elem,name,extra||(isBorderBox?"border":"content"),valueIsBorderBox,styles)+"px"}function showHide(elements,show){for(var display,elem,hidden,values=[],index=0,length=elements.length;index<length;index++)(elem=elements[index]).style&&(values[index]=dataPriv.get(elem,"olddisplay"),display=elem.style.display,show?(values[index]||"none"!==display||(elem.style.display=""),""===elem.style.display&&isHidden(elem)&&(values[index]=dataPriv.access(elem,"olddisplay",defaultDisplay(elem.nodeName)))):(hidden=isHidden(elem),"none"===display&&hidden||dataPriv.set(elem,"olddisplay",hidden?display:jQuery.css(elem,"display"))));for(index=0;index<length;index++)(elem=elements[index]).style&&(show&&"none"!==elem.style.display&&""!==elem.style.display||(elem.style.display=show?values[index]||"":"none"));return elements}function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing)}jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");return""===ret?"1":ret}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(elem,name,value,extra){if(elem&&3!==elem.nodeType&&8!==elem.nodeType&&elem.style){var ret,type,hooks,origName=jQuery.camelCase(name),style=elem.style;if(name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(origName)||origName),hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName],void 0===value)return hooks&&"get"in hooks&&void 0!==(ret=hooks.get(elem,!1,extra))?ret:style[name];"string"==(type=typeof value)&&(ret=rcssNum.exec(value))&&ret[1]&&(value=adjustCSS(elem,name,ret),type="number"),null!=value&&value==value&&("number"===type&&(value+=ret&&ret[3]||(jQuery.cssNumber[origName]?"":"px")),support.clearCloneStyle||""!==value||0!==name.indexOf("background")||(style[name]="inherit"),hooks&&"set"in hooks&&void 0===(value=hooks.set(elem,value,extra))||(style[name]=value))}},css:function(elem,name,extra,styles){var val,num,hooks,origName=jQuery.camelCase(name);return name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(origName)||origName),(hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName])&&"get"in hooks&&(val=hooks.get(elem,!0,extra)),void 0===val&&(val=curCSS(elem,name,styles)),"normal"===val&&name in cssNormalTransform&&(val=cssNormalTransform[name]),""===extra||extra?(num=parseFloat(val),!0===extra||isFinite(num)?num||0:val):val}}),jQuery.each(["height","width"],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){if(computed)return rdisplayswap.test(jQuery.css(elem,"display"))&&0===elem.offsetWidth?swap(elem,cssShow,function(){return getWidthOrHeight(elem,name,extra)}):getWidthOrHeight(elem,name,extra)},set:function(elem,value,extra){var matches,styles=extra&&getStyles(elem),subtract=extra&&augmentWidthOrHeight(elem,name,extra,"border-box"===jQuery.css(elem,"boxSizing",!1,styles),styles);return subtract&&(matches=rcssNum.exec(value))&&"px"!==(matches[3]||"px")&&(elem.style[name]=value,value=jQuery.css(elem,name)),setPositiveNumber(0,value,subtract)}}}),jQuery.cssHooks.marginLeft=addGetHookIf(support.reliableMarginLeft,function(elem,computed){if(computed)return(parseFloat(curCSS(elem,"marginLeft"))||elem.getBoundingClientRect().left-swap(elem,{marginLeft:0},function(){return elem.getBoundingClientRect().left}))+"px"}),jQuery.cssHooks.marginRight=addGetHookIf(support.reliableMarginRight,function(elem,computed){if(computed)return swap(elem,{display:"inline-block"},curCSS,[elem,"marginRight"])}),jQuery.each({margin:"",padding:"",border:"Width"},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){for(var i=0,expanded={},parts="string"==typeof value?value.split(" "):[value];i<4;i++)expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0];return expanded}},rmargin.test(prefix)||(jQuery.cssHooks[prefix+suffix].set=setPositiveNumber)}),jQuery.fn.extend({css:function(name,value){return access(this,function(elem,name,value){var styles,len,map={},i=0;if(jQuery.isArray(name)){for(styles=getStyles(elem),len=name.length;i<len;i++)map[name[i]]=jQuery.css(elem,name[i],!1,styles);return map}return void 0!==value?jQuery.style(elem,name,value):jQuery.css(elem,name)},name,value,arguments.length>1)},show:function(){return showHide(this,!0)},hide:function(){return showHide(this)},toggle:function(state){return"boolean"==typeof state?state?this.show():this.hide():this.each(function(){isHidden(this)?jQuery(this).show():jQuery(this).hide()})}}),jQuery.Tween=Tween,Tween.prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem,this.prop=prop,this.easing=easing||jQuery.easing._default,this.options=options,this.start=this.now=this.cur(),this.end=end,this.unit=unit||(jQuery.cssNumber[prop]?"":"px")},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this)},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];return this.options.duration?this.pos=eased=jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration):this.pos=eased=percent,this.now=(this.end-this.start)*eased+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),hooks&&hooks.set?hooks.set(this):Tween.propHooks._default.set(this),this}},Tween.prototype.init.prototype=Tween.prototype,Tween.propHooks={_default:{get:function(tween){var result;return 1!==tween.elem.nodeType||null!=tween.elem[tween.prop]&&null==tween.elem.style[tween.prop]?tween.elem[tween.prop]:(result=jQuery.css(tween.elem,tween.prop,""))&&"auto"!==result?result:0},set:function(tween){jQuery.fx.step[tween.prop]?jQuery.fx.step[tween.prop](tween):1!==tween.elem.nodeType||null==tween.elem.style[jQuery.cssProps[tween.prop]]&&!jQuery.cssHooks[tween.prop]?tween.elem[tween.prop]=tween.now:jQuery.style(tween.elem,tween.prop,tween.now+tween.unit)}}},Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(tween){tween.elem.nodeType&&tween.elem.parentNode&&(tween.elem[tween.prop]=tween.now)}},jQuery.easing={linear:function(p){return p},swing:function(p){return.5-Math.cos(p*Math.PI)/2},_default:"swing"},jQuery.fx=Tween.prototype.init,jQuery.fx.step={};var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rrun=/queueHooks$/;function createFxNow(){return window.setTimeout(function(){fxNow=void 0}),fxNow=jQuery.now()}function genFx(type,includeWidth){var which,i=0,attrs={height:type};for(includeWidth=includeWidth?1:0;i<4;i+=2-includeWidth)attrs["margin"+(which=cssExpand[i])]=attrs["padding"+which]=type;return includeWidth&&(attrs.opacity=attrs.width=type),attrs}function createTween(value,prop,animation){for(var tween,collection=(Animation.tweeners[prop]||[]).concat(Animation.tweeners["*"]),index=0,length=collection.length;index<length;index++)if(tween=collection[index].call(animation,prop,value))return tween}function Animation(elem,properties,options){var result,stopped,index=0,length=Animation.prefilters.length,deferred=jQuery.Deferred().always(function(){delete tick.elem}),tick=function(){if(stopped)return!1;for(var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),percent=1-(remaining/animation.duration||0),index=0,length=animation.tweens.length;index<length;index++)animation.tweens[index].run(percent);return deferred.notifyWith(elem,[animation,percent,remaining]),percent<1&&length?remaining:(deferred.resolveWith(elem,[animation]),!1)},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(!0,{specialEasing:{},easing:jQuery.easing._default},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);return animation.tweens.push(tween),tween},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;if(stopped)return this;for(stopped=!0;index<length;index++)animation.tweens[index].run(1);return gotoEnd?(deferred.notifyWith(elem,[animation,1,0]),deferred.resolveWith(elem,[animation,gotoEnd])):deferred.rejectWith(elem,[animation,gotoEnd]),this}}),props=animation.props;for(function(props,specialEasing){var index,name,easing,value,hooks;for(index in props)if(easing=specialEasing[name=jQuery.camelCase(index)],value=props[index],jQuery.isArray(value)&&(easing=value[1],value=props[index]=value[0]),index!==name&&(props[name]=value,delete props[index]),(hooks=jQuery.cssHooks[name])&&"expand"in hooks)for(index in value=hooks.expand(value),delete props[name],value)index in props||(props[index]=value[index],specialEasing[index]=easing);else specialEasing[name]=easing}(props,animation.opts.specialEasing);index<length;index++)if(result=Animation.prefilters[index].call(animation,elem,props,animation.opts))return jQuery.isFunction(result.stop)&&(jQuery._queueHooks(animation.elem,animation.opts.queue).stop=jQuery.proxy(result.stop,result)),result;return jQuery.map(props,createTween,animation),jQuery.isFunction(animation.opts.start)&&animation.opts.start.call(elem,animation),jQuery.fx.timer(jQuery.extend(tick,{elem:elem,anim:animation,queue:animation.opts.queue})),animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always)}jQuery.Animation=jQuery.extend(Animation,{tweeners:{"*":[function(prop,value){var tween=this.createTween(prop,value);return adjustCSS(tween.elem,prop,rcssNum.exec(value),tween),tween}]},tweener:function(props,callback){jQuery.isFunction(props)?(callback=props,props=["*"]):props=props.match(rnotwhite);for(var prop,index=0,length=props.length;index<length;index++)prop=props[index],Animation.tweeners[prop]=Animation.tweeners[prop]||[],Animation.tweeners[prop].unshift(callback)},prefilters:[function(elem,props,opts){var prop,value,toggle,tween,hooks,oldfire,display,anim=this,orig={},style=elem.style,hidden=elem.nodeType&&isHidden(elem),dataShow=dataPriv.get(elem,"fxshow");for(prop in opts.queue||(null==(hooks=jQuery._queueHooks(elem,"fx")).unqueued&&(hooks.unqueued=0,oldfire=hooks.empty.fire,hooks.empty.fire=function(){hooks.unqueued||oldfire()}),hooks.unqueued++,anim.always(function(){anim.always(function(){hooks.unqueued--,jQuery.queue(elem,"fx").length||hooks.empty.fire()})})),1===elem.nodeType&&("height"in props||"width"in props)&&(opts.overflow=[style.overflow,style.overflowX,style.overflowY],"inline"===("none"===(display=jQuery.css(elem,"display"))?dataPriv.get(elem,"olddisplay")||defaultDisplay(elem.nodeName):display)&&"none"===jQuery.css(elem,"float")&&(style.display="inline-block")),opts.overflow&&(style.overflow="hidden",anim.always(function(){style.overflow=opts.overflow[0],style.overflowX=opts.overflow[1],style.overflowY=opts.overflow[2]})),props)if(value=props[prop],rfxtypes.exec(value)){if(delete props[prop],toggle=toggle||"toggle"===value,value===(hidden?"hide":"show")){if("show"!==value||!dataShow||void 0===dataShow[prop])continue;hidden=!0}orig[prop]=dataShow&&dataShow[prop]||jQuery.style(elem,prop)}else display=void 0;if(jQuery.isEmptyObject(orig))"inline"===("none"===display?defaultDisplay(elem.nodeName):display)&&(style.display=display);else for(prop in dataShow?"hidden"in dataShow&&(hidden=dataShow.hidden):dataShow=dataPriv.access(elem,"fxshow",{}),toggle&&(dataShow.hidden=!hidden),hidden?jQuery(elem).show():anim.done(function(){jQuery(elem).hide()}),anim.done(function(){var prop;for(prop in dataPriv.remove(elem,"fxshow"),orig)jQuery.style(elem,prop,orig[prop])}),orig)tween=createTween(hidden?dataShow[prop]:0,prop,anim),prop in dataShow||(dataShow[prop]=tween.start,hidden&&(tween.end=tween.start,tween.start="width"===prop||"height"===prop?1:0))}],prefilter:function(callback,prepend){prepend?Animation.prefilters.unshift(callback):Animation.prefilters.push(callback)}}),jQuery.speed=function(speed,easing,fn){var opt=speed&&"object"==typeof speed?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};return opt.duration=jQuery.fx.off?0:"number"==typeof opt.duration?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default,null!=opt.queue&&!0!==opt.queue||(opt.queue="fx"),opt.old=opt.complete,opt.complete=function(){jQuery.isFunction(opt.old)&&opt.old.call(this),opt.queue&&jQuery.dequeue(this,opt.queue)},opt},jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:to},speed,easing,callback)},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);(empty||dataPriv.get(this,"finish"))&&anim.stop(!0)};return doAnimation.finish=doAnimation,empty||!1===optall.queue?this.each(doAnimation):this.queue(optall.queue,doAnimation)},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop,stop(gotoEnd)};return"string"!=typeof type&&(gotoEnd=clearQueue,clearQueue=type,type=void 0),clearQueue&&!1!==type&&this.queue(type||"fx",[]),this.each(function(){var dequeue=!0,index=null!=type&&type+"queueHooks",timers=jQuery.timers,data=dataPriv.get(this);if(index)data[index]&&data[index].stop&&stopQueue(data[index]);else for(index in data)data[index]&&data[index].stop&&rrun.test(index)&&stopQueue(data[index]);for(index=timers.length;index--;)timers[index].elem!==this||null!=type&&timers[index].queue!==type||(timers[index].anim.stop(gotoEnd),dequeue=!1,timers.splice(index,1));!dequeue&&gotoEnd||jQuery.dequeue(this,type)})},finish:function(type){return!1!==type&&(type=type||"fx"),this.each(function(){var index,data=dataPriv.get(this),queue=data[type+"queue"],hooks=data[type+"queueHooks"],timers=jQuery.timers,length=queue?queue.length:0;for(data.finish=!0,jQuery.queue(this,type,[]),hooks&&hooks.stop&&hooks.stop.call(this,!0),index=timers.length;index--;)timers[index].elem===this&&timers[index].queue===type&&(timers[index].anim.stop(!0),timers.splice(index,1));for(index=0;index<length;index++)queue[index]&&queue[index].finish&&queue[index].finish.call(this);delete data.finish})}}),jQuery.each(["toggle","show","hide"],function(i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return null==speed||"boolean"==typeof speed?cssFn.apply(this,arguments):this.animate(genFx(name,!0),speed,easing,callback)}}),jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback)}}),jQuery.timers=[],jQuery.fx.tick=function(){var timer,i=0,timers=jQuery.timers;for(fxNow=jQuery.now();i<timers.length;i++)(timer=timers[i])()||timers[i]!==timer||timers.splice(i--,1);timers.length||jQuery.fx.stop(),fxNow=void 0},jQuery.fx.timer=function(timer){jQuery.timers.push(timer),timer()?jQuery.fx.start():jQuery.timers.pop()},jQuery.fx.interval=13,jQuery.fx.start=function(){timerId||(timerId=window.setInterval(jQuery.fx.tick,jQuery.fx.interval))},jQuery.fx.stop=function(){window.clearInterval(timerId),timerId=null},jQuery.fx.speeds={slow:600,fast:200,_default:400},jQuery.fn.delay=function(time,type){return time=jQuery.fx&&jQuery.fx.speeds[time]||time,type=type||"fx",this.queue(type,function(next,hooks){var timeout=window.setTimeout(next,time);hooks.stop=function(){window.clearTimeout(timeout)}})},function(){var input=document.createElement("input"),select=document.createElement("select"),opt=select.appendChild(document.createElement("option"));input.type="checkbox",support.checkOn=""!==input.value,support.optSelected=opt.selected,select.disabled=!0,support.optDisabled=!opt.disabled,(input=document.createElement("input")).value="t",input.type="radio",support.radioValue="t"===input.value}();var boolHook,attrHandle=jQuery.expr.attrHandle;jQuery.fn.extend({attr:function(name,value){return access(this,jQuery.attr,name,value,arguments.length>1)},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name)})}}),jQuery.extend({attr:function(elem,name,value){var ret,hooks,nType=elem.nodeType;if(3!==nType&&8!==nType&&2!==nType)return void 0===elem.getAttribute?jQuery.prop(elem,name,value):(1===nType&&jQuery.isXMLDoc(elem)||(name=name.toLowerCase(),hooks=jQuery.attrHooks[name]||(jQuery.expr.match.bool.test(name)?boolHook:void 0)),void 0!==value?null===value?void jQuery.removeAttr(elem,name):hooks&&"set"in hooks&&void 0!==(ret=hooks.set(elem,value,name))?ret:(elem.setAttribute(name,value+""),value):hooks&&"get"in hooks&&null!==(ret=hooks.get(elem,name))?ret:null==(ret=jQuery.find.attr(elem,name))?void 0:ret)},attrHooks:{type:{set:function(elem,value){if(!support.radioValue&&"radio"===value&&jQuery.nodeName(elem,"input")){var val=elem.value;return elem.setAttribute("type",value),val&&(elem.value=val),value}}}},removeAttr:function(elem,value){var name,propName,i=0,attrNames=value&&value.match(rnotwhite);if(attrNames&&1===elem.nodeType)for(;name=attrNames[i++];)propName=jQuery.propFix[name]||name,jQuery.expr.match.bool.test(name)&&(elem[propName]=!1),elem.removeAttribute(name)}}),boolHook={set:function(elem,value,name){return!1===value?jQuery.removeAttr(elem,name):elem.setAttribute(name,name),name}},jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),function(i,name){var getter=attrHandle[name]||jQuery.find.attr;attrHandle[name]=function(elem,name,isXML){var ret,handle;return isXML||(handle=attrHandle[name],attrHandle[name]=ret,ret=null!=getter(elem,name,isXML)?name.toLowerCase():null,attrHandle[name]=handle),ret}});var rfocusable=/^(?:input|select|textarea|button)$/i,rclickable=/^(?:a|area)$/i;jQuery.fn.extend({prop:function(name,value){return access(this,jQuery.prop,name,value,arguments.length>1)},removeProp:function(name){return this.each(function(){delete this[jQuery.propFix[name]||name]})}}),jQuery.extend({prop:function(elem,name,value){var ret,hooks,nType=elem.nodeType;if(3!==nType&&8!==nType&&2!==nType)return 1===nType&&jQuery.isXMLDoc(elem)||(name=jQuery.propFix[name]||name,hooks=jQuery.propHooks[name]),void 0!==value?hooks&&"set"in hooks&&void 0!==(ret=hooks.set(elem,value,name))?ret:elem[name]=value:hooks&&"get"in hooks&&null!==(ret=hooks.get(elem,name))?ret:elem[name]},propHooks:{tabIndex:{get:function(elem){var tabindex=jQuery.find.attr(elem,"tabindex");return tabindex?parseInt(tabindex,10):rfocusable.test(elem.nodeName)||rclickable.test(elem.nodeName)&&elem.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),support.optSelected||(jQuery.propHooks.selected={get:function(elem){var parent=elem.parentNode;return parent&&parent.parentNode&&parent.parentNode.selectedIndex,null},set:function(elem){var parent=elem.parentNode;parent&&(parent.selectedIndex,parent.parentNode&&parent.parentNode.selectedIndex)}}),jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this});var rclass=/[\t\r\n\f]/g;function getClass(elem){return elem.getAttribute&&elem.getAttribute("class")||""}jQuery.fn.extend({addClass:function(value){var classes,elem,cur,curValue,clazz,j,finalValue,i=0;if(jQuery.isFunction(value))return this.each(function(j){jQuery(this).addClass(value.call(this,j,getClass(this)))});if("string"==typeof value&&value)for(classes=value.match(rnotwhite)||[];elem=this[i++];)if(curValue=getClass(elem),cur=1===elem.nodeType&&(" "+curValue+" ").replace(rclass," ")){for(j=0;clazz=classes[j++];)cur.indexOf(" "+clazz+" ")<0&&(cur+=clazz+" ");curValue!==(finalValue=jQuery.trim(cur))&&elem.setAttribute("class",finalValue)}return this},removeClass:function(value){var classes,elem,cur,curValue,clazz,j,finalValue,i=0;if(jQuery.isFunction(value))return this.each(function(j){jQuery(this).removeClass(value.call(this,j,getClass(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof value&&value)for(classes=value.match(rnotwhite)||[];elem=this[i++];)if(curValue=getClass(elem),cur=1===elem.nodeType&&(" "+curValue+" ").replace(rclass," ")){for(j=0;clazz=classes[j++];)for(;cur.indexOf(" "+clazz+" ")>-1;)cur=cur.replace(" "+clazz+" "," ");curValue!==(finalValue=jQuery.trim(cur))&&elem.setAttribute("class",finalValue)}return this},toggleClass:function(value,stateVal){var type=typeof value;return"boolean"==typeof stateVal&&"string"===type?stateVal?this.addClass(value):this.removeClass(value):jQuery.isFunction(value)?this.each(function(i){jQuery(this).toggleClass(value.call(this,i,getClass(this),stateVal),stateVal)}):this.each(function(){var className,i,self,classNames;if("string"===type)for(i=0,self=jQuery(this),classNames=value.match(rnotwhite)||[];className=classNames[i++];)self.hasClass(className)?self.removeClass(className):self.addClass(className);else void 0!==value&&"boolean"!==type||((className=getClass(this))&&dataPriv.set(this,"__className__",className),this.setAttribute&&this.setAttribute("class",className||!1===value?"":dataPriv.get(this,"__className__")||""))})},hasClass:function(selector){var className,elem,i=0;for(className=" "+selector+" ";elem=this[i++];)if(1===elem.nodeType&&(" "+getClass(elem)+" ").replace(rclass," ").indexOf(className)>-1)return!0;return!1}});var rreturn=/\r/g,rspaces=/[\x20\t\r\n\f]+/g;jQuery.fn.extend({val:function(value){var hooks,ret,isFunction,elem=this[0];return arguments.length?(isFunction=jQuery.isFunction(value),this.each(function(i){var val;1===this.nodeType&&(null==(val=isFunction?value.call(this,i,jQuery(this).val()):value)?val="":"number"==typeof val?val+="":jQuery.isArray(val)&&(val=jQuery.map(val,function(value){return null==value?"":value+""})),(hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()])&&"set"in hooks&&void 0!==hooks.set(this,val,"value")||(this.value=val))})):elem?(hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()])&&"get"in hooks&&void 0!==(ret=hooks.get(elem,"value"))?ret:"string"==typeof(ret=elem.value)?ret.replace(rreturn,""):null==ret?"":ret:void 0}}),jQuery.extend({valHooks:{option:{get:function(elem){var val=jQuery.find.attr(elem,"value");return null!=val?val:jQuery.trim(jQuery.text(elem)).replace(rspaces," ")}},select:{get:function(elem){for(var value,option,options=elem.options,index=elem.selectedIndex,one="select-one"===elem.type||index<0,values=one?null:[],max=one?index+1:options.length,i=index<0?max:one?index:0;i<max;i++)if(((option=options[i]).selected||i===index)&&(support.optDisabled?!option.disabled:null===option.getAttribute("disabled"))&&(!option.parentNode.disabled||!jQuery.nodeName(option.parentNode,"optgroup"))){if(value=jQuery(option).val(),one)return value;values.push(value)}return values},set:function(elem,value){for(var optionSet,option,options=elem.options,values=jQuery.makeArray(value),i=options.length;i--;)((option=options[i]).selected=jQuery.inArray(jQuery.valHooks.option.get(option),values)>-1)&&(optionSet=!0);return optionSet||(elem.selectedIndex=-1),values}}}}),jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(elem,value){if(jQuery.isArray(value))return elem.checked=jQuery.inArray(jQuery(elem).val(),value)>-1}},support.checkOn||(jQuery.valHooks[this].get=function(elem){return null===elem.getAttribute("value")?"on":elem.value})});var rfocusMorph=/^(?:focusinfocus|focusoutblur)$/;jQuery.extend(jQuery.event,{trigger:function(event,data,elem,onlyHandlers){var i,cur,tmp,bubbleType,ontype,handle,special,eventPath=[elem||document],type=hasOwn.call(event,"type")?event.type:event,namespaces=hasOwn.call(event,"namespace")?event.namespace.split("."):[];if(cur=tmp=elem=elem||document,3!==elem.nodeType&&8!==elem.nodeType&&!rfocusMorph.test(type+jQuery.event.triggered)&&(type.indexOf(".")>-1&&(type=(namespaces=type.split(".")).shift(),namespaces.sort()),ontype=type.indexOf(":")<0&&"on"+type,(event=event[jQuery.expando]?event:new jQuery.Event(type,"object"==typeof event&&event)).isTrigger=onlyHandlers?2:3,event.namespace=namespaces.join("."),event.rnamespace=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,event.result=void 0,event.target||(event.target=elem),data=null==data?[event]:jQuery.makeArray(data,[event]),special=jQuery.event.special[type]||{},onlyHandlers||!special.trigger||!1!==special.trigger.apply(elem,data))){if(!onlyHandlers&&!special.noBubble&&!jQuery.isWindow(elem)){for(bubbleType=special.delegateType||type,rfocusMorph.test(bubbleType+type)||(cur=cur.parentNode);cur;cur=cur.parentNode)eventPath.push(cur),tmp=cur;tmp===(elem.ownerDocument||document)&&eventPath.push(tmp.defaultView||tmp.parentWindow||window)}for(i=0;(cur=eventPath[i++])&&!event.isPropagationStopped();)event.type=i>1?bubbleType:special.bindType||type,(handle=(dataPriv.get(cur,"events")||{})[event.type]&&dataPriv.get(cur,"handle"))&&handle.apply(cur,data),(handle=ontype&&cur[ontype])&&handle.apply&&acceptData(cur)&&(event.result=handle.apply(cur,data),!1===event.result&&event.preventDefault());return event.type=type,onlyHandlers||event.isDefaultPrevented()||special._default&&!1!==special._default.apply(eventPath.pop(),data)||!acceptData(elem)||ontype&&jQuery.isFunction(elem[type])&&!jQuery.isWindow(elem)&&((tmp=elem[ontype])&&(elem[ontype]=null),jQuery.event.triggered=type,elem[type](),jQuery.event.triggered=void 0,tmp&&(elem[ontype]=tmp)),event.result}},simulate:function(type,elem,event){var e=jQuery.extend(new jQuery.Event,event,{type:type,isSimulated:!0});jQuery.event.trigger(e,null,elem),e.isDefaultPrevented()&&event.preventDefault()}}),jQuery.fn.extend({trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this)})},triggerHandler:function(type,data){var elem=this[0];if(elem)return jQuery.event.trigger(type,data,elem,!0)}}),jQuery.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(i,name){jQuery.fn[name]=function(data,fn){return arguments.length>0?this.on(name,null,data,fn):this.trigger(name)}}),jQuery.fn.extend({hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver)}}),support.focusin="onfocusin"in window,support.focusin||jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event))};jQuery.event.special[fix]={setup:function(){var doc=this.ownerDocument||this,attaches=dataPriv.access(doc,fix);attaches||doc.addEventListener(orig,handler,!0),dataPriv.access(doc,fix,(attaches||0)+1)},teardown:function(){var doc=this.ownerDocument||this,attaches=dataPriv.access(doc,fix)-1;attaches?dataPriv.access(doc,fix,attaches):(doc.removeEventListener(orig,handler,!0),dataPriv.remove(doc,fix))}}});var location=window.location,nonce=jQuery.now(),rquery=/\?/;jQuery.parseJSON=function(data){return JSON.parse(data+"")},jQuery.parseXML=function(data){var xml;if(!data||"string"!=typeof data)return null;try{xml=(new window.DOMParser).parseFromString(data,"text/xml")}catch(e){xml=void 0}return xml&&!xml.getElementsByTagName("parsererror").length||jQuery.error("Invalid XML: "+data),xml};var rhash=/#.*$/,rts=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)$/gm,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,prefilters={},transports={},allTypes="*/".concat("*"),originAnchor=document.createElement("a");function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){"string"!=typeof dataTypeExpression&&(func=dataTypeExpression,dataTypeExpression="*");var dataType,i=0,dataTypes=dataTypeExpression.toLowerCase().match(rnotwhite)||[];if(jQuery.isFunction(func))for(;dataType=dataTypes[i++];)"+"===dataType[0]?(dataType=dataType.slice(1)||"*",(structure[dataType]=structure[dataType]||[]).unshift(func)):(structure[dataType]=structure[dataType]||[]).push(func)}}function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR){var inspected={},seekingTransport=structure===transports;function inspect(dataType){var selected;return inspected[dataType]=!0,jQuery.each(structure[dataType]||[],function(_,prefilterOrFactory){var dataTypeOrTransport=prefilterOrFactory(options,originalOptions,jqXHR);return"string"!=typeof dataTypeOrTransport||seekingTransport||inspected[dataTypeOrTransport]?seekingTransport?!(selected=dataTypeOrTransport):void 0:(options.dataTypes.unshift(dataTypeOrTransport),inspect(dataTypeOrTransport),!1)}),selected}return inspect(options.dataTypes[0])||!inspected["*"]&&inspect("*")}function ajaxExtend(target,src){var key,deep,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src)void 0!==src[key]&&((flatOptions[key]?target:deep||(deep={}))[key]=src[key]);return deep&&jQuery.extend(!0,target,deep),target}originAnchor.href=location.href,jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:location.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(location.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(target,settings){return settings?ajaxExtend(ajaxExtend(target,jQuery.ajaxSettings),settings):ajaxExtend(jQuery.ajaxSettings,target)},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){"object"==typeof url&&(options=url,url=void 0),options=options||{};var transport,cacheURL,responseHeadersString,responseHeaders,timeoutTimer,urlAnchor,fireGlobals,i,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=s.context&&(callbackContext.nodeType||callbackContext.jquery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},state=0,strAbort="canceled",jqXHR={readyState:0,getResponseHeader:function(key){var match;if(2===state){if(!responseHeaders)for(responseHeaders={};match=rheaders.exec(responseHeadersString);)responseHeaders[match[1].toLowerCase()]=match[2];match=responseHeaders[key.toLowerCase()]}return null==match?null:match},getAllResponseHeaders:function(){return 2===state?responseHeadersString:null},setRequestHeader:function(name,value){var lname=name.toLowerCase();return state||(name=requestHeadersNames[lname]=requestHeadersNames[lname]||name,requestHeaders[name]=value),this},overrideMimeType:function(type){return state||(s.mimeType=type),this},statusCode:function(map){var code;if(map)if(state<2)for(code in map)statusCode[code]=[statusCode[code],map[code]];else jqXHR.always(map[jqXHR.status]);return this},abort:function(statusText){var finalText=statusText||strAbort;return transport&&transport.abort(finalText),done(0,finalText),this}};if(deferred.promise(jqXHR).complete=completeDeferred.add,jqXHR.success=jqXHR.done,jqXHR.error=jqXHR.fail,s.url=((url||s.url||location.href)+"").replace(rhash,"").replace(rprotocol,location.protocol+"//"),s.type=options.method||options.type||s.method||s.type,s.dataTypes=jQuery.trim(s.dataType||"*").toLowerCase().match(rnotwhite)||[""],null==s.crossDomain){urlAnchor=document.createElement("a");try{urlAnchor.href=s.url,urlAnchor.href=urlAnchor.href,s.crossDomain=originAnchor.protocol+"//"+originAnchor.host!=urlAnchor.protocol+"//"+urlAnchor.host}catch(e){s.crossDomain=!0}}if(s.data&&s.processData&&"string"!=typeof s.data&&(s.data=jQuery.param(s.data,s.traditional)),inspectPrefiltersOrTransports(prefilters,s,options,jqXHR),2===state)return jqXHR;for(i in(fireGlobals=jQuery.event&&s.global)&&0==jQuery.active++&&jQuery.event.trigger("ajaxStart"),s.type=s.type.toUpperCase(),s.hasContent=!rnoContent.test(s.type),cacheURL=s.url,s.hasContent||(s.data&&(cacheURL=s.url+=(rquery.test(cacheURL)?"&":"?")+s.data,delete s.data),!1===s.cache&&(s.url=rts.test(cacheURL)?cacheURL.replace(rts,"$1_="+nonce++):cacheURL+(rquery.test(cacheURL)?"&":"?")+"_="+nonce++)),s.ifModified&&(jQuery.lastModified[cacheURL]&&jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[cacheURL]),jQuery.etag[cacheURL]&&jqXHR.setRequestHeader("If-None-Match",jQuery.etag[cacheURL])),(s.data&&s.hasContent&&!1!==s.contentType||options.contentType)&&jqXHR.setRequestHeader("Content-Type",s.contentType),jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+("*"!==s.dataTypes[0]?", "+allTypes+"; q=0.01":""):s.accepts["*"]),s.headers)jqXHR.setRequestHeader(i,s.headers[i]);if(s.beforeSend&&(!1===s.beforeSend.call(callbackContext,jqXHR,s)||2===state))return jqXHR.abort();for(i in strAbort="abort",{success:1,error:1,complete:1})jqXHR[i](s[i]);if(transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR)){if(jqXHR.readyState=1,fireGlobals&&globalEventContext.trigger("ajaxSend",[jqXHR,s]),2===state)return jqXHR;s.async&&s.timeout>0&&(timeoutTimer=window.setTimeout(function(){jqXHR.abort("timeout")},s.timeout));try{state=1,transport.send(requestHeaders,done)}catch(e){if(!(state<2))throw e;done(-1,e)}}else done(-1,"No Transport");function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;2!==state&&(state=2,timeoutTimer&&window.clearTimeout(timeoutTimer),transport=void 0,responseHeadersString=headers||"",jqXHR.readyState=status>0?4:0,isSuccess=status>=200&&status<300||304===status,responses&&(response=function(s,jqXHR,responses){for(var ct,type,finalDataType,firstDataType,contents=s.contents,dataTypes=s.dataTypes;"*"===dataTypes[0];)dataTypes.shift(),void 0===ct&&(ct=s.mimeType||jqXHR.getResponseHeader("Content-Type"));if(ct)for(type in contents)if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break}if(dataTypes[0]in responses)finalDataType=dataTypes[0];else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break}firstDataType||(firstDataType=type)}finalDataType=finalDataType||firstDataType}if(finalDataType)return finalDataType!==dataTypes[0]&&dataTypes.unshift(finalDataType),responses[finalDataType]}(s,jqXHR,responses)),response=function(s,response,jqXHR,isSuccess){var conv2,current,conv,tmp,prev,converters={},dataTypes=s.dataTypes.slice();if(dataTypes[1])for(conv in s.converters)converters[conv.toLowerCase()]=s.converters[conv];for(current=dataTypes.shift();current;)if(s.responseFields[current]&&(jqXHR[s.responseFields[current]]=response),!prev&&isSuccess&&s.dataFilter&&(response=s.dataFilter(response,s.dataType)),prev=current,current=dataTypes.shift())if("*"===current)current=prev;else if("*"!==prev&&prev!==current){if(!(conv=converters[prev+" "+current]||converters["* "+current]))for(conv2 in converters)if((tmp=conv2.split(" "))[1]===current&&(conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]])){!0===conv?conv=converters[conv2]:!0!==converters[conv2]&&(current=tmp[0],dataTypes.unshift(tmp[1]));break}if(!0!==conv)if(conv&&s.throws)response=conv(response);else try{response=conv(response)}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current}}}return{state:"success",data:response}}(s,response,jqXHR,isSuccess),isSuccess?(s.ifModified&&((modified=jqXHR.getResponseHeader("Last-Modified"))&&(jQuery.lastModified[cacheURL]=modified),(modified=jqXHR.getResponseHeader("etag"))&&(jQuery.etag[cacheURL]=modified)),204===status||"HEAD"===s.type?statusText="nocontent":304===status?statusText="notmodified":(statusText=response.state,success=response.data,isSuccess=!(error=response.error))):(error=statusText,!status&&statusText||(statusText="error",status<0&&(status=0))),jqXHR.status=status,jqXHR.statusText=(nativeStatusText||statusText)+"",isSuccess?deferred.resolveWith(callbackContext,[success,statusText,jqXHR]):deferred.rejectWith(callbackContext,[jqXHR,statusText,error]),jqXHR.statusCode(statusCode),statusCode=void 0,fireGlobals&&globalEventContext.trigger(isSuccess?"ajaxSuccess":"ajaxError",[jqXHR,s,isSuccess?success:error]),completeDeferred.fireWith(callbackContext,[jqXHR,statusText]),fireGlobals&&(globalEventContext.trigger("ajaxComplete",[jqXHR,s]),--jQuery.active||jQuery.event.trigger("ajaxStop")))}return jqXHR},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json")},getScript:function(url,callback){return jQuery.get(url,void 0,callback,"script")}}),jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){return jQuery.isFunction(data)&&(type=type||callback,callback=data,data=void 0),jQuery.ajax(jQuery.extend({url:url,type:method,dataType:type,data:data,success:callback},jQuery.isPlainObject(url)&&url))}}),jQuery._evalUrl=function(url){return jQuery.ajax({url:url,type:"GET",dataType:"script",async:!1,global:!1,throws:!0})},jQuery.fn.extend({wrapAll:function(html){var wrap;return jQuery.isFunction(html)?this.each(function(i){jQuery(this).wrapAll(html.call(this,i))}):(this[0]&&(wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&wrap.insertBefore(this[0]),wrap.map(function(){for(var elem=this;elem.firstElementChild;)elem=elem.firstElementChild;return elem}).append(this)),this)},wrapInner:function(html){return jQuery.isFunction(html)?this.each(function(i){jQuery(this).wrapInner(html.call(this,i))}):this.each(function(){var self=jQuery(this),contents=self.contents();contents.length?contents.wrapAll(html):self.append(html)})},wrap:function(html){var isFunction=jQuery.isFunction(html);return this.each(function(i){jQuery(this).wrapAll(isFunction?html.call(this,i):html)})},unwrap:function(){return this.parent().each(function(){jQuery.nodeName(this,"body")||jQuery(this).replaceWith(this.childNodes)}).end()}}),jQuery.expr.filters.hidden=function(elem){return!jQuery.expr.filters.visible(elem)},jQuery.expr.filters.visible=function(elem){return elem.offsetWidth>0||elem.offsetHeight>0||elem.getClientRects().length>0};var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;function buildParams(prefix,obj,traditional,add){var name;if(jQuery.isArray(obj))jQuery.each(obj,function(i,v){traditional||rbracket.test(prefix)?add(prefix,v):buildParams(prefix+"["+("object"==typeof v&&null!=v?i:"")+"]",v,traditional,add)});else if(traditional||"object"!==jQuery.type(obj))add(prefix,obj);else for(name in obj)buildParams(prefix+"["+name+"]",obj[name],traditional,add)}jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,value){value=jQuery.isFunction(value)?value():null==value?"":value,s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value)};if(void 0===traditional&&(traditional=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional),jQuery.isArray(a)||a.jquery&&!jQuery.isPlainObject(a))jQuery.each(a,function(){add(this.name,this.value)});else for(prefix in a)buildParams(prefix,a[prefix],traditional,add);return s.join("&").replace(r20,"+")},jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var elements=jQuery.prop(this,"elements");return elements?jQuery.makeArray(elements):this}).filter(function(){var type=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(type)&&(this.checked||!rcheckableType.test(type))}).map(function(i,elem){var val=jQuery(this).val();return null==val?null:jQuery.isArray(val)?jQuery.map(val,function(val){return{name:elem.name,value:val.replace(rCRLF,"\r\n")}}):{name:elem.name,value:val.replace(rCRLF,"\r\n")}}).get()}}),jQuery.ajaxSettings.xhr=function(){try{return new window.XMLHttpRequest}catch(e){}};var xhrSuccessStatus={0:200,1223:204},xhrSupported=jQuery.ajaxSettings.xhr();support.cors=!!xhrSupported&&"withCredentials"in xhrSupported,support.ajax=xhrSupported=!!xhrSupported,jQuery.ajaxTransport(function(options){var callback,errorCallback;if(support.cors||xhrSupported&&!options.crossDomain)return{send:function(headers,complete){var i,xhr=options.xhr();if(xhr.open(options.type,options.url,options.async,options.username,options.password),options.xhrFields)for(i in options.xhrFields)xhr[i]=options.xhrFields[i];for(i in options.mimeType&&xhr.overrideMimeType&&xhr.overrideMimeType(options.mimeType),options.crossDomain||headers["X-Requested-With"]||(headers["X-Requested-With"]="XMLHttpRequest"),headers)xhr.setRequestHeader(i,headers[i]);callback=function(type){return function(){callback&&(callback=errorCallback=xhr.onload=xhr.onerror=xhr.onabort=xhr.onreadystatechange=null,"abort"===type?xhr.abort():"error"===type?"number"!=typeof xhr.status?complete(0,"error"):complete(xhr.status,xhr.statusText):complete(xhrSuccessStatus[xhr.status]||xhr.status,xhr.statusText,"text"!==(xhr.responseType||"text")||"string"!=typeof xhr.responseText?{binary:xhr.response}:{text:xhr.responseText},xhr.getAllResponseHeaders()))}},xhr.onload=callback(),errorCallback=xhr.onerror=callback("error"),void 0!==xhr.onabort?xhr.onabort=errorCallback:xhr.onreadystatechange=function(){4===xhr.readyState&&window.setTimeout(function(){callback&&errorCallback()})},callback=callback("abort");try{xhr.send(options.hasContent&&options.data||null)}catch(e){if(callback)throw e}},abort:function(){callback&&callback()}}}),jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(text){return jQuery.globalEval(text),text}}}),jQuery.ajaxPrefilter("script",function(s){void 0===s.cache&&(s.cache=!1),s.crossDomain&&(s.type="GET")}),jQuery.ajaxTransport("script",function(s){var script,callback;if(s.crossDomain)return{send:function(_,complete){script=jQuery("<script>").prop({charset:s.scriptCharset,src:s.url}).on("load error",callback=function(evt){script.remove(),callback=null,evt&&complete("error"===evt.type?404:200,evt.type)}),document.head.appendChild(script[0])},abort:function(){callback&&callback()}}});var oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var callback=oldCallbacks.pop()||jQuery.expando+"_"+nonce++;return this[callback]=!0,callback}}),jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,jsonProp=!1!==s.jsonp&&(rjsonp.test(s.url)?"url":"string"==typeof s.data&&0===(s.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(s.data)&&"data");if(jsonProp||"jsonp"===s.dataTypes[0])return callbackName=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback,jsonProp?s[jsonProp]=s[jsonProp].replace(rjsonp,"$1"+callbackName):!1!==s.jsonp&&(s.url+=(rquery.test(s.url)?"&":"?")+s.jsonp+"="+callbackName),s.converters["script json"]=function(){return responseContainer||jQuery.error(callbackName+" was not called"),responseContainer[0]},s.dataTypes[0]="json",overwritten=window[callbackName],window[callbackName]=function(){responseContainer=arguments},jqXHR.always(function(){void 0===overwritten?jQuery(window).removeProp(callbackName):window[callbackName]=overwritten,s[callbackName]&&(s.jsonpCallback=originalSettings.jsonpCallback,oldCallbacks.push(callbackName)),responseContainer&&jQuery.isFunction(overwritten)&&overwritten(responseContainer[0]),responseContainer=overwritten=void 0}),"script"}),jQuery.parseHTML=function(data,context,keepScripts){if(!data||"string"!=typeof data)return null;"boolean"==typeof context&&(keepScripts=context,context=!1),context=context||document;var parsed=rsingleTag.exec(data),scripts=!keepScripts&&[];return parsed?[context.createElement(parsed[1])]:(parsed=buildFragment([data],context,scripts),scripts&&scripts.length&&jQuery(scripts).remove(),jQuery.merge([],parsed.childNodes))};var _load=jQuery.fn.load;function getWindow(elem){return jQuery.isWindow(elem)?elem:9===elem.nodeType&&elem.defaultView}jQuery.fn.load=function(url,params,callback){if("string"!=typeof url&&_load)return _load.apply(this,arguments);var selector,type,response,self=this,off=url.indexOf(" ");return off>-1&&(selector=jQuery.trim(url.slice(off)),url=url.slice(0,off)),jQuery.isFunction(params)?(callback=params,params=void 0):params&&"object"==typeof params&&(type="POST"),self.length>0&&jQuery.ajax({url:url,type:type||"GET",dataType:"html",data:params}).done(function(responseText){response=arguments,self.html(selector?jQuery("<div>").append(jQuery.parseHTML(responseText)).find(selector):responseText)}).always(callback&&function(jqXHR,status){self.each(function(){callback.apply(this,response||[jqXHR.responseText,status,jqXHR])})}),this},jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(i,type){jQuery.fn[type]=function(fn){return this.on(type,fn)}}),jQuery.expr.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem}).length},jQuery.offset={setOffset:function(elem,options,i){var curPosition,curLeft,curCSSTop,curTop,curOffset,curCSSLeft,position=jQuery.css(elem,"position"),curElem=jQuery(elem),props={};"static"===position&&(elem.style.position="relative"),curOffset=curElem.offset(),curCSSTop=jQuery.css(elem,"top"),curCSSLeft=jQuery.css(elem,"left"),("absolute"===position||"fixed"===position)&&(curCSSTop+curCSSLeft).indexOf("auto")>-1?(curTop=(curPosition=curElem.position()).top,curLeft=curPosition.left):(curTop=parseFloat(curCSSTop)||0,curLeft=parseFloat(curCSSLeft)||0),jQuery.isFunction(options)&&(options=options.call(elem,i,jQuery.extend({},curOffset))),null!=options.top&&(props.top=options.top-curOffset.top+curTop),null!=options.left&&(props.left=options.left-curOffset.left+curLeft),"using"in options?options.using.call(elem,props):curElem.css(props)}},jQuery.fn.extend({offset:function(options){if(arguments.length)return void 0===options?this:this.each(function(i){jQuery.offset.setOffset(this,options,i)});var docElem,win,elem=this[0],box={top:0,left:0},doc=elem&&elem.ownerDocument;return doc?(docElem=doc.documentElement,jQuery.contains(docElem,elem)?(box=elem.getBoundingClientRect(),win=getWindow(doc),{top:box.top+win.pageYOffset-docElem.clientTop,left:box.left+win.pageXOffset-docElem.clientLeft}):box):void 0},position:function(){if(this[0]){var offsetParent,offset,elem=this[0],parentOffset={top:0,left:0};return"fixed"===jQuery.css(elem,"position")?offset=elem.getBoundingClientRect():(offsetParent=this.offsetParent(),offset=this.offset(),jQuery.nodeName(offsetParent[0],"html")||(parentOffset=offsetParent.offset()),parentOffset.top+=jQuery.css(offsetParent[0],"borderTopWidth",!0),parentOffset.left+=jQuery.css(offsetParent[0],"borderLeftWidth",!0)),{top:offset.top-parentOffset.top-jQuery.css(elem,"marginTop",!0),left:offset.left-parentOffset.left-jQuery.css(elem,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var offsetParent=this.offsetParent;offsetParent&&"static"===jQuery.css(offsetParent,"position");)offsetParent=offsetParent.offsetParent;return offsetParent||documentElement})}}),jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){var top="pageYOffset"===prop;jQuery.fn[method]=function(val){return access(this,function(elem,method,val){var win=getWindow(elem);if(void 0===val)return win?win[prop]:elem[method];win?win.scrollTo(top?win.pageXOffset:val,top?val:win.pageYOffset):elem[method]=val},method,val,arguments.length)}}),jQuery.each(["top","left"],function(i,prop){jQuery.cssHooks[prop]=addGetHookIf(support.pixelPosition,function(elem,computed){if(computed)return computed=curCSS(elem,prop),rnumnonpx.test(computed)?jQuery(elem).position()[prop]+"px":computed})}),jQuery.each({Height:"height",Width:"width"},function(name,type){jQuery.each({padding:"inner"+name,content:type,"":"outer"+name},function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||"boolean"!=typeof margin),extra=defaultExtra||(!0===margin||!0===value?"margin":"border");return access(this,function(elem,type,value){var doc;return jQuery.isWindow(elem)?elem.document.documentElement["client"+name]:9===elem.nodeType?(doc=elem.documentElement,Math.max(elem.body["scroll"+name],doc["scroll"+name],elem.body["offset"+name],doc["offset"+name],doc["client"+name])):void 0===value?jQuery.css(elem,type,extra):jQuery.style(elem,type,value,extra)},type,chainable?margin:void 0,chainable,null)}})}),jQuery.fn.extend({bind:function(types,data,fn){return this.on(types,null,data,fn)},unbind:function(types,fn){return this.off(types,null,fn)},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn)},undelegate:function(selector,types,fn){return 1===arguments.length?this.off(selector,"**"):this.off(types,selector||"**",fn)},size:function(){return this.length}}),jQuery.fn.andSelf=jQuery.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return jQuery});var _jQuery=window.jQuery,_$=window.$;return jQuery.noConflict=function(deep){return window.$===jQuery&&(window.$=_$),deep&&window.jQuery===jQuery&&(window.jQuery=_jQuery),jQuery},noGlobal||(window.jQuery=window.$=jQuery),jQuery}),function(factory){"function"==typeof define&&define.amd?define(["jquery"],factory):"object"==typeof exports?module.exports=factory:factory(jQuery)}(function($){var nullLowestDeltaTimeout,lowestDelta,toFix=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],toBind="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],slice=Array.prototype.slice;if($.event.fixHooks)for(var i=toFix.length;i;)$.event.fixHooks[toFix[--i]]=$.event.mouseHooks;var special=$.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var i=toBind.length;i;)this.addEventListener(toBind[--i],handler,!1);else this.onmousewheel=handler;$.data(this,"mousewheel-line-height",special.getLineHeight(this)),$.data(this,"mousewheel-page-height",special.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var i=toBind.length;i;)this.removeEventListener(toBind[--i],handler,!1);else this.onmousewheel=null;$.removeData(this,"mousewheel-line-height"),$.removeData(this,"mousewheel-page-height")},getLineHeight:function(elem){var $elem=$(elem),$parent=$elem["offsetParent"in $.fn?"offsetParent":"parent"]();return $parent.length||($parent=$("body")),parseInt($parent.css("fontSize"),10)||parseInt($elem.css("fontSize"),10)||16},getPageHeight:function(elem){return $(elem).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};function handler(event){var absDelta,orgEvent=event||window.event,args=slice.call(arguments,1),delta=0,deltaX=0,deltaY=0,offsetX=0,offsetY=0;if((event=$.event.fix(orgEvent)).type="mousewheel","detail"in orgEvent&&(deltaY=-1*orgEvent.detail),"wheelDelta"in orgEvent&&(deltaY=orgEvent.wheelDelta),"wheelDeltaY"in orgEvent&&(deltaY=orgEvent.wheelDeltaY),"wheelDeltaX"in orgEvent&&(deltaX=-1*orgEvent.wheelDeltaX),"axis"in orgEvent&&orgEvent.axis===orgEvent.HORIZONTAL_AXIS&&(deltaX=-1*deltaY,deltaY=0),delta=0===deltaY?deltaX:deltaY,"deltaY"in orgEvent&&(delta=deltaY=-1*orgEvent.deltaY),"deltaX"in orgEvent&&(deltaX=orgEvent.deltaX,0===deltaY&&(delta=-1*deltaX)),0!==deltaY||0!==deltaX){if(1===orgEvent.deltaMode){var lineHeight=$.data(this,"mousewheel-line-height");delta*=lineHeight,deltaY*=lineHeight,deltaX*=lineHeight}else if(2===orgEvent.deltaMode){var pageHeight=$.data(this,"mousewheel-page-height");delta*=pageHeight,deltaY*=pageHeight,deltaX*=pageHeight}if(absDelta=Math.max(Math.abs(deltaY),Math.abs(deltaX)),(!lowestDelta||absDelta<lowestDelta)&&(lowestDelta=absDelta,shouldAdjustOldDeltas(orgEvent,absDelta)&&(lowestDelta/=40)),shouldAdjustOldDeltas(orgEvent,absDelta)&&(delta/=40,deltaX/=40,deltaY/=40),delta=Math[delta>=1?"floor":"ceil"](delta/lowestDelta),deltaX=Math[deltaX>=1?"floor":"ceil"](deltaX/lowestDelta),deltaY=Math[deltaY>=1?"floor":"ceil"](deltaY/lowestDelta),special.settings.normalizeOffset&&this.getBoundingClientRect){var boundingRect=this.getBoundingClientRect();offsetX=event.clientX-boundingRect.left,offsetY=event.clientY-boundingRect.top}return event.deltaX=deltaX,event.deltaY=deltaY,event.deltaFactor=lowestDelta,event.offsetX=offsetX,event.offsetY=offsetY,event.deltaMode=0,args.unshift(event,delta,deltaX,deltaY),nullLowestDeltaTimeout&&clearTimeout(nullLowestDeltaTimeout),nullLowestDeltaTimeout=setTimeout(nullLowestDelta,200),($.event.dispatch||$.event.handle).apply(this,args)}}function nullLowestDelta(){lowestDelta=null}function shouldAdjustOldDeltas(orgEvent,absDelta){return special.settings.adjustOldDeltas&&"mousewheel"===orgEvent.type&&absDelta%120==0}$.fn.extend({mousewheel:function(fn){return fn?this.bind("mousewheel",fn):this.trigger("mousewheel")},unmousewheel:function(fn){return this.unbind("mousewheel",fn)}})}),function(){var root=this,previousUnderscore=root._,ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype,push=ArrayProto.push,slice=ArrayProto.slice,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind,nativeCreate=Object.create,Ctor=function(){},_=function(obj){return obj instanceof _?obj:this instanceof _?void(this._wrapped=obj):new _(obj)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=_),exports._=_):root._=_,_.VERSION="1.8.3";var optimizeCb=function(func,context,argCount){if(void 0===context)return func;switch(null==argCount?3:argCount){case 1:return function(value){return func.call(context,value)};case 2:return function(value,other){return func.call(context,value,other)};case 3:return function(value,index,collection){return func.call(context,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(context,accumulator,value,index,collection)}}return function(){return func.apply(context,arguments)}},cb=function(value,context,argCount){return null==value?_.identity:_.isFunction(value)?optimizeCb(value,context,argCount):_.isObject(value)?_.matcher(value):_.property(value)};_.iteratee=function(value,context){return cb(value,context,1/0)};var createAssigner=function(keysFunc,undefinedOnly){return function(obj){var length=arguments.length;if(length<2||null==obj)return obj;for(var index=1;index<length;index++)for(var source=arguments[index],keys=keysFunc(source),l=keys.length,i=0;i<l;i++){var key=keys[i];undefinedOnly&&void 0!==obj[key]||(obj[key]=source[key])}return obj}},baseCreate=function(prototype){if(!_.isObject(prototype))return{};if(nativeCreate)return nativeCreate(prototype);Ctor.prototype=prototype;var result=new Ctor;return Ctor.prototype=null,result},property=function(key){return function(obj){return null==obj?void 0:obj[key]}},MAX_ARRAY_INDEX=Math.pow(2,53)-1,getLength=property("length"),isArrayLike=function(collection){var length=getLength(collection);return"number"==typeof length&&length>=0&&length<=MAX_ARRAY_INDEX};function createReduce(dir){return function(obj,iteratee,memo,context){iteratee=optimizeCb(iteratee,context,4);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=dir>0?0:length-1;return arguments.length<3&&(memo=obj[keys?keys[index]:index],index+=dir),function(obj,iteratee,memo,keys,index,length){for(;index>=0&&index<length;index+=dir){var currentKey=keys?keys[index]:index;memo=iteratee(memo,obj[currentKey],currentKey,obj)}return memo}(obj,iteratee,memo,keys,index,length)}}_.each=_.forEach=function(obj,iteratee,context){var i,length;if(iteratee=optimizeCb(iteratee,context),isArrayLike(obj))for(i=0,length=obj.length;i<length;i++)iteratee(obj[i],i,obj);else{var keys=_.keys(obj);for(i=0,length=keys.length;i<length;i++)iteratee(obj[keys[i]],keys[i],obj)}return obj},_.map=_.collect=function(obj,iteratee,context){iteratee=cb(iteratee,context);for(var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,results=Array(length),index=0;index<length;index++){var currentKey=keys?keys[index]:index;results[index]=iteratee(obj[currentKey],currentKey,obj)}return results},_.reduce=_.foldl=_.inject=createReduce(1),_.reduceRight=_.foldr=createReduce(-1),_.find=_.detect=function(obj,predicate,context){var key;if(void 0!==(key=isArrayLike(obj)?_.findIndex(obj,predicate,context):_.findKey(obj,predicate,context))&&-1!==key)return obj[key]},_.filter=_.select=function(obj,predicate,context){var results=[];return predicate=cb(predicate,context),_.each(obj,function(value,index,list){predicate(value,index,list)&&results.push(value)}),results},_.reject=function(obj,predicate,context){return _.filter(obj,_.negate(cb(predicate)),context)},_.every=_.all=function(obj,predicate,context){predicate=cb(predicate,context);for(var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=0;index<length;index++){var currentKey=keys?keys[index]:index;if(!predicate(obj[currentKey],currentKey,obj))return!1}return!0},_.some=_.any=function(obj,predicate,context){predicate=cb(predicate,context);for(var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=0;index<length;index++){var currentKey=keys?keys[index]:index;if(predicate(obj[currentKey],currentKey,obj))return!0}return!1},_.contains=_.includes=_.include=function(obj,item,fromIndex,guard){return isArrayLike(obj)||(obj=_.values(obj)),("number"!=typeof fromIndex||guard)&&(fromIndex=0),_.indexOf(obj,item,fromIndex)>=0},_.invoke=function(obj,method){var args=slice.call(arguments,2),isFunc=_.isFunction(method);return _.map(obj,function(value){var func=isFunc?method:value[method];return null==func?func:func.apply(value,args)})},_.pluck=function(obj,key){return _.map(obj,_.property(key))},_.where=function(obj,attrs){return _.filter(obj,_.matcher(attrs))},_.findWhere=function(obj,attrs){return _.find(obj,_.matcher(attrs))},_.max=function(obj,iteratee,context){var value,computed,result=-1/0,lastComputed=-1/0;if(null==iteratee&&null!=obj)for(var i=0,length=(obj=isArrayLike(obj)?obj:_.values(obj)).length;i<length;i++)(value=obj[i])>result&&(result=value);else iteratee=cb(iteratee,context),_.each(obj,function(value,index,list){((computed=iteratee(value,index,list))>lastComputed||computed===-1/0&&result===-1/0)&&(result=value,lastComputed=computed)});return result},_.min=function(obj,iteratee,context){var value,computed,result=1/0,lastComputed=1/0;if(null==iteratee&&null!=obj)for(var i=0,length=(obj=isArrayLike(obj)?obj:_.values(obj)).length;i<length;i++)(value=obj[i])<result&&(result=value);else iteratee=cb(iteratee,context),_.each(obj,function(value,index,list){((computed=iteratee(value,index,list))<lastComputed||computed===1/0&&result===1/0)&&(result=value,lastComputed=computed)});return result},_.shuffle=function(obj){for(var rand,set=isArrayLike(obj)?obj:_.values(obj),length=set.length,shuffled=Array(length),index=0;index<length;index++)(rand=_.random(0,index))!==index&&(shuffled[index]=shuffled[rand]),shuffled[rand]=set[index];return shuffled},_.sample=function(obj,n,guard){return null==n||guard?(isArrayLike(obj)||(obj=_.values(obj)),obj[_.random(obj.length-1)]):_.shuffle(obj).slice(0,Math.max(0,n))},_.sortBy=function(obj,iteratee,context){return iteratee=cb(iteratee,context),_.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iteratee(value,index,list)}}).sort(function(left,right){var a=left.criteria,b=right.criteria;if(a!==b){if(a>b||void 0===a)return 1;if(a<b||void 0===b)return-1}return left.index-right.index}),"value")};var group=function(behavior){return function(obj,iteratee,context){var result={};return iteratee=cb(iteratee,context),_.each(obj,function(value,index){var key=iteratee(value,index,obj);behavior(result,value,key)}),result}};_.groupBy=group(function(result,value,key){_.has(result,key)?result[key].push(value):result[key]=[value]}),_.indexBy=group(function(result,value,key){result[key]=value}),_.countBy=group(function(result,value,key){_.has(result,key)?result[key]++:result[key]=1}),_.toArray=function(obj){return obj?_.isArray(obj)?slice.call(obj):isArrayLike(obj)?_.map(obj,_.identity):_.values(obj):[]},_.size=function(obj){return null==obj?0:isArrayLike(obj)?obj.length:_.keys(obj).length},_.partition=function(obj,predicate,context){predicate=cb(predicate,context);var pass=[],fail=[];return _.each(obj,function(value,key,obj){(predicate(value,key,obj)?pass:fail).push(value)}),[pass,fail]},_.first=_.head=_.take=function(array,n,guard){if(null!=array)return null==n||guard?array[0]:_.initial(array,array.length-n)},_.initial=function(array,n,guard){return slice.call(array,0,Math.max(0,array.length-(null==n||guard?1:n)))},_.last=function(array,n,guard){if(null!=array)return null==n||guard?array[array.length-1]:_.rest(array,Math.max(0,array.length-n))},_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,null==n||guard?1:n)},_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,strict,startIndex){for(var output=[],idx=0,i=startIndex||0,length=getLength(input);i<length;i++){var value=input[i];if(isArrayLike(value)&&(_.isArray(value)||_.isArguments(value))){shallow||(value=flatten(value,shallow,strict));var j=0,len=value.length;for(output.length+=len;j<len;)output[idx++]=value[j++]}else strict||(output[idx++]=value)}return output};function createPredicateIndexFinder(dir){return function(array,predicate,context){predicate=cb(predicate,context);for(var length=getLength(array),index=dir>0?0:length-1;index>=0&&index<length;index+=dir)if(predicate(array[index],index,array))return index;return-1}}function createIndexFinder(dir,predicateFind,sortedIndex){return function(array,item,idx){var i=0,length=getLength(array);if("number"==typeof idx)dir>0?i=idx>=0?idx:Math.max(idx+length,i):length=idx>=0?Math.min(idx+1,length):idx+length+1;else if(sortedIndex&&idx&&length)return array[idx=sortedIndex(array,item)]===item?idx:-1;if(item!=item)return(idx=predicateFind(slice.call(array,i,length),_.isNaN))>=0?idx+i:-1;for(idx=dir>0?i:length-1;idx>=0&&idx<length;idx+=dir)if(array[idx]===item)return idx;return-1}}_.flatten=function(array,shallow){return flatten(array,shallow,!1)},_.without=function(array){return _.difference(array,slice.call(arguments,1))},_.uniq=_.unique=function(array,isSorted,iteratee,context){_.isBoolean(isSorted)||(context=iteratee,iteratee=isSorted,isSorted=!1),null!=iteratee&&(iteratee=cb(iteratee,context));for(var result=[],seen=[],i=0,length=getLength(array);i<length;i++){var value=array[i],computed=iteratee?iteratee(value,i,array):value;isSorted?(i&&seen===computed||result.push(value),seen=computed):iteratee?_.contains(seen,computed)||(seen.push(computed),result.push(value)):_.contains(result,value)||result.push(value)}return result},_.union=function(){return _.uniq(flatten(arguments,!0,!0))},_.intersection=function(array){for(var result=[],argsLength=arguments.length,i=0,length=getLength(array);i<length;i++){var item=array[i];if(!_.contains(result,item)){for(var j=1;j<argsLength&&_.contains(arguments[j],item);j++);j===argsLength&&result.push(item)}}return result},_.difference=function(array){var rest=flatten(arguments,!0,!0,1);return _.filter(array,function(value){return!_.contains(rest,value)})},_.zip=function(){return _.unzip(arguments)},_.unzip=function(array){for(var length=array&&_.max(array,getLength).length||0,result=Array(length),index=0;index<length;index++)result[index]=_.pluck(array,index);return result},_.object=function(list,values){for(var result={},i=0,length=getLength(list);i<length;i++)values?result[list[i]]=values[i]:result[list[i][0]]=list[i][1];return result},_.findIndex=createPredicateIndexFinder(1),_.findLastIndex=createPredicateIndexFinder(-1),_.sortedIndex=function(array,obj,iteratee,context){for(var value=(iteratee=cb(iteratee,context,1))(obj),low=0,high=getLength(array);low<high;){var mid=Math.floor((low+high)/2);iteratee(array[mid])<value?low=mid+1:high=mid}return low},_.indexOf=createIndexFinder(1,_.findIndex,_.sortedIndex),_.lastIndexOf=createIndexFinder(-1,_.findLastIndex),_.range=function(start,stop,step){null==stop&&(stop=start||0,start=0),step=step||1;for(var length=Math.max(Math.ceil((stop-start)/step),0),range=Array(length),idx=0;idx<length;idx++,start+=step)range[idx]=start;return range};var executeBound=function(sourceFunc,boundFunc,context,callingContext,args){if(!(callingContext instanceof boundFunc))return sourceFunc.apply(context,args);var self=baseCreate(sourceFunc.prototype),result=sourceFunc.apply(self,args);return _.isObject(result)?result:self};_.bind=function(func,context){if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError("Bind must be called on a function");var args=slice.call(arguments,2),bound=function(){return executeBound(func,bound,context,this,args.concat(slice.call(arguments)))};return bound},_.partial=function(func){var boundArgs=slice.call(arguments,1),bound=function(){for(var position=0,length=boundArgs.length,args=Array(length),i=0;i<length;i++)args[i]=boundArgs[i]===_?arguments[position++]:boundArgs[i];for(;position<arguments.length;)args.push(arguments[position++]);return executeBound(func,bound,this,this,args)};return bound},_.bindAll=function(obj){var i,key,length=arguments.length;if(length<=1)throw new Error("bindAll must be passed function names");for(i=1;i<length;i++)obj[key=arguments[i]]=_.bind(obj[key],obj);return obj},_.memoize=function(func,hasher){var memoize=function(key){var cache=memoize.cache,address=""+(hasher?hasher.apply(this,arguments):key);return _.has(cache,address)||(cache[address]=func.apply(this,arguments)),cache[address]};return memoize.cache={},memoize},_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)},_.defer=_.partial(_.delay,_,1),_.throttle=function(func,wait,options){var context,args,result,timeout=null,previous=0;options||(options={});var later=function(){previous=!1===options.leading?0:_.now(),timeout=null,result=func.apply(context,args),timeout||(context=args=null)};return function(){var now=_.now();previous||!1!==options.leading||(previous=now);var remaining=wait-(now-previous);return context=this,args=arguments,remaining<=0||remaining>wait?(timeout&&(clearTimeout(timeout),timeout=null),previous=now,result=func.apply(context,args),timeout||(context=args=null)):timeout||!1===options.trailing||(timeout=setTimeout(later,remaining)),result}},_.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result,later=function(){var last=_.now()-timestamp;last<wait&&last>=0?timeout=setTimeout(later,wait-last):(timeout=null,immediate||(result=func.apply(context,args),timeout||(context=args=null)))};return function(){context=this,args=arguments,timestamp=_.now();var callNow=immediate&&!timeout;return timeout||(timeout=setTimeout(later,wait)),callNow&&(result=func.apply(context,args),context=args=null),result}},_.wrap=function(func,wrapper){return _.partial(wrapper,func)},_.negate=function(predicate){return function(){return!predicate.apply(this,arguments)}},_.compose=function(){var args=arguments,start=args.length-1;return function(){for(var i=start,result=args[start].apply(this,arguments);i--;)result=args[i].call(this,result);return result}},_.after=function(times,func){return function(){if(--times<1)return func.apply(this,arguments)}},_.before=function(times,func){var memo;return function(){return--times>0&&(memo=func.apply(this,arguments)),times<=1&&(func=null),memo}},_.once=_.partial(_.before,2);var hasEnumBug=!{toString:null}.propertyIsEnumerable("toString"),nonEnumerableProps=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];function collectNonEnumProps(obj,keys){var nonEnumIdx=nonEnumerableProps.length,constructor=obj.constructor,proto=_.isFunction(constructor)&&constructor.prototype||ObjProto,prop="constructor";for(_.has(obj,prop)&&!_.contains(keys,prop)&&keys.push(prop);nonEnumIdx--;)(prop=nonEnumerableProps[nonEnumIdx])in obj&&obj[prop]!==proto[prop]&&!_.contains(keys,prop)&&keys.push(prop)}_.keys=function(obj){if(!_.isObject(obj))return[];if(nativeKeys)return nativeKeys(obj);var keys=[];for(var key in obj)_.has(obj,key)&&keys.push(key);return hasEnumBug&&collectNonEnumProps(obj,keys),keys},_.allKeys=function(obj){if(!_.isObject(obj))return[];var keys=[];for(var key in obj)keys.push(key);return hasEnumBug&&collectNonEnumProps(obj,keys),keys},_.values=function(obj){for(var keys=_.keys(obj),length=keys.length,values=Array(length),i=0;i<length;i++)values[i]=obj[keys[i]];return values},_.mapObject=function(obj,iteratee,context){iteratee=cb(iteratee,context);for(var currentKey,keys=_.keys(obj),length=keys.length,results={},index=0;index<length;index++)results[currentKey=keys[index]]=iteratee(obj[currentKey],currentKey,obj);return results},_.pairs=function(obj){for(var keys=_.keys(obj),length=keys.length,pairs=Array(length),i=0;i<length;i++)pairs[i]=[keys[i],obj[keys[i]]];return pairs},_.invert=function(obj){for(var result={},keys=_.keys(obj),i=0,length=keys.length;i<length;i++)result[obj[keys[i]]]=keys[i];return result},_.functions=_.methods=function(obj){var names=[];for(var key in obj)_.isFunction(obj[key])&&names.push(key);return names.sort()},_.extend=createAssigner(_.allKeys),_.extendOwn=_.assign=createAssigner(_.keys),_.findKey=function(obj,predicate,context){predicate=cb(predicate,context);for(var key,keys=_.keys(obj),i=0,length=keys.length;i<length;i++)if(predicate(obj[key=keys[i]],key,obj))return key},_.pick=function(object,oiteratee,context){var iteratee,keys,result={},obj=object;if(null==obj)return result;_.isFunction(oiteratee)?(keys=_.allKeys(obj),iteratee=optimizeCb(oiteratee,context)):(keys=flatten(arguments,!1,!1,1),iteratee=function(value,key,obj){return key in obj},obj=Object(obj));for(var i=0,length=keys.length;i<length;i++){var key=keys[i],value=obj[key];iteratee(value,key,obj)&&(result[key]=value)}return result},_.omit=function(obj,iteratee,context){if(_.isFunction(iteratee))iteratee=_.negate(iteratee);else{var keys=_.map(flatten(arguments,!1,!1,1),String);iteratee=function(value,key){return!_.contains(keys,key)}}return _.pick(obj,iteratee,context)},_.defaults=createAssigner(_.allKeys,!0),_.create=function(prototype,props){var result=baseCreate(prototype);return props&&_.extendOwn(result,props),result},_.clone=function(obj){return _.isObject(obj)?_.isArray(obj)?obj.slice():_.extend({},obj):obj},_.tap=function(obj,interceptor){return interceptor(obj),obj},_.isMatch=function(object,attrs){var keys=_.keys(attrs),length=keys.length;if(null==object)return!length;for(var obj=Object(object),i=0;i<length;i++){var key=keys[i];if(attrs[key]!==obj[key]||!(key in obj))return!1}return!0};var eq=function(a,b,aStack,bStack){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof _&&(a=a._wrapped),b instanceof _&&(b=b._wrapped);var className=toString.call(a);if(className!==toString.call(b))return!1;switch(className){case"[object RegExp]":case"[object String]":return""+a==""+b;case"[object Number]":return+a!=+a?+b!=+b:0==+a?1/+a==1/b:+a==+b;case"[object Date]":case"[object Boolean]":return+a==+b}var areArrays="[object Array]"===className;if(!areArrays){if("object"!=typeof a||"object"!=typeof b)return!1;var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)&&"constructor"in a&&"constructor"in b)return!1}aStack=aStack||[],bStack=bStack||[];for(var length=aStack.length;length--;)if(aStack[length]===a)return bStack[length]===b;if(aStack.push(a),bStack.push(b),areArrays){if((length=a.length)!==b.length)return!1;for(;length--;)if(!eq(a[length],b[length],aStack,bStack))return!1}else{var key,keys=_.keys(a);if(length=keys.length,_.keys(b).length!==length)return!1;for(;length--;)if(key=keys[length],!_.has(b,key)||!eq(a[key],b[key],aStack,bStack))return!1}return aStack.pop(),bStack.pop(),!0};_.isEqual=function(a,b){return eq(a,b)},_.isEmpty=function(obj){return null==obj||(isArrayLike(obj)&&(_.isArray(obj)||_.isString(obj)||_.isArguments(obj))?0===obj.length:0===_.keys(obj).length)},_.isElement=function(obj){return!(!obj||1!==obj.nodeType)},_.isArray=nativeIsArray||function(obj){return"[object Array]"===toString.call(obj)},_.isObject=function(obj){var type=typeof obj;return"function"===type||"object"===type&&!!obj},_.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(name){_["is"+name]=function(obj){return toString.call(obj)==="[object "+name+"]"}}),_.isArguments(arguments)||(_.isArguments=function(obj){return _.has(obj,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(_.isFunction=function(obj){return"function"==typeof obj||!1}),_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))},_.isNaN=function(obj){return _.isNumber(obj)&&obj!==+obj},_.isBoolean=function(obj){return!0===obj||!1===obj||"[object Boolean]"===toString.call(obj)},_.isNull=function(obj){return null===obj},_.isUndefined=function(obj){return void 0===obj},_.has=function(obj,key){return null!=obj&&hasOwnProperty.call(obj,key)},_.noConflict=function(){return root._=previousUnderscore,this},_.identity=function(value){return value},_.constant=function(value){return function(){return value}},_.noop=function(){},_.property=property,_.propertyOf=function(obj){return null==obj?function(){}:function(key){return obj[key]}},_.matcher=_.matches=function(attrs){return attrs=_.extendOwn({},attrs),function(obj){return _.isMatch(obj,attrs)}},_.times=function(n,iteratee,context){var accum=Array(Math.max(0,n));iteratee=optimizeCb(iteratee,context,1);for(var i=0;i<n;i++)accum[i]=iteratee(i);return accum},_.random=function(min,max){return null==max&&(max=min,min=0),min+Math.floor(Math.random()*(max-min+1))},_.now=Date.now||function(){return(new Date).getTime()};var escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},unescapeMap=_.invert(escapeMap),createEscaper=function(map){var escaper=function(match){return map[match]},source="(?:"+_.keys(map).join("|")+")",testRegexp=RegExp(source),replaceRegexp=RegExp(source,"g");return function(string){return string=null==string?"":""+string,testRegexp.test(string)?string.replace(replaceRegexp,escaper):string}};_.escape=createEscaper(escapeMap),_.unescape=createEscaper(unescapeMap),_.result=function(object,property,fallback){var value=null==object?void 0:object[property];return void 0===value&&(value=fallback),_.isFunction(value)?value.call(object):value};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id},_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/,escapes={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},escaper=/\\|'|\r|\n|\u2028|\u2029/g,escapeChar=function(match){return"\\"+escapes[match]};_.template=function(text,settings,oldSettings){!settings&&oldSettings&&(settings=oldSettings),settings=_.defaults({},settings,_.templateSettings);var matcher=RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g"),index=0,source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){return source+=text.slice(index,offset).replace(escaper,escapeChar),index=offset+match.length,escape?source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'":interpolate?source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'":evaluate&&(source+="';\n"+evaluate+"\n__p+='"),match}),source+="';\n",settings.variable||(source="with(obj||{}){\n"+source+"}\n"),source="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{var render=new Function(settings.variable||"obj","_",source)}catch(e){throw e.source=source,e}var template=function(data){return render.call(this,data,_)},argument=settings.variable||"obj";return template.source="function("+argument+"){\n"+source+"}",template},_.chain=function(obj){var instance=_(obj);return instance._chain=!0,instance};var result=function(instance,obj){return instance._chain?_(obj).chain():obj};_.mixin=function(obj){_.each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];return push.apply(args,arguments),result(this,func.apply(_,args))}})},_.mixin(_),_.each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;return method.apply(obj,arguments),"shift"!==name&&"splice"!==name||0!==obj.length||delete obj[0],result(this,obj)}}),_.each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result(this,method.apply(this._wrapped,arguments))}}),_.prototype.value=function(){return this._wrapped},_.prototype.valueOf=_.prototype.toJSON=_.prototype.value,_.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return _})}.call(this),function(factory){var root="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global;if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],function(_,$,exports){root.Backbone=factory(root,exports,_,$)});else if("undefined"!=typeof exports){var $,_=require("underscore");try{$=require("jquery")}catch(e){}factory(root,exports,_,$)}else root.Backbone=factory(root,{},root._,root.jQuery||root.Zepto||root.ender||root.$)}(function(root,Backbone,_,$){var previousBackbone=root.Backbone,slice=Array.prototype.slice;Backbone.VERSION="1.3.3",Backbone.$=$,Backbone.noConflict=function(){return root.Backbone=previousBackbone,this},Backbone.emulateHTTP=!1,Backbone.emulateJSON=!1;var addUnderscoreMethods=function(Class,methods,attribute){_.each(methods,function(length,method){_[method]&&(Class.prototype[method]=function(length,method,attribute){switch(length){case 1:return function(){return _[method](this[attribute])};case 2:return function(value){return _[method](this[attribute],value)};case 3:return function(iteratee,context){return _[method](this[attribute],cb(iteratee,this),context)};case 4:return function(iteratee,defaultVal,context){return _[method](this[attribute],cb(iteratee,this),defaultVal,context)};default:return function(){var args=slice.call(arguments);return args.unshift(this[attribute]),_[method].apply(_,args)}}}(length,method,attribute))})},cb=function(iteratee,instance){return _.isFunction(iteratee)?iteratee:_.isObject(iteratee)&&!instance._isModel(iteratee)?modelMatcher(iteratee):_.isString(iteratee)?function(model){return model.get(iteratee)}:iteratee},modelMatcher=function(attrs){var matcher=_.matches(attrs);return function(model){return matcher(model.attributes)}},Events=Backbone.Events={},eventSplitter=/\s+/,eventsApi=function(iteratee,events,name,callback,opts){var names,i=0;if(name&&"object"==typeof name){void 0!==callback&&"context"in opts&&void 0===opts.context&&(opts.context=callback);for(names=_.keys(name);i<names.length;i++)events=eventsApi(iteratee,events,names[i],name[names[i]],opts)}else if(name&&eventSplitter.test(name))for(names=name.split(eventSplitter);i<names.length;i++)events=iteratee(events,names[i],callback,opts);else events=iteratee(events,name,callback,opts);return events};Events.on=function(name,callback,context){return internalOn(this,name,callback,context)};var internalOn=function(obj,name,callback,context,listening){return obj._events=eventsApi(onApi,obj._events||{},name,callback,{context:context,ctx:obj,listening:listening}),listening&&((obj._listeners||(obj._listeners={}))[listening.id]=listening),obj};Events.listenTo=function(obj,name,callback){if(!obj)return this;var id=obj._listenId||(obj._listenId=_.uniqueId("l")),listeningTo=this._listeningTo||(this._listeningTo={}),listening=listeningTo[id];if(!listening){var thisId=this._listenId||(this._listenId=_.uniqueId("l"));listening=listeningTo[id]={obj:obj,objId:id,id:thisId,listeningTo:listeningTo,count:0}}return internalOn(obj,name,callback,this,listening),this};var onApi=function(events,name,callback,options){if(callback){var handlers=events[name]||(events[name]=[]),context=options.context,ctx=options.ctx,listening=options.listening;listening&&listening.count++,handlers.push({callback:callback,context:context,ctx:context||ctx,listening:listening})}return events};Events.off=function(name,callback,context){return this._events?(this._events=eventsApi(offApi,this._events,name,callback,{context:context,listeners:this._listeners}),this):this},Events.stopListening=function(obj,name,callback){var listeningTo=this._listeningTo;if(!listeningTo)return this;for(var ids=obj?[obj._listenId]:_.keys(listeningTo),i=0;i<ids.length;i++){var listening=listeningTo[ids[i]];if(!listening)break;listening.obj.off(name,callback,this)}return this};var offApi=function(events,name,callback,options){if(events){var listening,i=0,context=options.context,listeners=options.listeners;if(name||callback||context){for(var names=name?[name]:_.keys(events);i<names.length;i++){var handlers=events[name=names[i]];if(!handlers)break;for(var remaining=[],j=0;j<handlers.length;j++){var handler=handlers[j];callback&&callback!==handler.callback&&callback!==handler.callback._callback||context&&context!==handler.context?remaining.push(handler):(listening=handler.listening)&&0==--listening.count&&(delete listeners[listening.id],delete listening.listeningTo[listening.objId])}remaining.length?events[name]=remaining:delete events[name]}return events}for(var ids=_.keys(listeners);i<ids.length;i++)delete listeners[(listening=listeners[ids[i]]).id],delete listening.listeningTo[listening.objId]}};Events.once=function(name,callback,context){var events=eventsApi(onceMap,{},name,callback,_.bind(this.off,this));return"string"==typeof name&&null==context&&(callback=void 0),this.on(events,callback,context)},Events.listenToOnce=function(obj,name,callback){var events=eventsApi(onceMap,{},name,callback,_.bind(this.stopListening,this,obj));return this.listenTo(obj,events)};var onceMap=function(map,name,callback,offer){if(callback){var once=map[name]=_.once(function(){offer(name,once),callback.apply(this,arguments)});once._callback=callback}return map};Events.trigger=function(name){if(!this._events)return this;for(var length=Math.max(0,arguments.length-1),args=Array(length),i=0;i<length;i++)args[i]=arguments[i+1];return eventsApi(triggerApi,this._events,name,void 0,args),this};var triggerApi=function(objEvents,name,callback,args){if(objEvents){var events=objEvents[name],allEvents=objEvents.all;events&&allEvents&&(allEvents=allEvents.slice()),events&&triggerEvents(events,args),allEvents&&triggerEvents(allEvents,[name].concat(args))}return objEvents},triggerEvents=function(events,args){var ev,i=-1,l=events.length,a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx);return;case 1:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1);return;case 2:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1,a2);return;case 3:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1,a2,a3);return;default:for(;++i<l;)(ev=events[i]).callback.apply(ev.ctx,args);return}};Events.bind=Events.on,Events.unbind=Events.off,_.extend(Backbone,Events);var Model=Backbone.Model=function(attributes,options){var attrs=attributes||{};options||(options={}),this.cid=_.uniqueId(this.cidPrefix),this.attributes={},options.collection&&(this.collection=options.collection),options.parse&&(attrs=this.parse(attrs,options)||{});var defaults=_.result(this,"defaults");attrs=_.defaults(_.extend({},defaults,attrs),defaults),this.set(attrs,options),this.changed={},this.initialize.apply(this,arguments)};_.extend(Model.prototype,Events,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(options){return _.clone(this.attributes)},sync:function(){return Backbone.sync.apply(this,arguments)},get:function(attr){return this.attributes[attr]},escape:function(attr){return _.escape(this.get(attr))},has:function(attr){return null!=this.get(attr)},matches:function(attrs){return!!_.iteratee(attrs,this)(this.attributes)},set:function(key,val,options){if(null==key)return this;var attrs;if("object"==typeof key?(attrs=key,options=val):(attrs={})[key]=val,options||(options={}),!this._validate(attrs,options))return!1;var unset=options.unset,silent=options.silent,changes=[],changing=this._changing;this._changing=!0,changing||(this._previousAttributes=_.clone(this.attributes),this.changed={});var current=this.attributes,changed=this.changed,prev=this._previousAttributes;for(var attr in attrs)val=attrs[attr],_.isEqual(current[attr],val)||changes.push(attr),_.isEqual(prev[attr],val)?delete changed[attr]:changed[attr]=val,unset?delete current[attr]:current[attr]=val;if(this.idAttribute in attrs&&(this.id=this.get(this.idAttribute)),!silent){changes.length&&(this._pending=options);for(var i=0;i<changes.length;i++)this.trigger("change:"+changes[i],this,current[changes[i]],options)}if(changing)return this;if(!silent)for(;this._pending;)options=this._pending,this._pending=!1,this.trigger("change",this,options);return this._pending=!1,this._changing=!1,this},unset:function(attr,options){return this.set(attr,void 0,_.extend({},options,{unset:!0}))},clear:function(options){var attrs={};for(var key in this.attributes)attrs[key]=void 0;return this.set(attrs,_.extend({},options,{unset:!0}))},hasChanged:function(attr){return null==attr?!_.isEmpty(this.changed):_.has(this.changed,attr)},changedAttributes:function(diff){if(!diff)return!!this.hasChanged()&&_.clone(this.changed);var old=this._changing?this._previousAttributes:this.attributes,changed={};for(var attr in diff){var val=diff[attr];_.isEqual(old[attr],val)||(changed[attr]=val)}return!!_.size(changed)&&changed},previous:function(attr){return null!=attr&&this._previousAttributes?this._previousAttributes[attr]:null},previousAttributes:function(){return _.clone(this._previousAttributes)},fetch:function(options){var model=this,success=(options=_.extend({parse:!0},options)).success;return options.success=function(resp){var serverAttrs=options.parse?model.parse(resp,options):resp;if(!model.set(serverAttrs,options))return!1;success&&success.call(options.context,model,resp,options),model.trigger("sync",model,resp,options)},wrapError(this,options),this.sync("read",this,options)},save:function(key,val,options){var attrs;null==key||"object"==typeof key?(attrs=key,options=val):(attrs={})[key]=val;var wait=(options=_.extend({validate:!0,parse:!0},options)).wait;if(attrs&&!wait){if(!this.set(attrs,options))return!1}else if(!this._validate(attrs,options))return!1;var model=this,success=options.success,attributes=this.attributes;options.success=function(resp){model.attributes=attributes;var serverAttrs=options.parse?model.parse(resp,options):resp;if(wait&&(serverAttrs=_.extend({},attrs,serverAttrs)),serverAttrs&&!model.set(serverAttrs,options))return!1;success&&success.call(options.context,model,resp,options),model.trigger("sync",model,resp,options)},wrapError(this,options),attrs&&wait&&(this.attributes=_.extend({},attributes,attrs));var method=this.isNew()?"create":options.patch?"patch":"update";"patch"!==method||options.attrs||(options.attrs=attrs);var xhr=this.sync(method,this,options);return this.attributes=attributes,xhr},destroy:function(options){var model=this,success=(options=options?_.clone(options):{}).success,wait=options.wait,destroy=function(){model.stopListening(),model.trigger("destroy",model,model.collection,options)};options.success=function(resp){wait&&destroy(),success&&success.call(options.context,model,resp,options),model.isNew()||model.trigger("sync",model,resp,options)};var xhr=!1;return this.isNew()?_.defer(options.success):(wrapError(this,options),xhr=this.sync("delete",this,options)),wait||destroy(),xhr},url:function(){var base=_.result(this,"urlRoot")||_.result(this.collection,"url")||urlError();if(this.isNew())return base;var id=this.get(this.idAttribute);return base.replace(/[^\/]$/,"$&/")+encodeURIComponent(id)},parse:function(resp,options){return resp},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(options){return this._validate({},_.extend({},options,{validate:!0}))},_validate:function(attrs,options){if(!options.validate||!this.validate)return!0;attrs=_.extend({},this.attributes,attrs);var error=this.validationError=this.validate(attrs,options)||null;return!error||(this.trigger("invalid",this,error,_.extend(options,{validationError:error})),!1)}}),addUnderscoreMethods(Model,{keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1},"attributes");var Collection=Backbone.Collection=function(models,options){options||(options={}),options.model&&(this.model=options.model),void 0!==options.comparator&&(this.comparator=options.comparator),this._reset(),this.initialize.apply(this,arguments),models&&this.reset(models,_.extend({silent:!0},options))},setOptions={add:!0,remove:!0,merge:!0},addOptions={add:!0,remove:!1},splice=function(array,insert,at){at=Math.min(Math.max(at,0),array.length);var i,tail=Array(array.length-at),length=insert.length;for(i=0;i<tail.length;i++)tail[i]=array[i+at];for(i=0;i<length;i++)array[i+at]=insert[i];for(i=0;i<tail.length;i++)array[i+length+at]=tail[i]};_.extend(Collection.prototype,Events,{model:Model,initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options)})},sync:function(){return Backbone.sync.apply(this,arguments)},add:function(models,options){return this.set(models,_.extend({merge:!1},options,addOptions))},remove:function(models,options){options=_.extend({},options);var singular=!_.isArray(models);models=singular?[models]:models.slice();var removed=this._removeModels(models,options);return!options.silent&&removed.length&&(options.changes={added:[],merged:[],removed:removed},this.trigger("update",this,options)),singular?removed[0]:removed},set:function(models,options){if(null!=models){(options=_.extend({},setOptions,options)).parse&&!this._isModel(models)&&(models=this.parse(models,options)||[]);var singular=!_.isArray(models);models=singular?[models]:models.slice();var at=options.at;null!=at&&(at=+at),at>this.length&&(at=this.length),at<0&&(at+=this.length+1);var model,i,set=[],toAdd=[],toMerge=[],toRemove=[],modelMap={},add=options.add,merge=options.merge,remove=options.remove,sort=!1,sortable=this.comparator&&null==at&&!1!==options.sort,sortAttr=_.isString(this.comparator)?this.comparator:null;for(i=0;i<models.length;i++){model=models[i];var existing=this.get(model);if(existing){if(merge&&model!==existing){var attrs=this._isModel(model)?model.attributes:model;options.parse&&(attrs=existing.parse(attrs,options)),existing.set(attrs,options),toMerge.push(existing),sortable&&!sort&&(sort=existing.hasChanged(sortAttr))}modelMap[existing.cid]||(modelMap[existing.cid]=!0,set.push(existing)),models[i]=existing}else add&&(model=models[i]=this._prepareModel(model,options))&&(toAdd.push(model),this._addReference(model,options),modelMap[model.cid]=!0,set.push(model))}if(remove){for(i=0;i<this.length;i++)modelMap[(model=this.models[i]).cid]||toRemove.push(model);toRemove.length&&this._removeModels(toRemove,options)}var orderChanged=!1,replace=!sortable&&add&&remove;if(set.length&&replace?(orderChanged=this.length!==set.length||_.some(this.models,function(m,index){return m!==set[index]}),this.models.length=0,splice(this.models,set,0),this.length=this.models.length):toAdd.length&&(sortable&&(sort=!0),splice(this.models,toAdd,null==at?this.length:at),this.length=this.models.length),sort&&this.sort({silent:!0}),!options.silent){for(i=0;i<toAdd.length;i++)null!=at&&(options.index=at+i),(model=toAdd[i]).trigger("add",model,this,options);(sort||orderChanged)&&this.trigger("sort",this,options),(toAdd.length||toRemove.length||toMerge.length)&&(options.changes={added:toAdd,removed:toRemove,merged:toMerge},this.trigger("update",this,options))}return singular?models[0]:models}},reset:function(models,options){options=options?_.clone(options):{};for(var i=0;i<this.models.length;i++)this._removeReference(this.models[i],options);return options.previousModels=this.models,this._reset(),models=this.add(models,_.extend({silent:!0},options)),options.silent||this.trigger("reset",this,options),models},push:function(model,options){return this.add(model,_.extend({at:this.length},options))},pop:function(options){var model=this.at(this.length-1);return this.remove(model,options)},unshift:function(model,options){return this.add(model,_.extend({at:0},options))},shift:function(options){var model=this.at(0);return this.remove(model,options)},slice:function(){return slice.apply(this.models,arguments)},get:function(obj){if(null!=obj)return this._byId[obj]||this._byId[this.modelId(obj.attributes||obj)]||obj.cid&&this._byId[obj.cid]},has:function(obj){return null!=this.get(obj)},at:function(index){return index<0&&(index+=this.length),this.models[index]},where:function(attrs,first){return this[first?"find":"filter"](attrs)},findWhere:function(attrs){return this.where(attrs,!0)},sort:function(options){var comparator=this.comparator;if(!comparator)throw new Error("Cannot sort a set without a comparator");options||(options={});var length=comparator.length;return _.isFunction(comparator)&&(comparator=_.bind(comparator,this)),1===length||_.isString(comparator)?this.models=this.sortBy(comparator):this.models.sort(comparator),options.silent||this.trigger("sort",this,options),this},pluck:function(attr){return this.map(attr+"")},fetch:function(options){var success=(options=_.extend({parse:!0},options)).success,collection=this;return options.success=function(resp){var method=options.reset?"reset":"set";collection[method](resp,options),success&&success.call(options.context,collection,resp,options),collection.trigger("sync",collection,resp,options)},wrapError(this,options),this.sync("read",this,options)},create:function(model,options){var wait=(options=options?_.clone(options):{}).wait;if(!(model=this._prepareModel(model,options)))return!1;wait||this.add(model,options);var collection=this,success=options.success;return options.success=function(m,resp,callbackOpts){wait&&collection.add(m,callbackOpts),success&&success.call(callbackOpts.context,m,resp,callbackOpts)},model.save(null,options),model},parse:function(resp,options){return resp},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(attrs){return attrs[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(attrs,options){if(this._isModel(attrs))return attrs.collection||(attrs.collection=this),attrs;(options=options?_.clone(options):{}).collection=this;var model=new this.model(attrs,options);return model.validationError?(this.trigger("invalid",this,model.validationError,options),!1):model},_removeModels:function(models,options){for(var removed=[],i=0;i<models.length;i++){var model=this.get(models[i]);if(model){var index=this.indexOf(model);this.models.splice(index,1),this.length--,delete this._byId[model.cid];var id=this.modelId(model.attributes);null!=id&&delete this._byId[id],options.silent||(options.index=index,model.trigger("remove",model,this,options)),removed.push(model),this._removeReference(model,options)}}return removed},_isModel:function(model){return model instanceof Model},_addReference:function(model,options){this._byId[model.cid]=model;var id=this.modelId(model.attributes);null!=id&&(this._byId[id]=model),model.on("all",this._onModelEvent,this)},_removeReference:function(model,options){delete this._byId[model.cid];var id=this.modelId(model.attributes);null!=id&&delete this._byId[id],this===model.collection&&delete model.collection,model.off("all",this._onModelEvent,this)},_onModelEvent:function(event,model,collection,options){if(model){if(("add"===event||"remove"===event)&&collection!==this)return;if("destroy"===event&&this.remove(model,options),"change"===event){var prevId=this.modelId(model.previousAttributes()),id=this.modelId(model.attributes);prevId!==id&&(null!=prevId&&delete this._byId[prevId],null!=id&&(this._byId[id]=model))}}this.trigger.apply(this,arguments)}}),addUnderscoreMethods(Collection,{forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3},"models");var View=Backbone.View=function(options){this.cid=_.uniqueId("view"),_.extend(this,_.pick(options,viewOptions)),this._ensureElement(),this.initialize.apply(this,arguments)},delegateEventSplitter=/^(\S+)\s*(.*)$/,viewOptions=["model","collection","el","id","attributes","className","tagName","events"];_.extend(View.prototype,Events,{tagName:"div",$:function(selector){return this.$el.find(selector)},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(element){return this.undelegateEvents(),this._setElement(element),this.delegateEvents(),this},_setElement:function(el){this.$el=el instanceof Backbone.$?el:Backbone.$(el),this.el=this.$el[0]},delegateEvents:function(events){if(events||(events=_.result(this,"events")),!events)return this;for(var key in this.undelegateEvents(),events){var method=events[key];if(_.isFunction(method)||(method=this[method]),method){var match=key.match(delegateEventSplitter);this.delegate(match[1],match[2],_.bind(method,this))}}return this},delegate:function(eventName,selector,listener){return this.$el.on(eventName+".delegateEvents"+this.cid,selector,listener),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(eventName,selector,listener){return this.$el.off(eventName+".delegateEvents"+this.cid,selector,listener),this},_createElement:function(tagName){return document.createElement(tagName)},_ensureElement:function(){if(this.el)this.setElement(_.result(this,"el"));else{var attrs=_.extend({},_.result(this,"attributes"));this.id&&(attrs.id=_.result(this,"id")),this.className&&(attrs.class=_.result(this,"className")),this.setElement(this._createElement(_.result(this,"tagName"))),this._setAttributes(attrs)}},_setAttributes:function(attributes){this.$el.attr(attributes)}}),Backbone.sync=function(method,model,options){var type=methodMap[method];_.defaults(options||(options={}),{emulateHTTP:Backbone.emulateHTTP,emulateJSON:Backbone.emulateJSON});var params={type:type,dataType:"json"};if(options.url||(params.url=_.result(model,"url")||urlError()),null!=options.data||!model||"create"!==method&&"update"!==method&&"patch"!==method||(params.contentType="application/json",params.data=JSON.stringify(options.attrs||model.toJSON(options))),options.emulateJSON&&(params.contentType="application/x-www-form-urlencoded",params.data=params.data?{model:params.data}:{}),options.emulateHTTP&&("PUT"===type||"DELETE"===type||"PATCH"===type)){params.type="POST",options.emulateJSON&&(params.data._method=type);var beforeSend=options.beforeSend;options.beforeSend=function(xhr){if(xhr.setRequestHeader("X-HTTP-Method-Override",type),beforeSend)return beforeSend.apply(this,arguments)}}"GET"===params.type||options.emulateJSON||(params.processData=!1);var error=options.error;options.error=function(xhr,textStatus,errorThrown){options.textStatus=textStatus,options.errorThrown=errorThrown,error&&error.call(options.context,xhr,textStatus,errorThrown)};var xhr=options.xhr=Backbone.ajax(_.extend(params,options));return model.trigger("request",model,xhr,options),xhr};var methodMap={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};Backbone.ajax=function(){return Backbone.$.ajax.apply(Backbone.$,arguments)};var Router=Backbone.Router=function(options){options||(options={}),options.routes&&(this.routes=options.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},optionalParam=/\((.*?)\)/g,namedParam=/(\(\?)?:\w+/g,splatParam=/\*\w+/g,escapeRegExp=/[\-{}\[\]+?.,\\\^$|#\s]/g;_.extend(Router.prototype,Events,{initialize:function(){},route:function(route,name,callback){_.isRegExp(route)||(route=this._routeToRegExp(route)),_.isFunction(name)&&(callback=name,name=""),callback||(callback=this[name]);var router=this;return Backbone.history.route(route,function(fragment){var args=router._extractParameters(route,fragment);!1!==router.execute(callback,args,name)&&(router.trigger.apply(router,["route:"+name].concat(args)),router.trigger("route",name,args),Backbone.history.trigger("route",router,name,args))}),this},execute:function(callback,args,name){callback&&callback.apply(this,args)},navigate:function(fragment,options){return Backbone.history.navigate(fragment,options),this},_bindRoutes:function(){if(this.routes){this.routes=_.result(this,"routes");for(var route,routes=_.keys(this.routes);null!=(route=routes.pop());)this.route(route,this.routes[route])}},_routeToRegExp:function(route){return route=route.replace(escapeRegExp,"\\$&").replace(optionalParam,"(?:$1)?").replace(namedParam,function(match,optional){return optional?match:"([^/?]+)"}).replace(splatParam,"([^?]*?)"),new RegExp("^"+route+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(route,fragment){var params=route.exec(fragment).slice(1);return _.map(params,function(param,i){return i===params.length-1?param||null:param?decodeURIComponent(param):null})}});var History=Backbone.History=function(){this.handlers=[],this.checkUrl=_.bind(this.checkUrl,this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},routeStripper=/^[#\/]|\s+$/g,rootStripper=/^\/+|\/+$/g,pathStripper=/#.*$/;History.started=!1,_.extend(History.prototype,Events,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root&&!this.getSearch()},matchRoot:function(){return this.decodeFragment(this.location.pathname).slice(0,this.root.length-1)+"/"===this.root},decodeFragment:function(fragment){return decodeURI(fragment.replace(/%25/g,"%2525"))},getSearch:function(){var match=this.location.href.replace(/#.*/,"").match(/\?.+/);return match?match[0]:""},getHash:function(window){var match=(window||this).location.href.match(/#(.*)$/);return match?match[1]:""},getPath:function(){var path=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===path.charAt(0)?path.slice(1):path},getFragment:function(fragment){return null==fragment&&(fragment=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),fragment.replace(routeStripper,"")},start:function(options){if(History.started)throw new Error("Backbone.history has already been started");if(History.started=!0,this.options=_.extend({root:"/"},this.options,options),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(rootStripper,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var rootPath=this.root.slice(0,-1)||"/";return this.location.replace(rootPath+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var body=document.body,iWindow=body.insertBefore(this.iframe,body.firstChild).contentWindow;iWindow.document.open(),iWindow.document.close(),iWindow.location.hash="#"+this.fragment}var addEventListener=window.addEventListener||function(eventName,listener){return attachEvent("on"+eventName,listener)};if(this._usePushState?addEventListener("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?addEventListener("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){var removeEventListener=window.removeEventListener||function(eventName,listener){return detachEvent("on"+eventName,listener)};this._usePushState?removeEventListener("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&removeEventListener("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),History.started=!1},route:function(route,callback){this.handlers.unshift({route:route,callback:callback})},checkUrl:function(e){var current=this.getFragment();if(current===this.fragment&&this.iframe&&(current=this.getHash(this.iframe.contentWindow)),current===this.fragment)return!1;this.iframe&&this.navigate(current),this.loadUrl()},loadUrl:function(fragment){return!!this.matchRoot()&&(fragment=this.fragment=this.getFragment(fragment),_.some(this.handlers,function(handler){if(handler.route.test(fragment))return handler.callback(fragment),!0}))},navigate:function(fragment,options){if(!History.started)return!1;options&&!0!==options||(options={trigger:!!options}),fragment=this.getFragment(fragment||"");var rootPath=this.root;""!==fragment&&"?"!==fragment.charAt(0)||(rootPath=rootPath.slice(0,-1)||"/");var url=rootPath+fragment;if(fragment=this.decodeFragment(fragment.replace(pathStripper,"")),this.fragment!==fragment){if(this.fragment=fragment,this._usePushState)this.history[options.replace?"replaceState":"pushState"]({},document.title,url);else{if(!this._wantsHashChange)return this.location.assign(url);if(this._updateHash(this.location,fragment,options.replace),this.iframe&&fragment!==this.getHash(this.iframe.contentWindow)){var iWindow=this.iframe.contentWindow;options.replace||(iWindow.document.open(),iWindow.document.close()),this._updateHash(iWindow.location,fragment,options.replace)}}return options.trigger?this.loadUrl(fragment):void 0}},_updateHash:function(location,fragment,replace){if(replace){var href=location.href.replace(/(javascript:|#).*$/,"");location.replace(href+"#"+fragment)}else location.hash="#"+fragment}}),Backbone.history=new History,Model.extend=Collection.extend=Router.extend=View.extend=History.extend=function(protoProps,staticProps){var child,parent=this;return child=protoProps&&_.has(protoProps,"constructor")?protoProps.constructor:function(){return parent.apply(this,arguments)},_.extend(child,parent,staticProps),child.prototype=_.create(parent.prototype,protoProps),child.prototype.constructor=child,child.__super__=parent.prototype,child};var urlError=function(){throw new Error('A "url" property or function must be specified')},wrapError=function(model,options){var error=options.error;options.error=function(resp){error&&error.call(options.context,model,resp,options),model.trigger("error",model,resp,options)}};return Backbone}),function(factory){"use strict";"function"==typeof define&&define.amd?define(["underscore","backbone"],factory):factory(_,Backbone)}(function(_,Backbone){"use strict";var Subscriber,channels={},delegateEvents=Backbone.View.prototype.delegateEvents,undelegateEvents=Backbone.View.prototype.undelegateEvents;return Backbone.Mediator={subscribe:function(channel,subscription,context,once){channels[channel]||(channels[channel]=[]),channels[channel].push({fn:subscription,context:context||this,once:once})},publish:function(channel){if(channels[channel])for(var subscription,args=[].slice.call(arguments,1),i=0;i<channels[channel].length;i++)(subscription=channels[channel][i]).fn.apply(subscription.context,args),subscription.once&&(Backbone.Mediator.unsubscribe(channel,subscription.fn,subscription.context),i--)},unsubscribe:function(channel,fn,context){if(channels[channel])for(var subscription,i=0;i<channels[channel].length;i++)(subscription=channels[channel][i]).fn===fn&&subscription.context===context&&(channels[channel].splice(i,1),i--)},subscribeOnce:function(channel,subscription,context){Backbone.Mediator.subscribe(channel,subscription,context,!0)}},Subscriber={delegateEvents:function(){delegateEvents.apply(this,arguments),this.setSubscriptions()},undelegateEvents:function(){undelegateEvents.apply(this,arguments),this.unsetSubscriptions()},subscriptions:{},setSubscriptions:function(subscriptions){subscriptions&&_.extend(this.subscriptions||{},subscriptions),(subscriptions=subscriptions||this.subscriptions)&&!_.isEmpty(subscriptions)&&(this.unsetSubscriptions(subscriptions),_.each(subscriptions,function(subscription,channel){var once;subscription.$once&&(subscription=subscription.$once,once=!0),_.isString(subscription)&&(subscription=this[subscription]),Backbone.Mediator.subscribe(channel,subscription,this,once)},this))},unsetSubscriptions:function(subscriptions){(subscriptions=subscriptions||this.subscriptions)&&!_.isEmpty(subscriptions)&&_.each(subscriptions,function(subscription,channel){_.isString(subscription)&&(subscription=this[subscription]),Backbone.Mediator.unsubscribe(channel,subscription.$once||subscription,this)},this)}},_.extend(Backbone.View.prototype,Subscriber),_.extend(Backbone.Mediator,{pub:Backbone.Mediator.publish,sub:Backbone.Mediator.subscribe}),Backbone}),function($){var longDelay,shortDelay,mwheelI={pos:[-260,-260]},minDif=3,doc=document,root=doc.documentElement,body=doc.body;function unsetPos(){this===mwheelI.elem&&(mwheelI.pos=[-260,-260],mwheelI.elem=!1,minDif=3)}$.event.special.mwheelIntent={setup:function(){var jElm=$(this).bind("mousewheel",$.event.special.mwheelIntent.handler);return this!==doc&&this!==root&&this!==body&&jElm.bind("mouseleave",unsetPos),jElm=null,!0},teardown:function(){return $(this).unbind("mousewheel",$.event.special.mwheelIntent.handler).unbind("mouseleave",unsetPos),!0},handler:function(e,d){var pos=[e.clientX,e.clientY];if(this===mwheelI.elem||Math.abs(mwheelI.pos[0]-pos[0])>minDif||Math.abs(mwheelI.pos[1]-pos[1])>minDif)return mwheelI.elem=this,mwheelI.pos=pos,minDif=250,clearTimeout(shortDelay),shortDelay=setTimeout(function(){minDif=10},200),clearTimeout(longDelay),longDelay=setTimeout(function(){minDif=3},1500),e=$.extend({},e,{type:"mwheelIntent"}),($.event.dispatch||$.event.handle).apply(this,arguments)}},$.fn.extend({mwheelIntent:function(fn){return fn?this.bind("mwheelIntent",fn):this.trigger("mwheelIntent")},unmwheelIntent:function(fn){return this.unbind("mwheelIntent",fn)}}),$(function(){body=doc.body,$(doc).bind("mwheelIntent.mwheelIntentDefault",$.noop)})}(jQuery),function(factory){"function"==typeof define&&define.amd?define(["jquery"],factory):"object"==typeof exports?module.exports=factory(require("jquery")):factory(jQuery)}(function($){$.fn.jScrollPane=function(settings){return settings=$.extend({},$.fn.jScrollPane.defaults,settings),$.each(["arrowButtonSpeed","trackClickSpeed","keyboardSpeed"],function(){settings[this]=settings[this]||settings.speed}),this.each(function(){var elem=$(this),jspApi=elem.data("jsp");jspApi?jspApi.reinitialise(settings):($("script",elem).filter('[type="text/javascript"],:not([type])').remove(),jspApi=new function(elem,s){var settings,pane,paneWidth,paneHeight,container,contentWidth,contentHeight,percentInViewH,percentInViewV,isScrollableV,isScrollableH,verticalDrag,dragMaxY,verticalDragPosition,horizontalDrag,dragMaxX,horizontalDragPosition,verticalBar,verticalTrack,scrollbarWidth,verticalTrackHeight,verticalDragHeight,arrowUp,arrowDown,horizontalBar,horizontalTrack,horizontalTrackWidth,horizontalDragWidth,arrowLeft,arrowRight,reinitialiseInterval,originalPadding,originalPaddingTotalWidth,previousContentWidth,jsp=this,wasAtTop=!0,wasAtLeft=!0,wasAtBottom=!1,wasAtRight=!1,originalElement=elem.clone(!1,!1).empty(),mwEvent=$.fn.mwheelIntent?"mwheelIntent.jsp":"mousewheel.jsp";function initialise(s){var isMaintainingPositon,lastContentX,lastContentY,hasContainingSpaceChanged,originalScrollTop,originalScrollLeft,scrollableWidth,scrollableHeight,startX,startY,touchStartX,touchStartY,moved,moving,maintainAtBottom=!1,maintainAtRight=!1;if(settings=s,void 0===pane)originalScrollTop=elem.scrollTop(),originalScrollLeft=elem.scrollLeft(),elem.css({overflow:"hidden",padding:0}),paneWidth=elem.innerWidth()+originalPaddingTotalWidth,paneHeight=elem.innerHeight(),elem.width(paneWidth),pane=$('<div class="jspPane" />').css("padding",originalPadding).append(elem.children()),container=$('<div class="jspContainer" />').css({width:paneWidth+"px",height:paneHeight+"px"}).append(pane).appendTo(elem);else{if(elem.css("width",""),maintainAtBottom=settings.stickToBottom&&(scrollableHeight=contentHeight-paneHeight)>20&&scrollableHeight-contentPositionY()<10,maintainAtRight=settings.stickToRight&&(scrollableWidth=contentWidth-paneWidth)>20&&scrollableWidth-contentPositionX()<10,(hasContainingSpaceChanged=elem.innerWidth()+originalPaddingTotalWidth!=paneWidth||elem.outerHeight()!=paneHeight)&&(paneWidth=elem.innerWidth()+originalPaddingTotalWidth,paneHeight=elem.innerHeight(),container.css({width:paneWidth+"px",height:paneHeight+"px"})),!hasContainingSpaceChanged&&previousContentWidth==contentWidth&&pane.outerHeight()==contentHeight)return void elem.width(paneWidth);previousContentWidth=contentWidth,pane.css("width",""),elem.width(paneWidth),container.find(">.jspVerticalBar,>.jspHorizontalBar").remove().end()}pane.css("overflow","auto"),contentWidth=s.contentWidth?s.contentWidth:pane[0].scrollWidth,contentHeight=pane[0].scrollHeight,pane.css("overflow",""),isScrollableV=(percentInViewV=contentHeight/paneHeight)>1,(isScrollableH=(percentInViewH=contentWidth/paneWidth)>1)||isScrollableV?(elem.addClass("jspScrollable"),(isMaintainingPositon=settings.maintainPosition&&(verticalDragPosition||horizontalDragPosition))&&(lastContentX=contentPositionX(),lastContentY=contentPositionY()),isScrollableV&&(container.append($('<div class="jspVerticalBar" />').append($('<div class="jspCap jspCapTop" />'),$('<div class="jspTrack" />').append($('<div class="jspDrag" />').append($('<div class="jspDragTop" />'),$('<div class="jspDragBottom" />'))),$('<div class="jspCap jspCapBottom" />'))),verticalBar=container.find(">.jspVerticalBar"),verticalTrack=verticalBar.find(">.jspTrack"),verticalDrag=verticalTrack.find(">.jspDrag"),settings.showArrows&&(arrowUp=$('<a class="jspArrow jspArrowUp" />').bind("mousedown.jsp",getArrowScroll(0,-1)).bind("click.jsp",nil),arrowDown=$('<a class="jspArrow jspArrowDown" />').bind("mousedown.jsp",getArrowScroll(0,1)).bind("click.jsp",nil),settings.arrowScrollOnHover&&(arrowUp.bind("mouseover.jsp",getArrowScroll(0,-1,arrowUp)),arrowDown.bind("mouseover.jsp",getArrowScroll(0,1,arrowDown))),appendArrows(verticalTrack,settings.verticalArrowPositions,arrowUp,arrowDown)),verticalTrackHeight=paneHeight,container.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each(function(){verticalTrackHeight-=$(this).outerHeight()}),verticalDrag.hover(function(){verticalDrag.addClass("jspHover")},function(){verticalDrag.removeClass("jspHover")}).bind("mousedown.jsp",function(e){$("html").bind("dragstart.jsp selectstart.jsp",nil),verticalDrag.addClass("jspActive");var startY=e.pageY-verticalDrag.position().top;return $("html").bind("mousemove.jsp",function(e){positionDragY(e.pageY-startY,!1)}).bind("mouseup.jsp mouseleave.jsp",cancelDrag),!1}),sizeVerticalScrollbar()),isScrollableH&&(container.append($('<div class="jspHorizontalBar" />').append($('<div class="jspCap jspCapLeft" />'),$('<div class="jspTrack" />').append($('<div class="jspDrag" />').append($('<div class="jspDragLeft" />'),$('<div class="jspDragRight" />'))),$('<div class="jspCap jspCapRight" />'))),horizontalBar=container.find(">.jspHorizontalBar"),horizontalTrack=horizontalBar.find(">.jspTrack"),horizontalDrag=horizontalTrack.find(">.jspDrag"),settings.showArrows&&(arrowLeft=$('<a class="jspArrow jspArrowLeft" />').bind("mousedown.jsp",getArrowScroll(-1,0)).bind("click.jsp",nil),arrowRight=$('<a class="jspArrow jspArrowRight" />').bind("mousedown.jsp",getArrowScroll(1,0)).bind("click.jsp",nil),settings.arrowScrollOnHover&&(arrowLeft.bind("mouseover.jsp",getArrowScroll(-1,0,arrowLeft)),arrowRight.bind("mouseover.jsp",getArrowScroll(1,0,arrowRight))),appendArrows(horizontalTrack,settings.horizontalArrowPositions,arrowLeft,arrowRight)),horizontalDrag.hover(function(){horizontalDrag.addClass("jspHover")},function(){horizontalDrag.removeClass("jspHover")}).bind("mousedown.jsp",function(e){$("html").bind("dragstart.jsp selectstart.jsp",nil),horizontalDrag.addClass("jspActive");var startX=e.pageX-horizontalDrag.position().left;return $("html").bind("mousemove.jsp",function(e){positionDragX(e.pageX-startX,!1)}).bind("mouseup.jsp mouseleave.jsp",cancelDrag),!1}),horizontalTrackWidth=container.innerWidth(),sizeHorizontalScrollbar()),function(){if(isScrollableH&&isScrollableV){var horizontalTrackHeight=horizontalTrack.outerHeight(),verticalTrackWidth=verticalTrack.outerWidth();verticalTrackHeight-=horizontalTrackHeight,$(horizontalBar).find(">.jspCap:visible,>.jspArrow").each(function(){horizontalTrackWidth+=$(this).outerWidth()}),horizontalTrackWidth-=verticalTrackWidth,paneHeight-=verticalTrackWidth,paneWidth-=horizontalTrackHeight,horizontalTrack.parent().append($('<div class="jspCorner" />').css("width",horizontalTrackHeight+"px")),sizeVerticalScrollbar(),sizeHorizontalScrollbar()}isScrollableH&&pane.width(container.outerWidth()-originalPaddingTotalWidth+"px"),contentHeight=pane.outerHeight(),percentInViewV=contentHeight/paneHeight,isScrollableH&&((horizontalDragWidth=Math.ceil(1/percentInViewH*horizontalTrackWidth))>settings.horizontalDragMaxWidth?horizontalDragWidth=settings.horizontalDragMaxWidth:horizontalDragWidth<settings.horizontalDragMinWidth&&(horizontalDragWidth=settings.horizontalDragMinWidth),horizontalDrag.width(horizontalDragWidth+"px"),dragMaxX=horizontalTrackWidth-horizontalDragWidth,_positionDragX(horizontalDragPosition)),isScrollableV&&((verticalDragHeight=Math.ceil(1/percentInViewV*verticalTrackHeight))>settings.verticalDragMaxHeight?verticalDragHeight=settings.verticalDragMaxHeight:verticalDragHeight<settings.verticalDragMinHeight&&(verticalDragHeight=settings.verticalDragMinHeight),verticalDrag.height(verticalDragHeight+"px"),dragMaxY=verticalTrackHeight-verticalDragHeight,_positionDragY(verticalDragPosition))}(),isMaintainingPositon&&(scrollToX(maintainAtRight?contentWidth-paneWidth:lastContentX,!1),scrollToY(maintainAtBottom?contentHeight-paneHeight:lastContentY,!1)),pane.find(":input,a").unbind("focus.jsp").bind("focus.jsp",function(e){scrollToElement(e.target,!1)}),container.unbind(mwEvent).bind(mwEvent,function(event,delta,deltaX,deltaY){horizontalDragPosition||(horizontalDragPosition=0),verticalDragPosition||(verticalDragPosition=0);var dX=horizontalDragPosition,dY=verticalDragPosition,factor=event.deltaFactor||settings.mouseWheelSpeed;return jsp.scrollBy(deltaX*factor,-deltaY*factor,!1),dX==horizontalDragPosition&&dY==verticalDragPosition}),moving=!1,container.unbind("touchstart.jsp touchmove.jsp touchend.jsp click.jsp-touchclick").bind("touchstart.jsp",function(e){var touch=e.originalEvent.touches[0];startX=contentPositionX(),startY=contentPositionY(),touchStartX=touch.pageX,touchStartY=touch.pageY,moved=!1,moving=!0}).bind("touchmove.jsp",function(ev){if(moving){var touchPos=ev.originalEvent.touches[0],dX=horizontalDragPosition,dY=verticalDragPosition;return jsp.scrollTo(startX+touchStartX-touchPos.pageX,startY+touchStartY-touchPos.pageY),moved=moved||Math.abs(touchStartX-touchPos.pageX)>5||Math.abs(touchStartY-touchPos.pageY)>5,dX==horizontalDragPosition&&dY==verticalDragPosition}}).bind("touchend.jsp",function(e){moving=!1}).bind("click.jsp-touchclick",function(e){if(moved)return moved=!1,!1}),settings.enableKeyboardNavigation&&function(){var keyDown,elementHasScrolled,validParents=[];function keyDownHandler(){var dX=horizontalDragPosition,dY=verticalDragPosition;switch(keyDown){case 40:jsp.scrollByY(settings.keyboardSpeed,!1);break;case 38:jsp.scrollByY(-settings.keyboardSpeed,!1);break;case 34:case 32:jsp.scrollByY(paneHeight*settings.scrollPagePercent,!1);break;case 33:jsp.scrollByY(-paneHeight*settings.scrollPagePercent,!1);break;case 39:jsp.scrollByX(settings.keyboardSpeed,!1);break;case 37:jsp.scrollByX(-settings.keyboardSpeed,!1)}return elementHasScrolled=dX!=horizontalDragPosition||dY!=verticalDragPosition}isScrollableH&&validParents.push(horizontalBar[0]),isScrollableV&&validParents.push(verticalBar[0]),pane.bind("focus.jsp",function(){elem.focus()}),elem.attr("tabindex",0).unbind("keydown.jsp keypress.jsp").bind("keydown.jsp",function(e){if(e.target===this||validParents.length&&$(e.target).closest(validParents).length){var dX=horizontalDragPosition,dY=verticalDragPosition;switch(e.keyCode){case 40:case 38:case 34:case 32:case 33:case 39:case 37:keyDown=e.keyCode,keyDownHandler();break;case 35:scrollToY(contentHeight-paneHeight),keyDown=null;break;case 36:scrollToY(0),keyDown=null}return!(elementHasScrolled=e.keyCode==keyDown&&dX!=horizontalDragPosition||dY!=verticalDragPosition)}}).bind("keypress.jsp",function(e){if(e.keyCode==keyDown&&keyDownHandler(),e.target===this||validParents.length&&$(e.target).closest(validParents).length)return!elementHasScrolled}),settings.hideFocus?(elem.css("outline","none"),"hideFocus"in container[0]&&elem.attr("hideFocus",!0)):(elem.css("outline",""),"hideFocus"in container[0]&&elem.attr("hideFocus",!1))}(),settings.clickOnTrack&&(removeClickOnTrack(),isScrollableV&&verticalTrack.bind("mousedown.jsp",function(e){if(void 0===e.originalTarget||e.originalTarget==e.currentTarget){var scrollTimeout,clickedTrack=$(this),offset=clickedTrack.offset(),direction=e.pageY-offset.top-verticalDragPosition,isFirst=!0,doScroll=function(){var offset=clickedTrack.offset(),pos=e.pageY-offset.top-verticalDragHeight/2,contentDragY=paneHeight*settings.scrollPagePercent,dragY=dragMaxY*contentDragY/(contentHeight-paneHeight);if(direction<0)verticalDragPosition-dragY>pos?jsp.scrollByY(-contentDragY):positionDragY(pos);else{if(!(direction>0))return void cancelClick();verticalDragPosition+dragY<pos?jsp.scrollByY(contentDragY):positionDragY(pos)}scrollTimeout=setTimeout(doScroll,isFirst?settings.initialDelay:settings.trackClickRepeatFreq),isFirst=!1},cancelClick=function(){scrollTimeout&&clearTimeout(scrollTimeout),scrollTimeout=null,$(document).unbind("mouseup.jsp",cancelClick)};return doScroll(),$(document).bind("mouseup.jsp",cancelClick),!1}}),isScrollableH&&horizontalTrack.bind("mousedown.jsp",function(e){if(void 0===e.originalTarget||e.originalTarget==e.currentTarget){var scrollTimeout,clickedTrack=$(this),offset=clickedTrack.offset(),direction=e.pageX-offset.left-horizontalDragPosition,isFirst=!0,doScroll=function(){var offset=clickedTrack.offset(),pos=e.pageX-offset.left-horizontalDragWidth/2,contentDragX=paneWidth*settings.scrollPagePercent,dragX=dragMaxX*contentDragX/(contentWidth-paneWidth);if(direction<0)horizontalDragPosition-dragX>pos?jsp.scrollByX(-contentDragX):positionDragX(pos);else{if(!(direction>0))return void cancelClick();horizontalDragPosition+dragX<pos?jsp.scrollByX(contentDragX):positionDragX(pos)}scrollTimeout=setTimeout(doScroll,isFirst?settings.initialDelay:settings.trackClickRepeatFreq),isFirst=!1},cancelClick=function(){scrollTimeout&&clearTimeout(scrollTimeout),scrollTimeout=null,$(document).unbind("mouseup.jsp",cancelClick)};return doScroll(),$(document).bind("mouseup.jsp",cancelClick),!1}})),function(){if(location.hash&&location.hash.length>1){var e,retryInt,hash=escape(location.hash.substr(1));try{e=$("#"+hash+', a[name="'+hash+'"]')}catch(err){return}e.length&&pane.find(hash)&&(0===container.scrollTop()?retryInt=setInterval(function(){container.scrollTop()>0&&(scrollToElement(e,!0),$(document).scrollTop(container.position().top),clearInterval(retryInt))},50):(scrollToElement(e,!0),$(document).scrollTop(container.position().top)))}}(),settings.hijackInternalLinks&&($(document.body).data("jspHijack")||($(document.body).data("jspHijack",!0),$(document.body).delegate("a[href*=#]","click",function(event){var hash,element,container,scrollTop,elementTop,href=this.href.substr(0,this.href.indexOf("#")),locationHref=location.href;if(-1!==location.href.indexOf("#")&&(locationHref=location.href.substr(0,location.href.indexOf("#"))),href===locationHref){hash=escape(this.href.substr(this.href.indexOf("#")+1));try{element=$("#"+hash+', a[name="'+hash+'"]')}catch(e){return}element.length&&((container=element.closest(".jspScrollable")).data("jsp").scrollToElement(element,!0),container[0].scrollIntoView&&(scrollTop=$(window).scrollTop(),((elementTop=element.offset().top)<scrollTop||elementTop>scrollTop+$(window).height())&&container[0].scrollIntoView()),event.preventDefault())}})))):(elem.removeClass("jspScrollable"),pane.css({top:0,left:0,width:container.width()-originalPaddingTotalWidth}),container.unbind(mwEvent),pane.find(":input,a").unbind("focus.jsp"),elem.attr("tabindex","-1").removeAttr("tabindex").unbind("keydown.jsp keypress.jsp"),pane.unbind(".jsp"),removeClickOnTrack()),settings.autoReinitialise&&!reinitialiseInterval?reinitialiseInterval=setInterval(function(){initialise(settings)},settings.autoReinitialiseDelay):!settings.autoReinitialise&&reinitialiseInterval&&clearInterval(reinitialiseInterval),originalScrollTop&&elem.scrollTop(0)&&scrollToY(originalScrollTop,!1),originalScrollLeft&&elem.scrollLeft(0)&&scrollToX(originalScrollLeft,!1),elem.trigger("jsp-initialised",[isScrollableH||isScrollableV])}function sizeVerticalScrollbar(){verticalTrack.height(verticalTrackHeight+"px"),verticalDragPosition=0,scrollbarWidth=settings.verticalGutter+verticalTrack.outerWidth(),pane.width(paneWidth-scrollbarWidth-originalPaddingTotalWidth);try{0===verticalBar.position().left&&pane.css("margin-left",scrollbarWidth+"px")}catch(err){}}function sizeHorizontalScrollbar(){container.find(">.jspHorizontalBar>.jspCap:visible,>.jspHorizontalBar>.jspArrow").each(function(){horizontalTrackWidth-=$(this).outerWidth()}),horizontalTrack.width(horizontalTrackWidth+"px"),horizontalDragPosition=0}function appendArrows(ele,p,a1,a2){var aTemp,p1="before",p2="after";"os"==p&&(p=/Mac/.test(navigator.platform)?"after":"split"),p==p1?p2=p:p==p2&&(p1=p,aTemp=a1,a1=a2,a2=aTemp),ele[p1](a1)[p2](a2)}function getArrowScroll(dirX,dirY,ele){return function(){return function(dirX,dirY,arrow,ele){arrow=$(arrow).addClass("jspActive");var eve,scrollTimeout,isFirst=!0,doScroll=function(){0!==dirX&&jsp.scrollByX(dirX*settings.arrowButtonSpeed),0!==dirY&&jsp.scrollByY(dirY*settings.arrowButtonSpeed),scrollTimeout=setTimeout(doScroll,isFirst?settings.initialDelay:settings.arrowRepeatFreq),isFirst=!1};doScroll(),eve=ele?"mouseout.jsp":"mouseup.jsp",(ele=ele||$("html")).bind(eve,function(){arrow.removeClass("jspActive"),scrollTimeout&&clearTimeout(scrollTimeout),scrollTimeout=null,ele.unbind(eve)})}(dirX,dirY,this,ele),this.blur(),!1}}function removeClickOnTrack(){horizontalTrack&&horizontalTrack.unbind("mousedown.jsp"),verticalTrack&&verticalTrack.unbind("mousedown.jsp")}function cancelDrag(){$("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp"),verticalDrag&&verticalDrag.removeClass("jspActive"),horizontalDrag&&horizontalDrag.removeClass("jspActive")}function positionDragY(destY,animate){isScrollableV&&(destY<0?destY=0:destY>dragMaxY&&(destY=dragMaxY),void 0===animate&&(animate=settings.animateScroll),animate?jsp.animate(verticalDrag,"top",destY,_positionDragY):(verticalDrag.css("top",destY),_positionDragY(destY)))}function _positionDragY(destY){void 0===destY&&(destY=verticalDrag.position().top),container.scrollTop(0);var isAtTop=0===(verticalDragPosition=destY||0),isAtBottom=verticalDragPosition==dragMaxY,destTop=-destY/dragMaxY*(contentHeight-paneHeight);wasAtTop==isAtTop&&wasAtBottom==isAtBottom||(wasAtTop=isAtTop,wasAtBottom=isAtBottom,elem.trigger("jsp-arrow-change",[wasAtTop,wasAtBottom,wasAtLeft,wasAtRight])),function(isAtTop,isAtBottom){settings.showArrows&&(arrowUp[isAtTop?"addClass":"removeClass"]("jspDisabled"),arrowDown[isAtBottom?"addClass":"removeClass"]("jspDisabled"))}(isAtTop,isAtBottom),pane.css("top",destTop),elem.trigger("jsp-scroll-y",[-destTop,isAtTop,isAtBottom]).trigger("scroll")}function positionDragX(destX,animate){isScrollableH&&(destX<0?destX=0:destX>dragMaxX&&(destX=dragMaxX),void 0===animate&&(animate=settings.animateScroll),animate?jsp.animate(horizontalDrag,"left",destX,_positionDragX):(horizontalDrag.css("left",destX),_positionDragX(destX)))}function _positionDragX(destX){void 0===destX&&(destX=horizontalDrag.position().left),container.scrollTop(0);var isAtLeft=0===(horizontalDragPosition=destX||0),isAtRight=horizontalDragPosition==dragMaxX,destLeft=-destX/dragMaxX*(contentWidth-paneWidth);wasAtLeft==isAtLeft&&wasAtRight==isAtRight||(wasAtLeft=isAtLeft,wasAtRight=isAtRight,elem.trigger("jsp-arrow-change",[wasAtTop,wasAtBottom,wasAtLeft,wasAtRight])),function(isAtLeft,isAtRight){settings.showArrows&&(arrowLeft[isAtLeft?"addClass":"removeClass"]("jspDisabled"),arrowRight[isAtRight?"addClass":"removeClass"]("jspDisabled"))}(isAtLeft,isAtRight),pane.css("left",destLeft),elem.trigger("jsp-scroll-x",[-destLeft,isAtLeft,isAtRight]).trigger("scroll")}function scrollToY(destY,animate){positionDragY(destY/(contentHeight-paneHeight)*dragMaxY,animate)}function scrollToX(destX,animate){positionDragX(destX/(contentWidth-paneWidth)*dragMaxX,animate)}function scrollToElement(ele,stickToTop,animate){var e,eleHeight,eleWidth,viewportTop,viewportLeft,maxVisibleEleTop,maxVisibleEleLeft,destY,destX,eleTop=0,eleLeft=0;try{e=$(ele)}catch(err){return}for(eleHeight=e.outerHeight(),eleWidth=e.outerWidth(),container.scrollTop(0),container.scrollLeft(0);!e.is(".jspPane");)if(eleTop+=e.position().top,eleLeft+=e.position().left,e=e.offsetParent(),/^body|html$/i.test(e[0].nodeName))return;maxVisibleEleTop=(viewportTop=contentPositionY())+paneHeight,eleTop<viewportTop||stickToTop?destY=eleTop-settings.horizontalGutter:eleTop+eleHeight>maxVisibleEleTop&&(destY=eleTop-paneHeight+eleHeight+settings.horizontalGutter),isNaN(destY)||scrollToY(destY,animate),maxVisibleEleLeft=(viewportLeft=contentPositionX())+paneWidth,eleLeft<viewportLeft||stickToTop?destX=eleLeft-settings.horizontalGutter:eleLeft+eleWidth>maxVisibleEleLeft&&(destX=eleLeft-paneWidth+eleWidth+settings.horizontalGutter),isNaN(destX)||scrollToX(destX,animate)}function contentPositionX(){return-pane.position().left}function contentPositionY(){return-pane.position().top}function nil(){return!1}"border-box"===elem.css("box-sizing")?(originalPadding=0,originalPaddingTotalWidth=0):(originalPadding=elem.css("paddingTop")+" "+elem.css("paddingRight")+" "+elem.css("paddingBottom")+" "+elem.css("paddingLeft"),originalPaddingTotalWidth=(parseInt(elem.css("paddingLeft"),10)||0)+(parseInt(elem.css("paddingRight"),10)||0)),$.extend(jsp,{reinitialise:function(s){initialise(s=$.extend({},settings,s))},scrollToElement:function(ele,stickToTop,animate){scrollToElement(ele,stickToTop,animate)},scrollTo:function(destX,destY,animate){scrollToX(destX,animate),scrollToY(destY,animate)},scrollToX:function(destX,animate){scrollToX(destX,animate)},scrollToY:function(destY,animate){scrollToY(destY,animate)},scrollToPercentX:function(destPercentX,animate){scrollToX(destPercentX*(contentWidth-paneWidth),animate)},scrollToPercentY:function(destPercentY,animate){scrollToY(destPercentY*(contentHeight-paneHeight),animate)},scrollBy:function(deltaX,deltaY,animate){jsp.scrollByX(deltaX,animate),jsp.scrollByY(deltaY,animate)},scrollByX:function(deltaX,animate){positionDragX((contentPositionX()+Math[deltaX<0?"floor":"ceil"](deltaX))/(contentWidth-paneWidth)*dragMaxX,animate)},scrollByY:function(deltaY,animate){positionDragY((contentPositionY()+Math[deltaY<0?"floor":"ceil"](deltaY))/(contentHeight-paneHeight)*dragMaxY,animate)},positionDragX:function(x,animate){positionDragX(x,animate)},positionDragY:function(y,animate){positionDragY(y,animate)},animate:function(ele,prop,value,stepCallback){var params={};params[prop]=value,ele.animate(params,{duration:settings.animateDuration,easing:settings.animateEase,queue:!1,step:stepCallback})},getContentPositionX:function(){return contentPositionX()},getContentPositionY:function(){return contentPositionY()},getContentWidth:function(){return contentWidth},getContentHeight:function(){return contentHeight},getPercentScrolledX:function(){return contentPositionX()/(contentWidth-paneWidth)},getPercentScrolledY:function(){return contentPositionY()/(contentHeight-paneHeight)},getIsScrollableH:function(){return isScrollableH},getIsScrollableV:function(){return isScrollableV},getContentPane:function(){return pane},scrollToBottom:function(animate){positionDragY(dragMaxY,animate)},hijackInternalLinks:$.noop,destroy:function(){var currentY,currentX;currentY=contentPositionY(),currentX=contentPositionX(),elem.removeClass("jspScrollable").unbind(".jsp"),pane.unbind(".jsp"),elem.replaceWith(originalElement.append(pane.children())),originalElement.scrollTop(currentY),originalElement.scrollLeft(currentX),reinitialiseInterval&&clearInterval(reinitialiseInterval)}}),initialise(s)}(elem,settings),elem.data("jsp",jspApi))})},$.fn.jScrollPane.defaults={showArrows:!1,maintainPosition:!0,stickToBottom:!1,stickToRight:!1,clickOnTrack:!0,autoReinitialise:!1,autoReinitialiseDelay:500,verticalDragMinHeight:0,verticalDragMaxHeight:99999,horizontalDragMinWidth:0,horizontalDragMaxWidth:99999,contentWidth:void 0,animateScroll:!1,animateDuration:300,animateEase:"linear",hijackInternalLinks:!1,verticalGutter:4,horizontalGutter:4,mouseWheelSpeed:3,arrowButtonSpeed:0,arrowRepeatFreq:50,arrowScrollOnHover:!1,trackClickSpeed:0,trackClickRepeatFreq:70,verticalArrowPositions:"split",horizontalArrowPositions:"split",enableKeyboardNavigation:!0,hideFocus:!1,keyboardSpeed:0,initialDelay:300,speed:30,scrollPagePercent:.8}}),function($){"use strict";var has3d,hasRot,vendor="",PI=Math.PI,A90=PI/2,isTouch="ontouchstart"in window,mouseEvents=isTouch?{down:"touchstart",move:"touchmove",up:"touchend",over:"touchstart",out:"touchend"}:{down:"mousedown",move:"mousemove",up:"mouseup",over:"mouseover",out:"mouseout"},corners={backward:["bl","tl"],forward:["br","tr"],all:["tl","bl","tr","br","l","r"]},displays=["single","double"],directions=["ltr","rtl"],turnOptions={acceleration:!0,display:"double",duration:600,page:1,gradients:!0,turnCorners:"bl,br",when:null},flipOptions={cornerSize:100},turnMethods={init:function(options){var parts;has3d="WebKitCSSMatrix"in window||"MozPerspective"in document.body.style,hasRot=!(parts=/AppleWebkit\/([0-9\.]+)/i.exec(navigator.userAgent))||parseFloat(parts[1])>534.3,vendor=getPrefix();var i,pageNum=0,data=this.data(),ch=this.children();if(flipOptions.cornerSize="number"==typeof options.cornerSize?options.cornerSize:flipOptions.cornerSize,options=$.extend({width:this.width(),height:this.height(),direction:this.attr("dir")||this.css("direction")||"ltr"},turnOptions,options),data.opts=options,data.pageObjs={},data.pages={},data.pageWrap={},data.pageZoom={},data.pagePlace={},data.pageMv=[],data.zoom=1,data.totalPages=options.pages||0,data.eventHandlers={touchStart:$.proxy(turnMethods._touchStart,this),touchMove:$.proxy(turnMethods._touchMove,this),touchEnd:$.proxy(turnMethods._touchEnd,this),start:$.proxy(turnMethods._eventStart,this)},options.when)for(i in options.when)has(i,options.when)&&this.bind(i,options.when[i]);for(this.css({position:"relative",width:options.width,height:options.height}),this.turn("display",options.display),""!==options.direction&&this.turn("direction",options.direction),has3d&&!isTouch&&options.acceleration&&this.transform(translate(0,0,!0)),i=0;i<ch.length;i++)"1"!=$(ch[i]).attr("ignore")&&this.turn("addPage",ch[i],++pageNum);return $(this).bind(mouseEvents.down,data.eventHandlers.touchStart).bind("end",turnMethods._eventEnd).bind("pressed",turnMethods._eventPressed).bind("released",turnMethods._eventReleased).bind("flip",turnMethods._flip),$(this).parent().bind("start",data.eventHandlers.start),$(document).bind(mouseEvents.move,data.eventHandlers.touchMove).bind(mouseEvents.up,data.eventHandlers.touchEnd),this.turn("page",options.page),data.done=!0,this.turn.initialLoading=!1,this},addPage:function(element,page){var currentPage,className,incPages=!1,data=this.data(),lastPage=data.totalPages+1;if(data.destroying)return!1;if((currentPage=/\bp([0-9]+)\b/.exec($(element).attr("class")))&&(page=parseInt(currentPage[1],10)),page){if(page==lastPage)incPages=!0;else if(page>lastPage)throw turnError('Page "'+page+'" cannot be inserted')}else page=lastPage,incPages=!0;return page>=1&&page<=lastPage&&(className="double"==data.display?page%2?" odd":" even":"",data.opts.isDoublePageLayout||(className+=" shadow"),data.done&&this.turn("stop"),page in data.pageObjs&&turnMethods._movePages.call(this,page,1),incPages&&(data.totalPages=lastPage),data.pageObjs[page]=$(element).css({float:"left"}).addClass("page p"+page+className),-1!=navigator.userAgent.indexOf("MSIE 9.0")&&data.pageObjs[page].hasClass("hard")&&data.pageObjs[page].removeClass("hard"),turnMethods._addPage.call(this,page),turnMethods._removeFromDOM.call(this)),this},_addPage:function(page){var data=this.data(),element=data.pageObjs[page],nextPage=-1;if(element)if(turnMethods._necessPage.call(this,page)){if(!data.pageWrap[page]){data.pageWrap[page]=$("<div/>",{class:"page-wrapper",page:page,css:{position:"absolute",overflow:"hidden"}}),$.each(data.pageWrap,function(key){var keyAsNumber=parseInt(key,10);-1===nextPage&&keyAsNumber>page&&(nextPage=keyAsNumber)}),nextPage>-1&&data.pageWrap[nextPage]?data.pageWrap[page].insertBefore(data.pageWrap[nextPage]):this.append(data.pageWrap[page]),data.pagePlace[page]||(data.pagePlace[page]=page,data.pageObjs[page].appendTo(data.pageWrap[page]));var prop=turnMethods._pageSize.call(this,page,!0);element.css({width:prop.width,height:prop.height}),data.pageWrap[page].css(prop)}data.pagePlace[page]==page&&turnMethods._makeFlip.call(this,page)}else data.pagePlace[page]=0,data.pageObjs[page]&&data.pageObjs[page].remove()},hasPage:function(page){return has(page,this.data().pageObjs)},center:function(page){var data=this.data(),size=$(this).turn("size"),currentLeft=parseInt($(this).css("margin-left")||0),left=0,$that=$(this);if(!data.noCenter){if("double"===data.display){var view=this.turn("view",page||data.tpage||data.page);"ltr"===data.direction?view[0]?view[1]||(left+=size.width/4):left-=size.width/4:view[0]?view[1]||(left-=size.width/4):left+=size.width/4}left!==currentLeft&&($("#mainView").hasClass("zoomed")?$that.css({marginLeft:left}):this.turn.initialLoading?this.animatef({from:currentLeft,to:left,duration:400,frame:function(v){$that.css({marginLeft:v})}}):$that.css({marginLeft:left}))}return this},destroy:function(){var flipbook=this,data=this.data();if("prevented"!=trigger("destroying",this)){for(data.destroying=!0,$.each(["end","first","flip","last","pressed","released","start","turning","turned","zooming","missing"],function(index,eventName){flipbook.unbind(eventName)}),this.parent().unbind("start",data.eventHandlers.start),$(document).unbind(mouseEvents.move,data.eventHandlers.touchMove).unbind(mouseEvents.up,data.eventHandlers.touchEnd);0!==data.totalPages;)this.turn("removePage",data.totalPages);return data.fparent&&data.fparent.remove(),data.shadow&&data.shadow.remove(),this.removeData(),data=null,this}},is:function(){return"object"==typeof this.data().pages},zoom:function(newZoom){var data=this.data();if("number"==typeof newZoom){if(newZoom<.001||newZoom>100)throw turnError(newZoom+" is not a value for zoom");if("prevented"==trigger("zooming",this,[newZoom,data.zoom]))return this;var size=this.turn("size"),currentView=this.turn("view"),iz=1/data.zoom,newWidth=Math.round(size.width*iz*newZoom),newHeight=Math.round(size.height*iz*newZoom);data.zoom=newZoom,$(this).turn("stop").turn("size",newWidth,newHeight),data.opts.autoCenter&&this.turn("center"),turnMethods._updateShadow.call(this);for(var i=0;i<currentView.length;i++)currentView[i]&&data.pageZoom[currentView[i]]!=data.zoom&&(this.trigger("zoomed",[currentView[i],currentView,data.pageZoom[currentView[i]],data.zoom]),data.pageZoom[currentView[i]]=data.zoom);return this}return data.zoom},_pageSize:function(page,position){var data=this.data(),prop={};if("single"==data.display)prop.width=this.width(),prop.height=this.height(),position&&(prop.top=0,prop.left=0,prop.right="auto");else{var pageWidth=this.width()/2,pageHeight=this.height();if(data.pageObjs[page].hasClass("own-size")?(prop.width=data.pageObjs[page].width(),prop.height=data.pageObjs[page].height()):(prop.width=pageWidth,prop.height=pageHeight),position){var odd=page%2;prop.top=(pageHeight-prop.height)/2,"ltr"==data.direction?(prop[odd?"right":"left"]=pageWidth-prop.width,prop[odd?"left":"right"]="auto"):(prop[odd?"left":"right"]=pageWidth-prop.width,prop[odd?"right":"left"]="auto")}}return prop},_makeFlip:function(page){var data=this.data();if(!data.pages[page]&&data.pagePlace[page]==page){var single="single"==data.display,odd=page%2;data.pages[page]=data.pageObjs[page].css(turnMethods._pageSize.call(this,page)).flip({page:page,next:odd||single?page+1:page-1,turn:this}).flip("disable",data.disabled),turnMethods._setPageLoc.call(this,page),data.pageZoom[page]=data.zoom}return data.pages[page]},_makeRange:function(){var page,range;if(!(this.data().totalPages<1))for(page=(range=this.turn("range"))[0];page<=range[1];page++)turnMethods._addPage.call(this,page)},range:function(page){var remainingPages,left,right,view,data=this.data();if(page=page||data.tpage||data.page||1,view=turnMethods._view.call(this,page),page<1||page>data.totalPages)throw turnError('"'+page+'" is not a valid page');return view[1]=view[1]||view[0],view[0]>=1&&view[1]<=data.totalPages?(remainingPages=Math.floor(2),data.totalPages-view[1]>view[0]?right=2*remainingPages-(left=Math.min(view[0]-1,remainingPages)):left=2*remainingPages-(right=Math.min(data.totalPages-view[1],remainingPages))):(left=5,right=5),[Math.max(1,view[0]-left),Math.min(data.totalPages,view[1]+right)]},_necessPage:function(page){if(0===page)return!0;var range=this.turn("range");return this.data().pageObjs[page].hasClass("fixed")||page>=range[0]&&page<=range[1]},_removeFromDOM:function(){var page,data=this.data();for(page in data.pageWrap)has(page,data.pageWrap)&&!turnMethods._necessPage.call(this,page)&&turnMethods._removePageFromDOM.call(this,page)},_removePageFromDOM:function(page){var data=this.data();if(data.pages[page]){var dd=data.pages[page].data();flipMethods._moveFoldingPage.call(data.pages[page],!1),dd.f&&dd.f.fwrapper&&dd.f.fwrapper.remove(),data.pages[page].removeData(),data.pages[page].remove(),delete data.pages[page]}data.pageObjs[page]&&data.pageObjs[page].remove(),data.pageWrap[page]&&(data.pageWrap[page].remove(),delete data.pageWrap[page]),turnMethods._removeMv.call(this,page),delete data.pagePlace[page],delete data.pageZoom[page]},removePage:function(page){var data=this.data();if("*"==page)for(;0!==data.totalPages;)this.turn("removePage",data.totalPages);else{if(page<1||page>data.totalPages)throw turnError("The page "+page+" doesn't exist");data.pageObjs[page]&&(this.turn("stop"),turnMethods._removePageFromDOM.call(this,page),delete data.pageObjs[page]),turnMethods._movePages.call(this,page,-1),data.totalPages=data.totalPages-1,data.page>data.totalPages?(data.page=null,turnMethods._fitPage.call(this,data.totalPages)):(turnMethods._makeRange.call(this),this.turn("update"))}return this},_movePages:function(from,change){var page,that=this,data=this.data(),single="single"==data.display,move=function(page){var next=page+change,odd=next%2,className=odd?" odd ":" even ";data.pageObjs[page]&&(data.pageObjs[next]=data.pageObjs[page].removeClass("p"+page+" odd even").addClass("p"+next+className)),data.pagePlace[page]&&data.pageWrap[page]&&(data.pagePlace[next]=next,data.pageObjs[next].hasClass("fixed")?data.pageWrap[next]=data.pageWrap[page].attr("page",next):data.pageWrap[next]=data.pageWrap[page].css(turnMethods._pageSize.call(that,next,!0)).attr("page",next),data.pages[page]&&(data.pages[next]=data.pages[page].flip("options",{page:next,next:single||odd?next+1:next-1})),change&&(delete data.pages[page],delete data.pagePlace[page],delete data.pageZoom[page],delete data.pageObjs[page],delete data.pageWrap[page]))};if(change>0)for(page=data.totalPages;page>=from;page--)move(page);else for(page=from;page<=data.totalPages;page++)move(page)},display:function(display){var data=this.data(),currentDisplay=data.display;if(void 0===display)return currentDisplay;if(-1==$.inArray(display,displays))throw turnError('"'+display+'" is not a value for display');switch(display){case"single":data.pageObjs[0]||(this.turn("stop").css({overflow:"hidden"}),data.pageObjs[0]=$("<div />",{class:"page p-temporal"}).css({width:this.width(),height:this.height()}).appendTo(this)),this.addClass("shadow");break;case"double":data.pageObjs[0]&&(this.turn("stop").css({overflow:""}),data.pageObjs[0].remove(),delete data.pageObjs[0]),this.removeClass("shadow")}if(data.display=display,currentDisplay){var size=this.turn("size");turnMethods._movePages.call(this,1,0),this.turn("size",size.width,size.height).turn("update")}return this},direction:function(dir){var data=this.data();if(void 0===dir)return data.direction;if(dir=dir.toLowerCase(),-1==$.inArray(dir,directions))throw turnError('"'+dir+'" is not a value for direction');return"rtl"==dir&&$(this).attr("dir","ltr").css({direction:"ltr"}),data.direction=dir,data.done&&this.turn("size",$(this).width(),$(this).height()),this},animating:function(){return this.data().pageMv.length>0},corner:function(){var corner,page,data=this.data();for(page in data.pages)if(has(page,data.pages)&&(corner=data.pages[page].flip("corner")))return corner;return!1},data:function(){return this.data()},disable:function(disable){var page,data=this.data(),view=this.turn("view");for(page in data.disabled=void 0===disable||!0===disable,data.pages)has(page,data.pages)&&data.pages[page].flip("disable",!!data.disabled||-1==$.inArray(parseInt(page,10),view));return this},disabled:function(disable){return void 0===disable?!0===this.data().disabled:this.turn("disable",disable)},size:function(width,height){if(void 0===width||void 0===height)return{width:this.width(),height:this.height()};this.turn("stop");var page,prop,data=this.data(),pageWidth="double"==data.display?width/2:width;for(page in this.css({width:width,height:height}),data.pageObjs[0]&&data.pageObjs[0].css({width:pageWidth,height:height}),data.pageWrap)has(page,data.pageWrap)&&(prop=turnMethods._pageSize.call(this,page,!0),data.pageObjs[page].css({width:prop.width,height:prop.height}),data.pageWrap[page].css(prop),data.pages[page]&&data.pages[page].css({width:prop.width,height:prop.height}));return this.turn("resize"),this},resize:function(){var page,data=this.data();for(data.pages[0]&&(data.pageWrap[0].css({left:-this.width()}),data.pages[0].flip("resize",!0)),page=1;page<=data.totalPages;page++)data.pages[page]&&data.pages[page].flip("resize",!0);turnMethods._updateShadow.call(this),data.opts.autoCenter&&this.turn("center")},_removeMv:function(page){var i,data=this.data();for(i=0;i<data.pageMv.length;i++)if(data.pageMv[i]==page)return data.pageMv.splice(i,1),!0;return!1},_addMv:function(page){var data=this.data();turnMethods._removeMv.call(this,page),data.pageMv.push(page)},_view:function(page){var data=this.data();return page=page||data.page,"double"==data.display?page%2?[page-1,page]:[page,page+1]:[page]},view:function(page){var data=this.data(),view=turnMethods._view.call(this,page);return"double"==data.display?[view[0]>0?view[0]:0,view[1]<=data.totalPages?view[1]:0]:[view[0]>0&&view[0]<=data.totalPages?view[0]:0]},stop:function(ignore,animate){if(this.turn("animating")){var i,opts,page,data=this.data();for(data.tpage&&(data.page=data.tpage,delete data.tpage),i=0;i<data.pageMv.length;i++)data.pageMv[i]&&data.pageMv[i]!==ignore&&(opts=(page=data.pages[data.pageMv[i]]).data().f.opts,page.flip("hideFoldedPage",animate),animate||flipMethods._moveFoldingPage.call(page,!1),opts.force&&(opts.next=opts.page%2==0?opts.page-1:opts.page+1,delete opts.force))}return this.turn("update"),this},pages:function(pages){var data=this.data();if(pages){if(pages<data.totalPages)for(var page=data.totalPages;page>pages;page--)this.turn("removePage",page);return data.totalPages=pages,turnMethods._fitPage.call(this,data.page),this}return data.totalPages},_missing:function(page){var data=this.data();if(!(data.totalPages<1)){var p,range=this.turn("range",page),missing=[];for(p=range[0];p<=range[1];p++)data.pageObjs[p]||missing.push(p);missing.length>0&&this.trigger("missing",[missing])}},_fitPage:function(page){var data=this.data(),newView=this.turn("view",page);if(turnMethods._missing.call(this,page),data.pageObjs[page]){data.page=page,this.turn("stop");for(var i=0;i<newView.length;i++)newView[i]&&data.pageZoom[newView[i]]!=data.zoom&&(this.trigger("zoomed",[newView[i],newView,data.pageZoom[newView[i]],data.zoom]),data.pageZoom[newView[i]]=data.zoom);if(turnMethods._removeFromDOM.call(this),turnMethods._makeRange.call(this),turnMethods._updateShadow.call(this),this.trigger("turned",[page,newView]),this.turn("update"),data.opts.isDoublePageLayout&&data.page>1&&data.page<data.totalPages&&!data.previousFlip){var rightPageNumber=data.page+1,rightPageWrap=data.pageWrap[rightPageNumber];changeRightSidePageOverflow(data.pages[rightPageNumber],rightPageWrap,!1,data)}data.opts.autoCenter&&this.turn("center")}},_turnPage:function(page){var current,next,data=this.data(),place=data.pagePlace[page],view=this.turn("view"),newView=this.turn("view",page);if(data.page!=page){var currentPage=data.page;if("prevented"==trigger("turning",this,[page,newView]))return void(currentPage==data.page&&-1!=$.inArray(place,data.pageMv)&&data.pages[place].flip("hideFoldedPage",!0));-1!=$.inArray(1,newView)&&this.trigger("first"),-1!=$.inArray(data.totalPages,newView)&&this.trigger("last")}"single"==data.display?(current=view[0],next=newView[0]):view[1]&&page>view[1]?(current=view[1],next=newView[0]):view[0]&&page<view[0]&&(current=view[0],next=newView[1]);var optsCorners=data.opts.turnCorners.split(","),flipData=data.pages[current].data().f,opts=flipData.opts,actualPoint=flipData.point;turnMethods._missing.call(this,page),data.pageObjs[page]&&(this.turn("stop"),data.page=page,turnMethods._makeRange.call(this),data.tpage=next,opts.next!=next&&(opts.next=next,opts.force=!0),this.turn("update"),flipData.point=actualPoint,"hard"==flipData.effect?"ltr"==data.direction?data.pages[current].flip("turnPage",page>current?"r":"l"):data.pages[current].flip("turnPage",page>current?"l":"r"):"ltr"==data.direction?data.pages[current].flip("turnPage",optsCorners[page>current?1:0]):data.pages[current].flip("turnPage",optsCorners[page>current?0:1]))},page:function(page){var data=this.data();if(void 0===page)return data.page;if(!data.disabled&&!data.destroying){if((page=parseInt(page,10))>0&&page<=data.totalPages)return page!=data.page&&(data.done&&-1==$.inArray(page,this.turn("view"))?turnMethods._turnPage.call(this,page):turnMethods._fitPage.call(this,page)),this;throw turnError("The page "+page+" does not exist")}},next:function(){return this.turn("page",Math.min(this.data().totalPages,turnMethods._view.call(this,this.data().page).pop()+1))},previous:function(){return this.turn("page",Math.max(1,turnMethods._view.call(this,this.data().page).shift()-1))},peel:function(corner,animate){var page,data=this.data(),view=this.turn("view");return animate=void 0===animate||!0===animate,!1===corner?this.turn("stop",null,animate):"single"==data.display?data.pages[data.page].flip("peel",corner,animate):(page="ltr"==data.direction?-1!=corner.indexOf("l")?view[0]:view[1]:-1!=corner.indexOf("l")?view[1]:view[0],data.pages[page]&&data.pages[page].flip("peel",corner,animate)),this},_addMotionPage:function(){var opts=$(this).data().f.opts,turn=opts.turn;turn.data(),turnMethods._addMv.call(turn,opts.page)},_eventStart:function(e,opts,corner){var data=opts.turn.data(),actualZoom=data.pageZoom[opts.page];if(e.isDefaultPrevented())turnMethods._updateShadow.call(opts.turn);else{if(actualZoom&&actualZoom!=data.zoom&&(opts.turn.trigger("zoomed",[opts.page,opts.turn.turn("view",opts.page),actualZoom,data.zoom]),data.pageZoom[opts.page]=data.zoom),"single"==data.display&&corner&&("l"==corner.charAt(1)&&"ltr"==data.direction||"r"==corner.charAt(1)&&"rtl"==data.direction?(opts.next=opts.next<opts.page?opts.next:opts.page-1,opts.force=!0):opts.next=opts.next>opts.page?opts.next:opts.page+1),data.opts.isDoublePageLayout){var flipDirection=opts.page<opts.next?"rtl":"ltr",rightPageNumber="rtl"===flipDirection?opts.page:opts.page+1,rightPageWrap=data.pageWrap[rightPageNumber],rightPage=data.pages[rightPageNumber];data.flipDirection=flipDirection,changeRightSidePageOverflow(rightPage,rightPageWrap,!0,data)}turnMethods._addMotionPage.call(e.target),turnMethods._updateShadow.call(opts.turn)}},_eventEnd:function(e,opts,turned){$(e.target).data().f;var rightPageNumber,rightPage,rightPageWrap,turn=opts.turn,dd=turn.data(),flipDirection=opts.page<opts.next?"rtl":"ltr";if(turned){var tpage=dd.tpage||dd.page;dd.previousFlip=flipDirection,dd.opts.isDoublePageLayout&&dd.page>1&&dd.page<dd.totalPages&&(rightPageNumber="rtl"===flipDirection?opts.next+1:opts.next,rightPageWrap=dd.pageWrap[rightPageNumber],changeRightSidePageOverflow(rightPage=dd.pages[rightPageNumber],rightPageWrap,!1,dd)),tpage!=opts.next&&tpage!=opts.page||(delete dd.tpage,turnMethods._fitPage.call(turn,tpage||opts.next,!0))}else{if(dd.opts.isDoublePageLayout&&dd.page>1&&dd.page<dd.totalPages)if(dd.page!==opts.next&&dd.page!==opts.page)dd.previousFlip?(rightPageNumber="rtl"===flipDirection?opts.page:opts.page+1,rightPageWrap=dd.pageWrap[rightPageNumber],changeRightSidePageOverflow(rightPage=dd.pages[rightPageNumber],rightPageWrap,!1,dd)):(rightPageNumber=dd.page+1,rightPageWrap=dd.pageWrap[rightPageNumber],changeRightSidePageOverflow(rightPage=dd.pages[rightPageNumber],rightPageWrap,!1,dd));else if(dd.previousFlip)if("rtl"===dd.previousFlip)rightPageNumber="rtl"===flipDirection?opts.next+1:opts.page+1,rightPageWrap=dd.pageWrap[rightPageNumber],changeRightSidePageOverflow(rightPage=dd.pages[rightPageNumber],rightPageWrap,!1,dd);else{rightPageNumber="rtl"===flipDirection?opts.page:opts.page-1,rightPageWrap=dd.pageWrap[rightPageNumber],rightPage=dd.pages[rightPageNumber];var isCorrectRightPage=rightPageNumber===(dd.page%2==0?dd.page+1:dd.page);rightPage&&!rightPage.hasClass("p1")&&isCorrectRightPage&&changeRightSidePageOverflow(rightPage,rightPageWrap,!1,dd)}else rightPageNumber=dd.page+1,rightPageWrap=dd.pageWrap[rightPageNumber],changeRightSidePageOverflow(rightPage=dd.pages[rightPageNumber],rightPageWrap,!1,dd);turnMethods._removeMv.call(turn,opts.page),turnMethods._updateShadow.call(turn),turn.turn("update")}},_eventPressed:function(e){var data=$(e.target).data().f,turn=data.opts.turn,turnData=turn.data();return turnData.pages,turnData.mouseAction=!0,turn.turn("update"),data.time=(new Date).getTime()},_eventReleased:function(e,point){var outArea,page=$(e.target),data=page.data().f,turn=data.opts.turn,turnData=turn.data();outArea="single"==turnData.display?"br"==point.corner||"tr"==point.corner?point.x<page.width()/2:point.x>page.width()/2:point.x<0||point.x>page.width(),((new Date).getTime()-data.time<200||outArea)&&(e.preventDefault(),turnMethods._turnPage.call(turn,data.opts.next)),turnData.mouseAction=!1},_flip:function(e){e.stopPropagation();var opts=$(e.target).data().f.opts;opts.turn.trigger("turn",[opts.next]),opts.turn.data().opts.autoCenter&&opts.turn.turn("center",opts.next)},_touchStart:function(){var data=this.data();for(var page in data.pages)if(has(page,data.pages)&&!1===flipMethods._eventStart.apply(data.pages[page],arguments))return!1},_touchMove:function(){var data=this.data();for(var page in data.pages)has(page,data.pages)&&flipMethods._eventMove.apply(data.pages[page],arguments)},_touchEnd:function(){var data=this.data();for(var page in data.pages)has(page,data.pages)&&flipMethods._eventEnd.apply(data.pages[page],arguments)},calculateZ:function(mv){var i,page,nextPage,placePage,dpage,that=this,data=this.data(),view=this.turn("view"),currentPage=view[0]||view[1],total=mv.length-1,r={pageZ:{},partZ:{},pageV:{}},addView=function(page){var view=that.turn("view",page);view[0]&&(r.pageV[view[0]]=!0),view[1]&&(r.pageV[view[1]]=!0)};for(i=0;i<=total;i++)page=mv[i],nextPage=data.pages[page].data().f.opts.next,placePage=data.pagePlace[page],addView(page),addView(nextPage),dpage=data.pagePlace[nextPage]==nextPage?nextPage:page,r.pageZ[dpage]=data.totalPages-Math.abs(currentPage-dpage),r.partZ[placePage]=2*data.totalPages-total+i;return r},update:function(){var page,data=this.data();if(this.turn("animating")&&0!==data.pageMv[0]){var p,fixed,pos=this.turn("calculateZ",data.pageMv),corner=this.turn("corner"),actualView=this.turn("view"),newView=this.turn("view",data.tpage),cssObj={};for(page in data.pageWrap)has(page,data.pageWrap)&&(fixed=data.pageObjs[page].hasClass("fixed"),cssObj={display:pos.pageV[page]||fixed?"":"none",zIndex:(data.pageObjs[page].hasClass("hard")?pos.partZ[page]:pos.pageZ[page])||(fixed?-1:0)},data.pageWrap[page].css(cssObj),(p=data.pages[page])&&(p.flip("z",pos.partZ[page]||null),pos.pageV[page]&&p.flip("resize"),data.tpage?p.flip("hover",!1).flip("disable",-1==$.inArray(parseInt(page,10),data.pageMv)&&page!=newView[0]&&page!=newView[1]):p.flip("hover",!1===corner).flip("disable",page!=actualView[0]&&page!=actualView[1])))}else for(page in data.pageWrap)if(has(page,data.pageWrap)){var pageLocation=turnMethods._setPageLoc.call(this,page);data.pages[page]&&data.pages[page].flip("disable",data.disabled||1!=pageLocation).flip("hover",!0).flip("z",null)}return this},_updateShadow:function(){var view,view2,data=this.data(),width=this.width(),height=this.height(),pageWidth="single"==data.display?width:width/2;view=this.turn("view"),data.shadow||(data.shadow=$("<div />",{class:"shadow",css:divAtt(0,0,0).css}).appendTo(this));for(var i=0;i<data.pageMv.length&&view[0]&&view[1];i++)view=this.turn("view",data.pages[data.pageMv[i]].data().f.opts.next),view2=this.turn("view",data.pageMv[i]),view[0]=view[0]&&view2[0],view[1]=view[1]&&view2[1];switch(view[0]?view[1]?3:"ltr"==data.direction?2:1:"ltr"==data.direction?1:2){case 1:data.shadow.css({width:pageWidth,height:height,top:0,left:pageWidth});break;case 2:data.shadow.css({width:pageWidth,height:height,top:0,left:0});break;case 3:data.shadow.css({width:width,height:height,top:0,left:0})}},_setPageLoc:function(page){var data=this.data(),view=this.turn("view"),loc=0,cssObj={};if(page==view[0]||page==view[1]?loc=1:("single"==data.display&&page==view[0]+1||"double"==data.display&&page==view[0]-2||page==view[1]+2)&&(loc=2),!this.turn("animating")){switch(loc){case 1:cssObj={zIndex:data.totalPages,display:""};break;case 2:cssObj={zIndex:data.totalPages-1,display:""};break;case 0:cssObj={zIndex:0,display:data.pageObjs[page].hasClass("fixed")?"":"none"}}data.pageWrap[page].css(cssObj)}return loc},options:function(options){if(void 0===options)return this.data().opts;var data=this.data();if($.extend(data.opts,options),options.pages&&this.turn("pages",options.pages),options.page&&this.turn("page",options.page),options.display&&this.turn("display",options.display),options.direction&&this.turn("direction",options.direction),options.width&&options.height&&this.turn("size",options.width,options.height),options.when)for(var eventName in options.when)has(eventName,options.when)&&this.unbind(eventName).bind(eventName,options.when[eventName]);return this},version:function(){return"4.1.0"}},flipMethods={init:function(opts){return this.data({f:{disabled:!1,hover:!1,effect:this.hasClass("hard")?"hard":"sheet"}}),this.flip("options",opts),flipMethods._addPageWrapper.call(this),this},setData:function(d){var data=this.data();return data.f=$.extend(data.f,d),this},options:function(opts){var data=this.data().f;return opts?(flipMethods.setData.call(this,{opts:$.extend({},data.opts||flipOptions,opts)}),this):data.opts},z:function(z){var data=this.data().f;return data.opts["z-index"]=z,data.fwrapper&&data.fwrapper.css({zIndex:z||parseInt(data.parent.css("z-index"),10)||0}),this},_cAllowed:function(){var data=this.data().f,page=data.opts.page,turnData=data.opts.turn.data(),odd=page%2;return"hard"==data.effect?"ltr"==turnData.direction?[odd?"r":"l"]:[odd?"l":"r"]:"single"==turnData.display?1==page?"ltr"==turnData.direction?corners.forward:corners.backward:page==turnData.totalPages?"ltr"==turnData.direction?corners.backward:corners.forward:corners.all:"ltr"==turnData.direction?corners[odd?"forward":"backward"]:corners[odd?"backward":"forward"]},_cornerActivated:function(p){var data=this.data().f,width=this.width(),height=this.height(),point={x:p.x,y:p.y,corner:""},csz=data.opts.cornerSize;if(point.x<=0||point.y<=0||point.x>=width||point.y>=height)return!1;var allowedCorners=flipMethods._cAllowed.call(this);switch(data.effect){case"hard":if(point.x>width-csz)point.corner="r";else{if(!(point.x<csz))return!1;point.corner="l"}break;case"sheet":if(point.y<csz)point.corner+="t";else{if(!(point.y>=height-csz))return!1;point.corner+="b"}if(point.x<=csz)point.corner+="l";else{if(!(point.x>=width-csz))return!1;point.corner+="r"}}return!(!point.corner||-1==$.inArray(point.corner,allowedCorners))&&point},_isIArea:function(e){var pos=this.data().f.parent.offset();return e=isTouch&&e.originalEvent?e.originalEvent.touches[0]:e,flipMethods._cornerActivated.call(this,{x:e.pageX-pos.left,y:e.pageY-pos.top})},_c:function(corner,opts){switch(opts=opts||0,corner){case"tl":return point2D(opts,opts);case"tr":return point2D(this.width()-opts,opts);case"bl":return point2D(opts,this.height()-opts);case"br":return point2D(this.width()-opts,this.height()-opts);case"l":return point2D(opts,0);case"r":return point2D(this.width()-opts,0)}},_c2:function(corner){switch(corner){case"tl":return point2D(2*this.width(),0);case"tr":return point2D(-this.width(),0);case"bl":return point2D(2*this.width(),this.height());case"br":return point2D(-this.width(),this.height());case"l":return point2D(2*this.width(),0);case"r":return point2D(-this.width(),0)}},_foldingPage:function(){var data=this.data().f;if(data){var opts=data.opts;return opts.turn?"single"==(data=opts.turn.data()).display?opts.next>1||opts.page>1?data.pageObjs[0]:null:data.pageObjs[opts.next]:void 0}},_backGradient:function(){var data=this.data().f,turnData=data.opts.turn.data(),gradient=turnData.opts.gradients&&("single"==turnData.display||2!=data.opts.page&&data.opts.page!=turnData.totalPages-1);return gradient&&!data.bshadow&&(data.bshadow=$("<div/>",divAtt(0,0,1)).css({position:"",width:this.width(),height:this.height()}).appendTo(data.parent)),gradient},type:function(){return this.data().f.effect},resize:function(full){var data=this.data().f,turnData=data.opts.turn.data(),width=this.width(),height=this.height();switch(data.effect){case"hard":full&&(data.wrapper.css({width:width,height:height}),data.fpage.css({width:width,height:height}),turnData.opts.gradients&&(data.ashadow.css({width:width,height:height}),data.bshadow.css({width:width,height:height})));break;case"sheet":if(full){var size=Math.round(Math.sqrt(Math.pow(width,2)+Math.pow(height,2)));data.wrapper.css({width:size,height:size}),data.fwrapper.css({width:size,height:size}).children(":first-child").css({width:width,height:height}),data.fpage.css({width:width,height:height}),turnData.opts.gradients&&data.ashadow.css({width:width,height:height}),flipMethods._backGradient.call(this)&&data.bshadow.css({width:width,height:height})}if(data.parent.is(":visible")){var offset=findPos(data.parent[0]);data.fwrapper.css({top:offset.top,left:offset.left}),offset=findPos(data.opts.turn[0]),data.fparent.css({top:-offset.top,left:-offset.left})}this.flip("z",data.opts["z-index"])}},_addPageWrapper:function(){var data=this.data().f,turnData=data.opts.turn.data(),parent=this.parent();if(data.parent=parent,!data.wrapper)switch(data.effect){case"hard":var cssProperties={};cssProperties[vendor+"transform-style"]="preserve-3d",cssProperties[vendor+"backface-visibility"]="hidden",data.wrapper=$("<div/>",divAtt(0,0,2)).css(cssProperties).appendTo(parent).prepend(this),data.fpage=$("<div/>",divAtt(0,0,1)).css(cssProperties).appendTo(parent),turnData.opts.gradients&&(data.ashadow=$("<div/>",divAtt(0,0,0)).hide().appendTo(parent),data.bshadow=$("<div/>",divAtt(0,0,0)));break;case"sheet":var width=this.width(),height=this.height();if(Math.round(Math.sqrt(Math.pow(width,2)+Math.pow(height,2))),data.fparent=data.opts.turn.data().fparent,!data.fparent){var fparent=$("<div/>",{css:{"pointer-events":"none"}}).hide();fparent.data().flips=0,fparent.css(divAtt(0,0,"auto","visible").css).appendTo(data.opts.turn),data.opts.turn.data().fparent=fparent,data.fparent=fparent}this.css({position:"absolute",top:0,left:0,bottom:"auto",right:"auto"}),data.wrapper=$("<div/>",divAtt(0,0,this.css("z-index"))).appendTo(parent).prepend(this),data.fwrapper=$("<div/>",divAtt(parent.offset().top,parent.offset().left)).hide().appendTo(data.fparent),data.fpage=$("<div/>",divAtt(0,0,0,"hidden")).css({cursor:"default"}).appendTo(data.fwrapper),turnData.opts.gradients&&(data.ashadow=$("<div/>",divAtt(0,0,1)).appendTo(data.fpage)),flipMethods.setData.call(this,data)}flipMethods.resize.call(this,!0)},_fold:function(point){var data=this.data().f,turnData=data.opts.turn.data(),o=flipMethods._c.call(this,point.corner),width=this.width(),height=this.height();switch(data.effect){case"hard":"l"==point.corner?point.x=Math.min(Math.max(point.x,0),2*width):point.x=Math.max(Math.min(point.x,width),-width);var leftPos,shadow,gradientX,fpageOrigin,parentOrigin,totalPages=turnData.totalPages,zIndex=data.opts["z-index"]||totalPages,parentCss={overflow:"visible"},relX=o.x?(o.x-point.x)/width:point.x/width,angle=90*relX,half=angle<90;switch(point.corner){case"l":fpageOrigin="0% 50%",parentOrigin="100% 50%",half?(leftPos=0,shadow=data.opts.next-1>0,gradientX=1):(leftPos="100%",shadow=data.opts.page+1<totalPages,gradientX=0);break;case"r":fpageOrigin="100% 50%",parentOrigin="0% 50%",angle=-angle,width=-width,half?(leftPos=0,shadow=data.opts.next+1<totalPages,gradientX=0):(leftPos="-100%",shadow=1!=data.opts.page,gradientX=1)}parentCss[vendor+"perspective-origin"]=parentOrigin,data.wrapper.transform("rotateY("+angle+"deg)translate3d(0px, 0px, "+(this.attr("depth")||0)+"px)",parentOrigin),data.fpage.transform("translateX("+width+"px) rotateY("+(180+angle)+"deg)",fpageOrigin),data.parent.css(parentCss),half?(relX=1-relX,data.wrapper.css({zIndex:zIndex+1}),data.fpage.css({zIndex:zIndex})):(relX-=1,data.wrapper.css({zIndex:zIndex}),data.fpage.css({zIndex:zIndex+1})),turnData.opts.gradients&&(shadow?data.ashadow.css({display:"",left:leftPos,backgroundColor:"rgba(0,0,0,"+.5*relX+")"}).transform("rotateY(0deg)"):data.ashadow.hide(),data.bshadow.css({opacity:1-relX}),half?data.bshadow.parent()[0]!=data.wrapper[0]&&data.bshadow.appendTo(data.wrapper):data.bshadow.parent()[0]!=data.fpage[0]&&data.bshadow.appendTo(data.fpage),gradient(data.bshadow,point2D(100*gradientX,0),point2D(100*(1-gradientX),0),[[0,"rgba(0,0,0,0.3)"],[1,"rgba(0,0,0,0)"]],2));break;case"sheet":var px,gradientEndPointA,gradientEndPointB,gradientStartVal,gradientSize,gradientOpacity,shadowVal,that=this,a=0,mv=point2D(0,0),df=point2D(0,0),tr=point2D(0,0),folding=flipMethods._foldingPage.call(this),ac=(Math.tan(0),turnData.opts.acceleration),h=data.wrapper.height(),top="t"==point.corner.substr(0,1),left="l"==point.corner.substr(1,1),compute=function(){var rel=point2D(0,0),middle=point2D(0,0);rel.x=o.x?o.x-point.x:point.x,rel.y=hasRot?o.y?o.y-point.y:point.y:0,middle.x=left?width-rel.x/2:point.x+rel.x/2,middle.y=rel.y/2;var alpha=A90-Math.atan2(rel.y,rel.x),gamma=alpha-Math.atan2(middle.y,middle.x),distance=Math.max(0,Math.sin(gamma)*Math.sqrt(Math.pow(middle.x,2)+Math.pow(middle.y,2)));if(a=alpha/PI*180,tr=point2D(distance*Math.sin(alpha),distance*Math.cos(alpha)),alpha>A90&&(tr.x=tr.x+Math.abs(tr.y*rel.y/rel.x),tr.y=0,Math.round(tr.x*Math.tan(PI-alpha))<height))return point.y=Math.sqrt(Math.pow(height,2)+2*middle.x*rel.x),top&&(point.y=height-point.y),compute();if(alpha>A90){var beta=PI-alpha,dd=h-height/Math.sin(beta);mv=point2D(Math.round(dd*Math.cos(beta)),Math.round(dd*Math.sin(beta))),left&&(mv.x=-mv.x),top&&(mv.y=-mv.y)}px=Math.round(tr.y/Math.tan(alpha)+tr.x);var side=width-px,sideX=side*Math.cos(2*alpha),sideY=side*Math.sin(2*alpha);if(df=point2D(Math.round(left?side-sideX:px+sideX),Math.round(top?sideY:height-sideY)),turnData.opts.gradients){gradientSize=side*Math.sin(alpha);var endingPoint=flipMethods._c2.call(that,point.corner),far=Math.sqrt(Math.pow(endingPoint.x-point.x,2)+Math.pow(endingPoint.y-point.y,2))/width;shadowVal=Math.sin(A90*(far>1?2-far:far)),gradientOpacity=Math.min(far,1),gradientStartVal=gradientSize>100?(gradientSize-100)/gradientSize:0,gradientEndPointA=point2D(gradientSize*Math.sin(alpha)/width*100,gradientSize*Math.cos(alpha)/height*100),flipMethods._backGradient.call(that)&&(gradientEndPointB=point2D(1.2*gradientSize*Math.sin(alpha)/width*100,1.2*gradientSize*Math.cos(alpha)/height*100),left||(gradientEndPointB.x=100-gradientEndPointB.x),top||(gradientEndPointB.y=100-gradientEndPointB.y))}return tr.x=Math.round(tr.x),tr.y=Math.round(tr.y),!0},transform=function(tr,c,x,a){var f=["0","auto"],mvW=(width-h)*x[0]/100,mvH=(height-h)*x[1]/100,cssA={left:f[c[0]],top:f[c[1]],right:f[c[2]],bottom:f[c[3]]},cssB={},aliasingFk=90!=a&&-90!=a?left?-1:1:0,origin=x[0]+"% "+x[1]+"%";that.css(cssA).transform(rotate(a)+translate(tr.x+aliasingFk,tr.y,ac),origin),data.fpage.css(cssA).transform(rotate(a)+translate(tr.x+df.x-mv.x-width*x[0]/100,tr.y+df.y-mv.y-height*x[1]/100,ac)+rotate((180/a-2)*a),origin),data.wrapper.transform(translate(-tr.x+mvW-aliasingFk,-tr.y+mvH,ac)+rotate(-a),origin),data.fwrapper.transform(translate(-tr.x+mv.x+mvW,-tr.y+mv.y+mvH,ac)+rotate(-a),origin),data.wrapper.css({position:""}),turnData.opts.gradients&&(x[0]&&(gradientEndPointA.x=100-gradientEndPointA.x),x[1]&&(gradientEndPointA.y=100-gradientEndPointA.y),cssB["box-shadow"]="0 0 20px rgba(0,0,0,"+.5*shadowVal+")",folding.css(cssB),gradient(data.ashadow,point2D(left?100:0,top?0:100),point2D(gradientEndPointA.x,gradientEndPointA.y),[[gradientStartVal,"rgba(0,0,0,0)"],[.8*(1-gradientStartVal)+gradientStartVal,"rgba(0,0,0,"+.2*gradientOpacity+")"],[1,"rgba(255,255,255,"+.2*gradientOpacity+")"]],3),flipMethods._backGradient.call(that)&&gradient(data.bshadow,point2D(left?0:100,top?0:100),point2D(gradientEndPointB.x,gradientEndPointB.y),[[.6,"rgba(0,0,0,0)"],[.8,"rgba(0,0,0,"+.3*gradientOpacity+")"],[1,"rgba(0,0,0,0)"]],3))};switch(point.corner){case"l":case"r":break;case"tl":point.x=Math.max(point.x,1),compute(),transform(tr,[1,0,0,1],[100,0],a);break;case"tr":point.x=Math.min(point.x,width-1),compute(),transform(point2D(-tr.x,tr.y),[0,0,0,1],[0,0],-a);break;case"bl":point.x=Math.max(point.x,1),compute(),transform(point2D(tr.x,-tr.y),[1,1,0,0],[100,100],-a);break;case"br":point.x=Math.min(point.x,width-1),compute(),transform(point2D(-tr.x,-tr.y),[0,1,1,0],[0,100],a)}}data.point=point},_moveFoldingPage:function(move){var data=this.data().f;if(data){var turn=data.opts.turn,turnData=turn.data(),place=turnData.pagePlace;if(move){var nextPage=data.opts.next;place[nextPage]!=data.opts.page&&(data.folding&&flipMethods._moveFoldingPage.call(this,!1),flipMethods._foldingPage.call(this).appendTo(data.fpage),place[nextPage]=data.opts.page,data.folding=nextPage),turn.turn("update")}else if(data.folding){if(turnData.pages[data.folding]){var flipData=turnData.pages[data.folding].data().f;turnData.pageObjs[data.folding].appendTo(flipData.wrapper)}else turnData.pageWrap[data.folding]&&turnData.pageObjs[data.folding].appendTo(turnData.pageWrap[data.folding]);data.folding in place&&(place[data.folding]=data.folding),delete data.folding}}},_showFoldedPage:function(c,animate){var folding=flipMethods._foldingPage.call(this),dd=this.data(),data=dd.f,visible=data.visible;if(folding){if(!visible||!data.point||data.point.corner!=c.corner){var corner="hover"==data.status||"peel"==data.status||data.opts.turn.data().mouseAction?c.corner:null;if(visible=!1,"prevented"==trigger("start",this,[data.opts,corner]))return!1}if(animate){var that=this,point=data.point&&data.point.corner==c.corner?data.point:flipMethods._c.call(this,c.corner,1);this.animatef({from:[point.x,point.y],to:[c.x,c.y],duration:500,frame:function(v){c.x=Math.round(v[0]),c.y=Math.round(v[1]),flipMethods._fold.call(that,c)}})}else flipMethods._fold.call(this,c),dd.effect&&!dd.effect.turning&&this.animatef(!1);if(!visible)switch(data.effect){case"hard":data.visible=!0,flipMethods._moveFoldingPage.call(this,!0),data.fpage.show(),data.opts.shadows&&data.bshadow.show();break;case"sheet":data.visible=!0,data.fparent.show().data().flips++,flipMethods._moveFoldingPage.call(this,!0),data.fwrapper.show(),data.bshadow&&data.bshadow.show()}return!0}return!1},hide:function(){var data=this.data().f,turnData=data.opts.turn.data(),folding=flipMethods._foldingPage.call(this);switch(data.effect){case"hard":turnData.opts.gradients&&(data.bshadowLoc=0,data.bshadow.remove(),data.ashadow.hide()),data.wrapper.transform(""),data.fpage.hide();break;case"sheet":0==--data.fparent.data().flips&&data.fparent.hide(),this.css({left:0,top:0,right:"auto",bottom:"auto"}).transform(""),data.wrapper.transform(""),data.fwrapper.hide(),data.bshadow&&data.bshadow.hide(),folding.transform("")}return data.visible=!1,this},hideFoldedPage:function(animate){var data=this.data().f;if(data.point){var that=this,p1=data.point,hide=function(){data.point=null,data.status="",that.flip("hide"),that.trigger("end",[data.opts,!1])};if(animate){var p4=flipMethods._c.call(this,p1.corner),delta="t"==p1.corner.substr(0,1)?Math.min(0,p1.y-p4.y)/2:Math.max(0,p1.y-p4.y)/2,p2=point2D(p1.x,p1.y+delta),p3=point2D(p4.x,p4.y-delta);this.animatef({from:0,to:1,frame:function(v){var np=bezier(p1,p2,p3,p4,v);p1.x=np.x,p1.y=np.y,flipMethods._fold.call(that,p1)},complete:hide,duration:800,hiding:!0})}else this.animatef(!1),hide()}},turnPage:function(corner){var that=this,data=this.data().f,turnData=data.opts.turn.data();corner={corner:data.corner?data.corner.corner:corner||flipMethods._cAllowed.call(this)[0]};var p1=data.point||flipMethods._c.call(this,corner.corner,data.opts.turn?turnData.opts.elevation:0),p4=flipMethods._c2.call(this,corner.corner);this.trigger("flip").animatef({from:0,to:1,frame:function(v){var np=bezier(p1,p1,p4,p4,v);corner.x=np.x,corner.y=np.y,flipMethods._showFoldedPage.call(that,corner)},complete:function(){that.trigger("end",[data.opts,!0])},duration:turnData.opts.duration,turning:!0}),data.corner=null},moving:function(){return"effect"in this.data()},isTurning:function(){return this.flip("moving")&&this.data().effect.turning},corner:function(){return this.data().f.corner},_eventStart:function(e){var data=this.data().f,turn=data.opts.turn;if(!data.corner&&!data.disabled&&!this.flip("isTurning")&&data.opts.page==turn.data().pagePlace[data.opts.page]){if(data.corner=flipMethods._isIArea.call(this,e),data.corner&&flipMethods._foldingPage.call(this))return this.trigger("pressed",[data.point]),flipMethods._showFoldedPage.call(this,data.corner),!1;data.corner=null}},_eventMove:function(e){var data=this.data().f;if(!data.disabled)if(e=isTouch?e.originalEvent.touches:[e],data.corner){var pos=data.parent.offset();data.corner.x=e[0].pageX-pos.left,data.corner.y=e[0].pageY-pos.top,flipMethods._showFoldedPage.call(this,data.corner)}else if(data.hover&&!this.data().effect&&this.is(":visible")){var point=flipMethods._isIArea.call(this,e[0]);if(point){if("sheet"==data.effect&&2==point.corner.length||"hard"==data.effect){data.status="hover";var origin=flipMethods._c.call(this,point.corner,data.opts.cornerSize/2);point.x=origin.x,point.y=origin.y,flipMethods._showFoldedPage.call(this,point,!0)}}else"hover"==data.status&&(data.status="",flipMethods.hideFoldedPage.call(this,!0))}},_eventEnd:function(){var data=this.data().f,corner=data.corner;!data.disabled&&corner&&"prevented"!=trigger("released",this,[data.point||corner])&&flipMethods.hideFoldedPage.call(this,!0),data.corner=null},disable:function(disable){return flipMethods.setData.call(this,{disabled:disable}),this},hover:function(hover){return flipMethods.setData.call(this,{hover:hover}),this},peel:function(corner,animate){var data=this.data().f;if(corner){if(-1==$.inArray(corner,corners.all))throw turnError("Corner "+corner+" is not permitted");if(-1!=$.inArray(corner,flipMethods._cAllowed.call(this))){var point=flipMethods._c.call(this,corner,data.opts.cornerSize/2);data.status="peel",flipMethods._showFoldedPage.call(this,{corner:corner,x:point.x,y:point.y},animate)}}else data.status="",flipMethods.hideFoldedPage.call(this,animate);return this}};function dec(that,methods,args){if(args[0]&&"object"!=typeof args[0]){if(methods[args[0]])return methods[args[0]].apply(that,Array.prototype.slice.call(args,1));throw turnError(args[0]+" is not a method or property")}return methods.init.apply(that,args)}function divAtt(top,left,zIndex,overf){return{css:{position:"absolute",top:top,left:left,overflow:overf||"hidden",zIndex:zIndex||"auto"}}}function bezier(p1,p2,p3,p4,t){var a=1-t,b=a*a*a,c=t*t*t;return point2D(Math.round(b*p1.x+3*t*a*a*p2.x+3*t*t*a*p3.x+c*p4.x),Math.round(b*p1.y+3*t*a*a*p2.y+3*t*t*a*p3.y+c*p4.y))}function point2D(x,y){return{x:x,y:y}}function translate(x,y,use3d){return has3d&&use3d?" translate3d("+x+"px,"+y+"px, 0px) ":" translate("+x+"px, "+y+"px) "}function rotate(degrees){return" rotate("+degrees+"deg) "}function has(property,object){return Object.prototype.hasOwnProperty.call(object,property)}function getPrefix(){for(var vendorPrefixes=["Moz","Webkit","Khtml","O","ms"],len=vendorPrefixes.length,vendor="";len--;)vendorPrefixes[len]+"Transform"in document.body.style&&(vendor="-"+vendorPrefixes[len].toLowerCase()+"-");return vendor}function gradient(obj,p0,p1,colors,numColors){var j,cols=[];if("-webkit-"==vendor){for(j=0;j<numColors;j++)cols.push("color-stop("+colors[j][0]+", "+colors[j][1]+")");obj.css({"background-image":"-webkit-gradient(linear, "+p0.x+"% "+p0.y+"%,"+p1.x+"% "+p1.y+"%, "+cols.join(",")+" )"})}else{p0={x:p0.x/100*obj.width(),y:p0.y/100*obj.height()};var dx=(p1={x:p1.x/100*obj.width(),y:p1.y/100*obj.height()}).x-p0.x,dy=p1.y-p0.y,angle=Math.atan2(dy,dx),angle2=angle-Math.PI/2,diagonal=Math.abs(obj.width()*Math.sin(angle2))+Math.abs(obj.height()*Math.cos(angle2)),gradientDiagonal=Math.sqrt(dy*dy+dx*dx),corner=point2D(p1.x<p0.x?obj.width():0,p1.y<p0.y?obj.height():0),slope=Math.tan(angle),inverse=-1/slope,x=(inverse*corner.x-corner.y-slope*p0.x+p0.y)/(inverse-slope),c={x:x,y:inverse*x-inverse*corner.x+corner.y},segA=Math.sqrt(Math.pow(c.x-p0.x,2)+Math.pow(c.y-p0.y,2));for(j=0;j<numColors;j++)cols.push(" "+colors[j][1]+" "+100*(segA+gradientDiagonal*colors[j][0])/diagonal+"%");obj.css({"background-image":vendor+"linear-gradient("+-angle+"rad,"+cols.join(",")+")"})}}function trigger(eventName,context,args){var event=$.Event(eventName);return context.trigger(event,args),event.isDefaultPrevented()?"prevented":event.isPropagationStopped()?"stopped":""}function turnError(message){function TurnJsError(message){this.name="TurnJsError",this.message=message}return TurnJsError.prototype=new Error,TurnJsError.prototype.constructor=TurnJsError,new TurnJsError(message)}function findPos(obj){var offset={top:0,left:0};do{offset.left+=obj.offsetLeft,offset.top+=obj.offsetTop}while(obj=obj.offsetParent);return offset}function changeRightSidePageOverflow(page,pageWrapper,enabled,data){page&&pageWrapper&&(enabled?(pageWrapper.css({overflow:"hidden","clip-path":"","-webkit-clip-path":""}),setTimeout(function(){page.parent().css("overflow","hidden"),trigger("afterOverflowEnabled",pageWrapper,data)},1)):(pageWrapper.css({overflow:"","clip-path":"polygon(-100% 0, 100% 0, 100% 100%, -100% 100%)","-webkit-clip-path":"polygon(-100% 0, 100% 0, 100% 100%, -100% 100%)"}),setTimeout(function(){page.parent().css("overflow",""),trigger("afterOverflowDisabled",pageWrapper,data)},1)))}window.requestAnim=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){window.setTimeout(callback,1e3/60)},$.extend($.fn,{flip:function(){return dec($(this[0]),flipMethods,arguments)},turn:function(){return dec($(this[0]),turnMethods,arguments)},transform:function(transform,origin){var properties={};return origin&&(properties[vendor+"transform-origin"]=origin),properties[vendor+"transform"]=transform,this.css(properties)},animatef:function(point){var data=this.data();if(data.effect&&data.effect.stop(),point){point.to.length||(point.to=[point.to]),point.from.length||(point.from=[point.from]);for(var diff=[],len=point.to.length,animating=!0,that=this,time=(new Date).getTime(),frame=function(){if(data.effect&&animating){for(var v=[],timeDiff=Math.min(point.duration,(new Date).getTime()-time),i=0;i<len;i++)v.push(data.effect.easing(1,timeDiff,point.from[i],diff[i],point.duration));point.frame(1==len?v[0]:v),timeDiff==point.duration?(delete data.effect,that.data(data),point.complete&&point.complete()):window.requestAnim(frame)}},i=0;i<len;i++)diff.push(point.to[i]-point.from[i]);data.effect=$.extend({stop:function(){animating=!1},easing:function(x,t,b,c,data){return c*Math.sqrt(1-(t=t/data-1)*t)+b}},point),this.data(data),frame()}else delete data.effect}}),$.isTouch=isTouch,$.mouseEvents=mouseEvents,$.cssPrefix=getPrefix,$.cssTransitionEnd=function(){var t,el=document.createElement("fakeelement"),transitions={transition:"transitionend",OTransition:"oTransitionEnd",MSTransition:"transitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(t in transitions)if(void 0!==el.style[t])return transitions[t]},$.findPos=findPos}(jQuery);var FontManager=Backbone.View.extend({initialize:function(){this.fontsLoaded=[],this.fontsToLoad=[],this.defaultFontName="Arimo",this.fontTable={Arial:{fontFamily:"Arial,sans-serif",css:!1},Verdana:{fontFamily:"Verdana",css:!1},"EB Garamond":{fontFamily:"EB Garamond",css:'@import url("https://fonts.googleapis.com/css?family=EB+Garamond")'},"Lucida Sans Unicode":{fontFamily:"Lucida Sans Unicode",css:!1},Lato:{fontFamily:"Lato",css:'@import url("https://fonts.googleapis.com/css?family=Lato:400,700")'},"PT Sans":{fontFamily:"PT Sans",css:'@import url("https://fonts.googleapis.com/css?family=PT+Sans:400,700")'},Calibri:{fontFamily:"Calibri",css:!1},"Droid Sans":{fontFamily:"Droid Sans",css:'@import url("https://fonts.googleapis.com/css?family=Droid+Sans:400,700")'},"Proxima Nova Reg":{fontFamily:"Proxima Nova Reg,Arial,sans-serif",css:'@font-face{font-family:"Proxima Nova Reg";font-weight:400;src:url("//www.snacktools.com/files/common/fonts/ProximaNova-Reg-gz.eot?") format("embedded-opentype"),url("//www.snacktools.com/files/common/fonts/ProximaNova-Reg-gz.woff");}'},"Proxima Nova Thin":{fontFamily:"Proxima Nova Thin,Arial,sans-serif",css:'@font-face{font-family:"Proxima Nova Thin";font-weight:100;src:url("//www.snacktools.com/files/common/fonts/ProximaNova-Thin-gz.eot?") format("embedded-opentype"),url("//www.snacktools.com/files/common/fonts/ProximaNova-Thin-gz.otf") format("truetype");}'},"Proxima Nova Light":{fontFamily:"Proxima Nova Light,Arial,sans-serif",css:'@font-face{font-family:"Proxima Nova Light";font-weight:300;src:url("//www.snacktools.com/files/common/fonts/ProximaNova-Light-gz.eot?") format("embedded-opentype"),url("//www.snacktools.com/files/common/fonts/ProximaNova-Light-gz.otf") format("opentype");}'},"Proxima Nova Bold":{fontFamily:"Proxima Nova Bold,Arial,sans-serif",css:'@font-face{font-family:"Proxima Nova Bold";font-weight:700;src:url("//www.snacktools.com/files/common/fonts/ProximaNova-Bold-gz.eot?") format("embedded-opentype"),url("//www.snacktools.com/files/common/fonts/ProximaNova-Bold-gz.woff");}'},Oswald:{fontFamily:"Oswald",css:'@import url("https://fonts.googleapis.com/css?family=Oswald:300,700")'},Lobster:{fontFamily:"Lobster",css:'@import url("https://fonts.googleapis.com/css?family=Lobster")'},"Open Sans":{fontFamily:"Open Sans",css:'@import url("https://fonts.googleapis.com/css?family=Open+Sans:400,700")'},"Mouse Memoirs":{fontFamily:"Mouse Memoirs",css:'@import url("https://fonts.googleapis.com/css?family=Mouse+Memoirs")'},"Just Me Again Down Here":{fontFamily:"Just Me Again Down Here",css:'@import url("https://fonts.googleapis.com/css?family=Just+Me+Again+Down+Here")'},"Annie Use Your Telescope":{fontFamily:"Annie Use Your Telescope",css:'@import url("https://fonts.googleapis.com/css?family=Annie+Use+Your+Telescope")'},Roboto:{fontFamily:"Roboto",css:"@import url(https://fonts.googleapis.com/css?family=Roboto:300,400&subset=latin,greek-ext,greek,vietnamese,latin-ext,cyrillic)",weight:{normal:300,bold:400}},"Droid Serif":{fontFamily:"Droid Serif",css:"@import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700)"},"Fjalla One":{fontFamily:"Fjalla One",css:"@import url(https://fonts.googleapis.com/css?family=Fjalla+One)"},"Lato Light":{fontFamily:"Lato",css:"@import url(https://fonts.googleapis.com/css?family=Lato:300,400)",weight:{normal:300,bold:400}},Lora:{fontFamily:"Lora",css:"@import url(https://fonts.googleapis.com/css?family=Lora:400,700)"},"Open Sans Light":{fontFamily:"Open Sans",css:"@import url(https://fonts.googleapis.com/css?family=Open+Sans:300,400)",weight:{normal:300,bold:400}},Parisienne:{fontFamily:"Parisienne",css:"@import url(https://fonts.googleapis.com/css?family=Parisienne)"},"Playfair Display":{fontFamily:"Playfair Display",css:"@import url(https://fonts.googleapis.com/css?family=Playfair+Display:400,700)"},"Playfair Display Italic":{fontFamily:"Playfair Display",css:"@import url(https://fonts.googleapis.com/css?family=Playfair+Display:400italic,700italic)",italic:!0},"Roboto Slab":{fontFamily:"Roboto Slab",css:"@import url(https://fonts.googleapis.com/css?family=Roboto+Slab:400,700)"},Yellowtail:{fontFamily:"Yellowtail",css:"@import url(https://fonts.googleapis.com/css?family=Yellowtail)"},"Raleway Light":{fontFamily:"Raleway",css:"@import url(https://fonts.googleapis.com/css?family=Raleway:300&subset=latin,latin-ext)",weight:{normal:300}},"Raleway Light Italic":{fontFamily:"Raleway",css:"@import url(https://fonts.googleapis.com/css?family=Raleway:300italic&subset=latin,latin-ext)",weight:{normal:300},italic:!0},Raleway:{fontFamily:"Raleway",css:"@import url(https://fonts.googleapis.com/css?family=Raleway:400&subset=latin,latin-ext)",weight:{normal:400}},"Raleway Italic":{fontFamily:"Raleway",css:"@import url(https://fonts.googleapis.com/css?family=Raleway:400italic&subset=latin,latin-ext)",weight:{normal:400},italic:!0},"Raleway Medium":{fontFamily:"Raleway",css:"@import url(https://fonts.googleapis.com/css?family=Raleway:500&subset=latin,latin-ext)",weight:{normal:500}},"Raleway Medium Italic":{fontFamily:"Raleway",css:"@import url(https://fonts.googleapis.com/css?family=Raleway:500italic&subset=latin,latin-ext)",weight:{normal:500},italic:!0},"Raleway Bold":{fontFamily:"Raleway",css:"@import url(https://fonts.googleapis.com/css?family=Raleway:700&subset=latin,latin-ext)",weight:{normal:700}},"Raleway Bold Italic":{fontFamily:"Raleway",css:"@import url(https://fonts.googleapis.com/css?family=Raleway:700italic&subset=latin,latin-ext)",weight:{normal:700},italic:!0},"Raleway Extra-Bold":{fontFamily:"Raleway",css:"@import url(https://fonts.googleapis.com/css?family=Raleway:800&subset=latin,latin-ext)",weight:{normal:800}},"Raleway Extra-Bold Italic":{fontFamily:"Raleway",css:"@import url(https://fonts.googleapis.com/css?family=Raleway:800italic&subset=latin,latin-ext)",weight:{normal:800},italic:!0},"PT Serif":{fontFamily:"PT Serif",css:"@import url(https://fonts.googleapis.com/css?family=PT+Serif:400&subset=latin,cyrillic-ext,latin-ext,cyrillic)",weight:{normal:400}},"PT Serif Italic":{fontFamily:"PT Serif",css:"@import url(https://fonts.googleapis.com/css?family=PT+Serif:400italic&subset=latin,cyrillic-ext,latin-ext,cyrillic)",weight:{normal:400},italic:!0},"PT Serif Bold":{fontFamily:"PT Serif",css:"@import url(https://fonts.googleapis.com/css?family=PT+Serif:700&subset=latin,cyrillic-ext,latin-ext,cyrillic)",weight:{normal:700}},"PT Serif Bold Italic":{fontFamily:"PT Serif",css:"@import url(https://fonts.googleapis.com/css?family=PT+Serif:700italic&subset=latin,cyrillic-ext,latin-ext,cyrillic)",weight:{normal:700},italic:!0},Pacifico:{fontFamily:"Pacifico",css:"@import url(https://fonts.googleapis.com/css?family=Pacifico)"},"Quicksand Light":{fontFamily:"Quicksand",css:"@import url(https://fonts.googleapis.com/css?family=Quicksand:300)",weight:{normal:300}},Quicksand:{fontFamily:"Quicksand",css:"@import url(https://fonts.googleapis.com/css?family=Quicksand:400)",weight:{normal:400}},"Quicksand Bold":{fontFamily:"Quicksand",css:"@import url(https://fonts.googleapis.com/css?family=Quicksand:700)",weight:{normal:700}},"Abril Fatface":{fontFamily:"Abril Fatface",css:"@import url(https://fonts.googleapis.com/css?family=Abril+Fatface&subset=latin,latin-ext)"},"Great Vibes":{fontFamily:"Great Vibes",css:"@import url(https://fonts.googleapis.com/css?family=Great+Vibes&subset=latin,latin-ext)"},Sacramento:{fontFamily:"Sacramento",css:"@import url(https://fonts.googleapis.com/css?family=Sacramento&subset=latin,latin-ext)"},Limelight:{fontFamily:"Limelight",css:"@import url(https://fonts.googleapis.com/css?family=Limelight&subset=latin,latin-ext)"},"Gravitas One":{fontFamily:"Gravitas One",css:"@import url(https://fonts.googleapis.com/css?family=Gravitas+One&subset=latin,latin-ext)"},"Rozha One":{fontFamily:"Rozha One",css:"@import url(https://fonts.googleapis.com/css?family=Rozha+One&subset=latin,devanagari,latin-ext)"},"Mrs Sheppards":{fontFamily:"Mrs Sheppards",css:"@import url(https://fonts.googleapis.com/css?family=Mrs+Sheppards&subset=latin,latin-ext)"},Montserrat:{fontFamily:"Montserrat",css:"@import url(https://fonts.googleapis.com/css?family=Montserrat:400)",weight:{normal:400}},"Montserrat Bold":{fontFamily:"Montserrat",css:"@import url(https://fonts.googleapis.com/css?family=Montserrat:700)",weight:{normal:700}},"Josefin Sans Light":{fontFamily:"Josefin Sans",css:"@import url(https://fonts.googleapis.com/css?family=Josefin+Sans:300&subset=latin,latin-ext)",weight:{normal:300}},"Josefin Sans Light Italic":{fontFamily:"Josefin Sans",css:"@import url(https://fonts.googleapis.com/css?family=Josefin+Sans:300italic&subset=latin,latin-ext)",weight:{normal:300},italic:!0},"Josefin Sans":{fontFamily:"Josefin Sans",css:"@import url(https://fonts.googleapis.com/css?family=Josefin+Sans:400&subset=latin,latin-ext)",weight:{normal:400}},"Josefin Sans Italic":{fontFamily:"Josefin Sans",css:"@import url(https://fonts.googleapis.com/css?family=Josefin+Sans:400italic&subset=latin,latin-ext)",weight:{normal:400},italic:!0},"Josefin Sans Bold":{fontFamily:"Josefin Sans",css:"@import url(https://fonts.googleapis.com/css?family=Josefin+Sans:700&subset=latin,latin-ext)",weight:{normal:700}},"Josefin Sans Bold Italic":{fontFamily:"Josefin Sans",css:"@import url(https://fonts.googleapis.com/css?family=Josefin+Sans:700italic&subset=latin,latin-ext)",weight:{normal:700},italic:!0},"Hammersmith One":{fontFamily:"Hammersmith One",css:"@import url(https://fonts.googleapis.com/css?family=Hammersmith+One&subset=latin,latin-ext)"},"Cantora One":{fontFamily:"Cantora One",css:"@import url(https://fonts.googleapis.com/css?family=Cantora+One&subset=latin,latin-ext)"},Coustard:{fontFamily:"Coustard",css:"@import url(https://fonts.googleapis.com/css?family=Coustard)"},Glegoo:{fontFamily:"Glegoo",css:"@import url(https://fonts.googleapis.com/css?family=Glegoo&subset=latin,devanagari,latin-ext)"},"Julius Sans One":{fontFamily:"Julius Sans One",css:"@import url(https://fonts.googleapis.com/css?family=Julius+Sans+One&subset=latin,latin-ext)"},Merriweather:{fontFamily:"Merriweather",css:"@import url(https://fonts.googleapis.com/css?family=Merriweather&subset=latin,cyrillic-ext,latin-ext,cyrillic)"},Quando:{fontFamily:"Quando",css:"@import url(https://fonts.googleapis.com/css?family=Quando&subset=latin,latin-ext)"},Sanchez:{fontFamily:"Sanchez",css:"@import url(https://fonts.googleapis.com/css?family=Sanchez&subset=latin,latin-ext)"},Vidaloka:{fontFamily:"Vidaloka",css:"@import url(https://fonts.googleapis.com/css?family=Vidaloka)"},Alike:{fontFamily:"Alike",css:"@import url(https://fonts.googleapis.com/css?family=Alike)"},Antic:{fontFamily:"Antic",css:"@import url(https://fonts.googleapis.com/css?family=Antic)"},Arimo:{fontFamily:"Arimo",css:"@import url(https://fonts.googleapis.com/css?family=Arimo&subset=latin,greek,hebrew,vietnamese,cyrillic-ext,latin-ext,cyrillic,greek-ext)",weight:{normal:400}},"Arimo Italic":{fontFamily:"Arimo",css:"@import url(https://fonts.googleapis.com/css?family=Arimo:400italic&subset=latin,greek,hebrew,vietnamese,cyrillic-ext,latin-ext,cyrillic,greek-ext)",weight:{normal:400},italic:!0},"Arimo Bold":{fontFamily:"Arimo",css:"@import url(https://fonts.googleapis.com/css?family=Arimo:700&subset=latin,greek,hebrew,vietnamese,cyrillic-ext,latin-ext,cyrillic,greek-ext)",weight:{normal:700}},"Arimo Bold Italic":{fontFamily:"Arimo",css:"@import url(https://fonts.googleapis.com/css?family=Arimo:700italic&subset=latin,greek,hebrew,vietnamese,cyrillic-ext,latin-ext,cyrillic,greek-ext)",weight:{normal:700},italic:!0},Vollkorn:{fontFamily:"Vollkorn",css:"@import url(https://fonts.googleapis.com/css?family=Vollkorn)"},Allura:{fontFamily:"Allura",css:"@import url(https://fonts.googleapis.com/css?family=Allura&subset=latin,latin-ext)"},"Amatic SC":{fontFamily:"Amatic SC",css:"@import url(https://fonts.googleapis.com/css?family=Amatic+SC&subset=latin,latin-ext)"},Courgette:{fontFamily:"Courgette",css:"@import url(https://fonts.googleapis.com/css?family=Courgette&subset=latin,latin-ext)"},"Kaushan Script":{fontFamily:"Kaushan Script",css:"@import url(https://fonts.googleapis.com/css?family=Kaushan+Script&subset=latin,latin-ext)"},"Libre Baskerville":{fontFamily:"Libre Baskerville",css:"@import url(https://fonts.googleapis.com/css?family=Libre+Baskerville&subset=latin,latin-ext)"},"Fauna One":{fontFamily:"Fauna One",css:"@import url(https://fonts.googleapis.com/css?family=Fauna+One&subset=latin,latin-ext)"},"Fugaz One":{fontFamily:"Fugaz One",css:"@import url(https://fonts.googleapis.com/css?family=Fugaz+One)"},Monda:{fontFamily:"Monda",css:"@import url(https://fonts.googleapis.com/css?family=Monda&subset=latin,latin-ext)"},"Unica One":{fontFamily:"Unica One",css:"@import url(https://fonts.googleapis.com/css?family=Unica+One&subset=latin,latin-ext)"},"Gentium Basic":{fontFamily:"Gentium Basic",css:"@import url(https://fonts.googleapis.com/css?family=Gentium+Basic&subset=latin,latin-ext)"},"Old Standard TT":{fontFamily:"Old Standard TT",css:"@import url(https://fonts.googleapis.com/css?family=Old+Standard+TT)"},Questrial:{fontFamily:"Questrial",css:"@import url(https://fonts.googleapis.com/css?family=Questrial)"},"Vast Shadow":{fontFamily:"Vast Shadow",css:"@import url(https://fonts.googleapis.com/css?family=Vast+Shadow)"},"Playfair Display SC":{fontFamily:"Playfair Display SC",css:"@import url(https://fonts.googleapis.com/css?family=Playfair+Display+SC&subset=latin,latin-ext,cyrillic)"},Ultra:{fontFamily:"Ultra",css:"@import url(https://fonts.googleapis.com/css?family=Ultra)"},"Slabo 13px":{fontFamily:"Slabo 13px",css:"@import url(https://fonts.googleapis.com/css?family=Slabo+13px&subset=latin,latin-ext)"},"Alfa Slab One":{fontFamily:"Alfa Slab One",css:"@import url(https://fonts.googleapis.com/css?family=Alfa+Slab+One)"},"Gentium Book Basic":{fontFamily:"Gentium Book Basic",css:"@import url(https://fonts.googleapis.com/css?family=Gentium+Book+Basic&subset=latin,latin-ext)"},"Nixie One":{fontFamily:"Nixie One",css:"@import url(https://fonts.googleapis.com/css?family=Nixie+One)"},"Crimson Text":{fontFamily:"Crimson Text",css:"@import url(https://fonts.googleapis.com/css?family=Crimson+Text)"},Muli:{fontFamily:"Muli",css:"@import url(https://fonts.googleapis.com/css?family=Muli)"},Alice:{fontFamily:"Alice",css:"@import url(https://fonts.googleapis.com/css?family=Alice)"},Dosis:{fontFamily:"Dosis",css:"@import url(https://fonts.googleapis.com/css?family=Dosis&subset=latin,latin-ext)"},Cantarell:{fontFamily:"Cantarell",css:"@import url(https://fonts.googleapis.com/css?family=Cantarell)"}}},addFont:function(fontFamily){var split,fontUrl,fontName,fontCss;-1===this.fontsLoaded.indexOf(fontFamily)&&-1===this.fontsToLoad.indexOf(fontFamily)&&(this.fontTable[fontFamily]||-1===fontFamily.indexOf("_")||(split=fontFamily.split("_"),fontUrl=URLPaths.FONT_PATH+split[split.length-1],fontCss='@font-face {font-family: "'+(fontName=split[split.length-1].substr(0,30))+'"; src: url("'+fontUrl+'"); }',this.fontTable[fontFamily]={fontFamily:fontName,css:fontCss}),this.fontsToLoad.push(fontFamily))},loadFonts:function(){for(var fontObj,fontName,cssStr="";this.fontsToLoad.length>0;)cssStr="",fontName=this.fontsToLoad.pop(),(fontObj=this.fontTable[fontName]||this.fontTable[this.defaultFontName]).css&&(cssStr+=fontObj.css),this.fontsLoaded.push(fontName),cssStr.length>0&&(cssStr='<style type="text/css">'+cssStr+"</style>",$("head").prepend(cssStr))},getFontSettings:function(font){return this.fontTable[font]?this.fontTable[font]:{fontFamily:font}},getFontFamily:function(modelFontFamily){return this.getFontSettings(modelFontFamily).fontFamily},getFontWeight:function(modelFontFamily,modelFontWeight){var fontSettings=this.getFontSettings(modelFontFamily),textWeight=modelFontWeight;return void 0!==fontSettings.weight&&(textWeight=modelFontWeight&&"normal"!==modelFontWeight?fontSettings.weight.bold:fontSettings.weight.normal),textWeight},getFontStyle:function(modelFontFamily){return this.getFontSettings(modelFontFamily).italic?"italic":"normal"}});FontManager._instance=null,FontManager.gi=function(){return FontManager._instance||(FontManager._instance=new FontManager),FontManager._instance};var Tracker={ga:function(category,action,label,value){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create",FSWidgetModel.gi().get("collectionData").trackingId,"auto","clientTracker"),FSWidgetModel.gi().get("collectionData").ipAnonymization&&ga("clientTracker.set","anonymizeIp",!0),value?ga("clientTracker.send","event",category,action,label,value,{nonInteraction:!0}):ga("clientTracker.send","event",category,action,label,{nonInteraction:!0})}},MAIN_CONTAINER_ID="fsw",CSS_RULES_ID="fsw-style",DisplayState={NORMAL:"displayStateNormal",FULLSCREEN:"displayStateFullScreen",CLASSIC_FULLSCREEN:"displayStateClassicFullScreen"},DisplayType={LARGE:"large",SMALL:"small"},WidgetType={CLASSIC:"classic",SHELF:"shelf"},CollectionType={PUBLISHED:"published",EDITABLE:"editable",TEMPORARY:"temporary"},PageType={EMPTY_PAGE:-1,UPLOADED_PAGE:0,CUSTOM_PAGE:1,MOVED_PAGE:3},WATERMARK_PAGE_LIMIT=30,WATERMARK_ITEM_LIMIT=3,WidgetStateType={INITIALIZING:"initializing",INITIALIZED:"initialized",BLOCKED_BY_FORM:"blockedByForm",PAYPAL_POPIN_DISPLAYED:"paypalDisplayed",IDLE:"idle",CHANGING_PAGE:"changingPage",CHANGING_ITEM:"changingItem",SEARCHING:"searching"},ImageExtensions=["jpg","png"],ImageTypes={THUMB:"thumb",SMALL:"small",MEDIUM:"medium",ORIGINAL:"original"},ImageSizeAppend={thumb:"_t",small:"_s",medium:"_m",original:""},DefaultPageSize={WIDTH:827,HEIGHT:1170},ImageSizes={thumb:{WIDTH:200,HEIGHT:200},small:{WIDTH:400,HEIGHT:400},medium:{WIDTH:900,HEIGHT:900}},MaxShelfThumbItemWidth=150,ControlsResize={MIN_WIDTH:800,MAX_WIDTH:1366},ContentLoaderStatus={IDLE:"idle",LOADING:"loading",ERROR:"error",COMPLETE:"complete"},ComponentContainers={MAIN_LAYOUT:"#mainLayout",MAIN_VIEW:"#mainView",THUMBNAIL_VIEW:"#thumbnailView",COLLECTION_VIEW:"#collectionView",MENU:"#menu",BOTTOM_BAR:"#bottomBar",FLIP_VIEW:"#flipView",SLIDER_VIEW:"#slideView",CLICK_TO_READ:"clickToRead",CUSTOM_TOOLTIP:"#genericElements",LEAD_FORM:"leadForm",SHELF_VIEW:"#shelfView",NAV_SLIDER:"#navSlider",BUY_BUTTON:"buyButton",BUY_CURTAIN:"#buyCurtain",PLAYER_MENU:"#playerMenu",AUTOMATOR_VIEW:"automatorView"},ElementType={OUTLINE:0,CART:1,CREDIT_CARD:2,PLUS:3,CART_TOOLTIP:4,CREDIT_CARD_TOOLTIP:5,PLUS_TOOLTIP:6,FACEBOOK:7,TWITTER:8,LINKEDIN:9,YOUTUBE:10,FLICKR:11,GOOGLE_PLUS:12,PINTEREST:13,SOUNDCLOUD:14,VIMEO:15,ETSY:16,WEBSITE:17,PREVIOUS_PAGE:18,NEXT_PAGE:19,FIRST_PAGE:20,LAST_PAGE:21,PAGE:22,DOWNLOAD:23,FLIPSNACK_PROFILE:24,CHECKMARK:25,HYPERLINK:26,MAIL:27,TEXT:28,CAPTION:29,PLAY:30,AUDIO:31,CHAT:32,PAYPAL:33,PAYPAL_TOOLTIP:34,FORM:35,IMAGE:37,VIDEO:46,TAG:48,INSTAGRAM:49,SHAPES:50,MASKED:51,TEXT_BOX:53,PRODUCT_TAG:54,BEHANCE:55,SPOTIFY:56,CART_WITH_LABEL:57,CREDIT_CARD_WITH_LABEL:58,MESSENGER:59,SNAPCHAT:60,REDDIT:61,TIKTOK:62,GROUP:100,EMBED:101},OldAudioIcon={ON:"31",OFF:"137"},OldCaptionIcon={OPEN:"136",CLOSED:"29"},LeadFormField={FIELD_TYPE_INPUT:0,FIELD_TYPE_COUNTRY:1,FIELD_TYPE_CUSTOM_DROPDOWN:2,FIELD_TYPE_MDY_DATE:3,FIELD_TYPE_DMY_DATE:4,FIELD_TYPE_CHECKBOX:5,FIELD_TYPE_TEXTAREA:6,FIELD_TYPE_EMAIL:7,FIELD_TYPE_BIRTHDATE_MDY:8,FIELD_TYPE_BIRTHDATE_DMY:9},LeadFormBlocking={PAGE:"page",ALL:"all"},PremiumTypeLinks=[35],CLICKTOREAD_SHOW_INTERVAL=3e3,EDITOR_ALERTS={share:"showShareMsg",download:"showDownloadMsg",print:"showPrintMsg"},VideoProvider={YOUTUBE:"youtube",VIMEO:"vimeo",OTHER:"other"},IFRAME_LOAD_MESSAGE="widgetLoaded",DEFAULT_ZOOM_STEP=5,DEFAULT_TEXT_LINE_HEIGHT=1.2,DEFAULT_TEXT_LETTER_SPACING=0,DEFAULT_BORDER_RADIUS=0,TextDirection={LEFT_TO_RIGHT:"ltr",RIGHT_TO_LEFT:"rtl"},DOWNLOAD_PDF_SUFFIX="download-pdf",PRINT_PDF_SUFFIX="print-pdf",PAGE_TURN_DURATION=1e3,WidgetSkinType={CLASSIC:"classic",PLAYER:"player"},ContentLayout={SINGLE_PAGE:"singlePage",DOUBLE_PAGE:"doublePage",SMART_VIEW:"smartView"},SourcePage={LEFT:"left",RIGHT:"right"},WidgetEvent={STARTUP:"startup",INIT_CONFIG:"initConfig",CONFIG_DONE:"configDone",RESIZE:"resize",DISPLAY_STATE_CHANGE:"displayStateChange",ITEM_VIEW_INIT:"itemViewInit",ITEM_INIT:"itemInit",ITEM_CHANGED:"itemChanged",PREV_ITEM:"prevItem",NEXT_ITEM:"nextItem",CHANGE_ITEM:"changeItem",PAGE_TURN_START:"pageTurnStart",PAGE_TURN_END:"pageTurnEnd",PAGE_TURN_CANCELED:"pageTurnCanceled",PAGE_CHANGED:"pageChanged",PREV_PAGE:"prevPage",NEXT_PAGE:"nextPage",CHANGE_PAGE:"changePage",AUTO_FLIP:"autoFlip",PASSWORD_POPIN_CLOSE:"passwordPopinClose",POPIN_OPEN:"popinOpen",POPIN_CLOSE:"popinClose",BEFORE_POPIN_CLOSE:"beforePopinClose",POPIN_RESIZE:"popinResize",ENTER_FULLSCREEN:"enterFullScreen",EXIT_FULLSCREEN:"exitFullScreen",FULLSCREEN_CHANGED:"fullScreen",RENDER_LAYOUT:"render-layout",WIDGET_CLICK_OR_TAP:"widgetClickOrTap",ZOOM_CHANGED:"zoomChanged",ZOOM_END:"zoomEnd",ZOOM_START:"zoomStart",MAX_ZOOM_CHANGED:"maxZoomChanged",CHANGE_ZOOM:"changeZoom",COLLECTION_PAGE_CHANGED:"collection-view:page-changed",OPEN_SHARE_OPTIONS:"options-panel-share:open",CLOSE_SHARE_OPTIONS:"options-panel-share:close",OPEN_ZOOM_OPTIONS:"options-zoom:open",CLOSE_ZOOM_OPTIONS:"options-zoom:close",OPEN_DOWNLOAD_OPTIONS:"options-panel-download:open",CLOSE_DOWNLOAD_OPTIONS:"options-panel-download:close",OPEN_SEARCH_OPTIONS:"options-panel-search:open",CLOSE_SEARCH_OPTIONS:"options-panel-search:close",CLOSE_DROP_DOWN_OPTIONS:"options-panel:close",CHANGE_SEARCH_STATE:"search:change-state",SEARCH_TEXTS_LOADED:"search:textjs-loaded",CLEAR_SEARCH:"search:clear",MUTE:"sound:off",UN_MUTE:"sound:on",SEND_EMAIL:"sendMail",SEND_SQS_MAIL:"sendSQSMail",CUSTOM_VIEW_LOADED:"customViewLoaded",HYPERLINK:"openLink",MOUSE_OVER_PAGE:"mouseOverPage",MOUSE_OUT_PAGE:"mouseOutPage",COUNTRIES_LOADED:"countriesLoaded",LEAD_FORM_SENT:"leadFormSent",LEAD_FORM_OPENED:"leadFormOpened",LEAD_FORM_CLOSED:"leadFormClosed",LEAD_FORM_INPUT_FOCUS:"leadFormInputFocus",LEAD_FORM_INPUT_KEYPRESS:"leadFormInputKeypress",SEND_LEAD_FORM:"sendLeadForm",PDF_LINKS_LOADED:"hyperlinks-loaded",WIDGET_VIEW_INIT:"widget-view-init",DESTROY:"widget-detroy",STOP_AUTOHIDE:"stopAutoHide",START_AUTOHIDE:"startAutoHide",AUTOHIDE_CONTROLS:"controllersHide",PREVIEW_PAGES_UPDATED:"previewPagesUpdated",CHANGE_SHELF_COLOR:"changeShelfColor",OPEN_TOC:"table-of-contents:open",CLOSE_TOC:"table-of-contents:close",DESELECT_TABLE_ROW:"table-of-contents:deselect",CHANGE_LANGUAGE:"changeLanguage",OPEN_PRODUCT_TAG_POPIN:"openProductTagPopin",CLOSE_PRODUCT_TAG_POPIN:"closeProductTagPopin",SCALE_PRODUCT_TAG_POPIN:"scaleProductTagPopin",OPEN_AUTOMATOR:"openAutomator",CLOSE_AUTOMATOR:"closeAutomator"},StatsEvents={REGISTER:"stats-register-event",REGISTER_COLLECTION_VIEW:"stats-register-collection-view",SEND_STATS:"stats-send"},Stats=Backbone.Model.extend({initialize:function(){this.queue=[],this.pingInterval=null,this.deviceType=this.getDeviceType(),this.referrerType=this.getReferrerType(),this.lastRequestTime=null,this.canPing=!1,this.firstViewSent=!1,this.impressionSent=!1,this.setupPing(),this.registerEvent([{eid:Stats.TYPE.IMPRESSION}]),this.impressionSent=!0,Backbone.Mediator.sub(StatsEvents.REGISTER,this.registerEvent,this),Backbone.Mediator.sub(StatsEvents.REGISTER_COLLECTION_VIEW,this.registerViewEvent,this),Backbone.Mediator.sub(WidgetEvent.PASSWORD_POPIN_CLOSE,this.registerViewEvent,this),FSWidgetModel.gi().get("collectionData").security||$(document).on("click",this,this.registerViewEvent)},registerViewEvent:function(clickEvent){var self=clickEvent?clickEvent.data:this;self.firstViewSent||(self.canPing=!0,self.firstViewSent=!0,self.addToQueue([{eid:Stats.TYPE.VIEW,d:self.deviceType,s:self.referrerType}]),self.sendStats(),$(document).off("click",self.registerViewEvent))},getCurrentPid:function(){var pageIndex=FSWidgetModel.gi().widgetState.get("currentPageIndex");return FSWidgetModel.gi().widgetState.get("currentItem").get("pages").at(pageIndex).get("pID")},registerEvent:function(params){var paramsArr=params;params.eid&&(paramsArr=[params]),this.addToQueue(paramsArr)},addToQueue:function(events){var sendInstant=!1,now=new Date,self=this;events&&$.each(events,function(i,event){event.eid===Stats.TYPE.IMPRESSION&&(sendInstant=!0),self.queue.push(event)}),now.getTime()-this.lastRequestTime>Stats.EVENTS_FREQUENCY&&(sendInstant=!0),sendInstant&&this.sendStats()},clearQueue:function(){this.queue=[]},sendStats:function(){var dataToSend,now=new Date,a=Math.max(now-this.lastRequestTime,0),b=Math.max(Stats.EVENTS_PING_TIMER+1e3,0),timeToSend=a<b?a:b,cHash=FSWidgetModel.gi().get("shelfData")&&FSWidgetModel.gi().get("shelfData").get("itemOpened")?FSWidgetModel.gi().get("shelfData").get("itemHash"):FSWidgetModel.gi().get("collectionHash");if(!(document.hidden||FSWidgetModel.gi().get("blockEvents")||now.getTime()-this.lastRequestTime<Stats.EVENTS_FREQUENCY)){if(clearInterval(this.pingInterval),this.impressionSent){if(!this.firstViewSent)return;this.addTimeEvents(timeToSend)}dataToSend={ih:FlipSnackEmbed.impressionHash,ch:cHash,cih:FSWidgetModel.gi().widgetState.get("currentItem").get("hash"),e:this.queue,ts:Math.floor(now.getTime()/1e3)},Backbone.Mediator.pub(StatsEvents.SEND_STATS,dataToSend),this.lastRequestTime=now.getTime(),this.clearQueue(),this.setupPing()}},addTimeEvents:function(timeSpent){var nextPage,currentPageIndex=FSWidgetModel.gi().widgetState.get("currentPageIndex"),totalPages=FSWidgetModel.gi().widgetState.get("currentItem").get("pages").length,currentPage=FSWidgetModel.gi().widgetState.get("currentItem").get("pages").at(currentPageIndex);this.queue.push({eid:Stats.TYPE.TIME,t:timeSpent}),currentPage.get("pID")&&this.queue.push({eid:Stats.TYPE.TIME_PAGE,pid:currentPage.get("pID"),t:timeSpent}),currentPageIndex>0&&currentPageIndex<totalPages-1&&(nextPage=FSWidgetModel.gi().widgetState.get("currentItem").get("pages").at(currentPageIndex+1)).get("pID")&&this.queue.push({eid:Stats.TYPE.TIME_PAGE,pid:nextPage.get("pID"),t:timeSpent})},setupPing:function(){var self=this;this.canPing&&(this.pingInterval=setInterval(function(){self.addToQueue(),self.sendPingRequest()},Stats.EVENTS_PING_TIMER))},sendPingRequest:function(){this.sendStats()},getPingData:function(){return{}},getDeviceType:function(){return FSUtils.isSmartphone()?Stats.DEVICE_MOBILE:FSUtils.isTablet()?Stats.DEVICE_TABLET:Stats.DEVICE_DESKTOP},getReferrerType:function(){for(var foundFlipsnackDomains,ref=FlipSnackEmbed.referrer||"",flipsnackDomains=["http(s?)://www.flipsnack.com","http(s?)://[a-z0-9.]*site.flipsnack.net","http(s?)://[a-z0-9.]*flipsnack.io"],socialDomains=["http(s?)://www.facebook.com"],foundSocialDomains="facebook"===ref,i=0,found=!1;!found&&i<flipsnackDomains.length;){if(0===ref.search(flipsnackDomains[i])){found=!0;break}i++}if(!(foundFlipsnackDomains=found)&&!foundSocialDomains){for(i=0,found=!1;!found&&i<socialDomains.length;)0===ref.search(socialDomains[i])?found=!0:i++;found&&(foundSocialDomains=found)}return foundSocialDomains?Stats.REFERRER_SOCIAL:foundFlipsnackDomains?Stats.REFERRER_FLIPSNACK:Stats.REFERRER_EMBED}});Stats.TYPE={IMPRESSION:1,VIEW:2,TIME:3,DOWNLOAD_COLLECTION:4,DOWNLOAD_ITEM:5,VIEW_PAGE:6,CLICK_ELEMENT:7,CLICK_LINK:8,VIEW_ITEM:9,TIME_PAGE:10,PRINT:11},Stats.DEVICE_DESKTOP=0,Stats.DEVICE_TABLET=1,Stats.DEVICE_MOBILE=2,Stats.REFERRER_FLIPSNACK=0,Stats.REFERRER_SOCIAL=1,Stats.REFERRER_EMBED=2,Stats.EVENTS_FREQUENCY=500,Stats.EVENTS_PING_TIMER=5e3,Stats.HOVER_TIMER=2e3,Stats._instance=null,Stats.gi=function(){return Stats._instance||(Stats._instance=new Stats),Stats._instance};var Templates={wheelPreloader:'<div class="fswp-default-css"><div class="spinner"></div></div>',mainLayout:'<div id="mainLayout"><div id="mainView"><div id="menu" /><div id="flipView" /><div id="slideView" /><div id="collectionView" /><div id="navSlider" /><div id="genericElements" /></div><div id="buyCurtain" /><div id="shelfView" /><div id="toc-container" /></div>',automatorView:'<div class="autmator-container"><button id="toggleProductsButton" class="button-blue"><span id="buttonLabel"><%- buttonLabel %></span> products (<%- productsCount %>)<img class="automator-arrow" src="<%- arrowSrc %>"></button><div class="products-container"></div></div>',automatorProduct:'<div class="automator-product product-<%- index %>"><% if (image_link) { %><div class="image-container"><img src="<%- image_link %>"></div><% } %><% if (title) { %><div class="product-title"><%- title %></div><% } %><div class="product-price"><%- sell_price %></div><div class="product-description"><% if (showReadMore) { %><span class="visible-description visible-<%- index %>"><%- visibleDescription %></span><span class="dots dots-<%- index %>">...</span><div data-index="<%- index %>" class="view-more more-<%- index %>">View more</div> <span class="hidden-description hidden-<%- index %>"><%- description %></span><div data-index="<%- index %>" class="view-less less-<%- index %>">View less</div> <% } else { %><%- description %><% } %></div><% if (link) { %><a class="button-blue product-button" href="<%- link %>" target="_blank" rel="nofollow noopener noreferrer">Buy product</a><% } %></div>',playerLayout:'<div id="mainLayout"><div id="mainView"><div id="bottomBar"><div id="bottomBarTop"><div id="playerNavSlider" /></div><div id="bottomBarBottom" ><div id="bottomLeft" /><div id="bottomRight" /></div></div><div id="flip-container"><div id="flipView" /></div></div><div id="buyCurtain" /><div id="shelfView" /><div id="player-toc-container" /></div>',embedWatermark:'<div id="fsw-watermark"><a class="fsw-watermark-url" href="" target="_blank"><img src="" alt="Flipsnack logo" /></a></div>',simpleLoader:'<div class="fsw-simpleloader"><a><div class="vignette-layer"></div><img class="fsw-simpleimage" src="" /></a><div class="fsw-wheelpreloader" /></div>',clickToRead:'<div class="wrapper"><svg width="18" height="18" viewBox="0 0 30 30"><path fill="#FFF" d="M2 19H0v11h11v-2H2v-9zm-2-8h2V2h9V0H0v11zm28 17h-9v2h11V19h-2v9zM19 0v2h9v9h2V0H19z" opacity=".9"/></svg><span class="click-to-read"><%- label %></span></div>',pageContentPreLoader:'<div class="page-content-bar-loader"><div class="progress-bar"></div></div>',genericTooltip:'<div class="content"><span class="tooltip-text"><%- tooltipText %></span></div>',genericPopin:'<div class="popin-overlay" /><div class="popin-panel"><a class="btn-x">X</a><div class="popin-content"></div></div>',productTagPopin:'<div class="popin-overlay" /><div class="popin-panel"><div class="popin-content"></div></div>',productTagPopinContent:'<% if (media && media.length) { %><div class="left-section"><div class="image-container"><img src="" /></div> <% if (media.length > 1) { %><div class="product-images"></div> <% } %></div><% } %><div class="right-section"><div class="top-section"><div class="section-header"><div class="close-popin"><svg width="14" height="14" viewBox="0 0 14 14" xmlns="http://www.w3.org/2000/svg"><path d="M.167 1.817l1.65-1.65 11.55 11.55-1.65 1.65z"/><path d="M13.366 1.817l-1.65-1.65L.167 11.717l1.65 1.65z"/></svg></div></div><% if (title) { %><div class="title"><%- title %></div><% } %><% if (description) { %><div class="description"><%- description %></div><% } %></div><div class="bottom-section"><div class="price-container"><% if (price && !discountPrice) { %><div class="new"><%- price %></div><% } %><% if (price && discountPrice) { %><div class="old"><%- price %></div><% } %><% if (discountPrice) { %><div class="new"><%- discountPrice %></div><% } %></div><% if (url) { %><a class="button" target="_blank" rel="noopener noreferrer" href="<%- url %>"><%- buttonLabel %></a><% } %></div></div>',leadForm:'<div class="form-main"><div class="form-container"><div class="form-header"><%- header %></div><div class="form-content"></div><div class="form-footer"><div class="form-required">(<span class="form-error">*</span>) <span class="footer-label"><%- labels.requiredFieldLabel %></span></div><div class="submit-button"><%- labels.buttonLabel %></div></div></div></div>',leadFormLabel:'<label class="form-label"><%- label %><% if (mandatory) { %> <span class="form-error">*</span><% } %></label>',leadFormError:'<div class="error-label"><%- error %></div>',leadFormInput:'<input type="<%- type %>" class="form-input input-border" spellcheck="false">',leadFormTextArea:'<textarea class="form-input input-border" spellcheck="false"></textarea>',leadFormDropDown:'<select class="form-input input-border"></select>',leadFormCheckbox:'<div class="cb-container"><input id="<%- id %>" type="checkbox" class="form-input"><label for="<%- id %>" class="form-cblabel"><%- label %></label></div>',pdfLinkTemplate:'<a href="<%- url %>" target="_blank" rel="nofollow noopener noreferrer"></a>',passwordPopinTemplate:'<div class="main"><div class="content"><form class="password-container" autocomplete="off" onsubmit="return false;"><div class="title"><%- title %></div><div class="labels"><label for="password"><%- passwordLabel %></label><span id="error" class="hidden"><%- wrongPasswordLabel %></span><span class="clear"></span></div><div class="password-field"><input type="password" name="psw" id="password" spellcheck="false" autofocus="autofocus" autocomplete="off" </div><input type="button" id="submit" value="<%- submitButtonLabel %>" /></form></div></div>',navSlider:'<div class="nav-slider-back" /><div class="nav-slider"><div class="slider-bar"/></div><div class="nav-slider-components"><div class="nav-slider-tooltip-container"><div class="nav-slider-thumb"></div><div class="nav-slider-tooltip"></div></div><div class="nav-slider-knob" /></div>',playerNavSlider:'<div class="nav-slider-back" /><div class="nav-slider"><div class="slider-bar"><div class="nav-slider-progress"/></div></div><div class="nav-slider-components"><div class="nav-slider-tooltip-container"><div class="nav-slider-thumb"><div class="nav-slider-tooltip"></div></div></div><div class="nav-slider-knob" /></div>',buyButton:'<% if (isInSubscription) { %><a class="buy-btn large-btn" target="_blank" href="<%- buyLink %>?selected=flipbook"><%- singleFlipbook %> <span><%- price %></span></a><a class="buy-btn large-btn subscription-btn" target="_blank" href="<%- buyLink %>?selected=subscription"><%- buySubscription %> <%- subscriptionFlipbooks %> <%- issues %><span> <%- subscriptionPrice %></span></a><% } else { %><div class="buy-btn"><a target="_blank" href="<%- buyLink %>"><%- buyLabel %> <span><%- price %></span></a></div><% } %>',buyCurtain:'<div class="curtain-top"><div class="publish-author">Published by <a class="author" href="<%- userUrl %>" target="_blank"><%- author %></a></div><div class="full-screen-exit-btn"><svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 26 26"><g fill="#AAB2C3" fill-rule="nonzero"><path d="M15.3 13L25.5 2.8A1.6 1.6 0 1 0 23.2.5L13 10.7 2.8.5A1.6 1.6 0 1 0 .5 2.8L10.7 13 .5 23.2a1.6 1.6 0 1 0 2.3 2.3L13 15.3l10.2 10.2a1.6 1.6 0 0 0 2.3 0 1.6 1.6 0 0 0 0-2.3L15.3 13z"/> </g></svg></div></div><div class="curtain-main <% if (isPlayerSkin) { %>playerCurtain<% } %>"><div class="prev-btn"><% if (!isPlayerSkin) { %><svg class="nav-button" width="26" height="93" viewBox="0 0 36 93" xmlns="http://www.w3.org/2000/svg"><path class="nav-button" d="M29.958 0L0 46.035l29.958 46.02H36L6.042 46.035 36 0z" /></svg><% } else { %><svg xmlns="http://www.w3.org/2000/svg" width="25" height="47" viewBox="0 0 33 54"><path d="M.967 25.44l19.338 19.906c1.29 1.267 2.438 1.267 3.728 0 1.29-1.266 1.29-2.392 0-3.658L6.087 23.148l17.945-18.54c1.29-1.266 1.29-2.392 0-3.658-1.29-1.267-2.437-1.267-3.727 0L.967 20.856a3.2 3.2 0 000 4.584z" fill="#FFF" fill-rule="evenodd"/></svg><% } %></div><div class="curtain-body"><div class="curtain-message"><%- message %></div><div class="flipbook-title"><%- title %></div><% if (isInSubscription) { %><div class="buy-btn large-btn"><a target="_blank" href="<%- buyLink %>?selected=flipbook"><%- singleFlipbook %> <%- price %></a></div><div class="buy-btn large-btn subscription-btn"><a target="_blank" href="<%- buyLink %>?selected=subscription"><%- buySubscription %> <%- subscriptionFlipbooks %> <%- issues %> <%- subscriptionPrice %></a></div><% } else { %><div class="buy-btn"><a target="_blank" href="<%- buyLink %>"><%- buyLabel %> <%- price %></a></div><% } %></div><div class="next-btn"><% if (!isPlayerSkin) { %><svg class="nav-button" width="26" height="93" viewBox="0 0 36 93" xmlns="http://www.w3.org/2000/svg"><path class="nav-button" d="M6.042 0L36 46.035 6.042 92.055H0l29.958-46.02L0 0z" /></svg><% } else { %><svg xmlns="http://www.w3.org/2000/svg" width="25" height="47" viewBox="0 0 33 54"><path d="M24.033 25.44L4.695 45.346c-1.29 1.267-2.438 1.267-3.728 0-1.29-1.266-1.29-2.392 0-3.658l17.946-18.54L.968 4.608C-.322 3.342-.322 2.216.968.95c1.29-1.267 2.437-1.267 3.727 0l19.338 19.906a3.2 3.2 0 010 4.584z" fill="#FFF" fill-rule="evenodd"/></svg><% } %></div></div>'};!function($){"use strict";window.FSUtils||(window.FSUtils={}),window.FSUtils={ua:navigator.userAgent.toLowerCase(),devicePixelRatio:window.devicePixelRatio||1,screenWidth:window.screen.width,screenHeight:window.screen.height,isWebkit:function(){var result=this.ua.match(/webkit/i);return result||(result=navigator.appVersion.match(/webkit/i)),result&&result.length>0},hasTouch:function(){return"ontouchstart"in window},isAndroid:function(){var result=this.ua.match(/android/i);return result&&result.length>0},isBlackBerry:function(){var result=this.ua.match(/blackberry/i);return result&&result.length>0},isIOS:function(){var result=this.ua.match(/iphone|ipad|ipod/i);return result&&result.length>0},isOpera:function(){var result=this.ua.match(/opera mini/i);return result&&result.length>0},isWindows:function(){var result=this.ua.match(/iemobile/i)||this.ua.match(/windows phone/i);return result&&result.length>0},isIE8:function(){return this.ua.search("msie 8")>-1||navigator.appVersion.search("msie 8")>-1},isIE9:function(){return this.ua.search("msie 9")>-1||navigator.appVersion.search("msie 9")>-1},isKindle:function(){var result=this.ua.match(/silk/i);return result&&result.length>0},isInFullScreen:function(){return FSWidgetModel.gi().widgetState.get("displayState")!==DisplayState.NORMAL},isMobileDevice:function(){var result=this.ua.match(/(iphone|ipod|ipad|android|windows phone|silk|blackberry|iemobile)/i);return!(!result||!result.length)||this.ua.indexOf("macintosh")>-1&&navigator.maxTouchPoints>0},isSmartphone:function(){var result=this.ua.match(/(iphone|ipod|android|windows phone|silk|blackberry|iemobile)/i),ss=this.getScreenSize();return result&&result.length>0&&ss.width<960&&ss.height<960},isTablet:function(){var result=this.ua.match(/(ipad|android|windows phone|silk|blackberry|iemobile)/i),ss=this.getScreenSize();return result&&result.length>0&&(ss.width>=960||ss.height>=960)},isAndroidStockBrowser:function(){var str,isFirefox=!1,isChrome=!1;return!!this.isAndroid()&&(isFirefox=(str=this.ua.match(/firefox/i))&&str.length>0,isChrome=(str=this.ua.match(/chrome/i))&&str.length>0,!isFirefox&&!isChrome)},isChrome:function(){var str=this.ua.match(/chrome/i);return str&&str.length>0},getScreenSize:function(){this.getAndroidVersion();var sw=window.screen.width,sh=window.screen.height;return this.isAndroidStockBrowser()&&(sw/=devicePixelRatio,sh/=devicePixelRatio),{width:sw,height:sh}},getAndroidVersion:function(){var match=this.ua.match(/android\s([0-9\.]*)/);return!!match&&match[1]},capitalize:function(str){return str.charAt(0).toUpperCase()+str.slice(1)},getTextSize:function(txt,cssObj){var normalizedTxt=txt.replace(/(?:\r\n|\r|\n)/g,"<br />"),spn=$("<span>").appendTo("body").html(normalizedTxt).css(cssObj).css({position:"absolute",left:"-9999px"}),returnObj={width:spn[0].scrollWidth,height:spn[0].scrollHeight};return spn.remove(),returnObj},calculatePageSize:function(width,height,originalWidth,originalHeight,roundingFunc){var wRatio=originalWidth/width,hRatio=originalHeight/height;return roundingFunc="function"==typeof roundingFunc?roundingFunc:Math.round,wRatio>hRatio?{width:width,height:roundingFunc.call(this,originalHeight/wRatio)}:{width:roundingFunc.call(this,originalWidth/hRatio),height:height}},calculateScaledSize:function(width,height,boundWidth,boundHeight,resizeIfSmaller){var wRatio=width/boundWidth,hRatio=height/boundHeight;return!resizeIfSmaller&&width<boundWidth&&height<boundHeight?{width:width,height:height}:wRatio>hRatio?{width:boundWidth,height:height/wRatio}:{width:width/hRatio,height:boundHeight}},calculateScale:function(width,height,boundWidth,boundHeight,resizeIfSmaller){return width/FSUtils.calculateScaledSize(width,height,boundWidth,boundHeight,resizeIfSmaller).width},getImageSizeType:function(w,h){return _.find(ImageTypes,function(type){return ImageSizes[type]&&ImageSizes[type].WIDTH>=w&&ImageSizes[type].HEIGHT>=h})||ImageTypes.ORIGINAL},elementCanBeDisplayed:function(type,premiumElements,isPremium){return-1===premiumElements.indexOf(type)||isPremium&&premiumElements.indexOf(type)>-1},getZoomLevel:function(){return Math.round(document.documentElement.clientWidth/window.innerWidth*100)/100},isVideo:function(url){return this.getVideoHash(url).length>0},getVideoHash:function(url){var ampersandPos,slashPos,arr=[],videoHash="";return"string"==typeof url&&url.length&&((url.indexOf("http://")<0||url.indexOf("https://")<0)&&(url="https://"+url),url.indexOf("://www.youtube.com/")>-1||url.indexOf("://youtube.com/")>-1?(arr=url.split("v=")).length>1?(ampersandPos=(videoHash=arr[1]).indexOf("&"))>-1&&(videoHash=videoHash.substring(0,ampersandPos)):(arr=url.split("/embed/")).length>1&&((slashPos=(videoHash=arr[1]).indexOf("/"))>-1&&(videoHash=videoHash.substring(0,slashPos)),(ampersandPos=videoHash.indexOf("&"))>-1&&(videoHash=videoHash.substring(0,ampersandPos))):url.indexOf("://youtu.be/")>-1?(arr=url.split("youtu.be/")).length>1&&(ampersandPos=(videoHash=arr[1]).indexOf("&"))>-1&&(videoHash=videoHash.substring(0,ampersandPos)):url.indexOf("vimeo.com/")>-1&&(arr=url.match(/\/[0-9]+/gi))&&arr.length&&(videoHash=arr[0].substr(1,arr[0].length))),videoHash},getVideoProvider:function(url){return"string"==typeof url&&url.length?url.indexOf("youtube.com/")>-1||url.indexOf("youtu.be/")>-1?VideoProvider.YOUTUBE:url.indexOf("vimeo.com/")>-1?VideoProvider.VIMEO:VideoProvider.OTHER:null},getVideoExtraParams:function(url){var urlSplit;return"string"==typeof url&&url.length&&(urlSplit=url.split("?"))&&urlSplit[1]?urlSplit[1]:""},getUrlProtocol:function(url){var result=url.match(/(mailto(?=:))|^\w+(?=:\/\/)/gi);return result&&result.length>0?result[0]:""},urlHasProtocol:function(url){return["http","https","ftp","sftp","udp","mailto"].indexOf(this.getUrlProtocol(url.toLowerCase()))>=0},isEmailValid:function(email){return null!==("string"==typeof email&&email.length>0&&email.match(/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/gi))},isPortrait:function(){if(this.isMobileDevice()){if("number"==typeof window.orientation)return 0===Math.abs(window.orientation)||Math.abs(180===window.orientation);if(screen.orientation&&"number"==typeof screen.orientation.angle)return 0===Math.abs(screen.orientation.angle)||Math.abs(180===screen.orientation.angle)}return!1},getElementCSSTransform:function(element){var computedStyle,transform,isMatrix3d,pos,tx,ty,scaleX,scaleY;try{return isMatrix3d=0===(transform=(computedStyle=getComputedStyle(element,null)).transform||computedStyle.webkitTransform||computedStyle.MozTransform||computedStyle.msTransform||computedStyle.OTransform).indexOf("matrix3d"),pos=transform.split("(")[1].split(")")[0].split(","),isMatrix3d?(tx=parseInt(pos[12],10),ty=parseInt(pos[13],10),scaleX=parseFloat(pos[0]),scaleY=parseFloat(pos[5])):(tx=parseInt(pos[4],10),ty=parseInt(pos[5],10),scaleX=parseFloat(pos[0]),scaleY=parseFloat(pos[3])),{x:tx,y:ty,scaleX:scaleX,scaleY:scaleY}}catch(e){return{x:0,y:0,scaleX:1,scaleY:1}}},colorToString:function(color){var colorStr="string"==typeof color?color:"";return"number"==typeof color&&(colorStr=color>16777215?"FFFFFF":color.toString(),colorStr=color<0?"000000":colorStr),3===(colorStr=(colorStr="#"===colorStr.substr(0,1)?colorStr.substr(1,colorStr.length-1):colorStr).length>6?"000000":colorStr).length&&(colorStr=colorStr[0]+colorStr[0]+colorStr[1]+colorStr[1]+colorStr[2]+colorStr[2]),colorStr.length<6&&(colorStr=new Array(7-colorStr.length).join("0")+colorStr),"#"+colorStr},compareArrays:function(arr1,arr2){var a1=arr1.map(function(elem){return elem}),a2=arr2.map(function(elem){return elem});function compareNumbers(a,b){return a-b}return a1.sort(compareNumbers),a2.sort(compareNumbers),a1.length===a2.length&&a1.every(function(v,i){return v===a2[i]})},arrayDiff:function(a1,a2){return a1.concat(a2).filter(function(e,i,array){return array.indexOf(e)===array.lastIndexOf(e)})},HASH:{hexcase:0,b64pad:"",chrsz:8,hex_md5:function(s){return this.binl2hex(this.core_md5(this.str2binl(s),s.length*this.chrsz))},b64_md5:function(s){return this.binl2b64(this.core_md5(this.str2binl(s),s.length*this.chrsz))},str_md5:function(s){return this.binl2str(this.core_md5(this.str2binl(s),s.length*this.chrsz))},hex_hmac_md5:function(key,data){return this.binl2hex(this.core_hmac_md5(key,data))},b64_hmac_md5:function(key,data){return this.binl2b64(this.core_hmac_md5(key,data))},str_hmac_md5:function(key,data){return this.binl2str(this.core_hmac_md5(key,data))},md5_vm_test:function(){return"900150983cd24fb0d6963f7d28e17f72"===this.hex_md5("abc")},core_md5:function(x,len){x[len>>5]|=128<<len%32,x[14+(len+64>>>9<<4)]=len;for(var a=1732584193,b=-271733879,c=-1732584194,d=271733878,i=0;i<x.length;i+=16){var olda=a,oldb=b,oldc=c,oldd=d;a=this.md5_ff(a,b,c,d,x[i+0],7,-680876936),d=this.md5_ff(d,a,b,c,x[i+1],12,-389564586),c=this.md5_ff(c,d,a,b,x[i+2],17,606105819),b=this.md5_ff(b,c,d,a,x[i+3],22,-1044525330),a=this.md5_ff(a,b,c,d,x[i+4],7,-176418897),d=this.md5_ff(d,a,b,c,x[i+5],12,1200080426),c=this.md5_ff(c,d,a,b,x[i+6],17,-1473231341),b=this.md5_ff(b,c,d,a,x[i+7],22,-45705983),a=this.md5_ff(a,b,c,d,x[i+8],7,1770035416),d=this.md5_ff(d,a,b,c,x[i+9],12,-1958414417),c=this.md5_ff(c,d,a,b,x[i+10],17,-42063),b=this.md5_ff(b,c,d,a,x[i+11],22,-1990404162),a=this.md5_ff(a,b,c,d,x[i+12],7,1804603682),d=this.md5_ff(d,a,b,c,x[i+13],12,-40341101),c=this.md5_ff(c,d,a,b,x[i+14],17,-1502002290),b=this.md5_ff(b,c,d,a,x[i+15],22,1236535329),a=this.md5_gg(a,b,c,d,x[i+1],5,-165796510),d=this.md5_gg(d,a,b,c,x[i+6],9,-1069501632),c=this.md5_gg(c,d,a,b,x[i+11],14,643717713),b=this.md5_gg(b,c,d,a,x[i+0],20,-373897302),a=this.md5_gg(a,b,c,d,x[i+5],5,-701558691),d=this.md5_gg(d,a,b,c,x[i+10],9,38016083),c=this.md5_gg(c,d,a,b,x[i+15],14,-660478335),b=this.md5_gg(b,c,d,a,x[i+4],20,-405537848),a=this.md5_gg(a,b,c,d,x[i+9],5,568446438),d=this.md5_gg(d,a,b,c,x[i+14],9,-1019803690),c=this.md5_gg(c,d,a,b,x[i+3],14,-187363961),b=this.md5_gg(b,c,d,a,x[i+8],20,1163531501),a=this.md5_gg(a,b,c,d,x[i+13],5,-1444681467),d=this.md5_gg(d,a,b,c,x[i+2],9,-51403784),c=this.md5_gg(c,d,a,b,x[i+7],14,1735328473),b=this.md5_gg(b,c,d,a,x[i+12],20,-1926607734),a=this.md5_hh(a,b,c,d,x[i+5],4,-378558),d=this.md5_hh(d,a,b,c,x[i+8],11,-2022574463),c=this.md5_hh(c,d,a,b,x[i+11],16,1839030562),b=this.md5_hh(b,c,d,a,x[i+14],23,-35309556),a=this.md5_hh(a,b,c,d,x[i+1],4,-1530992060),d=this.md5_hh(d,a,b,c,x[i+4],11,1272893353),c=this.md5_hh(c,d,a,b,x[i+7],16,-155497632),b=this.md5_hh(b,c,d,a,x[i+10],23,-1094730640),a=this.md5_hh(a,b,c,d,x[i+13],4,681279174),d=this.md5_hh(d,a,b,c,x[i+0],11,-358537222),c=this.md5_hh(c,d,a,b,x[i+3],16,-722521979),b=this.md5_hh(b,c,d,a,x[i+6],23,76029189),a=this.md5_hh(a,b,c,d,x[i+9],4,-640364487),d=this.md5_hh(d,a,b,c,x[i+12],11,-421815835),c=this.md5_hh(c,d,a,b,x[i+15],16,530742520),b=this.md5_hh(b,c,d,a,x[i+2],23,-995338651),a=this.md5_ii(a,b,c,d,x[i+0],6,-198630844),d=this.md5_ii(d,a,b,c,x[i+7],10,1126891415),c=this.md5_ii(c,d,a,b,x[i+14],15,-1416354905),b=this.md5_ii(b,c,d,a,x[i+5],21,-57434055),a=this.md5_ii(a,b,c,d,x[i+12],6,1700485571),d=this.md5_ii(d,a,b,c,x[i+3],10,-1894986606),c=this.md5_ii(c,d,a,b,x[i+10],15,-1051523),b=this.md5_ii(b,c,d,a,x[i+1],21,-2054922799),a=this.md5_ii(a,b,c,d,x[i+8],6,1873313359),d=this.md5_ii(d,a,b,c,x[i+15],10,-30611744),c=this.md5_ii(c,d,a,b,x[i+6],15,-1560198380),b=this.md5_ii(b,c,d,a,x[i+13],21,1309151649),a=this.md5_ii(a,b,c,d,x[i+4],6,-145523070),d=this.md5_ii(d,a,b,c,x[i+11],10,-1120210379),c=this.md5_ii(c,d,a,b,x[i+2],15,718787259),b=this.md5_ii(b,c,d,a,x[i+9],21,-343485551),a=this.safe_add(a,olda),b=this.safe_add(b,oldb),c=this.safe_add(c,oldc),d=this.safe_add(d,oldd)}return[a,b,c,d]},md5_cmn:function(q,a,b,x,s,t){return this.safe_add(this.bit_rol(this.safe_add(this.safe_add(a,q),this.safe_add(x,t)),s),b)},md5_ff:function(a,b,c,d,x,s,t){return this.md5_cmn(b&c|~b&d,a,b,x,s,t)},md5_gg:function(a,b,c,d,x,s,t){return this.md5_cmn(b&d|c&~d,a,b,x,s,t)},md5_hh:function(a,b,c,d,x,s,t){return this.md5_cmn(b^c^d,a,b,x,s,t)},md5_ii:function(a,b,c,d,x,s,t){return this.md5_cmn(c^(b|~d),a,b,x,s,t)},core_hmac_md5:function(key,data){var bkey=this.str2binl(key);bkey.length>16&&(bkey=this.core_md5(bkey,key.length*this.chrsz));for(var ipad=[16],opad=[16],i=0;i<16;i++)ipad[i]=909522486^bkey[i],opad[i]=1549556828^bkey[i];var hash=this.core_md5(ipad.concat(this.str2binl(data)),512+data.length*this.chrsz);return this.core_md5(opad.concat(hash),640)},safe_add:function(x,y){var lsw=(65535&x)+(65535&y);return(x>>16)+(y>>16)+(lsw>>16)<<16|65535&lsw},bit_rol:function(num,cnt){return num<<cnt|num>>>32-cnt},str2binl:function(str){for(var bin=[],mask=(1<<this.chrsz)-1,i=0;i<str.length*this.chrsz;i+=this.chrsz)bin[i>>5]|=(str.charCodeAt(i/this.chrsz)&mask)<<i%32;return bin},binl2str:function(bin){for(var str="",mask=(1<<this.chrsz)-1,i=0;i<32*bin.length;i+=this.chrsz)str+=String.fromCharCode(bin[i>>5]>>>i%32&mask);return str},binl2hex:function(binarray){for(var hex_tab=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",str="",i=0;i<4*binarray.length;i++)str+=hex_tab.charAt(binarray[i>>2]>>i%4*8+4&15)+hex_tab.charAt(binarray[i>>2]>>i%4*8&15);return str},binl2b64:function(binarray){for(var str="",i=0;i<4*binarray.length;i+=3)for(var triplet=(binarray[i>>2]>>i%4*8&255)<<16|(binarray[i+1>>2]>>(i+1)%4*8&255)<<8|binarray[i+2>>2]>>(i+2)%4*8&255,j=0;j<4;j++)8*i+6*j>32*binarray.length?str+=this.b64pad:str+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(triplet>>6*(3-j)&63);return str}},cssRules:{_rules:{},_generateCssRules:function(){var newCssRuleContainer=$('<style type="text/css" id="'+CSS_RULES_ID+'" />');this._removeCssRules(),$("head").append(newCssRuleContainer),this.cssRuleContainer=$("#"+CSS_RULES_ID),this._appendRules()},_appendRules:function(){var self=this;$.each(self._rules,function(ruleName,ruleVal){self.cssRuleContainer.append(ruleVal)})},_removeCssRules:function(){this.cssRuleContainer=$("#"+CSS_RULES_ID),this.cssRuleContainer.length&&this.cssRuleContainer.remove()},_addRule:function(identificator,ruleName,params){var rule="\n#"+MAIN_CONTAINER_ID+" "+ruleName+" {\n";$.each(params,function(p,val){rule+="    "+p+":"+val+";\n"}),rule+="}\n",this._rules[identificator]=rule},add:function(identificator,ruleName,params){if(!identificator||!ruleName||!params)return"Missing params!";this._addRule(identificator,ruleName,params),this._generateCssRules()},remove:function(identificator){void 0!==this._rules[identificator]&&(delete this._rules[identificator],this._generateCssRules())},reset:function(){this._rules={},this._generateCssRules()}},generateImpressionHash:function(string){return FSUtils.HASH.hex_md5(string+(new Date).getTime().toString()+(1e17*Math.random()).toString())},removeFromArrayWhereKey:function(arr,key,value){for(var item,i=0;item=arr[i++];)if(item[key]===value)return arr.splice(i-1,1),!0;return!1},loadScript:function(src,onLoadCallback,onErrorCallback){var script=document.createElement("script");return script.type="text/javascript",script.onload=function(){onLoadCallback&&onLoadCallback()},script.onerror=function(){onErrorCallback&&onErrorCallback()},document.head.appendChild(script),script.src=src,script},getDirectlink:function(){var shareLinkText=FSWidgetModel.gi().widgetSettings.get("shareLinkText");if(""!==FlipSnackEmbed.urls.customDomain){var parts=shareLinkText.split("/");shareLinkText=FlipSnackEmbed.urls.customDomain+"/"+parts[parts.length-1]}if(-1===shareLinkText.indexOf("http://")&&-1===shareLinkText.indexOf("https://")?shareLinkText="http://"+shareLinkText:shareLinkText.indexOf("http://")>-1&&(shareLinkText=shareLinkText.replace("http://","https://")),0===shareLinkText.length){var hash=FSUtils.getCurrentHash();shareLinkText="https:"+window.URLPaths.BASE+"/?fh="+hash}return shareLinkText},getCurrentHash:function(){return FSWidgetModel.gi().get("shelfData")&&FSWidgetModel.gi().get("shelfData").get("itemOpened")?FSWidgetModel.gi().get("shelfData").get("itemHash"):FSWidgetModel.gi().get("collectionHash")},getDownloadedPdfPath:function(){return"../"+FSWidgetModel.gi().get("exportName")},getDownloadLink:function(){return FSWidgetModel.gi().get("isDownload")&&""!==FSWidgetModel.gi().get("exportName")?FSUtils.getDownloadedPdfPath():FSUtils.getDirectlink().split(".html")[0]+"/"+DOWNLOAD_PDF_SUFFIX+".html"},getPrintLink:function(){return FSWidgetModel.gi().get("isDownload")&&""!==FSWidgetModel.gi().get("exportName")?FSUtils.getDownloadedPdfPath():FSUtils.getDirectlink().split(".html")[0]+"/"+PRINT_PDF_SUFFIX+".html"},hasAccessToElement:function(elem,features){var elemFeature=ElementActionToFeature[elem.action];return void 0===elemFeature||features[elemFeature]},parseJSONData:function(json,siteUrl,hashId){var i,prop,features,sell,jsonData,stringProps=["title","security","trackingId"];json.config&&(jsonData=json.config);var collection={};for(jsonData.params.widgetType===WidgetType.SHELF&&jsonData.params.newShelf&&(collection.shelfData={shelf:!0,shelfOpened:!0,items:jsonData.collection,shelfJson:json}),void 0!==jsonData.blocked&&"true"===jsonData.blocked&&(collection.isBlocked=!0),i=0;prop=stringProps[i++];)"string"==typeof jsonData[prop]&&jsonData[prop]&&(collection[prop]=jsonData[prop]);return features=jsonData.features?jsonData.features:null,sell=jsonData.sell?jsonData.sell:null,"string"==typeof jsonData.userProfile&&jsonData.userProfile.length?(collection.userProfile=jsonData.userProfile,collection.author=jsonData.userProfile,sell&&(sell.buyLink=FSUtils.getFlipbookBuyLink(siteUrl,jsonData.userProfile,hashId))):sell=null,"string"==typeof jsonData.linkName&&jsonData.linkName.length&&(collection.linkName=jsonData.linkName),"string"==typeof jsonData.author&&jsonData.author.length&&(collection.author=jsonData.author),collection.albumType=jsonData.type,collection.templateHash=jsonData.template_hash,collection.publisher=1===jsonData.publisher||"1"===jsonData.publisher,collection.resourceVersion=jsonData.resourceVersion||"1",collection.watermark=jsonData.watermark&&"yes"===jsonData.watermark.toLowerCase(),collection.params=FSUtils.parseJSONParams(jsonData.params),collection.collection=FSUtils.parseCollection(jsonData.collection),collection.features=FSUtils.parseJSONFeatures(features),collection.sell=collection.features&&collection.features.SELL?FSUtils.parseSellData(sell):{},collection.visibility=jsonData.visibility,collection.accountId=jsonData.accountId,collection.ipAnonymization=jsonData.ipAnonymization||!1,collection.features&&collection.features.TABLE_OF_CONTENT&&jsonData.params.enableToc&&jsonData.collection.flip&&jsonData.collection.flip.length&&(collection.tocPageLinks=FSUtils.getTocPageLinks(jsonData.collection.flip[0].pageData),collection.toc={tocData:jsonData.collection.toc,visible:!1}),collection},getFlipbookBuyLink:function(siteUrl,userProfile,flipbookLinkName){return siteUrl+"/store/publishers/"+userProfile+"/flips/"+flipbookLinkName+"/"},parseJSONParams:function(params){var paramsList={};for(var i in params)if(params.hasOwnProperty(i))switch(i){case"collectionWidth":case"collectionHeight":case"autoFlipDelay":paramsList[i]=parseInt(params[i]);break;default:"true"===params[i]||"false"===params[i]?paramsList[i]="true"===params[i]:paramsList[i]=params[i]}return paramsList},parseCollection:function(data){var collection=data.flip;return _.each(collection,function(item){item.pageData=item.pageData.page,_.each(item.pageData,function(page){page.links&&page.links.l&&(page.links=page.links.l,page.links=page.links.filter(function(elem){return!elem.invisible}))})}),collection},parseJSONFeatures:function(features){var featureList={};if(!features)return{};for(var i in features)features.hasOwnProperty(i)&&("true"===features[i]||"false"===features[i]?featureList[i]="true"===features[i]:featureList[i]=features[i]);return featureList},parseSellData:function(data){var sellData={};return data&&data.enabled&&data.price&&"object"==typeof data.previewPages&&data.previewPages.length&&(sellData={price:data.price.toString(),previewPages:_.uniq(data.previewPages).sort(function(a,b){return a-b}),buyLink:data.buyLink},data.subscriptionPrice&&(sellData.subscriptionPrice=data.subscriptionPrice.toString(),sellData.subscriptionFlipbooks=data.subscriptionFlipbooks)),sellData},getTocPageLinks:function(pages){var key,index,pageLinks={};return pages.forEach(function(p,k){p.originalHash&&!isNaN(p.pdfidx)&&(index=p.pdfidx+1,key=p.originalHash+"_"+index,pageLinks[key]=k)}),pageLinks},getOldEditorScaling:function(height,width,EDITOR_DEFAULTS){var nw,rPage=width/height;return nw=EDITOR_DEFAULTS.width/EDITOR_DEFAULTS.height>rPage?EDITOR_DEFAULTS.height*rPage:EDITOR_DEFAULTS.width,Math.min(nw/width,1)},getCollectionContentURL:function(accountId,hash){return URLPaths.COLLECTION_CONTENT.replace("{accountId}",accountId).replace("{hash}",hash)},getUserExternalLibraryURL:function(accountId){return URLPaths.EXTERNAL_CONTENT.replace("{accountId}",accountId)},getVideoParam:function(extraParams,searchParam){var value=0;return extraParams.split("&").forEach(function(p){var param=p.split("=");searchParam===param[0]&&(value=param[1])}),value},isPlayerSkin:function(){return FSWidgetModel.gi().widgetSettings.get("skinType")===WidgetSkinType.PLAYER},generateZoomValues:function(from,to,amount){for(var values=[],scale=to/amount,i=0;i<=amount;i++)values.push(scale*i);return values},getClosestZoomValue:function(zoomValues,currentValue){return zoomValues.reduce(function(prev,curr){return Math.abs(curr-currentValue)<Math.abs(prev-currentValue)?curr:prev})}}}(jQuery),FSUtils.FULLSCREEN_PORTRAIT_MARGIN=16,FSUtils.FULLSCREEN_LANDSCAPE_MARGIN=26,FSUtils.ORIENTATION_PORTRAIT="portrait",FSUtils.ORIENTATION_LANDSCAPE="landscape";var LoaderManager=Backbone.Model.extend({initialize:function(){this.taskList=[],this.hasTask=!1},removeAllTasks:function(){var self=this;this.taskList.forEach(function(task){$(task).off("complete error",self.completeHandler)}),this.taskList=[],this.hasTask=!1},addTask:function(item){this.taskList.push(item),this.hasTask||this.processTask()},processTask:function(){var item,self=this;this.taskList.length>0&&(this.hasTask=!0,(item=this.taskList.shift()).isLoadComplete()?this.processComplete():(void 0===(self=this).completeHandler&&(self.completeHandler=function(){self.processComplete()}),$(item).off("complete error",self.completeHandler),$(item).on("complete error",self.completeHandler),item.load()))},processComplete:function(){this.hasTask=!1,this.processTask()}}),SQSManager=Backbone.Model.extend({initialize:function(){FSWidgetModel.gi().get("isDownload")||(Backbone.Mediator.sub(WidgetEvent.SEND_SQS_MAIL,this.onSendMail,this),Backbone.Mediator.sub(WidgetEvent.SEND_LEAD_FORM,this.onSendFormData,this),Backbone.Mediator.sub(StatsEvents.SEND_STATS,this.onSendStats,this))},onSendMail:function(d){this.pushMessage({type:"paypal-email",data:this.appendOrigin(d)},URLPaths.SQS_WIDGET_QUEUE,"POST")},onSendFormData:function(d){this.pushMessage({type:"lead-form",data:this.appendOrigin(d)},URLPaths.SQS_WIDGET_QUEUE,"POST")},appendOrigin:function(options){return _.extend(options,FSWidgetModel.gi().get("isWhiteLabel")?{origin:"whitelabel"}:{})},onSendStats:function(statsData){this.pushMessage(statsData,URLPaths.SQS_STATS_QUEUE)},pushMessage:function(message,queue,requestMethod){var method=requestMethod||"GET",payload={Action:"SendMessage",MessageBody:JSON.stringify(message)},ajaxConfig={type:requestMethod,url:queue+("GET"===method?"?"+$.param(payload):"")};"POST"===requestMethod&&(ajaxConfig.data=payload),$.ajax(ajaxConfig)}});SQSManager._instance=null,SQSManager.gi=function(){return SQSManager._instance||(SQSManager._instance=new SQSManager),SQSManager._instance},function($){"use strict";window.ShelfUtils||(window.ShelfUtils={}),window.ShelfUtils={loadShelfItem:function(hashId,sendLoadEvent){if(!FSUtils.isIOS()){var jsonUrl=FlipSnackEmbed.urls.collectionJSON+hashId;$.getJSON(jsonUrl,"",function(e){sendLoadEvent(e)}).fail(ShelfUtils.loadShelfItemError)}},loadShelfItemError:function(){var mainContainer=$("#fsw");$(mainContainer).append($('<div class="fsw-embedmsg-container"></div>').append($('<p class="fsw-embed-message">There was an error loading the collection. Please try again later.</p>')))}}}(jQuery),function(){"use strict";window.URLPaths||(window.URLPaths={}),window.URLPaths={LOCAL_PATH:"widget.flipsnack.io",DEV_PATH:"stage.site.flipsnack.net",LIVE_PATH:"www.flipsnack.com",CDN_DEV:"cdn.flipsnack.net",CDN_LIVE:"cdn.flipsnack.com",CONTENT_DEV:"content.flipsnack.net",CONTENT_LIVE:"content.flipsnack.com",CDN_DEV_WHITELABEL:"d3hnuexrnaisrd.cloudfront.net",CDN_LIVE_WHITELABEL:"dgbgkkl7v688n.cloudfront.net",S3_DEV:"s3-eu-central-1.amazonaws.com",S3_DEV_SNACKTOOLS:"devfiles.snacktools.net",DEV_CLOUDFRONT:"d1dc988o4ywp3l.cloudfront.net",S3_LIVE:"files.flipsnack.net",LIVE_CLOUDFRONT:"d1dhn91mufybwl.cloudfront.net",S3_DEV_WHITELABEL:"devfiles.enterprise.flipsnack.net.s3.amazonaws.com",S3_LIVE_WHITELABEL:"dgbgkkl7v688n.cloudfront.net",EC3:"",HASH_ID:"",TEMPLATE_HASH_ID:"",BASE:"",BASE_FILES_PATH:"",COLLECTIONS_PATH:"",COVER_IMAGE:"",COVER_PATH:"",ASSETS_PATH:"",DIRECT_LINK:"",DIRECT_FULLSCREEN_LINK:"",ORIGINAL_IMAGE:"",THUMB_IMAGE:"",SMALL_IMAGE:"",MEDIUM_IMAGE:"",LARGE_IMAGE:"",TYPE:"",UPLOADS_PATH:"",HYPERLINK_UPLOADED_IMAGES_PATH:"",HYPERLINK_TEXTURE_IMAGES_PATH:"",HYPERLINK_STOCK_IMAGES_PATH:"",PAYPAL_NOTIFY_URL:"",PAYPAL_URL:"",COUNTRIES_URL:"",PREMIUM_LAYOUTS_URL:"",STATS_URL:"",SQS_URL:"",YOUTUBE_THUMB_URL:"",SVG_SHAPE_URL:"",SVG_ICON_URL:"",SQS_WIDGET_QUEUE:"",SQS_STATS_QUEUE:"",FONT_PATH:"",init:function(options){var embedLocation=location.host;this.isDownload=options.isDownload,this.collectionHashId=options.collectionHash,this.isDev=embedLocation.indexOf(this.DEV_PATH)>-1||embedLocation.indexOf(this.LOCAL_PATH)>-1||embedLocation.indexOf(this.S3_DEV)>-1&&0===location.pathname.indexOf("/flipsnack-dev")||embedLocation.indexOf(this.S3_DEV_SNACKTOOLS)>-1||embedLocation.indexOf(this.CDN_DEV)>-1||embedLocation.indexOf(this.S3_DEV_WHITELABEL)>-1||embedLocation.indexOf(this.CDN_DEV_WHITELABEL)>-1||embedLocation.indexOf(this.DEV_CLOUDFRONT)>-1||embedLocation.indexOf("192.168.0")>-1,this.isDev||(this.isDev=embedLocation.indexOf("flipsnack")>=0&&-1===embedLocation.indexOf("flipsnack.com")&&-1===embedLocation.indexOf(this.S3_LIVE)&&-1===embedLocation.indexOf(this.CDN_LIVE)&&-1===embedLocation.indexOf(this.S3_LIVE_WHITELABEL)&&-1===embedLocation.indexOf(this.LIVE_CLOUDFRONT)&&-1===embedLocation.indexOf(this.CDN_LIVE_WHITELABEL)),options.isWhiteLabel?(this.isDev?(this.BASE="//enterprise.dev.flipsnack.net",this.EC3="http://ec3dev.snacktools.net",this.BASE_FILES_PATH=options.useCDN?"//"+this.CDN_DEV_WHITELABEL:"http://"+this.S3_DEV_WHITELABEL,this.PAYPAL_URL="https://www.sandbox.paypal.com/cgi-bin/webscr",this.SQS_URL="https://sqs.eu-central-1.amazonaws.com/756737886395/",this.SQS_WIDGET_QUEUE=this.SQS_URL+"flip-dev-widget-queue",this.SQS_STATS_QUEUE=this.SQS_URL+"flip-dev-stats-queue",this.CONTENT_PATH="https://"+this.CONTENT_DEV):(this.BASE="//flipsnackenterprise.com",this.EC3="http://ec3.snacktools.net",this.BASE_FILES_PATH="//"+this.CDN_LIVE_WHITELABEL,this.PAYPAL_URL="https://www.paypal.com/cgi-bin/webscr",this.SQS_URL="https://sqs.us-east-1.amazonaws.com/756737886395/",this.SQS_WIDGET_QUEUE=this.SQS_URL+"flip-widget-queue",this.SQS_STATS_QUEUE=this.SQS_URL+"wlstats-flip",this.CONTENT_PATH="https://"+this.CONTENT_LIVE),this.DOWNLOAD_PATH_SUFFIX="&wl=1"):(this.isCloudFront(embedLocation)&&(this.CDN_DEV=this.DEV_CLOUDFRONT),this.isDev?(this.BASE="//site.flipsnack.net",this.EC3="http://ec3dev.snacktools.net",this.BASE_FILES_PATH=options.useCDN?"//"+this.CDN_DEV:"http://"+this.S3_DEV,this.CONTENT_PATH="https://"+this.CONTENT_DEV,this.PAYPAL_URL="https://www.sandbox.paypal.com/cgi-bin/webscr",this.SQS_URL="https://sqs.eu-central-1.amazonaws.com/756737886395/",this.SQS_WIDGET_QUEUE=this.SQS_URL+"flip-dev-widget-queue",this.SQS_STATS_QUEUE=this.SQS_URL+"flip-dev-stats-queue"):(this.BASE="//www.flipsnack.com",this.EC3="http://ec3.snacktools.net",this.BASE_FILES_PATH="//"+this.CDN_LIVE,this.CONTENT_PATH="https://"+this.CONTENT_LIVE,this.PAYPAL_URL="https://www.paypal.com/cgi-bin/webscr",this.SQS_URL="https://sqs.us-east-1.amazonaws.com/756737886395/",this.SQS_WIDGET_QUEUE=this.SQS_URL+"flip-widget-queue",this.SQS_STATS_QUEUE=this.SQS_URL+"flip-stats-queue"),this.DOWNLOAD_PATH_SUFFIX=""),this.DIRECT_LINK="https:"+this.BASE+"/flips/"+this.collectionHashId,this.isDownload?(this.BASE_FILES_PATH=options.resourcePath&&options.resourcePath.length?options.resourcePath+"/":"",this.ASSETS_PATH=options.resourcePath&&options.resourcePath.length?options.resourcePath+"/":"collections/assets/",this.COLLECTION_CONTENT=this.BASE_FILES_PATH,this.EXTERNAL_CONTENT=this.BASE_FILES_PATH):(this.BASE_FILES_PATH+="/",this.ASSETS_PATH=this.BASE_FILES_PATH+"widget/assets/",this.COLLECTION_CONTENT=this.CONTENT_PATH+"/{accountId}/collections/{hash}/",this.EXTERNAL_CONTENT=this.CONTENT_PATH+"/{accountId}/library/external/"),this.COLLECTIONS_PATH=this.BASE_FILES_PATH+"collections/",this.ITEMS_BASE_PATH=this.COLLECTIONS_PATH+"items/",this.UPLOADS_PATH=this.BASE_FILES_PATH+"collections/uploads/",this.HYPERLINK_UPLOADED_IMAGES_PATH=this.BASE_FILES_PATH+"collections/uploads/",this.HYPERLINK_STOCK_IMAGES_PATH=this.BASE_FILES_PATH+"collections/resources/images/high/",this.HYPERLINK_PROVIDERS_IMAGES_PATH=this.BASE_FILES_PATH+"collections/resources/images/saved/",this.HYPERLINK_TEXTURE_IMAGES_PATH=this.BASE_FILES_PATH+"collections/resources/images/high/",this.COUNTRIES_URL=this.BASE_FILES_PATH+"templates/countries.gz.js",this.PAYPAL_NOTIFY_URL=this.BASE+"/scripts/paypal_ipn.php",this.PREMIUM_LAYOUTS_URL=this.BASE_FILES_PATH+"templates/premium-layouts.gz.js",this.STATS_URL=this.BASE+"/scripts/stats/send-data.php",this.YOUTUBE_THUMB_URL="https://i.ytimg.com/vi/",this.COVER_PATH=this.ITEMS_BASE_PATH+this.collectionHashId+"/covers/",this.COVER_IMAGE=this.COVER_PATH+"page_1"+(this.isDownload?".jpg":""),this.ORIGINAL_IMAGE=this.COVER_PATH+"{page}/original"+(this.isDownload?".jpg":""),this.THUMB_IMAGE=this.COVER_PATH+"{page}/thumb"+(this.isDownload?".jpg":""),this.SMALL_IMAGE=this.COVER_PATH+"{page}/small"+(this.isDownload?".jpg":""),this.MEDIUM_IMAGE=this.COVER_PATH+"{page}/medium"+(this.isDownload?".jpg":""),this.SVG_SHAPE_URL=this.BASE_FILES_PATH+"resources/svg/",this.SVG_ICON_URL=this.BASE_FILES_PATH+"resources/icons/",this.FONT_PATH=this.BASE_FILES_PATH+"collections/uploads/"},isCloudFront:function(embedLocation){return embedLocation.indexOf(this.DEV_CLOUDFRONT)>-1||embedLocation.indexOf(this.LIVE_CLOUDFRONT)>-1},getLinksForItem:function(hid){var coverPath=this.COLLECTIONS_PATH+"items/"+hid+"/covers/";return{COLLECTIONS_PATH:this.COLLECTIONS_PATH,COVER_IMAGE:coverPath+"page_1"+(this.isDownload?".jpg":""),ORIGINAL_IMAGE:coverPath+"{page}/original"+(this.isDownload?".jpg":""),THUMB_IMAGE:coverPath+"{page}/thumb"+(this.isDownload?".jpg":""),SMALL_IMAGE:coverPath+"{page}/small"+(this.isDownload?".jpg":""),MEDIUM_IMAGE:coverPath+"{page}/medium"+(this.isDownload?".jpg":"")}}}}();var initializing=!1,fnTest=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;function rgbToHsl(rParam,gParam,bParam){var h,s,r=rParam/255,g=gParam/255,b=bParam/255,max=Math.max(r,g,b),min=Math.min(r,g,b),l=(max+min)/2;if(max===min)h=s=0;else{var d=max-min;switch(s=l>.5?d/(2-max-min):d/(max+min),max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4}h/=6}return{h:h,s:s,l:l}}function hexToRgb(hex){var value,rgb=[];if(7!==hex.length){if((hex=hex.match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/)).shift(),3!==hex.length)return null;for(var i=0;i<3;i++)1===(value=hex[i]).length&&(value+=value),rgb.push(parseInt(value,16))}else rgb=[(hex=parseInt(hex.slice(1),16))>>16,hex>>8&255,255&hex];return{r:rgb[0],g:rgb[1],b:rgb[2]}}function isLightColor(hex){var rgb=hexToRgb(hex);return!!rgb&&rgbToHsl(rgb.r,rgb.g,rgb.b).l>.5}this.Class=function(){},Class.extend=function(prop){var prototype,name,_super=this.prototype;for(name in initializing=!0,prototype=new this,initializing=!1,prop)prototype[name]="function"==typeof prop[name]&&"function"==typeof _super[name]&&fnTest.test(prop[name])?function(name,fn){return function(){var ret,tmp=this._super;return this._super=_super[name],ret=fn.apply(this,arguments),this._super=tmp,ret}}(name,prop[name]):prop[name];function Class(){!initializing&&this.create&&this.create.apply(this,arguments)}return Class.prototype=prototype,Class.prototype.constructor=Class,Class.extend=arguments.callee,Class};var CryptoJS=CryptoJS||function(e,m){var p={},j=p.lib={},l=function(){},f=j.Base={extend:function(a){l.prototype=this;var c=new l;return a&&c.mixIn(a),c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)}),c.init.prototype=c,c.$super=this,c},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var c in a)a.hasOwnProperty(c)&&(this[c]=a[c]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},n=j.WordArray=f.extend({init:function(a,c){a=this.words=a||[],this.sigBytes=void 0!=c?c:4*a.length},toString:function(a){return(a||h).stringify(this)},concat:function(a){var c=this.words,q=a.words,d=this.sigBytes;if(a=a.sigBytes,this.clamp(),d%4)for(var b=0;b<a;b++)c[d+b>>>2]|=(q[b>>>2]>>>24-b%4*8&255)<<24-(d+b)%4*8;else if(65535<q.length)for(b=0;b<a;b+=4)c[d+b>>>2]=q[b>>>2];else c.push.apply(c,q);return this.sigBytes+=a,this},clamp:function(){var a=this.words,c=this.sigBytes;a[c>>>2]&=4294967295<<32-c%4*8,a.length=e.ceil(c/4)},clone:function(){var a=f.clone.call(this);return a.words=this.words.slice(0),a},random:function(a){for(var c=[],b=0;b<a;b+=4)c.push(4294967296*e.random()|0);return new n.init(c,a)}}),b=p.enc={},h=b.Hex={stringify:function(a){var c=a.words;a=a.sigBytes;for(var b=[],d=0;d<a;d++){var f=c[d>>>2]>>>24-d%4*8&255;b.push((f>>>4).toString(16)),b.push((15&f).toString(16))}return b.join("")},parse:function(a){for(var c=a.length,b=[],d=0;d<c;d+=2)b[d>>>3]|=parseInt(a.substr(d,2),16)<<24-d%8*4;return new n.init(b,c/2)}},g=b.Latin1={stringify:function(a){var c=a.words;a=a.sigBytes;for(var b=[],d=0;d<a;d++)b.push(String.fromCharCode(c[d>>>2]>>>24-d%4*8&255));return b.join("")},parse:function(a){for(var c=a.length,b=[],d=0;d<c;d++)b[d>>>2]|=(255&a.charCodeAt(d))<<24-d%4*8;return new n.init(b,c)}},r=b.Utf8={stringify:function(a){try{return decodeURIComponent(escape(g.stringify(a)))}catch(c){throw Error("Malformed UTF-8 data")}},parse:function(a){return g.parse(unescape(encodeURIComponent(a)))}},k=j.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new n.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=r.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(a){var c=this._data,b=c.words,d=c.sigBytes,f=this.blockSize,h=d/(4*f);if(a=(h=a?e.ceil(h):e.max((0|h)-this._minBufferSize,0))*f,d=e.min(4*a,d),a){for(var g=0;g<a;g+=f)this._doProcessBlock(b,g);g=b.splice(0,a),c.sigBytes-=d}return new n.init(g,d)},clone:function(){var a=f.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0});j.Hasher=k.extend({cfg:f.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){k.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){return a&&this._append(a),this._doFinalize()},blockSize:16,_createHelper:function(a){return function(c,b){return new a.init(b).finalize(c)}},_createHmacHelper:function(a){return function(b,f){return new s.HMAC.init(a,f).finalize(b)}}});var s=p.algo={};return p}(Math);!function(){var e=CryptoJS,p=(m=e.lib).WordArray,j=m.Hasher,l=[],m=e.algo.SHA1=j.extend({_doReset:function(){this._hash=new p.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(f,n){for(var b=this._hash.words,h=b[0],g=b[1],e=b[2],k=b[3],j=b[4],a=0;80>a;a++){if(16>a)l[a]=0|f[n+a];else{var c=l[a-3]^l[a-8]^l[a-14]^l[a-16];l[a]=c<<1|c>>>31}c=(h<<5|h>>>27)+j+l[a],c=20>a?c+(1518500249+(g&e|~g&k)):40>a?c+(1859775393+(g^e^k)):60>a?c+((g&e|g&k|e&k)-1894007588):c+((g^e^k)-899497514),j=k,k=e,e=g<<30|g>>>2,g=h,h=c}b[0]=b[0]+h|0,b[1]=b[1]+g|0,b[2]=b[2]+e|0,b[3]=b[3]+k|0,b[4]=b[4]+j|0},_doFinalize:function(){var f=this._data,e=f.words,b=8*this._nDataBytes,h=8*f.sigBytes;return e[h>>>5]|=128<<24-h%32,e[14+(h+64>>>9<<4)]=Math.floor(b/4294967296),e[15+(h+64>>>9<<4)]=b,f.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var e=j.clone.call(this);return e._hash=this._hash.clone(),e}});e.SHA1=j._createHelper(m),e.HmacSHA1=j._createHmacHelper(m)}(),function(h){for(var s=CryptoJS,g=(f=s.lib).WordArray,q=f.Hasher,f=s.algo,m=[],r=[],l=function(a){return 4294967296*(a-(0|a))|0},k=2,n=0;64>n;){var j;a:{j=k;for(var u=h.sqrt(j),t=2;t<=u;t++)if(!(j%t)){j=!1;break a}j=!0}j&&(8>n&&(m[n]=l(h.pow(k,.5))),r[n]=l(h.pow(k,1/3)),n++),k++}var a=[];f=f.SHA256=q.extend({_doReset:function(){this._hash=new g.init(m.slice(0))},_doProcessBlock:function(c,d){for(var b=this._hash.words,e=b[0],f=b[1],g=b[2],j=b[3],h=b[4],m=b[5],n=b[6],q=b[7],p=0;64>p;p++){if(16>p)a[p]=0|c[d+p];else{var k=a[p-15],l=a[p-2];a[p]=((k<<25|k>>>7)^(k<<14|k>>>18)^k>>>3)+a[p-7]+((l<<15|l>>>17)^(l<<13|l>>>19)^l>>>10)+a[p-16]}k=q+((h<<26|h>>>6)^(h<<21|h>>>11)^(h<<7|h>>>25))+(h&m^~h&n)+r[p]+a[p],l=((e<<30|e>>>2)^(e<<19|e>>>13)^(e<<10|e>>>22))+(e&f^e&g^f&g),q=n,n=m,m=h,h=j+k|0,j=g,g=f,f=e,e=k+l|0}b[0]=b[0]+e|0,b[1]=b[1]+f|0,b[2]=b[2]+g|0,b[3]=b[3]+j|0,b[4]=b[4]+h|0,b[5]=b[5]+m|0,b[6]=b[6]+n|0,b[7]=b[7]+q|0},_doFinalize:function(){var a=this._data,d=a.words,b=8*this._nDataBytes,e=8*a.sigBytes;return d[e>>>5]|=128<<24-e%32,d[14+(e+64>>>9<<4)]=h.floor(b/4294967296),d[15+(e+64>>>9<<4)]=b,a.sigBytes=4*d.length,this._process(),this._hash},clone:function(){var a=q.clone.call(this);return a._hash=this._hash.clone(),a}}),s.SHA256=q._createHelper(f),s.HmacSHA256=q._createHmacHelper(f)}(Math),function(){var h=CryptoJS,s=h.enc.Utf8;h.algo.HMAC=h.lib.Base.extend({init:function(f,g){f=this._hasher=new f.init,"string"==typeof g&&(g=s.parse(g));var h=f.blockSize,m=4*h;g.sigBytes>m&&(g=f.finalize(g)),g.clamp();for(var r=this._oKey=g.clone(),l=this._iKey=g.clone(),k=r.words,n=l.words,j=0;j<h;j++)k[j]^=1549556828,n[j]^=909522486;r.sigBytes=l.sigBytes=m,this.reset()},reset:function(){var f=this._hasher;f.reset(),f.update(this._iKey)},update:function(f){return this._hasher.update(f),this},finalize:function(f){var g=this._hasher;return f=g.finalize(f),g.reset(),g.finalize(this._oKey.clone().concat(f))}})}();var CollectionItem=Backbone.Model.extend({defaults:{hash:"",title:"",description:"",hardCover:!1,noOfPages:1,hasCustomPages:!1,onlyCustomPages:!1,hasMovedPages:!1,imagesOnly:!1,extension:"pdf",blocked:!1,pages:void 0,forms:[]},addBlankPage:function(isArabicStyle,atIndex){var pageIndex=null!=atIndex?atIndex:this.get("pages").length,lastPage=new PageData({type:PageType.EMPTY_PAGE,width:this.get("pages").at(0).get("width"),height:this.get("pages").at(0).get("height"),itemHash:this.get("pages").at(0).get("itemHash"),pageIndex:pageIndex});null!=atIndex?this.get("pages").add(lastPage,{at:atIndex}):this.get("pages").add(lastPage,isArabicStyle?{at:0}:void 0)},destroy:function(){this.get("pages").reset()}}),CountryList=Backbone.Model.extend({defaults:{countries:[],countryOptions:""},initialize:function(){this.loading=!1,this.loaded=!1,this.loadContryList()},loadContryList:function(){var self=this;this.loading||(this.loading=!0,window.fs_countries=function(data){data&&data.countries&&data.countries.length?self.setCountryList(data.countries):self.setCountryList(CountryList.DEFAULT)},FSUtils.loadScript(URLPaths.COUNTRIES_URL,function(){},function(){self.setCountryList(CountryList.DEFAULT)}))},setCountryList:function(countryList){var options=this.createCountryOptionsList(countryList);this.set({countries:countryList,countryOptions:options}),this.loading=!1,this.loaded=!0},createCountryOptionsList:function(list){return list.map(function(country){return'<option value="'+country+'">'+country+"</option>"}).join("")}});CountryList.DEFAULT=["--"];var CustomElement=Backbone.Model.extend({defaults:{type:0,action:0,bounds:"",color:"807F7D",eID:0}}),Links=Backbone.Collection.extend({model:CustomElement}),FSWidgetModel=Backbone.Model.extend({defaults:{viewIDPrefix:"fsw_widget_",collectionHash:"",widgetSuffix:"",isDownload:!1,exportName:"",isMobileDevice:!1,openPayPalIndex:void 0,showLimit:!1,isDetailsPage:!1,blockEvents:!1,noWatermark:!0,isPublisher:!0,location:"",randomVal:"",width:640,height:385,forceSmall:!1,forceWidget:!1,collectionData:{},sandBoxType:"live",ip:"",logo:{},allowBrowserFullScreen:!1,labels:{l_thumbnails:"View thumbnails",l_download:"Download",l_print:"Print",l_enter_fs:"View in full screen",l_exit_fs:"Exit full screen",l_mute:"Turn off sounds",l_unmute:"Turn on sounds",l_prev_page:"Go to previous page",l_next_page:"Go to next page",l_click_to_read:"Fullscreen",l_click_to_zoom:"Double-click to zoom",l_nextLabelText:"Next",l_prevLabelText:"Previous",l_pages:"pages",l_page:"page",l_download_one:"Download current file",l_download_all:"Download entire collection",l_files:"files",l_search:"Search",l_resultsFound:"# results found",l_playerResults:"# results",l_pageSearch:"Page #",l_share:"Share",l_click_to_open:"Click to open",l_click_to_close:"Click to close",l_password:"Password",l_password_text:"The flipbook youre trying to access is password protected.",l_password_text_whitelabel:"The publication youre trying to access is password protected.",l_incorrect_password:"Incorrect password",l_enter:"Enter",l_zoom:"Zoom",l_toc:"Table of contents",l_cortina_message:"Unlock the full version of",l_single_flipbook:"Buy single issue",l_subscription:"Subscribe to",l_issues:"issues",l_buy:"buy"},premiumLayouts:[],useCDN:!0,mainContentWidth:0,retryFirstItem:!1,isWhiteLabel:!1,currentZoom:0,maxZoomValue:0,textDirection:TextDirection.LEFT_TO_RIGHT,firstPageThumb:"",userProfile:"",linkName:"",sell:{price:"",subscriptionPrice:"",subscriptionFlipbooks:0,previewPages:[],buyLink:""},isForSelling:!1,isInSubscription:!1,author:"",sellSettingsPage:!1,resourcePath:""},initialize:function(options){var startPageIndex,startBookIndex,obj,initialMergeSetting,shelfOpened=options.collectionData.shelfData&&options.collectionData.shelfData.shelfOpened;Backbone.Mediator.pub(WidgetEvent.INIT_CONFIG),URLPaths.init({useCDN:this.get("useCDN"),isDownload:this.get("isDownload"),collectionHash:this.get("collectionHash"),isWhiteLabel:this.get("isWhiteLabel"),resourcePath:this.get("resourcePath")}),this.widgetSettings=new WidgetSettings(this.get("collectionData").params),this.get("isWhiteLabel")&&this.widgetSettings.set("enableDownload",!1),initialMergeSetting=this.widgetSettings.get("mergePdfs"),this.singlePageView=this.widgetSettings.get("singlePageView"),this.arabicStyle=this.widgetSettings.get("arabicStyle"),this.isAutomatorOpen=!1,options.collectionData.sell&&options.collectionData.sell.price&&options.collectionData.sell.price.length&&(this.set("sell",options.collectionData.sell),this.set("isForSelling",!0),options.collectionData.sell.subscriptionPrice&&this.set("isInSubscription",!0)),options.collectionData.userProfile&&options.collectionData.userProfile.length&&this.set("userProfile",options.collectionData.userProfile),options.collectionData.linkName&&options.collectionData.linkName.length&&this.set("linkName",options.collectionData.linkName),options.collectionData.author&&options.collectionData.author.length&&this.set("author",options.collectionData.author),this.widgetSettings.set("mergePdfs",!0),""!==this.widgetSettings.get("language")&&""!==this.widgetSettings.get("language")||this.set("textDirection",TextDirection.RIGHT_TO_LEFT),this.set("sellSettingsPage",options.sellSettingsPage),shelfOpened?this.set("shelfData",new ShelfData(options.collectionData.shelfData)):(this.get("shelfData")&&this.set("shelfData",options.collectionData.shelfData),this.flipCollection=new FlipCollection({noOfItems:1,hash:this.get("collectionHash"),title:this.get("collectionData").title,watermark:this.get("collectionData").watermark,type:this.get("collectionData").albumType,publisher:this.get("collectionData").publisher,password:this.get("collectionData").security||"",mergePdfs:this.widgetSettings.get("mergePdfs"),arabicStyle:this.arabicStyle,singlePageView:this.singlePageView,collection:[].concat(this.get("collectionData").collection),resourceVersion:this.get("collectionData").resourceVersion,enableHardCover:this.widgetSettings.get("enableHardCover"),maxFlipPages:options.features.FLIP_PAGES?options.features.FLIP_PAGES:-1,previewPages:this.get("isForSelling")?this.get("sell").previewPages:[],exportVideo:this.widgetSettings.get("exportVideo"),isDoublePageLayout:this.widgetSettings.get("contentLayout")===ContentLayout.DOUBLE_PAGE}),this.flipCollection2=new FlipCollection({noOfItems:1,hash:this.get("collectionHash"),title:this.get("collectionData").title,watermark:this.get("collectionData").watermark,type:this.get("collectionData").albumType,publisher:this.get("collectionData").publisher,password:this.get("collectionData").security||"",mergePdfs:initialMergeSetting,arabicStyle:this.arabicStyle,singlePageView:this.singlePageView,collection:[].concat(this.get("collectionData").collection),resourceVersion:this.get("collectionData").resourceVersion,enableHardCover:this.widgetSettings.get("enableHardCover"),maxFlipPages:options.features.FLIP_PAGES?options.features.FLIP_PAGES:-1,exportVideo:this.widgetSettings.get("exportVideo")})),!options.startBook&&!options.startPage||shelfOpened?(startBookIndex=0,startPageIndex=this.arabicStyle?this.flipCollection.get("items").at(startBookIndex).get("pages").length-1:0):(startBookIndex=(obj=this.getStartItem(options.startBook,options.startPage)).itemIndex,startPageIndex=obj.pageIndex),this.setItem(startBookIndex,startPageIndex,options),this.autoFlipTimeoutId=null,this.autoFlip=this.widgetSettings.get("autoFlip"),this.autoFlipDelay=this.widgetSettings.get("autoFlipDelay"),this.isAudioPlaying=!1,this.autoFlip&&this.setAutoFlip(),this.get("shelfData")&&this.get("shelfData").get("shelfOpened")||(this.collectionUsesCountries=this.flipCollection.hasCountryList(),this.collectionUsesCountries&&(this.countries=new CountryList,this.listenTo(this.countries,"change",this.countriesUpdated))),Backbone.Mediator.sub(WidgetEvent.NEXT_PAGE,this.goNextPage,this),Backbone.Mediator.sub(WidgetEvent.PREV_PAGE,this.goPreviousPage,this),Backbone.Mediator.sub(WidgetEvent.CHANGE_PAGE,this.jumpToPage,this),Backbone.Mediator.sub(WidgetEvent.PAGE_CHANGED,this.setPage,this),Backbone.Mediator.sub(WidgetEvent.NEXT_ITEM,this.goNextItem,this),Backbone.Mediator.sub(WidgetEvent.PREV_ITEM,this.goPreviousItem,this),Backbone.Mediator.sub(WidgetEvent.CHANGE_ITEM,this.jumpToFirstPageOfItem,this),Backbone.Mediator.sub(WidgetEvent.ITEM_VIEW_INIT,this.handleItemViewInitialized,this),Backbone.Mediator.sub(WidgetEvent.LEAD_FORM_SENT,this.handleFormSent,this),Backbone.Mediator.sub(WidgetEvent.AUTO_FLIP,this.goAutoFlip,this),Backbone.Mediator.sub(WidgetEvent.HYPERLINK,this.goToUrl,this),Backbone.Mediator.sub(WidgetEvent.SEND_EMAIL,this.sendEmail,this),Backbone.Mediator.sub(WidgetEvent.OPEN_AUTOMATOR,this.toggleAutomator,this),Backbone.Mediator.sub(WidgetEvent.CLOSE_AUTOMATOR,this.toggleAutomator,this),Backbone.Mediator.sub(WidgetEvent.LEAD_FORM_OPENED,this.stopAutoFlip,this),Backbone.Mediator.sub(WidgetEvent.LEAD_FORM_CLOSED,this.setAutoFlip,this),Backbone.Mediator.sub(WidgetEvent.PAGE_TURN_START,this.stopAutoFlip,this),Backbone.Mediator.sub(WidgetEvent.PAGE_TURN_CANCELED,this.setAutoFlip,this),Backbone.Mediator.sub(WidgetEvent.POPIN_OPEN,this.stopAutoFlip,this),Backbone.Mediator.sub(WidgetEvent.POPIN_CLOSE,this.setAutoFlip,this),Backbone.Mediator.sub(WidgetEvent.WIDGET_CLICK_OR_TAP,this.handleWidgetClickOrTap,this),Backbone.Mediator.sub(WidgetEvent.CHANGE_ZOOM,this.changeZoom,this),Backbone.Mediator.sub(WidgetEvent.FULLSCREEN_CHANGED,this.resetZoom,this),Backbone.Mediator.sub(NewShelfEvents.OPEN_ITEM,this.newShelfOpenItem,this),Backbone.Mediator.sub(NewShelfEvents.ITEM_LOADED,this.newShelfItemLoaded,this),Backbone.Mediator.sub("audioStarted",this.stopAutoFlip,this),Backbone.Mediator.sub("audioStopped",this.handleAudioStopped,this),Backbone.Mediator.sub("captionOpened",this.stopAutoFlip,this),Backbone.Mediator.sub("customContentClick",this.stopAutoFlip,this),this.listenTo(this.widgetSettings,"change:autoFlip",this.updateAutoFlip),this.listenTo(this.widgetSettings,"change:autoFlipDelay",this.updateAutoFlip),this.listenTo(this.widgetSettings,"change:singlePageView",this.singlePageChanged),this.listenTo(this.widgetSettings,"change:language",this.updateLanguageSettings),this.listenTo(this,"change:maxZoomValue",this.handleMaxZoomChange),this.listenTo(this,"change:currentZoom",this.handleZoomChange),this.listenTo(this,"change:sell",this.updateSellSettings)},destroy:function(){Backbone.Mediator.unsubscribe(WidgetEvent.NEXT_PAGE,this.goNextPage,this),Backbone.Mediator.unsubscribe(WidgetEvent.PREV_PAGE,this.goPreviousPage,this),Backbone.Mediator.unsubscribe(WidgetEvent.CHANGE_PAGE,this.jumpToPage,this),Backbone.Mediator.unsubscribe(WidgetEvent.PAGE_CHANGED,this.setPage,this),Backbone.Mediator.unsubscribe(WidgetEvent.NEXT_ITEM,this.goNextItem,this),Backbone.Mediator.unsubscribe(WidgetEvent.PREV_ITEM,this.goPreviousItem,this),Backbone.Mediator.unsubscribe(WidgetEvent.CHANGE_ITEM,this.jumpToFirstPageOfItem,this),Backbone.Mediator.unsubscribe(WidgetEvent.ITEM_VIEW_INIT,this.handleItemViewInitialized,this),Backbone.Mediator.unsubscribe(WidgetEvent.LEAD_FORM_SENT,this.handleFormSent,this),Backbone.Mediator.unsubscribe(WidgetEvent.AUTO_FLIP,this.goAutoFlip,this),Backbone.Mediator.unsubscribe(WidgetEvent.HYPERLINK,this.goToUrl,this),Backbone.Mediator.unsubscribe(WidgetEvent.SEND_EMAIL,this.sendEmail,this),Backbone.Mediator.unsubscribe(WidgetEvent.LEAD_FORM_OPENED,this.stopAutoFlip,this),Backbone.Mediator.unsubscribe(WidgetEvent.LEAD_FORM_CLOSED,this.setAutoFlip,this),Backbone.Mediator.unsubscribe(WidgetEvent.PAGE_TURN_START,this.stopAutoFlip,this),Backbone.Mediator.unsubscribe(WidgetEvent.PAGE_TURN_CANCELED,this.setAutoFlip,this),Backbone.Mediator.unsubscribe(WidgetEvent.POPIN_OPEN,this.stopAutoFlip,this),Backbone.Mediator.unsubscribe(WidgetEvent.POPIN_CLOSE,this.setAutoFlip,this),Backbone.Mediator.unsubscribe(WidgetEvent.WIDGET_CLICK_OR_TAP,this.handleWidgetClickOrTap,this),Backbone.Mediator.unsubscribe(WidgetEvent.CHANGE_ZOOM,this.changeZoom,this),Backbone.Mediator.unsubscribe(WidgetEvent.EXIT_FULLSCREEN,this.resetZoom,this),Backbone.Mediator.unsubscribe("audioStarted",this.stopAutoFlip,this),Backbone.Mediator.unsubscribe("audioStopped",this.handleAudioStopped,this),Backbone.Mediator.unsubscribe("captionOpened",this.stopAutoFlip,this),Backbone.Mediator.unsubscribe("customContentClick",this.stopAutoFlip,this),Backbone.Mediator.unsubscribe(NewShelfEvents.OPEN_ITEM,this.newShelfOpenItem,this),Backbone.Mediator.unsubscribe(NewShelfEvents.ITEM_LOADED,this.newShelfItemLoaded,this),this.off(),this.stopListening(),clearTimeout(this.autoFlipTimeoutId),this.widgetState=null,this.flipCollection&&this.flipCollection.destroy(),this.get("shelfData")&&this.get("shelfData").destroy(),this.flipCollection2&&this.flipCollection2.destroy(),this.flipCollection=null,this.widgetSettings=null,this.countries&&(this.countries=null),Backbone.Mediator.pub(WidgetEvent.DESTROY)},handleFormSent:function(formData){this.removeForm(formData),this.unblockPage(formData.pageIndex),this.resetCollectionItemBlocked()},unblockPage:function(pageIndex){this.widgetState.get("currentItem").get("pages").at(pageIndex).set({form:null,formCanBlockItem:!1,hasForm:!1})},removeForm:function(formData){var submitedForm=_.find(this.widgetState.get("currentItem").get("forms"),function(item){return item.index===formData.pageIndex}),newFormList=_.without(this.widgetState.get("currentItem").get("forms"),submitedForm);FSWidgetModel.gi().widgetState.get("currentItem").set("forms",newFormList,{silent:!0})},resetCollectionItemBlocked:function(){_.find(this.widgetState.get("currentItem").get("forms"),function(form){return form.formCanBlockItem})||this.widgetState.get("currentItem").set("blocked",!1)},findFirstBlockingPage:function(startFromPage,item){var found=!1,i=startFromPage,end=this.arabicStyle?0:item.get("pages").length,page=item.get("pages").at(i);for(page.get("hasForm")&&page.get("formCanBlockItem")&&(found=!0);!found&&i!==end;)(page=item.get("pages").at(i)).get("hasForm")&&page.get("formCanBlockItem")?found=!0:i=this.arabicStyle?i-1:i+1;return found?i:-1},findFirstBlockedItem:function(startFromItem){var found=!1,i=startFromItem,end=this.flipCollection.get("noOfItems");for(this.flipCollection.get("items").at(i);!found&&i!==end;)this.flipCollection.get("items").at(i).get("blocked")?found=!0:i+=1;return found?i:-1},toggleAutomator:function(automatorView){this.isAutomatorOpen=automatorView.openContainer,this.isAutomatorOpen?this.stopAutoFlip():this.setAutoFlip()},jumpToFirstPageOfItem:function(itemIndex){var noOfPages=this.get("collectionData").collection.reduce(function(pages,currentItem,currentIndex){var itemPages=currentItem.pageData&&currentItem.pageData.length?currentItem.pageData.length:0;return pages+(currentIndex<itemIndex?itemPages:0)},0);this.setPage(this.arabicStyle?this.flipCollection.totalPages-noOfPages-1:noOfPages)},jumpToItem:function(itemIndex){var item,idx,cii=this.widgetState.get("currentItemIndex"),pageIndex=-1;itemIndex!==cii&&(idx=this.findFirstBlockedItem(cii),itemIndex<cii||-1===idx?this.setItem(itemIndex):idx>-1&&(itemIndex<idx?this.setItem(itemIndex):(item=this.flipCollection.get("items").at(idx),pageIndex=this.findFirstBlockingPage(this.arabicStyle?item.get("pages").length-1:0,item),this.setItem(idx,-1===pageIndex?void 0:pageIndex))))},goNextItem:function(){var blockedPage,cii=this.widgetState.get("currentItemIndex"),ci=this.widgetState.get("currentItem");cii<this.flipCollection.get("noOfItems")-1&&(this.widgetSettings.get("arabicStyle")?this.setItem(cii+1):ci.get("blocked")&&(blockedPage=this.findFirstBlockingPage(this.widgetState.get("currentPageIndex"),ci))>=this.widgetState.get("currentPageIndex")?this.setPage(blockedPage):this.setItem(cii+1))},goPreviousItem:function(){var blockedPage,cii=this.widgetState.get("currentItemIndex"),ci=this.widgetState.get("currentItem");cii>0&&(this.widgetSettings.get("arabicStyle")&&ci.get("blocked")&&(blockedPage=this.findFirstBlockingPage(this.widgetState.get("currentPageIndex"),ci))<=this.widgetState.get("currentPageIndex")?this.setPage(blockedPage):this.setItem(cii-1))},setItem:function(itemIndex,pageIndex,options){var newItem,cpi,left,right,widgetStateOptions,displayState=options&&options.fullScreen?DisplayState.CLASSIC_FULLSCREEN:DisplayState.NORMAL,isLargeView=displayState!==DisplayState.NORMAL,leftPageIndex=pageIndex%2==0?Math.max(pageIndex-1,0):pageIndex;this.get("shelfData")&&this.get("shelfData").get("shelfOpened")?this.widgetState?this.widgetState.set({displayState:displayState}):this.widgetState=new WidgetState({displayState:displayState}):itemIndex<0||itemIndex>=this.flipCollection.get("noOfItems")||(newItem=this.flipCollection.get("items").at(itemIndex),pageIndex<0||pageIndex>newItem.get("pages").length-1||(cpi="number"==typeof pageIndex?this.singlePageView?pageIndex:leftPageIndex:this.arabicStyle?newItem.get("pages").length-1:0,this.singlePageView?left=cpi:right=(left=0===cpi?-1:cpi)+1,Backbone.Mediator.pub(WidgetEvent.ITEM_INIT,{previousItemIndex:this.widgetState?this.widgetState.get("currentItemIndex"):void 0,previousItem:this.widgetState?this.widgetSettings.get("currentItem"):void 0,newItemIndex:itemIndex,newItem:newItem}),widgetStateOptions={currentItemIndex:itemIndex,currentItem:newItem,currentPageIndex:cpi,leftPageIndex:left,rightPageIndex:right},this.widgetState?this.widgetState.set(widgetStateOptions):(_.extend(widgetStateOptions,{displayState:displayState,widgetType:this.get("forceWidget")?WidgetType.CLASSIC:this.widgetSettings.get("widgetType"),displayType:isLargeView?DisplayType.LARGE:DisplayType.SMALL}),this.widgetState=new WidgetState(widgetStateOptions)),Backbone.Mediator.pub(WidgetEvent.ITEM_CHANGED),this.resetZoom()))},getStartItem:function(startBook,startPage){var itemIdx,pageIdx,item,totalPages,totalItems=this.flipCollection.get("noOfItems");return startBook="number"!=typeof startBook?0:(startBook-=1)<0?0:startBook>=totalItems?totalItems-1:startBook,totalPages=(item=this.flipCollection.get("items").at(startBook)).get("pages").length,startPage="number"!=typeof startPage?this.arabicStyle?totalPages-1:0:(startPage-=1)<0?0:startPage>=totalPages?totalPages-1:startPage,(itemIdx=this.findFirstBlockedItem(0))>-1&&itemIdx<startBook?(totalPages=(item=this.flipCollection.get("items").at(itemIdx)).get("pages").length,pageIdx=(pageIdx=this.findFirstBlockingPage(this.arabicStyle?totalPages-1:0,item))>-1?pageIdx:startPage):(itemIdx=startBook,((pageIdx=this.findFirstBlockingPage(this.arabicStyle?totalPages-1:0,item))<0||pageIdx>-1&&(this.arabicStyle&&pageIdx<startPage||!this.arabicStyle&&pageIdx>startPage))&&(pageIdx=startPage)),{itemIndex:itemIdx,pageIndex:pageIdx}},setPage:function(pageIndex){var right,cpi=pageIndex,left=pageIndex;!this.widgetState||pageIndex<0||pageIndex>this.widgetState.get("currentItem").get("pages").length-1||pageIndex===this.widgetState.get("currentPageIndex")||(this.singlePageView||(right=(left=0===(cpi=pageIndex%2==0?Math.max(pageIndex-1,0):pageIndex)?cpi-1:cpi)+1),this.widgetState.set({currentPageIndex:cpi,leftPageIndex:left,rightPageIndex:right}),this.isAudioPlaying=!1,this.setAutoFlip(),0===pageIndex||pageIndex===this.widgetState.get("currentItem").get("pages").length-1?this.registerPageViewEvent(this.widgetState.get("currentItem").get("pages").at(pageIndex).get("pID")):this.registerPageViewEvent([this.widgetState.get("currentItem").get("pages").at(pageIndex).get("pID"),this.widgetState.get("currentItem").get("pages").at(pageIndex+1).get("pID")]))},jumpToPage:function(pageIndex){var item=this.widgetState.get("currentItem"),cpi=this.widgetState.get("currentPageIndex"),idx=this.findFirstBlockingPage(cpi,item);idx>-1&&(this.arabicStyle&&idx>pageIndex||!this.arabicStyle&&idx<pageIndex)&&(pageIndex=idx),this.setPage(pageIndex)},goNextPage:function(){var ci=this.widgetState.get("currentItem"),cpi=this.widgetState.get("currentPageIndex"),currentPage=ci.get("pages").at(cpi),totalPages=ci.get("pages").length,nextPage=ci.get("pages").at(cpi+1);"string"==typeof FSWidgetModel.gi().get("collectionData").trackingId&&FSWidgetModel.gi().get("collectionData").trackingId.length&&!FlipSnackEmbed.isEditor&&Tracker.ga(FSWidgetModel.gi().get("collectionHash"),"Next"),cpi<totalPages-1&&(this.singlePageView?!this.arabicStyle&&currentPage.get("formCanBlockItem")||this.setPage(cpi+1):(this.arabicStyle||!currentPage.get("formCanBlockItem")&&(currentPage.get("pageIndex")%2==0||!nextPage||nextPage&&!nextPage.get("formCanBlockItem")))&&this.setPage(0===cpi?cpi+1:Math.min(cpi+2,totalPages-1)))},goPreviousPage:function(){var ci=this.widgetState.get("currentItem"),cpi=this.widgetState.get("currentPageIndex"),currentPage=ci.get("pages").at(cpi),nextPage=ci.get("pages").at(cpi+1);"string"==typeof FSWidgetModel.gi().get("collectionData").trackingId&&FSWidgetModel.gi().get("collectionData").trackingId.length&&!FlipSnackEmbed.isEditor&&Tracker.ga(FSWidgetModel.gi().get("collectionHash"),"Previous"),cpi>0&&(this.singlePageView?this.arabicStyle&&currentPage.get("formCanBlockItem")||this.setPage(cpi-1):this.arabicStyle&&(currentPage.get("formCanBlockItem")||currentPage.get("pageIndex")%2!=0&&nextPage&&(!nextPage||nextPage.get("formCanBlockItem")))||this.setPage(Math.max(cpi-2,0)))},goAutoFlip:function(){var ci=this.widgetState.get("currentItem"),cpi=this.widgetState.get("currentPageIndex"),totalPages=ci.get("pages").length;this.arabicStyle?cpi<=0?Backbone.Mediator.pub(WidgetEvent.CHANGE_PAGE,totalPages-1):Backbone.Mediator.pub(WidgetEvent.PREV_PAGE):cpi>=totalPages-1?Backbone.Mediator.pub(WidgetEvent.CHANGE_PAGE,0):Backbone.Mediator.pub(WidgetEvent.NEXT_PAGE)},setAutoFlip:function(){this.isAudioPlaying||(this.autoFlipTimeoutId&&(clearTimeout(this.autoFlipTimeoutId),this.autoFlipTimeoutId=null),this.autoFlip&&!this.isAutomatorOpen&&(this.autoFlipDelay<1&&(this.autoFlipDelay=1),this.autoFlipTimeoutId=setTimeout(function(){Backbone.Mediator.pub(WidgetEvent.AUTO_FLIP)},1e3*this.autoFlipDelay)))},updateAutoFlip:function(){this.autoFlip=this.widgetSettings.get("autoFlip"),this.autoFlipDelay=this.widgetSettings.get("autoFlipDelay"),this.setAutoFlip()},stopAutoFlip:function(){this.autoFlipTimeoutId&&(clearTimeout(this.autoFlipTimeoutId),this.autoFlipTimeoutId=null)},handleAudioStopped:function(){this.isAudioPlaying=!1},handleWidgetClickOrTap:function(event){var $target=$(event.target);($target.hasClass("page-content")||$target.hasClass("page-image")||$target.hasClass("custom-content")||$target.hasClass("pdf-links"))&&this.stopAutoFlip()},isInitialized:function(){return this.widgetState&&this.widgetState.has("currentItem")},getFirstPage:function(){var idx=this.arabicStyle?this.widgetState.get("currentItem").get("pages").length-1:0;return this.widgetState.get("currentItem").get("pages").models[idx]||null},getFirstPageThumb:function(){var firstPage=this.getFirstPage();return new PageCommon(firstPage.toJSON()).get("src")||""},checkCollectionViewVisibility:function(){return!1},getShareOptions:function(){var shareLinkText=this.widgetSettings.get("shareLinkText").indexOf("http://")>-1?this.widgetSettings.get("shareLinkText").replace("http://","https://"):this.widgetSettings.get("shareLinkText");return{sharePost:this.widgetSettings.get("sharePost"),shareLink:this.widgetSettings.get("shareLink"),shareLinkText:shareLinkText,sharePinterest:this.widgetSettings.get("sharePinterest"),shareTwitter:this.widgetSettings.get("shareTwitter"),shareEmail:this.widgetSettings.get("shareEmail"),shareFaceBook:this.widgetSettings.get("shareFaceBook"),shareGooglePlus:this.widgetSettings.get("shareGooglePlus")}},getTOCData:function(){return FSWidgetModel.gi().get("collectionData").toc},goToUrl:function(url,targetParam){var target=void 0===targetParam?"_blank":targetParam;window.parent!==window.top?("_blank"===target?window:parent).location.href=url:window.open(url,target)},sendEmail:function(email){void 0!==email&&(window.top.location="mailto:"+email)},getItemIndex:function(sItemHash){var allItems=this.get("collectionData").collection,pos=!1;return $.each(allItems,function(idx,item){return item.source!==sItemHash||(pos=idx,!1)}),pos},getPagesBeforeItem:function(itemHash){var allItems=this.get("collectionData").collection,pagesCount=0;return $.each(allItems,function(idx,item){return item.source!==itemHash&&(pagesCount+=item.pageData.length,!0)}),pagesCount},countriesUpdated:function(){Backbone.Mediator.pub(WidgetEvent.COUNTRIES_LOADED)},getCountries:function(){return this.countries.get("countries")},getCountryOptions:function(){return this.countries.get("countryOptions")},getRealPageNumber:function(bookIndex,pageIndex){return this.flipCollection.get("items").at(bookIndex).get("pages").at(pageIndex).get("pageIndexInBook")},getCurrentDownloadLink:function(){var currentItem=FSWidgetModel.gi().widgetState.get("currentItem"),downloadCurrentPath=URLPaths.EC3+"/flipsnack_download_pdf/getPDF.php?hash="+currentItem.get("hash"),extension="custom"===currentItem.get("extension")?"jpg":currentItem.get("extension")||"pdf",name=currentItem.get("title").length>0?currentItem.get("title"):currentItem.get("hash")+"&extension="+extension,url=downloadCurrentPath+"&title="+encodeURIComponent(name),collectionHash=FSWidgetModel.gi().get("collectionHash");return(currentItem.get("hasCustomPages")||currentItem.get("hasMovedPages"))&&(url+="&collectionHash="+encodeURIComponent(collectionHash)+"&hasCustomPages=true"),url},getCollectionDownloadLink:function(print){return print?FSUtils.getPrintLink():FSUtils.getDownloadLink()},sendMessage:function(model){var fnc=model.has("action")&&void 0!==EDITOR_ALERTS[model.get("action")]?EDITOR_ALERTS[model.get("action")]:null;fnc&&(FSWidgetModel.gi().widgetState.get("displayState")!==DisplayState.NORMAL&&Backbone.Mediator.pub(WidgetEvent.EXIT_FULLSCREEN),window.top.postMessage("editor_error_fnc:"+fnc,"*"),model.get("parent")&&model.get("parent").closePanel())},handleItemViewInitialized:function(){this.registerCollectionViewEvent()},registerCollectionViewEvent:function(){var currentPageIndex=this.widgetState.get("currentPageIndex"),itemPages=this.widgetState.get("currentItem").get("pages");Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:Stats.TYPE.VIEW_ITEM,pageIndex:currentPageIndex}),0===currentPageIndex||currentPageIndex===itemPages.length-1?this.registerPageViewEvent(itemPages.at(currentPageIndex).get("pID")):this.registerPageViewEvent([itemPages.at(currentPageIndex).get("pID"),itemPages.at(currentPageIndex+1).get("pID")])},registerPageViewEvent:function(id){var arr;"number"==typeof id?Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:Stats.TYPE.VIEW_PAGE,pid:id}):id&&id.length&&(arr=id.filter(function(pid){return"number"==typeof pid||"string"==typeof pid&&pid.length}).map(function(pid){return{eid:Stats.TYPE.VIEW_PAGE,pid:pid}}),Backbone.Mediator.pub(StatsEvents.REGISTER,arr))},singlePageChanged:function(){this.singlePageView=this.widgetSettings.get("singlePageView"),this.flipCollection.set("singlePageView",this.singlePageView),this.setItem(this.widgetState.get("currentItemIndex"),this.widgetState.get("currentPageIndex"))},changeZoom:function(obj){var newValue=Math.max(0,Math.min(this.get("maxZoomValue"),obj.value));this.set("currentZoom",newValue)},handleZoomChange:function(){Backbone.Mediator.pub(WidgetEvent.ZOOM_CHANGED,{value:this.get("currentZoom")})},handleMaxZoomChange:function(){Backbone.Mediator.pub(WidgetEvent.MAX_ZOOM_CHANGED)},canShowControls:function(){return!(!FSWidgetModel.gi().widgetSettings.get("showControls")||FSWidgetModel.gi().widgetState.get("isBuyCurtainDisplayed"))&&this.hasEnoughSpaceForControls()},hasEnoughSpaceForControls:function(){var width=FSWidgetModel.gi().get("width"),height=FSWidgetModel.gi().get("height");return width>FSWidgetModel.SHOW_CONTROLS_MIN_WIDTH&&height>FSWidgetModel.SHOW_CONTROLS_MIN_HEIGHT},resetZoom:function(){this.set("currentZoom",0)},updateSellSettings:function(){var p1,p2,price=FSWidgetModel.gi().get("sell").price,subscriptionPrice=FSWidgetModel.gi().get("sell").subscriptionPrice;FSWidgetModel.gi().set("isForSelling",price&&price.length>0),FSWidgetModel.gi().set("isInSubscription",!!(subscriptionPrice&&subscriptionPrice.length>0)),FSWidgetModel.gi().get("isForSelling")&&(p1=_.clone(FSWidgetModel.gi().get("sell")).previewPages,p2=_.clone(this.flipCollection.get("previewPages")),FSUtils.compareArrays(p1,p2)||(this.flipCollection.set("previewPages",p1),Backbone.Mediator.pub(WidgetEvent.PREVIEW_PAGES_UPDATED,FSUtils.arrayDiff(p1,p2))))},sendNewShelfItemLoadedEvent:function(data){Backbone.Mediator.pub(NewShelfEvents.ITEM_LOADED,data)},newShelfOpenItem:function(item){this.get("shelfData").set("itemHash",item.hash),ShelfUtils.loadShelfItem(item.hash,this.sendNewShelfItemLoadedEvent)},newShelfItemLoaded:function(data){var newCollectionData;this.get("shelfData").set("itemOpened",!0),this.get("shelfData").set("shelfOpened",!1),(newCollectionData=FSUtils.parseJSONData(data,FlipSnackEmbed.urls.siteURL,this.get("shelfData").get("itemHash"))).shelfData=this.get("shelfData"),Backbone.Mediator.pub(NewShelfEvents.RELOAD_WITH_ITEM,newCollectionData)},updateLanguageSettings:function(){""===this.widgetSettings.get("language")||""===this.widgetSettings.get("language")?this.set("textDirection",TextDirection.RIGHT_TO_LEFT):this.set("textDirection",TextDirection.LEFT_TO_RIGHT),Backbone.Mediator.pub(WidgetEvent.CHANGE_LANGUAGE)}});FSWidgetModel._instance=null,FSWidgetModel.gi=function(options){return!FSWidgetModel._instance&&options&&(FSWidgetModel._instance=new FSWidgetModel(options)),FSWidgetModel._instance},FSWidgetModel.SHOW_CONTROLS_MIN_WIDTH=400,FSWidgetModel.SHOW_CONTROLS_MIN_HEIGHT=330;var FlipCollection=Backbone.Model.extend({defaults:{noOfItems:1,hash:"",title:"",watermark:!1,type:"published",publisher:!0,blocked:!1,password:"",mergePdfs:!1,arabicStyle:!1,singlePageView:!1,hasCustomElements:!1,items:void 0,resourceVersion:"1",enableHardCover:!1,maxFlipPages:-1,previewPages:[],isDoublePageLayout:!1},initialize:function(data){this.data=this.data||data,this.exportVideo=data.exportVideo,this.setupItems(this.data),this.listenTo(this,"change:singlePageView",this.singlePageChanged),this.listenTo(this,"change:previewPages",this.updatePreviewPages)},setupItems:function(data){this.totalPages=0,data.collection&&(this.set("items",this.parseCollectionItems(data.collection)),this.set("hasCustomElements",this.hasCustomElements()),this.get("isDoublePageLayout")&&this.setupForDoublePageLayout(this.get("items"))),this.set("noOfItems",this.get("items").length)},setupForDoublePageLayout:function(items){var pages=items.at(0).get("pages").toJSON(),newPages=this.processPageElements(pages);items.at(0).set("pages",newPages)},processPageElements:function(pages){var self=this,newPages=new Pages;return _.each(pages,function(page,index,list){var rightPage,leftPageElements,rightPageElements,doElementsHaveZIndex,allLeftPageElements,allRightPageElements,leftPageElementsWithSource,rightPageElementsWithSource;index<=0||index>=list.length-2||index%2==0||(rightPage=list[index+1],leftPageElements=self.getPageElements(page),rightPageElements=self.getPageElements(rightPage),(doElementsHaveZIndex=self.checkIfDoublePageElementsHaveZIndex(leftPageElements,rightPageElements))||(self.addZIndexToElements(leftPageElements,rightPageElements),page.customElements=leftPageElements,rightPage.customElements=rightPageElements),leftPageElementsWithSource=self.addPropsToPageElements(leftPageElements,{sourcePage:SourcePage.LEFT,pageWidth:page.width,pageHeight:page.height,pid:page.pID}),rightPageElementsWithSource=self.addPropsToPageElements(rightPageElements,{sourcePage:SourcePage.RIGHT,pageWidth:page.width,pageHeight:page.height,pid:page.pID}),doElementsHaveZIndex?((allLeftPageElements=self.orderElementsByZIndex(page.customElements,rightPageElementsWithSource)).length&&(page.customElements=allLeftPageElements),allRightPageElements=self.orderElementsByZIndex(leftPageElementsWithSource,rightPage.customElements),allLeftPageElements.length&&(rightPage.customElements=allRightPageElements)):(rightPageElementsWithSource.length&&(page.customElements=leftPageElements.concat(rightPageElementsWithSource)),leftPageElementsWithSource.length&&(rightPage.customElements=leftPageElementsWithSource.concat(rightPageElements))),newPages.add(page),newPages.add(rightPage))}),newPages.unshift(pages[0]),1!==pages.length&&newPages.push(pages[pages.length-1]),newPages},getPageElements:function(page){return page.customElements&&page.customElements.length?page.customElements:[]},checkIfDoublePageElementsHaveZIndex:function(leftPageElements,rightPageElements){var doLeftPageElementsHaveZIndex=_.some(leftPageElements,function(element){return"number"==typeof element.zIndex&&element.zIndex>0}),doRightPageElementsHaveZIndex=_.some(rightPageElements,function(element){return"number"==typeof element.zIndex&&element.zIndex>0});return doLeftPageElementsHaveZIndex||doRightPageElementsHaveZIndex},addZIndexToElements:function(leftPageElements,rightPageElements){var lastLeftPageElementZIndex=0;_.each(leftPageElements,function(element,index){element.zIndex="number"==typeof element.zIndex&&element.zIndex>0?element.zIndex:index+1,lastLeftPageElementZIndex=element.zIndex}),_.each(rightPageElements,function(element,index){element.zIndex="number"==typeof element.zIndex&&element.zIndex>0?element.zIndex:lastLeftPageElementZIndex+index+1})},addPropsToPageElements:function(page,props){return _.map(page,function(element){return $.extend(!0,{},element,props)})},orderElementsByZIndex:function(leftPageElements,rightPageElements){var allElements=leftPageElements.concat(rightPageElements);return allElements.sort(function(a,b){return a.zIndex<b.zIndex?-1:a.zIndex>b.zIndex?1:0}),allElements},destroy:function(){this.off(),this.stopListening(),this.get("items").reset()},parseCollectionItems:function(collection){var currentItem,pages,noOfItems=collection&&collection.length?collection.length:0,collectionItems=new Items,self=this,maxFlipPages=this.get("maxFlipPages");if(noOfItems){$.each(collection,function(index,item){var newItem,newItemPages,newItemForms;if(maxFlipPages>0&&self.totalPages>=maxFlipPages&&!FlipSnackEmbed.isEditor||self.get("watermark")&&!self.get("mergePdfs")&&index+1>WATERMARK_ITEM_LIMIT)return!1;if(currentItem=self.createCollectionItem(item,index),self.get("mergePdfs"))0===collectionItems.length?self.get("arabicStyle")?collectionItems.unshift(currentItem):collectionItems.add(currentItem):(newItem=currentItem,newItemPages=currentItem.get("pages"),currentItem=collectionItems.at(0),self.get("arabicStyle")?currentItem.get("pages").unshift(newItemPages.models):currentItem.get("pages").add(newItemPages.models),(newItemForms=newItem.get("forms"))&&newItemForms.length&&currentItem.set("forms",currentItem.get("forms").concat(newItemForms)),currentItem.set("noOfPages",currentItem.get("noOfPages")+newItemPages.length),currentItem.set("hasCustomPages",currentItem.get("hasCustomPages")||newItem.get("hasCustomPages")),currentItem.set("onlyCustomPages",currentItem.get("onlyCustomPages")&&newItem.get("onlyCustomPages")),currentItem.set("hasMovedPages",currentItem.get("hasMovedPages")||newItem.get("hasMovedPages")),currentItem.set("imagesOnly",currentItem.get("imagesOnly")&&newItem.get("imagesOnly")),currentItem.set("blocked",currentItem.get("blocked")||newItem.get("blocked")));else{pages=currentItem.get("pages").length;var needExtraPage=!self.get("singlePageView")||self.get("arabicStyle");pages%2>0&&needExtraPage&&1!==pages&&(currentItem.addBlankPage(self.get("arabicStyle")),currentItem.set("noOfPages",currentItem.get("noOfPages")+1)),collectionItems.add(currentItem)}return!0}),pages=collectionItems.at(0).get("pages").length;var needExtraPage=!self.get("singlePageView")||self.get("arabicStyle");return this.get("mergePdfs")&&pages%2>0&&1!==pages&&needExtraPage&&(collectionItems.at(0).addBlankPage(self.get("arabicStyle")),collectionItems.at(0).set("noOfPages",pages)),this.get("arabicStyle")&&collectionItems.each(function(item){var itemTotalPages=item.get("noOfPages");item.get("pages").each(function(page,idx){page.set({pageIndex:idx},{silent:!0})}),_.each(item.get("forms"),function(form){form.index=itemTotalPages-form.index-1})}),this.get("previewPages").length&&this.get("mergePdfs")&&(collectionItems.at(0).get("pages").at(-1).get("type")===PageType.EMPTY_PAGE&&collectionItems.at(0).get("pages").at(-1).set("isBlockedForSellingPreview",!0),this.setPagesForPreview(collectionItems.at(0),this.get("previewPages"))),collectionItems}},createCollectionItem:function(item,itemIndex){var pageIdx,currentPage,itemData,pageList=new Pages,hasCustomPages=!1,onlyCustomPages=!0,hasCustomContent=!1,hasMovedPages=!1,isItemBlocked=!1,self=this,urls=URLPaths.getLinksForItem(item.source),forms=[],maxFlipPages=this.get("maxFlipPages");return _.each(item.pageData,function(page,pageIndex){if((!(maxFlipPages>0&&self.totalPages>=maxFlipPages)||FlipSnackEmbed.isEditor)&&(!self.get("watermark")||!(self.get("mergePdfs")&&self.totalPages>=WATERMARK_PAGE_LIMIT||!self.get("mergePdfs")&&pageIndex>=WATERMARK_PAGE_LIMIT)))switch(self.totalPages++,pageIdx=self.get("mergePdfs")?self.totalPages-1:pageIndex,currentPage=self.parseItemPageData(page,pageIdx,item,urls),self.get("arabicStyle")?pageList.unshift(currentPage):pageList.add(currentPage),currentPage.get("hasForm")&&(localStorage.getItem(self.get("hash"))||forms.push({index:self.get("mergePdfs")?self.totalPages-1:pageIndex,formCanBlockItem:currentPage.get("formCanBlockItem"),form:currentPage.get("form")})),isItemBlocked=isItemBlocked||currentPage.get("hasForm")&&currentPage.get("formCanBlockItem"),hasCustomContent=hasCustomContent||page.links&&page.links.length>0,page.type){case PageType.UPLOADED_PAGE:onlyCustomPages=!1;break;case PageType.CUSTOM_PAGE:hasCustomPages=!0;break;case PageType.MOVED_PAGE:hasMovedPages=!0}}),itemData={itemIndex:itemIndex,hash:item.source,title:item.name||(itemIndex+1).toString(),description:item.description||"",hardCover:self.get("enableHardCover"),noOfPages:pageList.length,hasCustomPages:hasCustomPages,onlyCustomPages:onlyCustomPages,hasCustomContent:hasCustomContent,hasMovedPages:hasMovedPages,imagesOnly:"true"===item.imagesOnly||"boolean"==typeof item.imagesOnly&&item.imagesOnly,extension:item.extension,blocked:isItemBlocked,pages:pageList,forms:forms},new CollectionItem(itemData)},parseItemPageData:function(page,pageIndex,item,urls){var pdfidx=void 0!==page.pdfidx&&null!==page.pdfidx?parseInt(page.pdfidx,10):void 0,pageType=void 0===page.type||null===page.type||isNaN(parseInt(page.type,10))?0:parseInt(page.type,10),width=this.getResolvedPageSize(page.width,DefaultPageSize.WIDTH),height=this.getResolvedPageSize(page.height,DefaultPageSize.HEIGHT),pageDataObj={pageIndex:pageIndex,pageIndexInBook:this.get("mergePdfs")?this.totalPages:pageIndex+1,width:width,height:height,type:pageType,pdfidx:pdfidx,itemHash:page.originalHash||page.itemhash||item.source,originalHash:page.originalHash||"",pID:"string"==typeof page.pID?parseInt(page.pID,10):page.pID,thumbHash:pageType===PageType.CUSTOM_PAGE&&page.thumbHash?page.thumbHash:"page_"+(pdfidx+1),thumbVersion:page.thumbVersion||"1",extension:pageType!==PageType.CUSTOM_PAGE&&"string"==typeof item.extension&&item.extension.length>0?item.extension:"",isBlockedForSellingPreview:this.get("previewPages").length>0,bgColor:page.bgColor?page.bgColor:""},pageUrls=page.originalHash||page.itemhash?URLPaths.getLinksForItem(pageDataObj.itemHash):urls,resourceVersion=this.getResourceVersion();return pageDataObj.thumb=this.getImageURL(pageUrls.THUMB_IMAGE,pageDataObj,pageDataObj.thumbVersion),pageDataObj.small=this.getImageURL(pageUrls.SMALL_IMAGE,pageDataObj,resourceVersion),pageDataObj.medium=this.getImageURL(pageUrls.MEDIUM_IMAGE,pageDataObj,resourceVersion),pageDataObj.original=pageType!==PageType.CUSTOM_PAGE?this.getImageURL(pageUrls.ORIGINAL_IMAGE,pageDataObj,resourceVersion):"",pageDataObj.customElements=this.parsePageElements(page,pageDataObj),new PageData(pageDataObj)},parsePageElements:function(page,pageDataObj){var customElements=[],self=this;return page.products&&(pageDataObj.products=page.products),page.links&&_.each(page.links,function(element,index){element.type=parseInt(element.type,10),element.action=parseInt(element.action,10),element.icon||(element.icon={default:{id:element.type>0?element.type.toString():""}},element.type===ElementType.AUDIO&&(element.icon={default:{id:OldAudioIcon.ON},active:{id:OldAudioIcon.OFF}}),element.type===ElementType.CAPTION&&(element.icon={default:{id:OldCaptionIcon.CLOSED},active:{id:OldCaptionIcon.OPEN}})),element.type===ElementType.FORM&&self.exportVideo||(element.type===ElementType.FORM&&FSUtils.elementCanBeDisplayed(element.type,PremiumTypeLinks,self.get("publisher"))&&(pageDataObj.hasForm=!0,pageDataObj.formCanBlockItem=element.limit===LeadFormBlocking.ALL&&!localStorage.getItem(self.get("hash")),pageDataObj.form=$.extend(!0,{},element),pageDataObj.form.elements&&(pageDataObj.form.elements=[].concat(element.elements.el)),_.each(pageDataObj.form.elements,function(elem){elem.mandatory=1===parseInt(elem.mandatory,10)||!0===elem.mandatory,elem.type=parseInt(elem.type,10)})),customElements.push($.extend(!0,{},element)))}),customElements},getResourceVersion:function(){return this.get("resourceVersion")},getImageURL:function(baseUrl,pageData,version){var imgUrl="";switch(pageData.type){case PageType.CUSTOM_PAGE:imgUrl=baseUrl.replace("{page}",pageData.thumbHash);break;default:imgUrl=baseUrl.replace("{page}","page_"+(pageData.pdfidx+1))}return void 0!==version&&(imgUrl+="?v="+version),imgUrl},getResolvedPageSize:function(size,defaultValue){var result=defaultValue;if(size&&!isNaN(parseInt(size,10)))try{result=parseInt(size,10),result=isNaN(result)||0===result?defaultValue:result}catch(e){result=defaultValue}return result},getForms:function(){var arr=[];return _.each(this.get("items").models,function(item){var itemForms=item.get("forms");itemForms&&itemForms.length&&(arr=arr.concat(itemForms))}),arr},hasCountryList:function(){var obj,collectionForms=this.getForms(),hasCountry=!1,self=this;return collectionForms&&collectionForms.length&&(hasCountry=void 0!==(obj=_.find(collectionForms,function(formData){return self.formHasElement(formData.form,LeadFormField.FIELD_TYPE_COUNTRY)}))&&null!==obj),hasCountry},formHasElement:function(form,elementType){var elementsList=form.elements,element=elementsList&&_.find(elementsList,function(elem){return elem.type===elementType});return void 0!==element&&null!==element},hasCustomElements:function(){var items=this.get("items").models,collectionHasCustomElements=!1;return items&&(collectionHasCustomElements=_.some(items,function(item){var pages=item.get("pages").models;return _.some(pages,function(page){var customElements=page.get("customElements");return customElements&&customElements.length})})),collectionHasCustomElements},singlePageChanged:function(){this.destroy(),this.initialize()},setPagesForPreview:function(collectionItem,previewPages){var pages=collectionItem.get("pages"),self=this;previewPages&&previewPages.length&&_.each(previewPages,function(pageIndex){var pIdx=self.get("arabicStyle")?pages.length-pageIndex:pageIndex-1;pages.at(pIdx)&&pages.at(pIdx).set("isBlockedForSellingPreview",!1)})},resetPagesForPreview:function(collectionItem){collectionItem.get("pages").forEach(function(page){page.set("isBlockedForSellingPreview",!0)})},updatePreviewPages:function(){this.resetPagesForPreview(this.get("items").at(0)),this.setPagesForPreview(this.get("items").at(0),this.get("previewPages"))}}),Items=Backbone.Collection.extend({model:CollectionItem}),LeadFormModel=Backbone.Model.extend({defaults:{eID:0,pid:0,limit:LeadFormBlocking.ALL,header:"",bookIndex:0,pageIndex:0,realPageNumber:1,bookTitle:"",elements:[],labels:{},pageSize:[],formVersion:0},initialize:function(){this.checkElements(),this.listenTo(this,"change",this.checkElements)},checkElements:function(){var elementsList=this.get("elements");Array.isArray(elementsList)||(elementsList=[elementsList]),this.set("elements",elementsList,{silent:!0})},destroy:function(){this.off()}}),NavSliderModel=Backbone.Model.extend({defaults:{pages:[],tooltipText:""}}),PageCommon=Backbone.Model.extend({defaults:{src:"",selected:!1},initialize:function(){this.set("src",this.get("thumb"),{silent:!0})},getPdfUrl:function(pageHash){return"pdf"!==this.get("extension")?"":(pageHash=pageHash||"page_1",URLPaths.ITEMS_BASE_PATH+this.get("itemHash")+"/pdf_pages/"+pageHash)},unselect:function(silent){this.set("selected",!1,{silent:void 0!==silent&&silent})}}),PageData=Backbone.Model.extend({defaults:{pageIndex:0,pageIndexInBook:0,width:827,height:1170,type:PageType.UPLOADED_PAGE,source:"",thumbHash:"",pID:"",pdfidx:0,hasForm:!1,formCanBlockItem:!1,customElements:null,itemHash:"",originalHash:"",isBlockedForSellingPreview:!1,bgColor:""}}),Pages=Backbone.Collection.extend({model:PageData}),PdfLinks=Backbone.Model.extend({initialize:function(){this.pdfItems=[],this.pdfLinksLoaded=[],this.mergePdfs=FSWidgetModel.gi().widgetSettings.get("mergePdfs"),this.loadLinkJS(),this.listenTo(FSWidgetModel.gi().widgetState,"change:currentItem",this.onCurrentItemChanged)},onCurrentItemChanged:function(){this.removeRequest()},loadLinkJS:function(){this.mergePdfs?(this.setPdfItems(),this.pdfItems.length&&!FSWidgetModel.gi().widgetSettings.get("exportVideo")&&this.loadAllLinks()):"failed"===FSWidgetModel.gi().widgetState.get("currentItem").get("linkLoadStatus")||FSWidgetModel.gi().widgetSettings.get("exportVideo")||this.loadSingleItemJS()},setPdfItems:function(){var items=FSWidgetModel.gi().get("collectionData").collection,_this=this;this.pdfItems=[],$.each(items,function(i,item){"pdf"===item.extension&&_this.pdfItems.push(item)})},loadSingleItemJS:function(){var _this=this,currentItem=FSWidgetModel.gi().widgetState.get("currentItem"),linkJsUrl=FlipSnackEmbed.urls.items+currentItem.get("hash")+FlipSnackEmbed.urls.linkJS;window.linksJs=null,delete window.linksJs,this.windowFunctionName="link_"+currentItem.get("hash"),void 0===window[this.windowFunctionName]&&(window[this.windowFunctionName]=function(data){window.linksJs=data}),this.request=FSUtils.loadScript(linkJsUrl,function(){_this.linkJsLoaded()},function(){_this.linkJSFail()})},linkJsLoaded:function(){FSWidgetModel.gi().widgetState.get("currentItem").set("linkLoadStatus","success"),Backbone.Mediator.pub(WidgetEvent.PDF_LINKS_LOADED)},linkJSFail:function(){delete window["link_"+FSWidgetModel.gi().widgetState.get("currentItem").get("hash")],FSWidgetModel.gi().widgetState.get("currentItem").set("linkLoadStatus","failed")},setLinksJsMulti:function(){for(var pages=FSWidgetModel.gi().widgetState.get("currentItem").get("pages"),pdfLInksLoaded=[],i=0,len=this.pdfLinksLoaded.length;i<len;i++)pdfLInksLoaded[this.pdfLinksLoaded[i].hash]=this.pdfLinksLoaded[i].linksData;window.linksJs={},$.each(pages.models,function(pageIndex,page){var linkData=pdfLInksLoaded[page.get("itemHash")]||null,linkDataPageIndex=page.get("pdfidx");linkData&&linkData[linkDataPageIndex]&&page.get("type")===PageType.UPLOADED_PAGE&&(window.linksJs[pageIndex]=linkData[linkDataPageIndex])})},loadAllLinks:function(){var item,linksUrl,_this;this.pdfItems.length?(item=this.pdfItems.shift(),linksUrl=FlipSnackEmbed.urls.items+item.source+FlipSnackEmbed.urls.linkJS,_this=this,this.windowAllFunctionName="link_"+item.source,window[this.windowAllFunctionName]=function(data){!1!==FSWidgetModel.gi().getItemIndex(item.source)&&_this.pdfLinksLoaded.push({hash:item.source,linksData:data})},this.request=FSUtils.loadScript(linksUrl,function(){_this.loadAllLinks()},function(){_this.loadAllLinks()})):this.pdfLinksLoaded.length&&(this.setLinksJsMulti(),Backbone.Mediator.pub(WidgetEvent.PDF_LINKS_LOADED))},removeRequest:function(){this.request&&(this.request.parentNode.removeChild(this.request),this.request=null)},destroy:function(){this.stopListening(),this.pdfItems=null,this.removeRequest(),window[this.windowFunctionName]=null,window[this.windowAllFunctionName]=null,window.linksJs=null}}),ShelfData=Backbone.Model.extend({defaults:{resourceVersion:"1",enableHardCover:!1,maxFlipPages:-1,previewPages:[],items:void 0,shelfOpened:!1},initialize:function(data){this.data=this.data||data,this.setupItems(this.data),this.set("shelfOpened",data.shelfOpened)},setupItems:function(data){data&&data.items&&this.set("items",data.items),this.set("noOfItems",data.items.length)},destroy:function(){this.off(),this.stopListening()}}),SimpleLoaderModel=Backbone.Model.extend({defaults:{source:"",width:100,height:100,originalWidth:void 0,originalHeight:void 0,scaleMode:"scaleCrop",showPreloader:!0,status:ContentLoaderStatus.IDLE}}),WidgetSettings=Backbone.Model.extend({defaults:{widgetType:WidgetType.CLASSIC,collectionWidth:640,collectionHeight:385,mobileNavigationEffect:"slide",showNavigationFlipButtons:!0,showThumbView:!0,enableSounds:!0,sharePost:!0,shareLink:!0,shareFaceBook:!0,shareTwitter:!0,shareGooglePlus:!0,sharePinterest:!0,shareEmail:!0,shareLinkText:"",language:"English",mergePdfs:!1,transparentBackground:!1,autoFlip:!1,autoFlipDelay:6,useHighlights:!0,arabicStyle:!1,enableShelfToolTips:!0,singlePageView:!1,enableSearch:!0,remoteControlled:!0,startSizeMultiplier:100,backgroundScaleType:"scaleCrop",useBackgroundVignette:!1,logoImage:"",logoUrl:"",color:"DEDEDE",backgroundImage:"",enableHardCover:!1,showControls:!1,skinType:"classic",productDetails:null,contentLayout:void 0}}),WidgetState=Backbone.Model.extend({defaults:{currentItemIndex:0,currentItem:void 0,currentPageIndex:0,leftPageIndex:-1,rightPageIndex:0,displayState:DisplayState.NORMAL,widgetType:WidgetType.CLASSIC,displayType:DisplayType.SMALL,isBuyCurtainDisplayed:!1}}),AutomatorView=Backbone.View.extend({template:_.template(Templates.automatorView),productTemplate:_.template(Templates.automatorProduct),id:ComponentContainers.AUTOMATOR_VIEW,events:function(){return FSUtils.isMobileDevice()?{"touchend #toggleProductsButton":"onClickButton","touchend .view-more":"onViewMore","touchend .view-less":"onViewLess"}:{"click #toggleProductsButton":"onClickButton","click .view-more":"onViewMore","click .view-less":"onViewLess"}},initialize:function(){this.openContainer=!1,this.isPlayerSkin=FSUtils.isPlayerSkin(),this.visibleData=FSWidgetModel.gi().get("collectionData").params.productDetails,this.listenTo(FSWidgetModel.gi().widgetState,"change:currentPageIndex",this.render),this.listenTo(FSWidgetModel.gi().widgetSettings,"change:singlePageView",this.render),this.listenTo(FSWidgetModel.gi(),"change:height",this.setCss),this.listenTo(FSWidgetModel.gi(),"change:width",this.setCss),Backbone.Mediator.sub(WidgetEvent.OPEN_SEARCH_OPTIONS,this.hideContainer,this),Backbone.Mediator.sub(WidgetEvent.CLOSE_SEARCH_OPTIONS,this.showContainer,this),Backbone.Mediator.sub(WidgetEvent.FULLSCREEN_CHANGED,this.setCss,this)},render:function(){var products=this.getProductsInView();return this.model.set("products",products),this.model.set("productsCount",products.length),this.model.set("buttonLabel",this.openContainer?"Hide":"Show"),this.model.set("arrowSrc",URLPaths.ASSETS_PATH+"automator-arrow.gz.svg"),this.$el.html(this.template(this.model.attributes)),this.productsContainer=this.$el.find(".products-container"),this.renderProducts(),this.setCss(),this},renderProducts:function(){var self=this;$.each(this.model.get("products"),function(index,product){var data=$.extend(!0,{},product);if(data.image_link=data.image_hash,self.visibleData&&self.visibleData.length&&Object.keys(data).forEach(function(key){-1===self.visibleData.indexOf(key)&&(data[key]="")}),data.showReadMore=!1,data.full_price=data.full_price?data.full_price:"",data.link=data.link?data.link:"",data.description=data.description?data.description.replace(/^\s*[\r\n]/gm,""):"",data.title=data.title?data.title:"",data.index=index,data.description.length>AutomatorView.PRODUCT_DESCRIPTION_LIMIT){var description=data.description;data.showReadMore=!0,data.visibleDescription=description.substring(0,data.image_link?AutomatorView.PRODUCT_DESCRIPTION_LIMIT:AutomatorView.PRODUCT_ONLY_DESCRIPTION_LIMIT),data.hiddenDescription=description.substring(AutomatorView.PRODUCT_DESCRIPTION_LIMIT,description.length)}if(data.image_link){var accountId=FSWidgetModel.gi().get("accountId"),externalLibraryURL=FSUtils.getUserExternalLibraryURL(accountId);data.image_link=externalLibraryURL+data.image_link}self.productsContainer.append(self.productTemplate(data))})},setCss:function(){var widgetModel=FSWidgetModel.gi(),hasSpace=this.isPlayerSkin||FSUtils.isInFullScreen()||FSWidgetModel.gi().widgetSettings.get("showControls")&&widgetModel.get("width")>FSWidgetModel.SHOW_CONTROLS_MIN_WIDTH&&widgetModel.get("height")>FSWidgetModel.SHOW_CONTROLS_MIN_HEIGHT,margin=this.isPlayerSkin?"75px":"46px";if(this.$el.css({"margin-bottom":hasSpace&&!this.openContainer?margin:"0px",display:this.model.get("productsCount")?"block":"none",bottom:this.isPlayerSkin?"-60px":0}),this.productsContainer.animate({opacity:this.openContainer?1:0,height:this.openContainer?"100%":"0px"},100),this.openContainer){this.$el.addClass("open");var padding=widgetModel.get("height")-AutomatorView.PADDING_OFFSET;padding<40&&(padding=40),this.$el.css({"padding-top":this.model.get("productsCount")>AutomatorView.PRODUCTS_PER_ROW?"40px":padding+"px"}),this.$el.animate({height:"100vh"},100)}else this.$el.removeClass("open"),this.$el.animate({height:"0","padding-top":0},200);var productsPerRow=this.getProductsPerRow(widgetModel.get("width")),xPadding=(widgetModel.get("width")-301*productsPerRow)/2-10;this.productsContainer.css({"padding-left":xPadding+"px","padding-right":xPadding+"px"}),this.model.set("buttonLabel",this.openContainer?"Hide":"Show")},onClickButton:function(){this.openContainer=!this.openContainer,this.model.set("buttonLabel",this.openContainer?"Hide":"Show"),this.$el.find("#buttonLabel").text(this.model.get("buttonLabel")),this.openContainer?Backbone.Mediator.pub(WidgetEvent.OPEN_AUTOMATOR,this):Backbone.Mediator.pub(WidgetEvent.CLOSE_AUTOMATOR,this),this.setCss()},getProductsPerRow:function(width){return width>1250?4:width>950?3:width>650?2:1},onViewMore:function(e){var index=e.target.getAttribute("data-index");this.productsContainer.find(".dots-"+index).css({display:"none"}),this.productsContainer.find(".more-"+index).css({display:"none"}),this.productsContainer.find(".visible-"+index).css({display:"none"}),this.productsContainer.find(".hidden-"+index).css({display:"inline"}),this.productsContainer.find(".product-"+index).css({height:"100%"}),this.productsContainer.find(".less-"+index).css({display:"block"})},onViewLess:function(e){var index=e.target.getAttribute("data-index");this.productsContainer.find(".dots-"+index).css({display:"inline"}),this.productsContainer.find(".more-"+index).css({display:"block"}),this.productsContainer.find(".visible-"+index).removeAttr("style"),this.productsContainer.find(".hidden-"+index).removeAttr("style"),this.productsContainer.find(".product-"+index).removeAttr("style"),this.productsContainer.find(".less-"+index).css({display:"none"})},showContainer:function(){this.$el.css({"z-index":31005})},hideContainer:function(){this.$el.css({"z-index":3e3})},getProductsInView:function(){var currentPageProducts=[];if(FSWidgetModel.gi().widgetState.get("currentItem")){var pages=FSWidgetModel.gi().widgetState.get("currentItem").get("pages"),currentPageIndex=FSWidgetModel.gi().widgetState.get("currentPageIndex");pages.models[currentPageIndex]&&pages.models[currentPageIndex].attributes&&pages.models[currentPageIndex].attributes.products&&(currentPageProducts=currentPageProducts.concat(pages.models[currentPageIndex].attributes.products)),!FSWidgetModel.gi().widgetSettings.get("singlePageView")&&0!==currentPageIndex&&pages.models[currentPageIndex+1]&&pages.models[currentPageIndex+1].attributes&&pages.models[currentPageIndex+1].attributes.products&&(currentPageProducts=currentPageProducts.concat(pages.models[currentPageIndex+1].attributes.products))}return currentPageProducts},remove:function(){Backbone.Mediator.unsubscribe(WidgetEvent.OPEN_SEARCH_OPTIONS,this.hideContainer,this),Backbone.Mediator.unsubscribe(WidgetEvent.CLOSE_SEARCH_OPTIONS,this.showContainer,this),Backbone.Mediator.unsubscribe(WidgetEvent.FULLSCREEN_CHANGED,this.setCss,this)}});AutomatorView.PADDING_OFFSET=495,AutomatorView.PRODUCT_DESCRIPTION_LIMIT=70,AutomatorView.PRODUCT_ONLY_DESCRIPTION_LIMIT=380,AutomatorView.PRODUCTS_PER_ROW=4,AutomatorView.BUTTON_HEGHT=40;var BuyButton=Backbone.View.extend({events:{click:"sendTrackingData"},template:_.template(Templates.buyButton),id:ComponentContainers.BUY_BUTTON,className:"buy-button-container",initialize:function(){this.listenTo(this.model,"change:price",this.render),this.listenTo(this.model,"change:subscriptionPrice",this.render),this.listenTo(this.model,"change:subscriptionFlipbooks",this.render),this.listenTo(this.model,"change:isInSubscription",this.render),this.listenTo(FSWidgetModel.gi(),"change:labels",this.changeLabel)},changeLabel:function(){this.model.set("singleFlipbook",FSWidgetModel.gi().get("labels").l_single_flipbook),this.model.set("issues",FSWidgetModel.gi().get("labels").l_issues),this.model.set("buySubscription",FSWidgetModel.gi().get("labels").l_subscription),this.model.set("buyLabel",FSWidgetModel.gi().get("labels").l_buy),this.render()},render:function(){return this.$el.html(this.template(this.model.attributes)),this},sendTrackingData:function(){"string"==typeof FSWidgetModel.gi().get("collectionData").trackingId&&FSWidgetModel.gi().get("collectionData").trackingId.length&&!FlipSnackEmbed.isEditor&&Tracker.ga(FSWidgetModel.gi().get("collectionHash"),"Click to buy")}}),BuyCurtain=Backbone.View.extend({events:{"click .prev-btn":"handlePreviousPage","click .next-btn":"handleNextPage","click .buy-btn span":"sendTrackingData","click .full-screen-exit-btn":"exitFullScreen"},template:_.template(Templates.buyCurtain),className:"curtain-content",initialize:function(){this.listenTo(this.model,"change:price",this.render),this.listenTo(this.model,"change:subscriptionPrice",this.render),this.listenTo(this.model,"change:subscriptionFlipbooks",this.render),this.listenTo(this.model,"change:isInSubscription",this.render),this.listenTo(FSWidgetModel.gi(),"change:labels",this.changeLabel)},changeLabel:function(){this.model.set("singleFlipbook",FSWidgetModel.gi().get("labels").l_single_flipbook),this.model.set("issues",FSWidgetModel.gi().get("labels").l_issues),this.model.set("buySubscription",FSWidgetModel.gi().get("labels").l_subscription),this.model.set("message",FSWidgetModel.gi().get("labels").l_cortina_message),this.model.set("buyLabel",FSWidgetModel.gi().get("labels").l_buy),this.render()},render:function(){return this.$el.html(this.template(this.model.attributes)),this},sendTrackingData:function(){"string"==typeof FSWidgetModel.gi().get("collectionData").trackingId&&FSWidgetModel.gi().get("collectionData").trackingId.length&&!FlipSnackEmbed.isEditor&&Tracker.ga(FSWidgetModel.gi().get("collectionHash"),"Click to buy")},handlePreviousPage:function(){Backbone.Mediator.pub(WidgetEvent.PREV_PAGE)},handleNextPage:function(){Backbone.Mediator.pub(WidgetEvent.NEXT_PAGE)},exitFullScreen:function(){Backbone.Mediator.pub(WidgetEvent.EXIT_FULLSCREEN)}}),ClickToReadButton=Backbone.View.extend({template:_.template(Templates.clickToRead),id:ComponentContainers.CLICK_TO_READ,initialize:function(){var eventName=FSUtils.isMobileDevice()?"touchend":"click";this.listenTo(FSWidgetModel.gi(),"change:labels",this.changeLabel),this.$el.on(eventName,this.sendFullScreenEvent),Backbone.Mediator.sub(WidgetEvent.RESIZE,this.resize,this),Backbone.Mediator.sub(WidgetEvent.CHANGE_LANGUAGE,this.setTextDirection,this),this.stateTimeout=null},render:function(){return this.$el.html(this.template(this.model.attributes)),this.setTextDirection(),this.resize(),this},resize:function(){this.$el.css({left:Math.round((FSWidgetModel.gi().get("width")-ClickToReadButton.BUTTON_SIZE)/2)+"px",top:Math.round((FSWidgetModel.gi().get("height")-ClickToReadButton.BUTTON_SIZE)/2)+"px"})},changeLabel:function(){this.model.set("label",FSWidgetModel.gi().get("labels").l_click_to_read),this.render()},sendFullScreenEvent:function(){"string"==typeof FSWidgetModel.gi().get("collectionData").trackingId&&FSWidgetModel.gi().get("collectionData").trackingId.length&&!FlipSnackEmbed.isEditor&&Tracker.ga(FSWidgetModel.gi().get("collectionHash"),"Click to read"),Backbone.Mediator.pub(WidgetEvent.ENTER_FULLSCREEN)},show:function(){clearTimeout(this.stateTimeout),this.$el.show(),this.resize(),this.$el.css("opacity",1)},hide:function(){var _this=this;this.$el.css("opacity","0"),clearTimeout(this.stateTimeout),this.stateTimeout=setTimeout(function(){_this.$el.hide()},300)},setTextDirection:function(){FSWidgetModel.gi().get("textDirection")===TextDirection.RIGHT_TO_LEFT?this.$el.find(".click-to-read").addClass("reverse-text"):this.$el.find(".click-to-read").removeClass("reverse-text")},remove:function(){clearTimeout(this.stateTimeout),this.stateTimeout=null,this.$el.off(),Backbone.Mediator.unsubscribe(WidgetEvent.RESIZE,this.resize,this),Backbone.Mediator.unsubscribe(WidgetEvent.CHANGE_LANGUAGE,this.setTextDirection,this),Backbone.View.prototype.remove.apply(this,arguments)}});ClickToReadButton.BUTTON_SIZE=58;var FSWidgetView=Backbone.View.extend({events:{mouseenter:"onMouseOver",mouseover:"onMouseOver",mouseleave:"onMouseLeave"},initialize:function(){this.hoverTimer=null,SQSManager.gi(),FlipSnackEmbed.isEditor||FSWidgetModel.gi().get("blockEvents")||Stats.gi(),!FSWidgetModel.gi().get("collectionData").security||FlipSnackEmbed.isEditor&&!FlipSnackEmbed.isPublish?this.initWidgetView(!0):(this.po=new PasswordOverlay,this.pp=new PasswordPopinView({model:new Backbone.Model}),this.$el.append(this.po.render().$el).append(this.pp.render().$el)),Backbone.Mediator.sub(WidgetEvent.WIDGET_VIEW_INIT,this.initWidgetView,this),this.listenTo(FSWidgetModel.gi(),"change:labels",this.labelChange),parent.postMessage(IFRAME_LOAD_MESSAGE,"*")},genericPopin:!1,productTagPopin:!1,onMouseLeave:function(sendViewEvent){var cond=!0===sendViewEvent&&!FSWidgetModel.gi().get("collectionData").security;this.clearHoverEvents(cond),cond&&Backbone.Mediator.pub(StatsEvents.REGISTER_COLLECTION_VIEW)},onMouseOver:function(){var self=this;this.hoverTimer&&this.clearHoverEvents(),this.hoverTimer=setTimeout(function(){self.onMouseLeave(!0)},Stats.HOVER_TIMER)},clearHoverEvents:function(removeEvents){this.hoverTimer&&clearTimeout(this.hoverTimer),removeEvents&&this.removeHoverEvents()},removeHoverEvents:function(){this.undelegateEvents()},labelChange:function(){this.pp&&(this.pp.labelChange(),this.pp.render())},initWidgetView:function(skipHoverVerification){skipHoverVerification||this.clearHoverEvents(!0),this.removePasswordPopin(),Backbone.Mediator.pub(WidgetEvent.STARTUP),this.layoutManager=new LayoutManager({model:new Backbone.Model({width:this.model.get("width"),height:this.model.get("height")})}),this.$el.append(this.layoutManager.render().$el),this.listenTo(this.model,"change",this.render),Backbone.Mediator.sub(WidgetEvent.POPIN_OPEN,this.showPopin,this),Backbone.Mediator.sub(WidgetEvent.OPEN_PRODUCT_TAG_POPIN,this.showProductTagPopin,this),Backbone.Mediator.sub(WidgetEvent.POPIN_CLOSE,this.hidePopin,this),Backbone.Mediator.sub(WidgetEvent.CLOSE_PRODUCT_TAG_POPIN,this.hideProductTagPopin,this),Backbone.Mediator.sub(WidgetEvent.POPIN_RESIZE,this.resizePopin,this),Backbone.Mediator.sub(ShelfEvents.SHELF_OPENED,this.closePopin,this),Backbone.Mediator.pub(WidgetEvent.CONFIG_DONE),FontManager.gi()},render:function(){var obj={},canChangeModel=!1;return("width"in this.model.changed||"height"in this.model.changed)&&(canChangeModel=!0,obj.width=this.model.get("width"),obj.height=this.model.get("height")),"logo"in this.model.changed&&(canChangeModel=!0,obj.logo=this.model.get("logo")),canChangeModel&&this.layoutManager.model.set(obj),this},fullScreenChange:function(isFullScreen){var newState;newState=isFullScreen?this.model.get("allowBrowserFullScreen")?DisplayState.FULLSCREEN:DisplayState.CLASSIC_FULLSCREEN:DisplayState.NORMAL,this.model.widgetState.set("displayState",newState),Backbone.Mediator.pub(WidgetEvent.FULLSCREEN_CHANGED,{displayState:newState})},showPopin:function(html,videoButton){this.genericPopin||(this.genericPopin=new GenericPopin,this.$el.append(this.genericPopin.render().el)),this.genericPopin.setContent(html),this.genericPopin.showModal(videoButton.genericVideoButton)},showProductTagPopin:function(attributes){this.productTagPopin||(this.productTagPopin=new ProductTagPopin,this.$el.append(this.productTagPopin.render().el)),this.productTagPopin.showModal(attributes)},hidePopin:function(){this.genericPopin&&this.genericPopin.hidePopin()},hideProductTagPopin:function(){this.productTagPopin&&this.productTagPopin.hidePopin()},closePopin:function(){this.genericPopin&&this.genericPopin.closePopin()},resizePopin:function(){this.genericPopin&&this.genericPopin.centerPopin()},removePasswordPopin:function(){this.pp&&(this.pp.remove(),this.pp=null,FSWidgetModel.gi().unset("passwordPopinVisible"),Backbone.Mediator.pub(StatsEvents.REGISTER_COLLECTION_VIEW)),this.po&&(this.po.remove(),this.po=null)},remove:function(){this.removePasswordPopin(),this.genericPopin&&(this.genericPopin.remove(),this.genericPopin=null),this.layoutManager&&(this.layoutManager.remove(),this.layoutManager=null),Backbone.Mediator.unsubscribe(WidgetEvent.WIDGET_VIEW_INIT,this.initWidgetView,this),Backbone.Mediator.unsubscribe(WidgetEvent.POPIN_OPEN,this.showPopin,this),Backbone.Mediator.unsubscribe(WidgetEvent.OPEN_PRODUCT_TAG_POPIN,this.showProductTagPopin,this),Backbone.Mediator.unsubscribe(WidgetEvent.POPIN_CLOSE,this.hidePopin,this),Backbone.Mediator.unsubscribe(WidgetEvent.CLOSE_PRODUCT_TAG_POPIN,this.hideProductTagPopin,this),Backbone.Mediator.unsubscribe(WidgetEvent.POPIN_RESIZE,this.resizePopin,this),Backbone.Mediator.unsubscribe(ShelfEvents.SHELF_OPENED,this.closePopin,this),FSWidgetModel.gi().destroy(),FSWidgetModel._instance=null,Backbone.View.prototype.remove.apply(this,arguments)}}),LayoutManager=Backbone.View.extend({events:function(){var mobileEvents={};return FSUtils.isIOS()?{touchend:"onMouseMoveClick",mousemove:"onMouseMoveClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave"}:(FSUtils.isMobileDevice()&&(mobileEvents={touchstart:"handleStopAutoHide",touchend:"handleStartAutoHide"}),$.extend({click:"onMouseMoveClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mousemove:"onMouseMoveClick"},mobileEvents))},template:_.template(Templates.mainLayout),templatePlayer:_.template(Templates.playerLayout),initialize:function(){var event=FSUtils.isMobileDevice()?"touchend":"click",self=this;this.isFormOpen=!1,this.isPopinOpen=!1,this.stopAutoHide=!1,this.initialClick=!1,this.buyCurtainTimeout=null,this.logoSize={width:0,height:0,bottom:0,right:0},FSUtils.isPlayerSkin()&&!FSWidgetModel.gi().get("isApp")?this.setElement(this.templatePlayer()):this.setElement(this.template()),this.$mainView=this.$el.find(ComponentContainers.MAIN_VIEW),this.collectionViewContainer=this.$el.find(ComponentContainers.COLLECTION_VIEW),this.menuContainer=this.$el.find(ComponentContainers.MENU),this.playerMenuContainer=this.$el.find(ComponentContainers.BOTTOM_BAR),this.navSlider=this.$el.find(ComponentContainers.NAV_SLIDER),this.flipViewContainer=this.$el.find(ComponentContainers.FLIP_VIEW),this.genericElement=this.$el.find(ComponentContainers.CUSTOM_TOOLTIP),this.shelfView=this.$el.find(ComponentContainers.SHELF_VIEW),this.customTooltip=null,this.clickToRead=null,FSWidgetModel.gi().widgetSettings.get("showFullScreenButton")&&FSWidgetModel.gi().widgetSettings.get("skinType")===WidgetSkinType.CLASSIC&&(this.clickToRead=new ClickToReadButton({model:new Backbone.Model({label:FSWidgetModel.gi().get("labels").l_click_to_read})})),this.buyButton=null,this.$buyCurtainContainer=this.$el.find(ComponentContainers.BUY_CURTAIN),this.buyCurtain=null,this.listenTo(FSWidgetModel.gi().widgetSettings,"change:mergePdfs",this.render),this.listenTo(FSWidgetModel.gi().widgetSettings,"change:showControls",this.onChangeShowControls),this.listenTo(FSWidgetModel.gi().widgetSettings,"change:showFullScreenButton",this.handleFullScreenOptionChange),this.listenTo(FSWidgetModel.gi().widgetState,"change:displayType",this.handleFullScreen),this.listenTo(FSWidgetModel.gi().widgetState,"change:displayState",this.render),this.listenTo(this.model,"change",this.onchange),this.listenTo(FSWidgetModel.gi(),"change:sell",this.handleSellChange),Backbone.Mediator.sub(WidgetEvent.RENDER_LAYOUT,this.render,this),Backbone.Mediator.sub(WidgetEvent.LEAD_FORM_OPENED,this.handleFormOpened,this),Backbone.Mediator.sub(WidgetEvent.LEAD_FORM_CLOSED,this.handleFormClosed,this),Backbone.Mediator.sub(WidgetEvent.ITEM_CHANGED,this.hideClickToReadButton,this),Backbone.Mediator.sub(WidgetEvent.PAGE_TURN_START,this.handlePageTurnStart,this),Backbone.Mediator.sub(WidgetEvent.LEAD_FORM_INPUT_FOCUS,this.hideClickToReadButton,this),Backbone.Mediator.sub(WidgetEvent.LEAD_FORM_INPUT_KEYPRESS,this.hideClickToReadButton,this),Backbone.Mediator.sub(WidgetEvent.POPIN_OPEN,this.handlePopinOpen,this),Backbone.Mediator.sub(WidgetEvent.POPIN_CLOSE,this.handlePopinClose,this),Backbone.Mediator.sub(WidgetEvent.ZOOM_CHANGED,this.handleZoomChanged,this),Backbone.Mediator.sub(WidgetEvent.ZOOM_END,this.handleZoomChanged,this),Backbone.Mediator.sub(ShelfEvents.SHELF_OPENED,this.hideMainView,this),Backbone.Mediator.sub(ShelfEvents.SHELF_CLOSED,this.showMainView,this),Backbone.Mediator.sub(WidgetEvent.START_AUTOHIDE,this.handleStartAutoHide,this),Backbone.Mediator.sub(WidgetEvent.STOP_AUTOHIDE,this.handleStopAutoHide,this),Backbone.Mediator.sub(WidgetEvent.CUSTOM_VIEW_LOADED,this.initCustomTooltip,this),window.CustomTooltipView&&this.initCustomTooltip(),FSUtils.isMobileDevice()||this.$el.on("mouseup",function(e){Backbone.Mediator.pub(e.type,e)}),this.$el.on(event,function(e){$(e.target).hasClass("form-input")||self.handleWidgetClickOrTap(e)}),FSWidgetModel.gi().get("isForSelling")&&(Backbone.Mediator.sub(WidgetEvent.PREV_PAGE,this.handlePageChange,this),Backbone.Mediator.sub(WidgetEvent.NEXT_PAGE,this.handlePageChange,this),Backbone.Mediator.sub(WidgetEvent.PAGE_TURN_END,this.handlePageChange,this),FSUtils.isPlayerSkin()&&Backbone.Mediator.sub(WidgetEvent.CHANGE_PAGE,this.handlePageChange,this),this.handlePageChange())},onMouseEnter:function(){var state=FSWidgetModel.gi().widgetState.get("displayType");this.initialClick&&!FSWidgetModel.gi().widgetState.get("isBuyCurtainDisplayed")&&(state===DisplayType.LARGE?(this.showControllers(),this.autoHideControllers()):this.showControllers())},onMouseLeave:function(){this.initialClick&&this.hideControllers(),FSWidgetModel.gi().widgetSettings.get("skinType")===WidgetSkinType.CLASSIC&&MenuController.gi().closeAll()},onMouseMoveClick:function(e){Backbone.Mediator.pub(e.type,e),(FSUtils.isInFullScreen()&&!FSWidgetModel.gi().widgetState.get("isBuyCurtainDisplayed")||FSUtils.isPlayerSkin())&&(this.showControllers(),this.autoHideControllers()),FSUtils.isInFullScreen()||"mousemove"!==e.type&&!FSUtils.isIOS()||this.showClickToReadButton()},onchange:function(){this.render(),this.model.changed&&(this.model.changed.width||this.model.changed.height||this.model.changed.logo)&&Backbone.Mediator.pub(WidgetEvent.RESIZE)},render:function(){var isCollectionViewVisible,cvMinHeight,w=this.model.get("width"),h=FSUtils.isPlayerSkin()?this.model.get("height")-LayoutManager.FLIPVIEW_BOTTOM_MARGIN:this.model.get("height"),cvwidth=0,cvheight=0,cvMargin=2*LayoutManager.COLLECTION_VIEW_VERTICAL_MARGIN,extraTopSpace=0,extraBottomSpace=0;return this.logoSize=this.model.get("logo")||this.logoSize,this.$el.css({position:"relative",width:w+"px",height:h+"px"}),FSWidgetModel.gi().widgetState.get("displayState")===DisplayState.NORMAL||FSWidgetModel.gi().get("forceWidget")&&FSWidgetModel.gi().widgetState.get("displayState")!==DisplayState.FULLSCREEN?(this.collectionViewContainer.hide(),this.flipViewContainer.css({left:"15px",top:this.getFlipTopBottom(),right:"15px",bottom:this.getFlipTopBottom()}),FSWidgetModel.gi().widgetState.set({displayType:DisplayType.SMALL})):(isCollectionViewVisible=FSWidgetModel.gi().checkCollectionViewVisibility(),cvMinHeight=h-cvMargin-this.logoSize.height-this.logoSize.bottom,isCollectionViewVisible?(cvwidth=LayoutManager.COLLECTION_VIEW_WIDTH+LayoutManager.MARGIN,cvheight=this.logoSize.height>0?cvMinHeight:h-cvMargin,this.collectionViewContainer.css({display:"block",height:cvheight+"px"})):this.collectionViewContainer.hide(),FSWidgetModel.gi().set("mainContentWidth",this.logoSize.width>0?w-2*LayoutManager.MARGIN-this.logoSize.width-this.logoSize.right:w-cvwidth-2*LayoutManager.MARGIN),FSWidgetModel.gi().widgetSettings.get("showThumbViewer")&&this.navSlider.css({display:"block"}),extraTopSpace=50,extraBottomSpace=2*NavSliderView.MARGIN+NavSliderView.HEIGHT-LayoutManager.MARGIN,this.flipViewContainer.css({left:LayoutManager.MARGIN+"px",top:FSUtils.isMobileDevice()?0:LayoutManager.MARGIN+extraTopSpace+"px",right:LayoutManager.MARGIN+cvwidth+"px",bottom:FSUtils.isMobileDevice()?0:LayoutManager.MARGIN+extraBottomSpace+"px",display:"block"}),FSWidgetModel.gi().widgetState.set({displayType:DisplayType.LARGE})),this.automatorView||(this.automatorView=new AutomatorView({model:new Backbone.Model({})}),this.$mainView.append(this.automatorView.render().$el)),this.clickToRead&&(this.$el.append(this.clickToRead.render().$el),this.clickToRead.render().$el.after(this.$buyCurtainContainer)),FSWidgetModel.gi().get("isForSelling")&&(this.buyButton||(this.buyButton=new BuyButton({model:new Backbone.Model({price:FSWidgetModel.gi().get("sell").price,buyLink:FSWidgetModel.gi().get("sell").buyLink,isInSubscription:FSWidgetModel.gi().get("isInSubscription"),subscriptionFlipbooks:FSWidgetModel.gi().get("sell").subscriptionFlipbooks,subscriptionPrice:FSWidgetModel.gi().get("sell").subscriptionPrice,singleFlipbook:FSWidgetModel.gi().get("labels").l_single_flipbook,issues:FSWidgetModel.gi().get("labels").l_issues,buySubscription:FSWidgetModel.gi().get("labels").l_subscription,buyLabel:FSWidgetModel.gi().get("labels").l_buy})}),this.$el.append(this.buyButton.render().$el)),this.buyCurtain||(this.buyCurtain=new BuyCurtain({model:new Backbone.Model({message:FSWidgetModel.gi().get("labels").l_cortina_message,title:FSWidgetModel.gi().flipCollection.get("title"),author:FSWidgetModel.gi().get("author"),userUrl:URLPaths.BASE+"/"+FSWidgetModel.gi().get("userProfile")+"/",price:FSWidgetModel.gi().get("sell").price,buyLink:FSWidgetModel.gi().get("sell").buyLink,isInSubscription:FSWidgetModel.gi().get("isInSubscription"),subscriptionFlipbooks:FSWidgetModel.gi().get("sell").subscriptionFlipbooks,subscriptionPrice:FSWidgetModel.gi().get("sell").subscriptionPrice,singleFlipbook:FSWidgetModel.gi().get("labels").l_single_flipbook,issues:FSWidgetModel.gi().get("labels").l_issues,buySubscription:FSWidgetModel.gi().get("labels").l_subscription,buyLabel:FSWidgetModel.gi().get("labels").l_buy,isPlayerSkin:FSUtils.isPlayerSkin()})}),this.$buyCurtainContainer.append(this.buyCurtain.render().$el).show())),FSUtils.isMobileDevice()&&this.navSlider.find(".nav-slider-back").addClass("visible"),(!0===FSWidgetModel.gi().get("isApp")||FSUtils.isMobileDevice())&&this.navSlider.addClass("mobile-slider"),this.isFullScreenView()||this.showClickToReadButton(),!this.toc&&FSWidgetModel.gi().widgetSettings.get("enableToc")&&this.addToc(),FSWidgetModel.gi().get("isForSelling")&&FSUtils.isPlayerSkin()&&this.$buyCurtainContainer.css({height:this.isFullScreenView?$(window).height():this.model.get("height")}),this},addToc:function(){var tocData=FSWidgetModel.gi().getTOCData();this.toc=new TableOfContent({model:new Backbone.Model(tocData)}),FSUtils.isPlayerSkin()?this.$el.find("#player-toc-container").append(this.toc.render().el):this.$el.find("#toc-container").append(this.toc.render().el)},getFlipTopBottom:function(){return FSWidgetModel.gi().canShowControls()?"46px":FSUtils.isMobileDevice()?"5px":"15px"},handleFullScreen:function(e){FSWidgetModel.gi().widgetState.get("displayType")===DisplayType.LARGE?this.autoHideControllers():(clearTimeout(this.controllersTimeout),this.controllersTimeout=null)},handleStopAutoHide:function(){FSWidgetModel.gi().widgetState.get("isBuyCurtainDisplayed")||(this.stopAutoHide=!0,this.showControllers())},handleStartAutoHide:function(){this.stopAutoHide=!1,(FSUtils.isInFullScreen()&&!FSWidgetModel.gi().widgetState.get("isBuyCurtainDisplayed")||FSUtils.isPlayerSkin())&&(this.showControllers(),this.autoHideControllers())},showClickToReadButton:function(){var widgetType=FSWidgetModel.gi().widgetSettings.get("widgetType"),forceWidget=FSWidgetModel.gi().get("forceWidget");this.clickToRead&&(FSWidgetModel.gi().widgetState.get("isBuyCurtainDisplayed")||!FSWidgetModel.gi().widgetSettings.get("showFullScreenButton")||FSWidgetModel.gi().widgetState.get("displayType")!==DisplayType.SMALL||this.isFormOpen||this.isPopinOpen||widgetType===WidgetType.SHELF&&!forceWidget?this.clickToRead.hide():this.clickToRead.show())},hideClickToReadButton:function(){this.clickToRead&&this.clickToRead.hide()},showMenuContainer:function(){FSUtils.isPlayerSkin()?this.playerMenuContainer.css({visibility:"",opacity:1}):this.menuContainer.css({visibility:"",opacity:1})},showNavSlider:function(){FSWidgetModel.gi().widgetSettings.get("showThumbView")&&this.navSlider.css({visibility:"",opacity:1})},hideControllers:function(){var _this=this;FSUtils.isPlayerSkin()?this.playerMenuContainer.css({opacity:0}):(this.navSlider.css({opacity:0}),this.menuContainer.css({opacity:0}),this.hideClickToReadButton()),this.visibilityTimeOut=setTimeout(function(){FSUtils.isPlayerSkin()?_this.playerMenuContainer.css({visibility:"hidden"}):(_this.navSlider.css({visibility:"hidden"}),_this.menuContainer.css({visibility:"hidden"}))},300)},autoHideControllers:function(){var _this=this;if(this.stopAutoHide)return!0;clearTimeout(this.controllersTimeout),this.controllersTimeout=null,this.controllersTimeout=setTimeout(function(){_this.hideControllers(),Backbone.Mediator.pub(WidgetEvent.AUTOHIDE_CONTROLS)},CLICKTOREAD_SHOW_INTERVAL)},showControllers:function(){clearTimeout(this.controllersTimeout),clearTimeout(this.visibilityTimeOut),this.controllersTimeout=null,this.visibilityTimeOut=null,this.showNavSlider(),this.showMenuContainer(),this.showClickToReadButton()},handlePageTurnStart:function(){this.hideClickToReadButton()},handleFormOpened:function(){this.isFormOpen=!0,this.hideClickToReadButton()},handleFormClosed:function(){this.isFormOpen=!1,this.showClickToReadButton()},handlePopinOpen:function(){this.isPopinOpen=!0,this.hideClickToReadButton()},handlePopinClose:function(){this.isPopinOpen=!1,this.showClickToReadButton()},handleWidgetClickOrTap:function(event){this.initialClick=!0,Backbone.Mediator.pub(WidgetEvent.WIDGET_CLICK_OR_TAP,event)},handleZoomChanged:function(){FSWidgetModel.gi().get("currentZoom")>0?this.$mainView.addClass("zoomed"):this.$mainView.removeClass("zoomed")},initCustomTooltip:function(){this.customTooltip||(this.customTooltip=new CustomTooltipView,this.genericElement.append(this.customTooltip.render().$el))},onChangeShowControls:function(){this.render(),this.showControllers()},remove:function(){this.$el.off(),clearTimeout(this.controllersTimeout),this.controllersTimeout=null,clearTimeout(this.buyCurtainTimeout),this.buyCurtainTimeout=null,this.clickToRead&&(this.clickToRead.remove(),this.clickToRead=null),this.customTooltip&&(this.customTooltip.remove(),this.customTooltip=null),Backbone.Mediator.unsubscribe(WidgetEvent.RENDER_LAYOUT,this.render,this),Backbone.Mediator.unsubscribe(WidgetEvent.LEAD_FORM_OPENED,this.handleFormOpened,this),Backbone.Mediator.unsubscribe(WidgetEvent.LEAD_FORM_CLOSED,this.handleFormClosed,this),Backbone.Mediator.unsubscribe(WidgetEvent.ITEM_CHANGED,this.hideClickToReadButton,this),Backbone.Mediator.unsubscribe(WidgetEvent.PAGE_TURN_START,this.hideClickToReadButton,this),Backbone.Mediator.unsubscribe(WidgetEvent.LEAD_FORM_INPUT_FOCUS,this.hideClickToReadButton,this),Backbone.Mediator.unsubscribe(WidgetEvent.LEAD_FORM_INPUT_KEYPRESS,this.hideClickToReadButton,this),Backbone.Mediator.unsubscribe(WidgetEvent.POPIN_OPEN,this.handlePopinOpen,this),Backbone.Mediator.unsubscribe(WidgetEvent.POPIN_CLOSE,this.handlePopinClose,this),Backbone.Mediator.unsubscribe(WidgetEvent.ZOOM_CHANGED,this.handleZoomChanged,this),Backbone.Mediator.unsubscribe(WidgetEvent.ZOOM_END,this.handleZoomChanged,this),Backbone.Mediator.unsubscribe(WidgetEvent.CUSTOM_VIEW_LOADED,this.initCustomTooltip,this),Backbone.Mediator.unsubscribe(ShelfEvents.SHELF_OPENED,this.hideMainView,this),Backbone.Mediator.unsubscribe(ShelfEvents.SHELF_CLOSED,this.showMainView,this),Backbone.View.prototype.remove.apply(this,arguments)},hideMainView:function(){this.$mainView.hide()},showMainView:function(){this.$mainView.show()},isFullScreenView:function(){return FSWidgetModel.gi().widgetState.get("displayType")===DisplayType.LARGE},handleSellChange:function(){var previewPages,leftPage,rightPage,totalPages;FSWidgetModel.gi().get("isForSelling")&&(this.buyButton&&(this.buyButton.model.set("price",FSWidgetModel.gi().get("sell").price),this.buyButton.model.set("isInSubscription",FSWidgetModel.gi().get("isInSubscription")),this.buyButton.model.set("subscriptionPrice",FSWidgetModel.gi().get("sell").subscriptionPrice),this.buyButton.model.set("subscriptionFlipbooks",FSWidgetModel.gi().get("sell").subscriptionFlipbooks)),this.buyCurtain&&(this.buyCurtain.model.set("price",FSWidgetModel.gi().get("sell").price),this.buyCurtain.model.set("isInSubscription",FSWidgetModel.gi().get("isInSubscription")),this.buyCurtain.model.set("subscriptionPrice",FSWidgetModel.gi().get("sell").subscriptionPrice),this.buyCurtain.model.set("subscriptionFlipbooks",FSWidgetModel.gi().get("sell").subscriptionFlipbooks),previewPages=FSWidgetModel.gi().get("sell").previewPages,FSWidgetModel.gi().widgetSettings.get("arabicStyle")&&(totalPages=FSWidgetModel.gi().widgetState.get("currentItem").get("pages").length,previewPages=previewPages.map(function(pageNumber){return totalPages-pageNumber+1})),rightPage=(leftPage=FSWidgetModel.gi().widgetState.get("currentPageIndex")+1)+1,previewPages.includes(leftPage)||previewPages.includes(rightPage)?(this.hideBuyCurtain(),this.buyButton.$el.show(),this.showControllers()):(this.showBuyCurtain(),this.buyButton.$el.hide(),this.hideControllers())))},showBuyCurtain:function(){FSWidgetModel.gi().get("isForSelling")&&(this.$buyCurtainContainer.addClass("visible"),FSWidgetModel.gi().widgetState.set("isBuyCurtainDisplayed",!0),this.hideClickToReadButton())},hideBuyCurtain:function(){FSWidgetModel.gi().get("isForSelling")&&(this.$buyCurtainContainer.removeClass("visible"),FSWidgetModel.gi().widgetState.set("isBuyCurtainDisplayed",!1),this.showClickToReadButton())},handlePageChange:function(){var self=this;FSWidgetModel.gi().get("isForSelling")&&(clearTimeout(this.buyCurtainTimeout),this.buyCurtainTimeout=setTimeout(function(){self.delayBuyCurtainChange()},PAGE_TURN_DURATION/5))},delayBuyCurtainChange:function(){this.shouldDisplayBuyCurtain()?(this.showBuyCurtain(),this.buyButton.$el.hide(),this.hideControllers()):(this.hideBuyCurtain(),this.buyButton.$el.show(),this.showControllers())},shouldDisplayBuyCurtain:function(){var isSinglePageView=FSWidgetModel.gi().widgetSettings.get("singlePageView"),totalPages=FSWidgetModel.gi().widgetState.get("currentItem").get("pages").length,pageIdx=FSWidgetModel.gi().widgetState.get("currentPageIndex"),page=FSWidgetModel.gi().widgetState.get("currentItem").get("pages").at(pageIdx),nextPage=FSWidgetModel.gi().widgetState.get("currentItem").get("pages").at(pageIdx+1);return(0===pageIdx||pageIdx===totalPages-1||isSinglePageView)&&page.get("isBlockedForSellingPreview")||!isSinglePageView&&pageIdx>0&&pageIdx<totalPages-1&&(page.get("isBlockedForSellingPreview")||nextPage&&nextPage.get("isBlockedForSellingPreview"))},handleFullScreenOptionChange:function(){FSWidgetModel.gi().widgetSettings.get("showFullScreenButton")?this.showClickToReadButton():this.hideClickToReadButton()}});LayoutManager.MARGIN=15,LayoutManager.COLLECTION_VIEW_VERTICAL_MARGIN=40,LayoutManager.COLLECTION_VIEW_WIDTH=110,LayoutManager.FLIPVIEW_BOTTOM_MARGIN=78;var LeadFormView=Backbone.View.extend({template:_.template(Templates.leadForm),id:ComponentContainers.LEAD_FORM,events:{"click .submit-button":"submitForm"},initialize:function(){this.formIsOutside=null,this.formHasMandatoryFields=this.getFormHasMandatoryElements(),this.resizeTimeout=null,this.firstPageThumb="",this.newForm=this.isNewVersion(),this.setupDays(),this.setupMonths(),this.setupYears(),this.listenTo(this.model,"change:pageSize",this.resize),Backbone.Mediator.sub(WidgetEvent.COUNTRIES_LOADED,this.countriesLoaded,this),this.render()},render:function(){return this.$el.html(this.template(this.model.attributes)),this.mainContainer=this.$el.find(".form-main"),this.formContainer=this.$el.find(".form-container"),this.titleContainer=this.$el.find(".form-header"),this.contentContainer=this.$el.find(".form-content"),this.footerContainer=this.$el.find(".form-footer"),this.formHasMandatoryFields||this.footerContainer.find(".form-required").css("visibility","hidden"),this.newForm&&this.createNewFormTemplate(),this.createElements(),this.formPadding=parseInt(this.$el.css("padding-top"),10),this.$el.css("visibility","hidden"),this.model.get("pageContainer").append(this.$el),this.resize(),Backbone.Mediator.pub(WidgetEvent.LEAD_FORM_OPENED,this.model.attributes),this},createNewFormTemplate:function(){this.footerContainer.find(".form-required").css("display","none"),this.mainContainer.parent().addClass("new-form"),this.firstPageThumb="https:"+FSWidgetModel.gi().getFirstPageThumb(),this.coverImage=new Image,this.coverImage.src=this.firstPageThumb,$(this.coverImage).attr("width",200),$(this.coverImage).attr("height","auto"),$(this.coverImage).addClass("cover-img"),this.mainContainer.prepend(this.coverImage),this.scaleNewForm()},countriesLoaded:function(){var countryElements=this.contentContainer.find("select[data-type=country]"),self=this;countryElements.length>0&&_.each(countryElements,function(element){self.setDropdownOptions($(element),FSWidgetModel.gi().getCountryOptions())})},resize:function(){var self=this;clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){self.setFormSize()},10),this.scaleNewForm()},setFormSize:function(){var newHeight,maxFormWidth,maxFormHeight,size=this.model.get("pageSize"),pageWidth=size[0],pageHeight=size[1],widgetHeight=FSWidgetModel.gi().get("height"),formHeight=this.titleContainer.height()+parseInt(this.titleContainer.css("padding-bottom"),10)+this.contentContainer.height()+this.footerContainer.height(),formWidth=this.contentContainer.width()+2*parseInt(this.$el.css("padding-left"),10);this.newForm?(this.$el.height("auto"),this.mainContainer.height("auto")):(this.formPadding||(this.formPadding=parseInt(this.$el.css("padding-top"),10)),maxFormWidth=pageWidth-2*LeadFormView.FORM_SHADOW-2*this.formPadding,maxFormHeight=pageHeight-2*LeadFormView.FORM_SHADOW-2*this.formPadding,maxFormWidth<formWidth+20?(maxFormHeight=widgetHeight-2*LeadFormView.FORM_SHADOW-2*this.formPadding,this.formIsOutside||(this.placeFormOverBook(),this.formIsOutside=!0)):(this.formIsOutside||"boolean"!=typeof this.formIsOutside)&&(this.placeFormInsidePage(),this.formIsOutside=!1),newHeight=Math.min(maxFormHeight,formHeight),this.$el.height(newHeight),this.mainContainer.height(newHeight)),this.$el.css("visibility","visible")},placeFormOverBook:function(){var docView=this.model.get("widgetContainer").find("#docView")[0];this.newForm&&0===$(docView).find(".form-bg-layer").length&&$(docView).append('<div class="form-bg-layer"></div>'),this.model.get("widgetContainer").append(this.$el)},placeFormInsidePage:function(){this.model.get("pageContainer").append(this.$el)},createElements:function(){var self=this;_.each(this.model.get("elements"),function(element,index){var elementType="string"==typeof element.type?parseInt(element.type,10):element.type,elemCreator=self.getElementCreator(elementType,index);elemCreator&&"function"==typeof elemCreator.getCreator&&elemCreator.getCreator.call(self,element)})},getElementCreator:function(elementType,index){var fieldIndex="f_"+index,typeOfElements=[{type:LeadFormField.FIELD_TYPE_INPUT,getCreator:function(element){this.createLabel(fieldIndex,element.name,element.mandatory),this.createTextInput(fieldIndex,"text",element.mandatory),element.mandatory&&this.createErrorLabel(fieldIndex,this.model.get("labels").fieldRequiredLabel)}},{type:LeadFormField.FIELD_TYPE_COUNTRY,getCreator:function(element){this.createLabel(fieldIndex,element.name,element.mandatory),this.createDropdown(fieldIndex,FSWidgetModel.gi().getCountryOptions(),"country",element.mandatory,{type:"country"}),element.mandatory&&this.createErrorLabel(fieldIndex,this.model.get("labels").fieldRequiredLabel)}},{type:LeadFormField.FIELD_TYPE_CUSTOM_DROPDOWN,getCreator:function(element){this.createLabel(fieldIndex,element.name,element.mandatory),this.createDropdown(fieldIndex,element.ddvalues.split(","),"custom",element.mandatory,{type:"mandatory"}),element.mandatory&&this.createErrorLabel(fieldIndex,this.model.get("labels").fieldRequiredLabel)}},{type:LeadFormField.FIELD_TYPE_MDY_DATE,getCreator:function(element){this.createLabel(fieldIndex,element.name,element.mandatory),this.createDateField(fieldIndex,element.type,element.mandatory),element.mandatory&&this.createErrorLabel(fieldIndex,this.model.get("labels").fieldRequiredLabel)}},{type:LeadFormField.FIELD_TYPE_DMY_DATE,getCreator:function(element){this.createLabel(fieldIndex,element.name,element.mandatory),this.createDateField(fieldIndex,element.type,element.mandatory),element.mandatory&&this.createErrorLabel(fieldIndex,this.model.get("labels").fieldRequiredLabel)}},{type:LeadFormField.FIELD_TYPE_CHECKBOX,getCreator:function(element){this.createCheckbox(fieldIndex,element.name,element.mandatory),element.mandatory&&this.createErrorLabel(fieldIndex,this.model.get("labels").fieldRequiredLabel,"cb")}},{type:LeadFormField.FIELD_TYPE_TEXTAREA,getCreator:function(element){this.createLabel(fieldIndex,element.name,element.mandatory),this.createTextArea(fieldIndex,element.lines,element.mandatory)}},{type:LeadFormField.FIELD_TYPE_EMAIL,getCreator:function(element){this.createLabel(fieldIndex,element.name,element.mandatory),this.createTextInput(fieldIndex,"email",element.mandatory),this.createErrorLabel(fieldIndex,this.model.get("labels").validEmailLabel)}},{type:LeadFormField.FIELD_TYPE_BIRTHDATE_MDY,getCreator:function(element){this.createLabel(fieldIndex,element.name,element.mandatory),this.createDateField(fieldIndex,element.type,element.mandatory),element.mandatory&&this.createErrorLabel(fieldIndex,this.model.get("labels").fieldRequiredLabel)}},{type:LeadFormField.FIELD_TYPE_BIRTHDATE_DMY,getCreator:function(element){this.createLabel(fieldIndex,element.name,element.mandatory),this.createDateField(fieldIndex,element.type,element.mandatory),element.mandatory&&this.createErrorLabel(fieldIndex,this.model.get("labels").fieldRequiredLabel)}}];return _.find(typeOfElements,function(item){return item.type===elementType})},createLabel:function(id,labelValue,isMandatory,forID){var labelElement=_.template(Templates.leadFormLabel)({label:labelValue,mandatory:isMandatory}),$label=$(labelElement).attr("data-index",id);this.newForm||("string"==typeof forID&&forID.length>0&&$label.attr("for",forID),this.contentContainer.append($label))},createErrorLabel:function(id,labelValue,className){var errorElement=_.template(Templates.leadFormError)({error:labelValue}),$error=$(errorElement).attr("data-index",id).hide();"string"==typeof className&&className.length>0&&$error.addClass(className),this.contentContainer.append($error)},disableFieldError:function(event){var id,targetSiblings,errorLabel,target=$(event.currentTarget);target.hasClass("error")&&(id=target.attr("data-index"),targetSiblings=target.siblings("[data-index="+id+"]"),errorLabel=target.siblings(".error-label[data-index="+id+"]"),target.removeClass("error"),targetSiblings.removeClass(".error"),0===errorLabel.length&&(errorLabel=target.parent().find(".error-label[data-index="+id+"]")),errorLabel.hide())},handleInputFocus:function(event){Backbone.Mediator.pub(WidgetEvent.LEAD_FORM_INPUT_FOCUS),this.disableFieldError(event)},handleInputKeypress:function(){Backbone.Mediator.pub(WidgetEvent.LEAD_FORM_INPUT_KEYPRESS)},createTextInput:function(id,inputType,isMandatory){var inputElement=_.template(Templates.leadFormInput)({type:inputType}),$element=$(inputElement).attr("data-index",id).attr("placeholder",this.model.get("placeholder"));this.newForm&&$element.addClass("new-form-input"),isMandatory&&$element.addClass("mandatory"),$element.on("focus",$.proxy(this.handleInputFocus,this)),$element.on("keypress",$.proxy(this.handleInputKeypress,this)),this.contentContainer.append($element)},createTextArea:function(id,noOfLines,isMandatory){var inputElement=_.template(Templates.leadFormTextArea)(),$element=$(inputElement);noOfLines="number"==typeof noOfLines&&noOfLines>0?noOfLines:2,$element.attr("rows",noOfLines),isMandatory&&$element.addClass("mandatory"),$element.on("focus",$.proxy(this.handleInputFocus,this)),$element.on("keypress",$.proxy(this.handleInputKeypress,this)),this.contentContainer.append($element)},createDropdown:function(id,list,className,isMandatory,attributes,changeCallback){var dropdownElement=_.template(Templates.leadFormDropDown)(),$dropdown=$(dropdownElement),self=this;$dropdown.attr("data-index",id),"string"==typeof className&&className.length>0&&$dropdown.addClass(className),isMandatory&&$dropdown.addClass("mandatory"),attributes&&_.each(attributes,function(attrValue,attrName){$dropdown.attr("data-"+attrName,attrValue)}),$dropdown.on("focus",$.proxy(this.handleInputFocus,this)),this.setDropdownOptions($dropdown,list),this.contentContainer.append($dropdown),"function"==typeof changeCallback&&$dropdown.on("change",function(event){changeCallback.call(self,event)})},setDropdownOptions:function(ddInput,list){var optionsStr="";ddInput.empty(),"string"==typeof list?list.length>0&&(optionsStr=list):optionsStr=list.map(function(listItem){return'<option value="'+listItem+'">'+listItem+"</option>"}).join(""),ddInput.html(optionsStr)},createCheckbox:function(id,labelValue,isMandatory){var element=_.template(Templates.leadFormCheckbox)({label:labelValue,id:id}),$element=$(element),$cbElement=$element.find("input");$element.attr("data-index",id),$cbElement.attr("data-index",id),isMandatory&&$cbElement.addClass("mandatory"),$element.on("click",$.proxy(this.handleInputFocus,this)),this.contentContainer.append($element)},createDateField:function(id,type,isMandatory){type===LeadFormField.FIELD_TYPE_DMY_DATE||type===LeadFormField.FIELD_TYPE_BIRTHDATE_DMY?(this.createDropdown(id,this.days31Str,"day",isMandatory,{type:"day-"+id},null),this.createDropdown(id,this.monthsStr,"month",isMandatory,{type:"month-"+id},this.handleDateChanged)):(this.createDropdown(id,this.monthsStr,"month",isMandatory,{type:"month-"+id},this.handleDateChanged),this.createDropdown(id,this.days31Str,"day",isMandatory,{type:"day-"+id},null)),type===LeadFormField.FIELD_TYPE_BIRTHDATE_DMY||type===LeadFormField.FIELD_TYPE_BIRTHDATE_MDY?this.createDropdown(id,this.bdYearsStr,"year",isMandatory,{type:"year-"+id},this.handleDateChanged):this.createDropdown(id,this.yearsStr,"year",isMandatory,{type:"year-"+id},this.handleDateChanged)},setupYears:function(){var currentYear=(new Date).getFullYear(),startYear=currentYear+15,noOfYears=99,endYear=startYear-noOfYears,i=startYear;for(this.years=["----"];i>=endYear;i--)this.years.push(i);for(endYear=(startYear=currentYear)-(noOfYears=149),this.bdYears=["----"],i=startYear;i>=endYear;i--)this.bdYears.push(i);this.yearsStr=this.getOptionList(this.years),this.bdYearsStr=this.getOptionList(this.bdYears)},setupMonths:function(){this.months=["--",1,2,3,4,5,6,7,8,9,10,11,12],this.month31=[0,1,3,5,7,8,10,12],this.monthsStr=this.getOptionList(this.months)},setupDays:function(){var i;for(this.days28=["--"],this.days29=["--"],this.days30=["--"],this.days31=["--"],i=1;i<=31;i++)i<=28&&this.days28.push(i),i<=29&&this.days29.push(i),i<=30&&this.days30.push(i),i<=31&&this.days31.push(i);this.days28Str=this.getOptionList(this.days28),this.days29Str=this.getOptionList(this.days29),this.days30Str=this.getOptionList(this.days30),this.days31Str=this.getOptionList(this.days31)},getOptionList:function(list){return list.map(function(item){return'<option value="'+item+'">'+item+"</option>"}).join("")},handleDateChanged:function(event){var elementDataIndex=$(event.currentTarget).attr("data-type").split("-")[1],dayInput=this.$el.find("select[data-type=day-"+elementDataIndex+"]"),monthInput=this.$el.find("select[data-type=month-"+elementDataIndex+"]"),yearInput=this.$el.find("select[data-type=year-"+elementDataIndex+"]");this.setDate(dayInput,monthInput,yearInput)},setDate:function(dInput,mInput,yInput){var selectedMonth=mInput[0].selectedIndex,selectedYear="----"===yInput[0].value?0:parseInt(yInput[0].value,10),selectedDay=dInput[0].selectedIndex;2===selectedMonth?selectedYear%4==0?(this.setDropdownOptions(dInput,this.days29Str),dInput[0].selectedIndex=selectedDay>29?29:selectedDay):(this.setDropdownOptions(dInput,this.days28Str),dInput[0].selectedIndex=selectedDay>28?28:selectedDay):this.month31.indexOf(selectedMonth)>-1?(this.setDropdownOptions(dInput,this.days31Str),dInput[0].selectedIndex=selectedDay):(this.setDropdownOptions(dInput,this.days30Str),dInput[0].selectedIndex=selectedDay>30?30:selectedDay)},getFormHasMandatoryElements:function(){var elements=this.model.get("elements");return!(!elements||"function"!=typeof elements.some)&&this.model.get("elements").some(function(element){return element.mandatory})},checkMandatoryElements:function(){var currentContainerTopOffset,firstMandatoryTopOffset,newTopOffset,mandatoryFields=this.contentContainer.find(".mandatory"),self=this,fieldsOk=!0,problemFields=[];return mandatoryFields.length>0&&(fieldsOk=!0,problemFields=[],mandatoryFields.each(function(){var id,isFieldValueSet=!1;"checkbox"===this.type?isFieldValueSet=this.checked:"string"==typeof this.value&&this.value.length>0&&("textarea"===this.type?isFieldValueSet=!0:"email"===this.type?FSUtils.isEmailValid(this.value)&&(isFieldValueSet=!0):this.value!==LeadFormView.TWO_DASH&&this.value!==LeadFormView.FOUR_DASH&&(isFieldValueSet=!0)),isFieldValueSet||(id=$(this).attr("data-index"),$(this).addClass("error"),"checkbox"===this.type&&$(this).parent().addClass("error"),this.newForm||self.contentContainer.find(".error-label[data-index="+id+"]").show(),fieldsOk=!1,problemFields.push($(this)))}),fieldsOk||(currentContainerTopOffset=this.formContainer.offset().top,firstMandatoryTopOffset=problemFields[0].offset().top,"checkbox"===mandatoryFields.first().attr("type")||this.newForm||(firstMandatoryTopOffset=problemFields[0].prev().offset().top),newTopOffset=firstMandatoryTopOffset-currentContainerTopOffset+this.formContainer.scrollTop(),this.mainContainer.scrollTop(newTopOffset)),!fieldsOk)},haveInvalidEmails:function(){var emailInputs=this.contentContainer.find("input[type=email]"),invalidEmails=!1,self=this;return emailInputs.length>0&&emailInputs.each(function(){var id;"string"==typeof this.value&&this.value.length>0&&!FSUtils.isEmailValid(this.value)&&(invalidEmails=!0,id=$(this).attr("data-index"),$(this).addClass("error"),self.contentContainer.find(".error-label[data-index="+id+"]").show())}),invalidEmails},getFormData:function(){var self=this,formData={collectionHash:FSWidgetModel.gi().get("collectionHash"),Timestamp:(new Date).toISOString(),fields:[]};return formData["Book title"]=this.model.get("bookTitle"),formData["Page index"]=this.model.get("realPageNumber"),_.each(this.model.get("elements"),function(element,index){var field=self.contentContainer.find(".form-input[data-index=f_"+index+"]");if(field.length>0)switch(element.type){case LeadFormField.FIELD_TYPE_CHECKBOX:formData.fields.push({name:element.name,value:field.first()[0].checked});break;case LeadFormField.FIELD_TYPE_MDY_DATE:case LeadFormField.FIELD_TYPE_DMY_DATE:case LeadFormField.FIELD_TYPE_BIRTHDATE_MDY:case LeadFormField.FIELD_TYPE_BIRTHDATE_DMY:formData.fields.push({name:element.name,value:field.eq(0)[0].value+"/"+field.eq(1)[0].value+"/"+field.eq(2)[0].value});break;default:formData.fields.push({name:element.name,value:field[0].value})}}),formData},submitForm:function(){this.checkMandatoryElements()||this.haveInvalidEmails()||(FlipSnackEmbed.isEditor||Backbone.Mediator.pub(WidgetEvent.SEND_LEAD_FORM,this.getFormData()),this.saveSubmitedInfo(),Backbone.Mediator.pub(WidgetEvent.LEAD_FORM_SENT,this.model.attributes))},saveSubmitedInfo:function(){var hash;this.newForm&&(hash=FSWidgetModel.gi().get("collectionHash"),localStorage.setItem(hash,1))},remove:function(){this.model.get("widgetContainer").find(".form-bg-layer").length>0&&this.model.get("widgetContainer").find(".form-bg-layer")[0].remove(),this.$el.remove(),Backbone.Mediator.unsubscribe(WidgetEvent.COUNTRIES_LOADED,this.countriesLoaded,this),Backbone.View.prototype.remove.apply(this)},close:function(){Backbone.Mediator.pub(WidgetEvent.LEAD_FORM_CLOSED,this.model.attributes),this.registerClickEvent(),this.remove()},registerClickEvent:function(){Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:Stats.TYPE.CLICK_ELEMENT,pid:this.model.get("pid"),elid:this.model.get("eID")})},isNewVersion:function(){return this.model.get("formVersion")&&1===parseInt(this.model.get("formVersion"),10)},scaleNewForm:function(){var size=this.model.get("pageSize"),pid=this.model.get("realPageNumber"),pageWidth=size[0],percentage=1,difference=0,noOfPages=FSWidgetModel.gi().widgetState.get("currentItem").get("noOfPages"),singlePage=FSWidgetModel.gi().widgetSettings.get("singlePageView");pageWidth<LeadFormView.NEW_FORM_WIDTH&&(difference=LeadFormView.NEW_FORM_WIDTH-pageWidth,percentage=(100-parseInt(100*difference/LeadFormView.NEW_FORM_WIDTH,10))/100),pid%2!=0||this.model.get("pageIndex")+1===noOfPages||singlePage||this.placeFormOverBook(),this.$el.css("transform","translate(-50%, -50%) scale("+percentage+")")}});LeadFormView._instance=null,LeadFormView.gi=function(options){return!LeadFormView._instance&&options&&(LeadFormView._instance=new LeadFormView(options)),LeadFormView._instance},LeadFormView.hasInstance=function(){return void 0!==LeadFormView._instance&&null!==LeadFormView._instance},LeadFormView.close=function(){LeadFormView._instance&&(clearTimeout(LeadFormView._instance.resizeTimeout),LeadFormView._instance.close(),LeadFormView._instance=null,$("#leadForm").remove())},LeadFormView.FORM_SHADOW=8,LeadFormView.TWO_DASH="--",LeadFormView.FOUR_DASH="----",LeadFormView.NEW_FORM_WIDTH="509",function(global){window.NavSliderView=Backbone.View.extend({events:{mouseover:"handleMouseOver",mouseout:"handleMouseOut"},el:ComponentContainers.NAV_SLIDER,template:_.template(Templates.navSlider),initialize:function(){this.render(),this.hasTouch=FSUtils.hasTouch(),this.isMobile=FSUtils.isMobileDevice(),this.downEvent=this.hasTouch?"touchstart":"mousedown",this.moveEvent=this.hasTouch?"touchmove":"mousemove",this.endEvent=this.hasTouch?"touchend":"mouseup",this.direction="left",this.currentPoint=FSWidgetModel.gi().widgetState.get("currentPageIndex"),this.isSinglePageView=FSWidgetModel.gi().widgetSettings.get("singlePageView"),this.isArabicStyle=FSWidgetModel.gi().widgetSettings.get("arabicStyle"),this.$slider=this.$el.find(".nav-slider"),this.$components=this.$el.find(".nav-slider-components"),this.$knob=this.$el.find(".nav-slider-knob"),this.$tooltipContainer=this.$el.find(".nav-slider-tooltip-container"),this.$tooltip=this.$el.find(".nav-slider-tooltip"),this.$thumb=this.$el.find(".nav-slider-thumb"),this.computeVars(),this.previousX=this.positionX,this.leftThumb=new SimpleLoader({model:new SimpleLoaderModel({width:this.thumbWidth,height:NavSliderView.THUMB_HEIGHT,scaleMode:"scale"})}),this.rightThumb=new SimpleLoader({model:new SimpleLoaderModel({width:this.thumbWidth,height:NavSliderView.THUMB_HEIGHT,scaleMode:"scale"})}),this.$thumb.append(this.leftThumb.render().$el),this.$thumb.append(this.rightThumb.render().$el),this.$knob.on(this.downEvent,{self:this},this.onEventDown),this.$knob.on(this.endEvent,{self:this},this.onEventEnd),this.$knob.on("mouseenter",{self:this},this.onKnobMouseEnter),this.$knob.on("mouseleave",{self:this},this.onKnobMouseLeave),this.$slider.on(this.endEvent,{self:this},this.onSliderEvent),this.$slider.on(this.downEvent,{self:this},this.onSliderTap),Backbone.Mediator.sub(WidgetEvent.RESIZE,this.resize,this),Backbone.Mediator.sub(WidgetEvent.NEXT_PAGE,this.pageChanged,this),Backbone.Mediator.sub(WidgetEvent.PREV_PAGE,this.pageChanged,this),this.listenTo(FSWidgetModel.gi().widgetState,"change:currentItem",this.itemChanged),this.listenTo(FSWidgetModel.gi().widgetState,"change:currentPageIndex",this.pageChanged),this.listenTo(FSWidgetModel.gi().widgetSettings,"change:showControls",this.handleShowControls),this.pageChanged()},render:function(){return this.$el.html(this.template()),this.handleShowControls(),this},resize:function(){this.computeVars(),this.pageChanged(),this.handleShowControls()},computeVars:function(){var sliderBoundRect;this.totalPages=FSWidgetModel.gi().widgetState.get("currentItem").get("pages").length,sliderBoundRect=this.$slider[0].getBoundingClientRect(),this.positionX=sliderBoundRect.left,this.totalPoints=this.isSinglePageView?Math.max(this.totalPages-1,1):this.totalPages/2,this.distanceBetweenPoints=sliderBoundRect.width/this.totalPoints,this.firstPage=FSWidgetModel.gi().getFirstPage(),this.firstPageWidth=this.firstPage.get("width"),this.firstPageHeight=this.firstPage.get("height"),this.thumbWidth=Math.ceil(this.firstPageWidth*(NavSliderView.THUMB_HEIGHT/this.firstPageHeight))},handleShowControls:function(){FSWidgetModel.gi().canShowControls()?this.$el.addClass("show-controls"):this.$el.removeClass("show-controls")},onEventDown:function(e){var self=e.data.self,posX=self.isMobile?e.originalEvent.changedTouches[0].pageX:e.pageX;$(window).on(self.moveEvent,{self:self},self.onMoveEvent),$(window).on(self.endEvent,{self:self},self.onEventEnd),self.previousX=posX-self.positionX,self.isMobile&&(self.showThumbnail(),self.$knob.css({transition:"transform .3s",transform:"scale(1.3)"}))},onEventEnd:function(e){var self=e.data.self;$(window).off(self.moveEvent,self.onMoveEvent),$(window).off(self.endEvent,self.onEventEnd),self.moveKnob(self.currentPoint*self.distanceBetweenPoints),self.dispatchPageChange(),self.isMobile&&(self.hideThumbnail(),self.$knob.css({transition:"transform .3s",transform:"scale(1)"}))},onMoveEvent:function(e){var self=e.data.self,newX=(self.isMobile?e.originalEvent.changedTouches[0].pageX:e.pageX)-self.positionX,delta=newX-self.currentPoint*self.distanceBetweenPoints;self.direction=newX-self.previousX>0?"right":"left",self.previousX=newX,"right"===self.direction?delta>self.distanceBetweenPoints*NavSliderView.DRAG_DELTA?self.gotoNextPoint():delta>0&&self.moveKnob(newX):"left"===self.direction&&(delta<self.distanceBetweenPoints*-NavSliderView.DRAG_DELTA?self.gotoPreviousPoint():delta<0&&self.moveKnob(newX))},onSliderEvent:function(e){var self=e.data.self,newX=(self.isMobile?e.originalEvent.changedTouches[0].pageX:e.pageX)-self.positionX,newPoint=Math.round(newX/self.distanceBetweenPoints),newPos=newPoint*self.distanceBetweenPoints;self.currentPoint=newPoint,self.moveKnob(newPos),self.dispatchPageChange()},onSliderTap:function(e){var self=e.data.self;self.isMobile&&self.hideThumbnail()},onKnobMouseEnter:function(e){e.data.self.showTooltip()},onKnobMouseLeave:function(e){e.data.self.hideTooltip()},showTooltip:function(){this.$tooltipContainer.addClass("visible")},hideTooltip:function(){this.$tooltipContainer.removeClass("visible")},showThumbViewChanged:function(data){data.changed.showThumbView?this.$el.show():this.$el.hide()},pageChanged:function(){var currentPageIndex=FSWidgetModel.gi().widgetState.get("currentPageIndex"),newPoint=this.isSinglePageView?currentPageIndex:Math.floor((currentPageIndex+1)/2),newPosX=newPoint*this.distanceBetweenPoints;this.moveKnob(newPosX),this.setTooltipText(),this.currentPoint=newPoint,this.loadThumbnail()},itemChanged:function(){var newPosX;FSWidgetModel.gi().widgetState.get("currentPageIndex"),this.currentPoint=FSWidgetModel.gi().widgetState.get("currentPageIndex"),this.computeVars(),newPosX=this.currentPoint*this.distanceBetweenPoints,this.leftThumb.model.set({width:this.thumbWidth}),this.rightThumb.model.set({width:this.thumbWidth}),this.moveKnob(newPosX),this.setTooltipText(),this.loadThumbnail()},setTooltipText:function(useCurrentPoint){var rightPage,tooltipText,aux,pointToPage=this.isSinglePageView?this.currentPoint:2*this.currentPoint-1,leftPageIndex=useCurrentPoint?pointToPage:FSWidgetModel.gi().widgetState.get("leftPageIndex"),leftPage=this.isArabicStyle?this.totalPages-leftPageIndex-1:leftPageIndex+1;this.isArabicStyle&&this.isSinglePageView&&leftPage++,rightPage=leftPage+1,leftPage=0===leftPage?"":leftPage+"",rightPage=this.isSinglePageView||rightPage>this.totalPages?"":rightPage+"",this.isArabicStyle&&(aux=rightPage,rightPage=leftPage,leftPage=aux),tooltipText=leftPage.length&&rightPage.length?leftPage+"-"+rightPage:leftPage+rightPage,this.$tooltip.text(tooltipText)},gotoNextPoint:function(){this.currentPoint++,this.currentPoint<=this.totalPoints&&(this.moveKnob(this.currentPoint*this.distanceBetweenPoints),this.setTooltipText(!0),this.loadThumbnail(!0))},gotoPreviousPoint:function(){this.currentPoint--,this.currentPoint>=0&&(this.moveKnob(this.currentPoint*this.distanceBetweenPoints),this.setTooltipText(!0),this.loadThumbnail(!0))},moveKnob:function(posX){var newPos=Math.min(Math.max(0,posX),this.$slider.width());this.$components.css({left:this.positionX+(newPos-NavSliderView.HEIGHT/2)+"px"})},dispatchPageChange:function(){var pageIndex=this.isSinglePageView?this.currentPoint:2*this.currentPoint-1,lastPageIndex=FSWidgetModel.gi().widgetState.get("currentItem").get("pages").length-1,currentPageIndex=pageIndex;pageIndex<0?currentPageIndex=Math.max(pageIndex,0):pageIndex>lastPageIndex&&(currentPageIndex=Math.min(pageIndex,lastPageIndex)),Backbone.Mediator.pub(WidgetEvent.CHANGE_PAGE,currentPageIndex)},loadThumbnail:function(useCurrentPoint){var pointToPage=this.isSinglePageView?this.currentPoint:Math.max(2*this.currentPoint-1,0),currentPageIndex=useCurrentPoint?pointToPage:FSWidgetModel.gi().widgetState.get("currentPageIndex"),isFirstPage=0===currentPageIndex,isLastPage=currentPageIndex===this.totalPages-1,pageList=FSWidgetModel.gi().widgetState.get("currentItem").get("pages").models;this.isSinglePageView||isFirstPage||isLastPage?(this.$thumb.width(this.thumbWidth),this.rightThumb.$el.hide(),this.leftThumb.model.set("source",pageList[currentPageIndex].get("thumb"))):(this.$thumb.width(2*this.thumbWidth),this.leftThumb.model.set("source",pageList[currentPageIndex].get("thumb")),this.rightThumb.$el.show(),this.rightThumb.model.set("source",pageList[currentPageIndex+1].get("thumb")))},hideThumbnail:function(){this.hideTooltip(),this.$thumb.hide(),this.$tooltip.hide()},showThumbnail:function(){this.showTooltip(),this.$thumb.show(),this.$tooltip.show()},handleMouseOver:function(){Backbone.Mediator.pub(WidgetEvent.STOP_AUTOHIDE)},handleMouseOut:function(){Backbone.Mediator.pub(WidgetEvent.START_AUTOHIDE)},remove:function(){Backbone.Mediator.unsubscribe(WidgetEvent.RESIZE,this.resize,this),Backbone.Mediator.unsubscribe(WidgetEvent.NEXT_PAGE,this.pageChanged,this),Backbone.Mediator.unsubscribe(WidgetEvent.PREV_PAGE,this.pageChanged,this),this.$knob.off(),this.$slider.off(),this.$slider=null,this.$knob=null,this.$components=null,this.$tooltipContainer=null,this.$tooltip=null,this.$thumb=null,Backbone.View.prototype.remove.apply(this,arguments)}}),NavSliderView.HEIGHT=22,NavSliderView.MARGIN=25,NavSliderView.DRAG_DELTA=.9,NavSliderView.THUMB_HEIGHT=96,NavSliderView._instance=null,NavSliderView.gi=function(){return NavSliderView._instance||(NavSliderView._instance=new NavSliderView),NavSliderView._instance},Backbone.Mediator.sub(WidgetEvent.CONFIG_DONE,function(){FSWidgetModel.gi().widgetSettings.get("skinType")===WidgetSkinType.CLASSIC&&(FSWidgetModel.gi().get("shelfData")&&FSWidgetModel.gi().get("shelfData").get("shelfOpened")||FSWidgetModel.gi().widgetState.get("currentItem").get("pages").length<=2||(FSWidgetModel.gi().widgetSettings.get("showThumbView")&&NavSliderView.gi(),FlipSnackEmbed.isEditor&&NavSliderView.gi().listenTo(FSWidgetModel.gi().widgetSettings,"change:showThumbView",NavSliderView.gi().showThumbViewChanged)))},this),Backbone.Mediator.sub(WidgetEvent.DESTROY,function(){NavSliderView._instance&&(NavSliderView.gi().remove(),NavSliderView._instance=null)},this)}();var PasswordOverlay=Backbone.View.extend({className:"password-overlay",initialize:function(){this.render()},render:function(){return this}}),PasswordPopinView=Backbone.View.extend({template:_.template(Templates.passwordPopinTemplate),className:"password-popin",events:{"click #submit":"onSubmit","keydown #password":"onKeyPress"},initialize:function(){FSWidgetModel.gi().set("passwordPopinVisible",!0),this.labelChange(),Backbone.Mediator.sub(WidgetEvent.CHANGE_LANGUAGE,this.setTextDirection,this)},labelChange:function(){var labels={title:FSWidgetModel.gi().get("isWhiteLabel")?FSWidgetModel.gi().get("labels").l_password_text_whitelabel:FSWidgetModel.gi().get("labels").l_password_text,passwordLabel:FSWidgetModel.gi().get("labels").l_password,wrongPasswordLabel:FSWidgetModel.gi().get("labels").l_incorrect_password,submitButtonLabel:FSWidgetModel.gi().get("labels").l_enter};this.model.set(labels)},render:function(){return this.$el.html(this.template(this.model.attributes)),this.setTextDirection(),this},onKeyPress:function(e){13===e.which&&this.onSubmit(),e.stopImmediatePropagation()},onSubmit:function(){String(CryptoJS.SHA1(this.$el.find("#password").val()))===FSWidgetModel.gi().get("collectionData").security?(Backbone.Mediator.pub(WidgetEvent.PASSWORD_POPIN_CLOSE),Backbone.Mediator.pub(WidgetEvent.WIDGET_VIEW_INIT),FSWidgetModel.gi().get("collectionData").security=""):this.$el.find("#error").removeClass("hidden")},setTextDirection:function(){FSWidgetModel.gi().get("textDirection")===TextDirection.RIGHT_TO_LEFT?(this.$el.find("#submit").addClass("reverse-text"),this.$el.find(".title").addClass("reverse-text"),this.$el.find("label").addClass("reverse-text"),this.$el.find("#error").addClass("reverse-text")):(this.$el.find("#submit").removeClass("reverse-text"),this.$el.find(".title").removeClass("reverse-text"),this.$el.find("label").removeClass("reverse-text"),this.$el.find("#error").removeClass("reverse-text"))},remove:function(){Backbone.Mediator.unsubscribe(WidgetEvent.CHANGE_LANGUAGE,this.setTextDirection,this),Backbone.View.prototype.remove.apply(this,arguments)}}),PdfLinkView=Backbone.View.extend({template:_.template(Templates.pdfLinkTemplate),className:"pdf-link",events:{click:"onLinkClick"},initialize:function(){this.isInternalLink=!this.model.has("url"),this.listenTo(FSWidgetModel.gi().widgetSettings,"change:useHighlights",this.updateHighlights),this.isInternalLink&&this.model.set("url","#"),this.delegateEvents()},resize:function(scale){var bb=this.model.get("bb"),css={left:bb[0]*scale+"px",top:bb[1]*scale+"px",width:bb[2]*scale+"px",height:bb[3]*scale+"px"};this.$el.css(css)},updateHighlights:function(){this.highLight=FSWidgetModel.gi().widgetSettings.get("useHighlights"),this.highLight?this.$el.hasClass("highlight")||this.$el.addClass("highlight"):this.$el.removeClass("highlight")},render:function(){return this.$el.html(this.template(this.model.attributes)),this.updateHighlights(),this.resize(this.model.get("scale")),this},onLinkClick:function(){var linkPageTarget;return this.registerClickEvent(),!this.isInternalLink||(linkPageTarget=FSWidgetModel.gi().widgetSettings.get("arabicStyle")?FSWidgetModel.gi().widgetState.get("currentItem").get("pages").length-this.getLinkPage()-1:this.getLinkPage(),Backbone.Mediator.pub(WidgetEvent.CHANGE_PAGE,linkPageTarget),!1)},getLinkPage:function(){var linkPageTarget;return linkPageTarget=void 0!==this.model.get("page")?parseInt(this.model.get("page"),10)-1:this.model.get("pageIndex")-1,Math.max(linkPageTarget,0)},registerClickEvent:function(){var pid=this.model.get("pageIndex");FSWidgetModel.gi().widgetSettings.get("singlePageView")&&(pid=FSWidgetModel.gi().widgetSettings.get("arabicStyle")?(pid-1)/2:pid/2+1),Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:Stats.TYPE.CLICK_LINK,pid:FSWidgetModel.gi().widgetState.get("currentItem").get("pages").at(pid).get("pID"),elid:this.model.get("linkIndex")})}}),PlayerNavSliderView=Backbone.View.extend({events:{mouseover:"handleMouseOver",mouseout:"handleMouseOut"},el:ComponentContainers.PLAYER_NAV_SLIDER,template:_.template(Templates.playerNavSlider),initialize:function(){this.render(),this.computeVars(),Backbone.Mediator.sub(WidgetEvent.RESIZE,this.resize,this),Backbone.Mediator.sub(WidgetEvent.NEXT_PAGE,this.pageChanged,this),Backbone.Mediator.sub(WidgetEvent.PREV_PAGE,this.pageChanged,this),this.listenTo(FSWidgetModel.gi().widgetState,"change:currentItem",this.itemChanged),this.listenTo(FSWidgetModel.gi().widgetState,"change:currentPageIndex",this.pageChanged),this.pageChanged()},render:function(){return this.$el.html(this.template()),this.setup(),this},setup:function(){this.hasTouch=FSUtils.hasTouch(),this.isMobile=FSUtils.isMobileDevice(),this.downEvent=this.hasTouch?"touchstart":"mousedown",this.moveEvent=this.hasTouch?"touchmove":"mousemove",this.endEvent=this.hasTouch?"touchend":"mouseup",this.direction="left",this.isDragging=!1,this.currentPoint=FSWidgetModel.gi().widgetState.get("currentPageIndex"),this.isSinglePageView=FSWidgetModel.gi().widgetSettings.get("singlePageView"),this.isArabicStyle=FSWidgetModel.gi().widgetSettings.get("arabicStyle"),this.$slider=this.$el.find(".nav-slider"),this.$components=this.$el.find(".nav-slider-components"),this.$knob=this.$el.find(".nav-slider-knob"),this.$tooltipContainer=this.$el.find(".nav-slider-tooltip-container"),this.$tooltip=this.$el.find(".nav-slider-tooltip"),this.$thumb=this.$el.find(".nav-slider-thumb"),this.$sliderProgress=this.$el.find(".nav-slider-progress"),this.computeVars(),this.previousX=this.positionX,this.leftThumb=new SimpleLoader({model:new SimpleLoaderModel({width:this.thumbWidth,height:PlayerNavSliderView.THUMB_HEIGHT,scaleMode:"stretch"})}),this.rightThumb=new SimpleLoader({model:new SimpleLoaderModel({width:this.thumbWidth,height:PlayerNavSliderView.THUMB_HEIGHT,scaleMode:"stretch"})}),this.$thumb.append(this.leftThumb.render().$el),this.$thumb.append(this.rightThumb.render().$el),this.$knob.on(this.downEvent,{self:this},this.onEventDown),this.$knob.on(this.endEvent,{self:this},this.onEventEnd),this.$knob.on("mouseenter",{self:this},this.onKnobMouseEnter),this.$knob.on("mouseleave",{self:this},this.onKnobMouseLeave),this.$slider.on(this.endEvent,{self:this},this.onSliderEvent),this.$slider.on(this.downEvent,{self:this},this.onSliderTap),$(ComponentContainers.MAIN_LAYOUT).on("mouseup",{self:this},this.hideThumbOnMouseUp),this.pageChanged()},resize:function(){this.computeVars(),this.pageChanged()},computeVars:function(){var mainLayout=$(ComponentContainers.MAIN_LAYOUT);this.sliderWidth=mainLayout.width()-2*PlayerNavSliderView.MARGIN,this.positionX=PlayerNavSliderView.MARGIN,this.totalPages=FSWidgetModel.gi().widgetState.get("currentItem").get("pages").length,this.totalPoints=this.isSinglePageView?Math.max(this.totalPages-1,1):this.totalPages/2,this.distanceBetweenPoints=this.sliderWidth/this.totalPoints,this.firstPage=FSWidgetModel.gi().getFirstPage(),this.firstPageWidth=this.firstPage.get("width"),this.firstPageHeight=this.firstPage.get("height"),this.thumbWidth=Math.ceil(this.firstPageWidth*(PlayerNavSliderView.THUMB_HEIGHT/this.firstPageHeight))},onEventDown:function(e){var self=e.data.self;self.isDragging=!0;var posX=self.isMobile?e.originalEvent.changedTouches[0].pageX:e.pageX;$(window).on(self.moveEvent,{self:self},self.onMoveEvent),$(window).on(self.endEvent,{self:self},self.onEventEnd),self.previousX=posX-self.positionX,self.showThumbnail(),self.isMobile&&self.$knob.addClass("scaled")},onEventEnd:function(e){var self=e.data.self;self.isDragging=!1,$(window).off(self.moveEvent,self.onMoveEvent),$(window).off(self.endEvent,self.onEventEnd),self.moveKnob(self.currentPoint*self.distanceBetweenPoints),self.dispatchPageChange(),self.isMobile&&(self.hideThumbnail(),self.$knob.removeClass("scaled"))},onMoveEvent:function(e){var self=e.data.self,newX=(self.isMobile?e.originalEvent.changedTouches[0].pageX:e.pageX)-self.positionX,nextCurrentPoint=Math.round(newX/self.distanceBetweenPoints);nextCurrentPoint<=self.totalPoints&&nextCurrentPoint>=0&&(self.direction=newX-self.previousX>0?"right":"left",self.previousX=newX,self.currentPoint=Math.round(newX/self.distanceBetweenPoints),self.loadThumbnail(!0),self.setTooltipText(!0),self.moveKnob(newX))},onSliderEvent:function(e){var self=e.data.self;self.computeVars();var newX=(self.isMobile?e.originalEvent.changedTouches[0].pageX:e.pageX)-self.positionX,newPoint=Math.round(newX/self.distanceBetweenPoints),newPos=newPoint*self.distanceBetweenPoints;self.currentPoint=newPoint,self.moveKnob(newPos),self.dispatchPageChange()},onSliderTap:function(e){var self=e.data.self;self.isMobile&&self.hideThumbnail()},onKnobMouseEnter:function(e){var self=e.data.self;self.arrangeThumb(),self.loadThumbnail(!0),self.setTooltipText(!0),self.showTooltip()},onKnobMouseLeave:function(e){var self=e.data.self;self.isDragging||self.hideTooltip()},showTooltip:function(){this.$tooltipContainer.addClass("visible")},hideTooltip:function(){this.$tooltipContainer.removeClass("visible")},showThumbViewChanged:function(data){data.changed.showThumbView?this.$el.show():this.$el.hide()},pageChanged:function(){var currentPageIndex=FSWidgetModel.gi().widgetState.get("currentPageIndex"),newPoint=this.isSinglePageView?currentPageIndex:Math.floor((currentPageIndex+1)/2),newPosX=newPoint*this.distanceBetweenPoints;this.moveKnob(newPosX),this.setTooltipText(),this.currentPoint=newPoint},itemChanged:function(){var newPosX;this.currentPoint=FSWidgetModel.gi().widgetState.get("currentPageIndex"),this.computeVars(),newPosX=this.currentPoint*this.distanceBetweenPoints,this.leftThumb.model.set({width:this.thumbWidth}),this.rightThumb.model.set({width:this.thumbWidth}),this.moveKnob(newPosX),this.setTooltipText(),this.loadThumbnail()},setTooltipText:function(useCurrentPoint){var rightPage,tooltipText,aux,pointToPage=this.isSinglePageView?this.currentPoint:2*this.currentPoint-1,leftPageIndex=useCurrentPoint?pointToPage:FSWidgetModel.gi().widgetState.get("leftPageIndex"),leftPage=this.isArabicStyle?this.totalPages-leftPageIndex-1:leftPageIndex+1;this.isArabicStyle&&this.isSinglePageView&&leftPage++,rightPage=leftPage+1,leftPage=0===leftPage?"":leftPage+"",rightPage=this.isSinglePageView||rightPage>this.totalPages?"":rightPage+"",this.isArabicStyle&&(aux=rightPage,rightPage=leftPage,leftPage=aux),tooltipText=leftPage.length&&rightPage.length?leftPage+"-"+rightPage:leftPage+rightPage,this.$tooltip.text(tooltipText)},moveKnob:function(posX){var newPos=Math.min(Math.max(0,posX),this.sliderWidth);this.arrangeThumb(),this.$components.css({left:this.positionX+(newPos-PlayerNavSliderView.HEIGHT/2)+"px"}),this.isArabicStyle?this.$sliderProgress.css({left:this.positionX+(newPos-PlayerNavSliderView.HEIGHT/2)+"px",width:this.sliderWidth-(this.positionX+(newPos-PlayerNavSliderView.HEIGHT/2))+"px"}):this.$sliderProgress.css("width",this.positionX+(newPos-PlayerNavSliderView.HEIGHT/2)+"px")},arrangeThumb:function(){var knobPosition=this.$components.position(),thumbContainerWidth=this.isSinglePageView||this.currentPoint<1||this.currentPoint===this.totalPoints?this.thumbWidth:2*this.thumbWidth,translateVal=-thumbContainerWidth/2;knobPosition.left<thumbContainerWidth/2?translateVal=-knobPosition.left:knobPosition.left>this.$slider.width()-thumbContainerWidth/2&&(translateVal=-(thumbContainerWidth-(this.$slider.width()-knobPosition.left))),this.$thumb.css("transform","translateX("+translateVal+"px)")},dispatchPageChange:function(){var pageIndex=this.isSinglePageView?this.currentPoint:2*this.currentPoint-1,lastPageIndex=FSWidgetModel.gi().widgetState.get("currentItem").get("pages").length-1,currentPageIndex=pageIndex;pageIndex<0?currentPageIndex=Math.max(pageIndex,0):pageIndex>lastPageIndex&&(currentPageIndex=Math.min(pageIndex,lastPageIndex)),Backbone.Mediator.pub(WidgetEvent.CHANGE_PAGE,currentPageIndex)},loadThumbnail:function(useCurrentPoint){var pointToPage=this.isSinglePageView?this.currentPoint:Math.max(2*this.currentPoint-1,0),currentPageIndex=useCurrentPoint?pointToPage:FSWidgetModel.gi().widgetState.get("currentPageIndex"),isFirstPage=0===currentPageIndex,isLastPage=currentPageIndex===this.totalPages-1,pageList=FSWidgetModel.gi().widgetState.get("currentItem").get("pages").models;this.isSinglePageView||isFirstPage||isLastPage?(this.$thumb.width(this.thumbWidth),this.rightThumb.$el.hide(),this.leftThumb.model.set("source",pageList[currentPageIndex].get("thumb"))):(this.$thumb.width(2*this.thumbWidth),this.leftThumb.model.set("source",pageList[currentPageIndex].get("thumb")),this.rightThumb.$el.show(),this.rightThumb.model.set("source",pageList[currentPageIndex+1].get("thumb")))},hideThumbnail:function(){this.hideTooltip(),this.$thumb.hide(),this.$tooltip.hide()},showThumbnail:function(){this.showTooltip(),this.$thumb.show(),this.$tooltip.show()},hideThumbOnMouseUp:function(e){e.data.self.hideTooltip()},remove:function(){Backbone.Mediator.unsubscribe(WidgetEvent.RESIZE,this.resize,this),Backbone.Mediator.unsubscribe(WidgetEvent.NEXT_PAGE,this.pageChanged,this),Backbone.Mediator.unsubscribe(WidgetEvent.PREV_PAGE,this.pageChanged,this),this.$knob&&this.$knob.off(),this.$slider&&this.$slider.off(),this.$slider=null,this.$knob=null,this.$components=null,this.$tooltipContainer=null,this.$tooltip=null,this.$thumb=null,Backbone.View.prototype.remove.apply(this,arguments)}});function createNavSliderView(){FSWidgetModel.gi().widgetSettings.get("skinType")===WidgetSkinType.PLAYER&&(FSWidgetModel.gi().get("shelfData")&&FSWidgetModel.gi().get("shelfData").get("shelfOpened")||FSWidgetModel.gi().widgetState.get("currentItem").get("pages").length<=2||(FSWidgetModel.gi().widgetSettings.get("showThumbView")&&PlayerNavSliderView.gi(),FlipSnackEmbed.isEditor&&PlayerNavSliderView.gi().listenTo(FSWidgetModel.gi().widgetSettings,"change:showThumbView",PlayerNavSliderView.gi().showThumbViewChanged)))}function destroyNavSliderView(){PlayerNavSliderView._instance&&(PlayerNavSliderView.gi().remove(),PlayerNavSliderView._instance=null)}PlayerNavSliderView.HEIGHT=42,PlayerNavSliderView.MARGIN=20,PlayerNavSliderView.THUMB_HEIGHT=91,PlayerNavSliderView._instance=null,PlayerNavSliderView.gi=function(){return PlayerNavSliderView._instance||(PlayerNavSliderView._instance=new PlayerNavSliderView),PlayerNavSliderView._instance},Backbone.Mediator.sub(WidgetEvent.CONFIG_DONE,createNavSliderView,this),Backbone.Mediator.sub(WidgetEvent.DESTROY,destroyNavSliderView,this);var GenericPopin=Backbone.View.extend({template:_.template(Templates.genericPopin),className:"generic-popin",events:{"click .btn-x":"onClosePopin","click .popin-overlay":"onClosePopin","mousemove .popin-overlay":"onMouseHandle","mouseenter .popin-overlay":"onMouseHandle","mouseleave .popin-overlay":"onMouseHandle","mousemove .popin-panel":"onMouseHandle","mouseenter .popin-panel":"onMouseHandle","mouseleave .popin-panel":"onMouseHandle"},initialize:function(){Backbone.Mediator.sub(CustomContentEvent.VIDEO_EMBED_SIZE,this.showVideo,this)},render:function(){return this.$el.html(this.template()),this},setContent:function(html){this.$el.find(".popin-content").html(html)},showModal:function(videoButton){var panel=this.$el.find(".popin-panel");this.$el.css({opacity:0}).show(),videoButton||this.showVideo({videoWidth:panel.width(),videoHeight:panel.height()})},showVideo:function(size){var panel=this.$el.find(".popin-panel");size&&size.videoWidth&&size.videoHeight&&(panel.css({marginTop:-1*size.videoHeight/2,marginLeft:-1*size.videoWidth/2}),this.$el.animate({opacity:1},200))},hidePopin:function(){var self=this;Backbone.Mediator.pub(WidgetEvent.BEFORE_POPIN_CLOSE,this.$el),this.$el.animate({opacity:0},200,function(){self.$el.hide()})},closePopin:function(){this.onClosePopin()},onClosePopin:function(){Backbone.Mediator.pub(WidgetEvent.POPIN_CLOSE),this.$el.find(".popin-content").empty()},onMouseHandle:function(event){return"INPUT"===event.target.tagName||"TEXTAREA"===event.target.tagName||(event.stopImmediatePropagation(),event.preventDefault(),!1)},centerPopin:function(){var panel=this.$el.find(".popin-panel");panel.css({marginTop:-1*panel.height()/2,marginLeft:-1*panel.width()/2})}}),ProductTagPopin=Backbone.View.extend({template:_.template(Templates.productTagPopin),contentTemplate:_.template(Templates.productTagPopinContent),className:"product-tag-popin",events:{"click .popin-overlay":"closePopin","click .close-popin":"closePopin","click .image-preview":"selectImage"},initialize:function(){Backbone.Mediator.sub(WidgetEvent.SCALE_PRODUCT_TAG_POPIN,this.setCss,this),this.media=[]},render:function(){return this.$el.html(this.template()),this},showModal:function(attributes){this.$el.find(".popin-content").html(this.contentTemplate(attributes)),this.setCss(attributes.scale),this.insertMediaInPopin(attributes),this.$el.css({opacity:1}).show()},hidePopin:function(){var self=this;this.$el.animate({opacity:0},300,function(){self.$el.hide()})},insertMediaInPopin:function(attributes){if(this.media=attributes.media,this.media&&this.media.length){var $mainImg=this.$el.find(".image-container img"),$productImages=this.$el.find(".product-images"),firstImg=this.media[0];$mainImg.attr("src",FlipSnackEmbed.urls.uploadPath+firstImg.hash),this.media.length>1&&this.media.forEach(function(img,index){var imgPreview='<div class="image-preview" index="'+index+'" style="background-image: url('+FlipSnackEmbed.urls.uploadPath+img.hash+')"></div>';$productImages.append(imgPreview)})}},selectImage:function(e){var target=e.target;this.$el.find(".image-container img").attr("src",FlipSnackEmbed.urls.uploadPath+this.media[target.getAttribute("index")].hash)},setCss:function(scale){var minScale=Math.min(parseFloat(scale),1);FSUtils.isMobileDevice()&&(minScale*=.8);var transform="translate(-50%, -50%) scale("+minScale+")";this.$el.find(".popin-panel").css({transform:transform})},closePopin:function(){Backbone.Mediator.pub(WidgetEvent.CLOSE_PRODUCT_TAG_POPIN),this.$el.find(".popin-content").empty()},remove:function(){Backbone.Mediator.unsubscribe(WidgetEvent.SCALE_PRODUCT_TAG_POPIN,this.setCss,this)}}),SimpleLoader=Backbone.View.extend({template:_.template(Templates.simpleLoader),initialize:function(){var src=this.model.get("source"),self=this;this.setElement(this.template()),this.preloader=new WheelPreloader(20),this.$preloader=this.$el.find(".fsw-wheelpreloader"),this.$image=this.$el.find("img"),this.$image.on("load",function(){self.resizeImage(),$(this).css("opacity",1)}),this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"change:source",this.load),this.resizeImage(),src&&src.length&&this.load()},render:function(){return("width"in this.model.changed||"height"in this.model.changed)&&this.resizeImage(),this},resizeImage:function(){var newImgWidth,newImgHeight,croppedImageCoordinates,imageCss,ow=this.model.get("originalWidth"),oh=this.model.get("originalHeight"),w=this.model.has("width")?this.model.get("width"):ow,h=this.model.has("height")?this.model.get("height"):oh,wRatio=ow/w,hRatio=oh/h;if("number"==typeof ow&&"number"==typeof oh)switch(this.model.get("scaleMode")){case"scale":wRatio>hRatio?(newImgWidth=w,newImgHeight=oh/wRatio):(newImgHeight=h,newImgWidth=ow/hRatio);break;case"scaleCrop":wRatio<hRatio?(newImgWidth=w,newImgHeight=oh/wRatio):(newImgHeight=h,newImgWidth=ow/hRatio);break;case"crop":newImgWidth=ow,newImgHeight=oh;break;default:newImgWidth=w,newImgHeight=h}else newImgWidth=w,newImgHeight=h;newImgWidth=newImgWidth.toFixed(2),newImgHeight=newImgHeight.toFixed(2),this.model.set({imageWidth:newImgWidth,imageHeight:newImgHeight}),this.$el.css({width:w+"px",height:h+"px"}),imageCss={width:newImgWidth+"px",height:newImgHeight+"px",position:"absolute",top:0,left:0},this.model.get("cropData")&&(croppedImageCoordinates={left:-newImgWidth/this.model.get("cropData").width*this.model.get("cropData").left,top:-newImgHeight/this.model.get("cropData").height*this.model.get("cropData").top,width:newImgWidth/this.model.get("cropData").width,height:newImgHeight/this.model.get("cropData").height,position:"absolute"},imageCss=$.extend(!0,{},imageCss,croppedImageCoordinates)),this.$image.css(imageCss)},load:function(){this.model.set("status",ContentLoaderStatus.LOADING),this.$preloader.append(this.preloader.render().$el),this.$el.css("background",""),this.$image.attr("src","").css({opacity:0,visibility:"hidden"}),this.tempImage&&this.removeTempImage(),this.model.get("source")&&this.model.get("source").length&&this.createTempImage()},loadComplete:function(){this.tempImage&&("tile"!==this.model.get("scaleMode")?this.$image.css("visibility","visible").attr("src",this.model.get("source")):this.$el.css({background:"url("+this.model.get("source")+") repeat"}),this.model.set({originalWidth:this.tempImage.width,originalHeight:this.tempImage.height,status:ContentLoaderStatus.COMPLETE}),this.$preloader.empty())},loadError:function(){this.model.set({originalWidth:void 0,originalHeight:void 0,status:ContentLoaderStatus.ERROR}),this.$preloader.empty()},createTempImage:function(){var self=this;this.tempImage=new Image,this.tempImage.addEventListener("load",function(){self.loadComplete()}),this.tempImage.addEventListener("abort",function(){self.loadError()}),this.tempImage.addEventListener("error",function(){self.loadError()}),this.tempImage.src=this.model.get("source")},removeTempImage:function(){var self=this;this.tempImage&&(this.tempImage.removeEventListener("load",function(){self.loadComplete()}),this.tempImage.removeEventListener("abort",function(){self.loadError()}),this.tempImage.removeEventListener("error",function(){self.loadError()}),this.tempImage.src="",this.tempImage=null)},show:function(){this.$el.css("visibility","visible")},hide:function(){this.$el.css("visibility","hidden")},isVisible:function(){return"visible"===this.$el.css("visibility")},remove:function(){this.preloader&&(this.preloader.remove(),this.preloader=null),this.removeTempImage(),this.$image.off(),this.stopListening(this.model),Backbone.View.prototype.remove.apply(this,arguments)}}),WheelPreloader=Backbone.View.extend({el:_.template(Templates.wheelPreloader),initialize:function(size){var scale=size/200;this.$el.css({"-webkit-transform":"scale("+scale+")","-moz-transform":"scale("+scale+")","-ms-transform":"scale("+scale+")",transform:"scale("+scale+")"})},render:function(){return this}}),WidgetWatermark=Backbone.View.extend({template:_.template(Templates.embedWatermark),initialize:function(){this.setElement(this.template()),this.listenTo(this.model,"change",this.render)},render:function(){return this.$el.find("a.fsw-watermark-url").attr("href",this.getUrl()),this.$el.find("img").attr("src",this.model.get("logoSrc")),this.model.get("embedWidth")<this.model.get("lowerLimitWidth")||this.model.get("embedHeight")<this.model.get("lowerLimitHeight")?this.$el.removeClass("medium large").addClass("small"):this.model.get("embedWidth")>=this.model.get("limitWidth")&&this.model.get("embedHeight")>=this.model.get("limitHeight")?this.$el.removeClass("medium small").addClass("large"):this.$el.removeClass("small large").addClass("medium"),this},getUrl:function(){var path=Math.round(Math.random())?"/?utm_source=watermark&utm_medium=embed":"/create-html5-flipbooks/?utm_source=watermark&utm_medium=embed";return this.model.get("flipsnackUrl")+path},show:function(){this.$el.show()},hide:function(){this.$el.hide()}});!function($){window.FlipSnackEmbed||(window.FlipSnackEmbed={}),window.FlipSnackEmbed=function(options){var embedWidth,embedHeight,collectionData,$mainContainerParent,$mainContainer,$embedContainer,$backContainer,flipSnackLinks,$logoContainer,$logoImg,$preloader,img,wheelPreloader,jsonWm,labels,allowBrowserFullScreen,isWhiteLabel,initialSinglePageSetting,state,sellReaderTimeout,accessConfirmationTimeout,accessConfirmationHandler,sellPermissionHandler,LIMIT_WIDTH=759,LIMIT_HEIGHT=759,LOWER_LIMIT_WIDTH=500,LOWER_LIMIT_HEIGHT=200,LOGO_MIN_SIZE={WIDTH:50,HEIGHT:50},LOGO_MAX_SIZE={WIDTH:100,HEIGHT:100},LOGO_RESIZE_BRACKPOINT=1170,MESSAGE_WAIT_TIMEOUT=250,MSG_OK_TO_READ="OKTOREAD",MSG_OK_ACCESS="OKACCESS",FLIPSNACK_DOMAINS=["www.flipsnack.com","prelive.flipsnack.com","site.flipsnack.net","widget.flipsnack.io","flipsnack.io"],LIVE_URLS={siteURL:"//www.flipsnack.com",baseUrl:"//cdn.flipsnack.com",mainEmbedDomain:"cdn.flipsnack.com",cloudFront:"d1dhn91mufybwl.cloudfront.net",s3:"//cdn.flipsnack.com",s3secure:"//cdn.flipsnack.com",content:"https://content.flipsnack.com"},LIVE_NOCDN_URLS={siteURL:"//www.flipsnack.com",baseUrl:"https://s3.amazonaws.com/files.flipsnack.net",mainEmbedDomain:"cdn.flipsnack.com",cloudFront:"d1dhn91mufybwl.cloudfront.net",s3:"https://s3.amazonaws.com/files.flipsnack.net",s3secure:"https://s3.amazonaws.com/files.flipsnack.net"},DEV_URLS={siteURL:"https://stage.site.flipsnack.net",baseUrl:"//cdn.flipsnack.net",mainEmbedDomain:"cdn.flipsnack.net",cloudFront:"d1dc988o4ywp3l.cloudfront.net",s3:"//cdn.flipsnack.net",s3secure:"//cdn.flipsnack.net",content:"https://content.flipsnack.net"},DEV_NOCDN_URLS={siteURL:"https://stage.site.flipsnack.net",baseUrl:"https://s3-eu-central-1.amazonaws.com/flipsnack-dev",mainEmbedDomain:"https://s3-eu-central-1.amazonaws.com/flipsnack-dev",cloudFront:"d1dc988o4ywp3l.cloudfront.net",s3:"https://s3-eu-central-1.amazonaws.com/flipsnack-dev",s3secure:"https://s3-eu-central-1.amazonaws.com/flipsnack-dev"},DOWNLOAD_URLS={siteURL:"https://www.flipsnack.com",baseUrl:"",mainEmbedDomain:"",s3:"",s3secure:""},WHITELABEL={DEV:{siteURL:"//enterprise.dev.flipsnack.net",baseUrl:"//d3hnuexrnaisrd.cloudfront.net",mainEmbedDomain:"d3hnuexrnaisrd.cloudfront.net",s3:"//d3hnuexrnaisrd.cloudfront.net",s3secure:"//d3hnuexrnaisrd.cloudfront.net",content:"https://content.flipsnack.net"},DEV_NOCDN:{siteURL:"//enterprise.dev.flipsnack.net",baseUrl:"//devfiles.enterprise.flipsnack.net.s3.amazonaws.com",mainEmbedDomain:"devfiles.enterprise.flipsnack.net.s3.amazonaws.com",s3:"https://devfiles.enterprise.flipsnack.net.s3.amazonaws.com",s3secure:"https://s3.amazonaws.com/devfiles.enterprise.flipsnack.net"},LIVE:{siteURL:"//www.flipsnackenterprise.com",baseUrl:"//dgbgkkl7v688n.cloudfront.net",mainEmbedDomain:"dgbgkkl7v688n.cloudfront.net",s3:"//dgbgkkl7v688n.cloudfront.net",s3secure:"//dgbgkkl7v688n.cloudfront.net",content:"https://content.flipsnack.com"},LIVE_NOCDN:{siteURL:"//www.flipsnackenterprise.com",baseUrl:"//files.enterprise.flipsnack.net",mainEmbedDomain:"cdn.enterprise.flipsnack.net",s3:"https://files.enterprise.flipsnack.net",s3secure:"https://s3.amazonaws.com/files.enterprise.flipsnack.net"}},version="5.1.0",idSuffix=parseInt(1e6*Math.random()),isDev=!1,mobileDomain="",config={},widget=null,defaultBackgroundColor="#4e5565",bgType="color",randomVal="",domainName="",shelfOpened=!1,itemOpened=!1,jsonError=!1,isFlipSnackDomain=!1,hashId="",forcewm=!1,isPublisherVar=!1,blockWatermarkVar=!1,forceWidget=!1,isDetailsPage=!1,blockEvents=!1,startPage=null,startBook=null,fullScreen=!1,forceSmall=!1,openFullScreenInNewTab=!1,nocdn=!1,disableFullScreen=!1,step2=!1,download=!1,exportName="",exportVideo=!1,resourcePath=void 0,isApp=!1,hasWatermark=!0,showWatermarkClip=!0,isPublisher=!1,isMobileDevice=!1,openPayPalIndex="",logoImage="",logoUrl="",labelsAreLoaded=!1,premiumLayouts=[],logoDisplayed=!0,isInSellSettingsPage=!1,isSafariBrowser=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),checkSellAccess=!1;function updateSinglePageSetting(){var isShelfOpened=collectionData.shelfData&&collectionData.shelfData.shelfOpened,fs=FSWidgetModel.gi().widgetState.get("displayState")!==DisplayState.NORMAL,sp=FSWidgetModel.gi().widgetState.get("currentPageIndex")+1,si=FSWidgetModel.gi().widgetState.get("currentItemIndex")+1;collectionData.params.singlePageView=!(!initialSinglePageSetting&&!isShelfOpened)||setSinglePage(),reloadWidget({fullScreen:fs,startPage:sp,si:si})}function destroyWheelPreloader(){wheelPreloader&&(wheelPreloader.remove(),wheelPreloader=null)}function createWidgetContainer(){$embedContainer=$("<div>").attr("id","fsw_widget_"+idSuffix).css({width:"100%",height:"100%"})}function checkFlipSnackDomain(){var isOurDomain=!1;return isWhiteLabel?isOurDomain=!0:_.each(FLIPSNACK_DOMAINS,function(item){(domainName.indexOf(item)>-1&&"cdn.flipsnack.net"!==domainName||domainName===mobileDomain)&&(isOurDomain=!0)}),isOurDomain}function checkContinueEmbedInit(){jsonError?showJSONErrorMessage():function(){if("string"==typeof collectionData.title&&collectionData.title.length>0&&(document.title=collectionData.title),!collectionData.isBlocked)return"editable"!==collectionData.albumType||isFlipSnackDomain?(setBackground(),void widgetLoaded()):(destroyWheelPreloader(),!1);$mainContainer.append($('<div class="fsw-embedmsg-container"></div>').append($('<p class="fsw-embed-message">Currently blocked due to a copyright infringement complaint. Sorry about that.</p>')))}()}function loadLabels(language){var url,languageList;if("English"!==language){if(url=FlipSnackEmbed.urls.labelsJSON,!(languageList={Basque:"basque",Bosanski:"bosanski","Catal":"catalan",Czech:"czech",Dansk:"dansk",Deutsch:"deutsch",Dutch:"dutch","Espaol":"spanish","":"hebrew","":"hebrew","":"hebrew","":"hebrew","Franaise":"french","":"greek",Hrvatski:"hrvatski",Indonesian:"indonesian",Italiano:"italiano",Magyar:"magyar",Nederlands:"nederlands",Norsk:"norsk",Polski:"polski","Portugus":"portugues","Portugus do Brasil":"portuguesdobrasil","Romn":"romana","P":"russian","C":"bosnian",Slovene:"slovene",Suomi:"suomi",Turkish:"turkish",Slovak:"slovak",Swedish:"swedish"})[language])for(var i in languageList)0===i.localeCompare(language)&&(language=i);window.labelsLoaded=function(jsonp){var e,defaultLabels,langLabels,newLabels;e=jsonp,defaultLabels=widget.model.defaults.labels,langLabels=e.language.tooltipLabels,newLabels={},Object.keys(defaultLabels).forEach(function(el){langLabels[el]?newLabels[el]=langLabels[el]:newLabels[el]=defaultLabels[el]}),widget?widget.model.set("labels",newLabels):(labelsAreLoaded=!0,labels=newLabels)},FSUtils.loadScript(url+languageList[language]+".js")}else widget&&widget.model.set("labels",widget.model.defaults.labels)}function premiumLayoutsLoaded(data){data&&data.length&&(premiumLayouts=data.map(function(currentValue){return"layout_"+currentValue})),loadCollectionData()}function resize(w,h){embedWidth=config.width=w,embedHeight=config.height=h,flipSnackLinks&&(showWatermarkClip&&hasWatermark?(flipSnackLinks.show(),flipSnackLinks.model.set({embedWidth:embedWidth,embedHeight:embedHeight})):flipSnackLinks.hide()),widget&&widget.model&&widget.model.set({width:embedWidth,height:embedHeight}),img&&resizeBack(),$logoImg&&(resizeLogo(),repositionLogo())}function isFullScreen(){return!!(void 0!==document.fullScreenElement&&null!==document.fullScreenElement||void 0!==document.mozFullScreen&&document.mozFullScreen||void 0!==document.webkitIsFullScreen&&document.webkitIsFullScreen&&document.webkitFullscreenElement||void 0!==document.msFullscreenElement&&document.msFullscreenElement)}function exitNewShelfItemFullScreen(){var data;FSWidgetModel.gi().get("shelfData")&&FSWidgetModel.gi().get("shelfData").get("itemOpened")&&(Stats._instance=null,widget&&widget.fullScreenChange&&widget.fullScreenChange(!1),Backbone.Mediator.pub(NewShelfEvents.CLOSE_ITEM),data=FSUtils.parseJSONData(FSWidgetModel.gi().get("shelfData").get("shelfJson"),FlipSnackEmbed.urls.siteURL,hashId),collectionData=data,fullScreen=!1,shelfOpened=!1,itemOpened=!0,blockEvents=!0,reloadWidget(),setBackground())}function toggleFullScreen(data){if(!isSafariBrowser||isFullScreen()||window.innerHeight!==screen.height)if(allowBrowserFullScreen){var docElem=$mainContainer[0];isFullScreen()?($mainContainer.removeClass("full-screen"),document.cancelFullScreen?document.cancelFullScreen():document.exitFullScreen?document.exitFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?(document.webkitCancelFullScreen(),widget&&widget.fullScreenChange&&widget.fullScreenChange(!1)):document.msCancelFullScreen?document.msCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),shelfOpened&&exitNewShelfItemFullScreen()):docElem.requestFullScreen?docElem.requestFullScreen():docElem.mozRequestFullScreen?docElem.mozRequestFullScreen():docElem.webkitRequestFullScreen?docElem.webkitRequestFullScreen():docElem.msRequestFullscreen&&docElem.msRequestFullscreen()}else data&&data.hash?openFullScreenInTab(data.hash):openFullScreenInTab()}function openFullScreenInTab(itemHash){var url,domain,currentHash=itemHash||hashId;if(fullScreen)return download&&window.close(),void window.history.back();url=FlipSnackEmbed.urls.baseUrl+"/widget/v2/flipsnackwidget.html?hash="+currentHash+"&t="+randomVal+"&fullscreen=1",download&&(url="iframe.html?hash="+currentHash+"&t="+randomVal+"&fullscreen=1&download=1"),domain=location.host,openFullScreenInNewTab||domain!==FlipSnackEmbed.urls.mainEmbedDomain&&domain!==DEV_NOCDN_URLS.mainEmbedDomain?window.open(url):window.parent.location.href=url}function loadCollectionData(forceReload){var jsonUrl=FlipSnackEmbed.urls.collectionJSON+hashId+(""!==randomVal?"?t="+randomVal:"")+(download?".json":"");if(download){var toLoad=[{name:"json",src:FlipSnackEmbed.urls.baseUrl+"collections/json/"+hashId+".js"},{name:"icons",src:FlipSnackEmbed.urls.baseUrl+"resources/icons.js"},{name:"shapes",src:FlipSnackEmbed.urls.baseUrl+"resources/shapes.js"}];toLoad.map(function(resource){var script=document.createElement("script");script.type="text/javascript",script.onload=function(){FSUtils.removeFromArrayWhereKey(toLoad,"name",resource.name),toLoad.length||collectionDataLoaded(window["json_"+hashId]())},script.onerror=function(){FSUtils.removeFromArrayWhereKey(toLoad,"name",resource.name)},document.head.appendChild(script),script.src=resource.src})}else if(FSUtils.isIE9()){var req=new XDomainRequest;req.open("GET",jsonUrl),req.onerror=handlerJSONError,req.onload=function(){collectionDataLoaded(JSON.parse(req.responseText))},req.send()}else forceReload?$.getJSON(jsonUrl,"",handleJsonAndReloadWidget).fail(handlerJSONError):$.getJSON(jsonUrl,"",collectionDataLoaded).fail(handlerJSONError)}function handleJsonAndReloadWidget(e){collectionDataLoaded(e),reloadWidget()}function collectionDataLoaded(e){jsonError=!1,collectionData=FSUtils.parseJSONData(e,FlipSnackEmbed.urls.siteURL,hashId),e.config.params.widgetType===WidgetType.SHELF&&e.config.params.newShelf&&(blockEvents=!0),collectionData.collection&&collectionData.collection.length||collectionData.shelfData&&collectionData.shelfData.shelfOpened?(FlipSnackEmbed.isEditor="published"!==collectionData.albumType,FlipSnackEmbed.isPublish="published"!==collectionData.albumType&&"publish"===state,initialSinglePageSetting=void 0===collectionData.params.contentLayout?collectionData.params.singlePageView:collectionData.params.contentLayout===ContentLayout.SINGLE_PAGE,collectionData.params.contentLayout===ContentLayout.DOUBLE_PAGE&&(collectionData.params.showPageShadows=!1),collectionData.params.singlePageView=!!initialSinglePageSetting||setSinglePage(),collectionData.params.mergePdfs=!1,isOnAllowedPage()||"PRIVATE_EMAIL"!==collectionData.visibility||"published"!==collectionData.albumType||download||exportVideo?(function(collectionData){return collectionData.sell&&collectionData.sell.price&&collectionData.sell.price.length&&collectionData.features&&collectionData.features.SELL}(collectionData)&&(checkSellAccess||isMobileDevice&&window.isMobileApp)?(sellPermissionHandler=generateConfirmationMessageHandler(MSG_OK_TO_READ,receiveWidgetSellAccessMessage,continueAsPreviewWidget),window.addEventListener("message",sellPermissionHandler,!0),window.top.postMessage("getSellAccess-"+hashId,"*"),sellReaderTimeout=setTimeout(continueAsPreviewWidget,MESSAGE_WAIT_TIMEOUT)):checkContinueEmbedInit(),initTracking(collectionData)):handleVisibilityWithEmail()):showJSONErrorMessage()}function checkForValidMessageOrigin(event){return!(!isDev&&FLIPSNACK_DOMAINS.indexOf(event.origin.replace(/^https?\:\/\//i,""))<0&&event.origin.replace(/^https?\:\/\//i,"")!==mobileDomain)}function generateConfirmationMessageHandler(messageType,success,fail){return function(event){var responseMessage=function(event){var msgData=event.data.split("-");return{name:msgData[0],value:msgData[1]}}(event);responseMessage.name===messageType&&(function(event,flipHash){return checkForValidMessageOrigin(event)&&hashId===flipHash}(event,responseMessage.value)?success&&"function"==typeof success&&success():fail&&"function"==typeof fail&&fail())}}function continueAsPreviewWidget(){clearTimeout(sellReaderTimeout),window.removeEventListener("message",sellPermissionHandler),checkContinueEmbedInit()}function receiveWidgetSellAccessMessage(){clearTimeout(sellReaderTimeout),window.removeEventListener("message",sellPermissionHandler),collectionData.sell={},collectionData.watermark=!1,collectionData.features.FLIP_PAGES=-1,checkContinueEmbedInit()}function showAccessDeniedMsg(){clearTimeout(accessConfirmationTimeout),window.removeEventListener("message",accessConfirmationHandler),destroyWheelPreloader(),$mainContainer.append($('<div class="fsw-embedmsg-container"></div>').append($('<p class="fsw-embed-message">The publication youre trying to access is private.</p>'))),Backbone.Mediator.sub(NewShelfEvents.CLOSE_ITEM,function(){$(".fsw-embedmsg-container").remove()},this)}function continueFlipbookAccess(){clearTimeout(accessConfirmationTimeout),window.removeEventListener("message",accessConfirmationHandler),initTracking(collectionData),checkContinueEmbedInit()}function handlerJSONError(e){jsonError=!0,checkContinueEmbedInit()}function widgetLoaded(opts){var widgetOptions,widgetModel;destroyWheelPreloader(),labelsAreLoaded||loadLabels(collectionData.params.language),jsonWm=void 0===collectionData.features||void 0===collectionData.features.WIDGET_NO_WATERMARK?collectionData.watermark:!collectionData.features.WIDGET_NO_WATERMARK,hasWatermark=jsonWm&&hasWatermark&&!isFlipSnackDomain&&!isDetailsPage,collectionData.watermark=hasWatermark,isPublisher=collectionData.publisher||isPublisherVar||isFlipSnackDomain||isDetailsPage,collectionData.publisher=!0===isPublisher,showWatermarkClip=hasWatermark&&showWatermarkClip&&!blockWatermarkVar,(!collectionData.features||collectionData.features&&!Object.keys(collectionData.features).length)&&(collectionData.features=jsonWm?{SELL:!1,FLIP_PAGES:30,FLIP_FILES:3,WIDGET_DAILY_VIEWS:1e4,WIDGET_NO_WATERMARK:!1,WIDGET_NO_RELATED:!1,WIDGET_RTL_ORIENTATION:!1,WIDGET_SINGLE_PAGE_VIEW:!1,WIDGET_SEARCH:!1,CUSTOM_FONTS:!1,WIDGET_SHELF:!1,WIDGET_LOGO:!1,WIDGET_PASSWORD:0,WIDGET_ANALYTICS:!1,WIDGET_PRINT:!1,WIDGET_MEDIA:!1,WIDGET_TAGS:!1,WIDGET_FORMS:!1,WIDGET_MASKS:!1,WIDGET_SHOPPING:!1,DOWNLOAD_PDF:!1,LAYOUTS:!1,TABLE_OF_CONTENT:!1,LINKS_FROM_TEXT:!1,EMBED:!1,UPLOAD_VIDEO:!1,PRODUCT_TAG:!1}:{SELL:!1,FLIP_PAGES:100,FLIP_FILES:100,WIDGET_DAILY_VIEWS:25e3,WIDGET_NO_WATERMARK:!0,WIDGET_NO_RELATED:!0,WIDGET_RTL_ORIENTATION:!0,WIDGET_SINGLE_PAGE_VIEW:!0,WIDGET_SEARCH:!0,CUSTOM_FONTS:!0,WIDGET_SHELF:!1,WIDGET_LOGO:!1,WIDGET_PASSWORD:0,WIDGET_ANALYTICS:!1,WIDGET_PRINT:!0,WIDGET_MEDIA:!1,WIDGET_TAGS:!1,WIDGET_FORMS:!0,WIDGET_MASKS:!0,WIDGET_SHOPPING:!0,DOWNLOAD_PDF:!0,LAYOUTS:!0,TABLE_OF_CONTENT:!1,LINKS_FROM_TEXT:!1,EMBED:!1,UPLOAD_VIDEO:!1,PRODUCT_TAG:!1}),embedWidth!==collectionData.params.collectionWidth&&(collectionData.params.collectionWidth=embedWidth),embedHeight!==collectionData.params.collectionHeight&&(collectionData.params.collectionHeight=embedHeight),disableFullScreen&&(collectionData.params.showFullScreenButton=!1),exportVideo&&(collectionData.params.exportVideo=!0,collectionData.params.autoFlipDelay=1,collectionData.params.showFullScreenButton=!1),logoImage=collectionData.params.logoImage||"",logoUrl=checkLogoUrlScheme(collectionData.params.logoUrl||""),showWatermarkClip&&hasWatermark?flipSnackLinks||(flipSnackLinks=new WidgetWatermark({model:new Backbone.Model({embedWidth:embedWidth,embedHeight:embedHeight,lowerLimitWidth:LOWER_LIMIT_WIDTH,lowerLimitHeight:LOWER_LIMIT_HEIGHT,limitWidth:LIMIT_WIDTH,limitHeight:LIMIT_HEIGHT,flipsnackUrl:FlipSnackEmbed.urls.siteURL,logoSrc:FlipSnackEmbed.urls.baseUrl+"/site/images/flipsnack-logo-gray.gz.svg"})}),$mainContainer.append(flipSnackLinks.render().$el)):!hasWatermark&&logoImage.length>0&&(!collectionData.security||FlipSnackEmbed.isEditor||FlipSnackEmbed.isPublish)&&loadLogo(),widgetOptions={viewIDPrefix:"fsw_widget_",collectionHash:hashId,accountId:collectionData.accountId,widgetSuffix:idSuffix,fullScreen:fullScreen||itemOpened||opts&&opts.fullScreen,isDownload:download,exportName:exportName,isMobileDevice:isMobileDevice,openPayPalIndex:openPayPalIndex,showLimit:jsonWm&&isDetailsPage,isDetailsPage:isDetailsPage,blockEvents:blockEvents,noWatermark:!showWatermarkClip,isPublisher:!0===isPublisher,location:domainName,randomVal:randomVal,width:embedWidth,height:embedHeight,collectionData:collectionData,forceWidget:(!opts||!opts.fullScreen)&&forceWidget,forceSmall:forceSmall,sandBoxType:isDev?"dev":"live",allowBrowserFullScreen:allowBrowserFullScreen,premiumLayouts:premiumLayouts,useCDN:!nocdn,retryFirstItem:step2,isWhiteLabel:isWhiteLabel,features:collectionData.features,sellSettingsPage:isInSellSettingsPage,shelfData:collectionData.shelfData,resourcePath:resourcePath,isApp:isApp,skinType:collectionData.params.skinType||WidgetSkinType.CLASSIC},startPage&&"number"==typeof startPage&&(widgetOptions.startPage=startPage),opts&&opts.startPage&&"number"==typeof opts.startPage&&(widgetOptions.startPage=opts.startPage),startBook&&"number"==typeof startBook&&(widgetOptions.startBook=startBook),opts&&opts.startBook&&"number"==typeof opts.startBook&&(widgetOptions.startBook=opts.startBook),labelsAreLoaded&&labels&&(widgetOptions.labels=labels),widgetModel=FSWidgetModel.gi(widgetOptions),widget=new FSWidgetView({model:widgetModel,el:$embedContainer[0]}),$(document).off("keydown").on("keydown",function(e){var k=e.keyCode||e.which;if(-1!==$.inArray(k,[33,34,37,39,116]))switch(k){case 34:case 39:if(FSWidgetModel.gi().get("passwordPopinVisible"))return;Backbone.Mediator.pub(WidgetEvent.NEXT_PAGE),e.preventDefault();break;case 33:case 37:if(FSWidgetModel.gi().get("passwordPopinVisible"))return;Backbone.Mediator.pub(WidgetEvent.PREV_PAGE),e.preventDefault();break;case 116:collectionData.params.remoteControlled&&(Backbone.Mediator.pub(WidgetEvent.ENTER_FULLSCREEN),e.preventDefault())}}),FSWidgetModel.gi().listenTo(FSWidgetModel.gi().widgetState,"change:currentPageIndex",function(){var ev=new $.Event("pageChanged");ev.book=FSWidgetModel.gi().widgetState.get("currentItemIndex")+1,ev.page=FSWidgetModel.gi().widgetState.get("currentPageIndex")+1,$mainContainer.trigger(ev)}),FSWidgetModel.gi().listenTo(FSWidgetModel.gi().widgetState,"change:currentItem",function(){var ev=new $.Event("bookChanged");ev.book=FSWidgetModel.gi().widgetState.get("currentItemIndex")+1,ev.page=1,$mainContainer.trigger(ev)}),shelfOpened||Backbone.Mediator.sub(NewShelfEvents.RELOAD_WITH_ITEM,reloadWithNewShelfItem,this),Backbone.Mediator.sub(WidgetEvent.ENTER_FULLSCREEN,toggleFullScreen,this),Backbone.Mediator.sub(WidgetEvent.EXIT_FULLSCREEN,toggleFullScreen,this),collectionData.security&&Backbone.Mediator.sub(WidgetEvent.PASSWORD_POPIN_CLOSE,function(){!hasWatermark&&logoImage.length>0&&loadLogo()})}function reloadWithNewShelfItem(data){collectionData=data,fullScreen=!0,shelfOpened=!0,itemOpened=!1,blockEvents=!1,Backbone.Mediator.unsubscribe(NewShelfEvents.RELOAD_WITH_ITEM,reloadWithNewShelfItem,this),isOnAllowedPage()||"PRIVATE_EMAIL"!==collectionData.visibility||"published"!==collectionData.albumType?(reloadWidget(),setBackground()):handleVisibilityWithEmail(function(){clearTimeout(accessConfirmationTimeout),window.removeEventListener("message",accessConfirmationHandler),reloadWidget(),setBackground()})}function handleVisibilityWithEmail(customHandler){accessConfirmationHandler=generateConfirmationMessageHandler(MSG_OK_ACCESS,customHandler||continueFlipbookAccess,showAccessDeniedMsg),window.addEventListener("message",accessConfirmationHandler),window.top.postMessage("getAccessConfirmation-"+hashId,"*"),accessConfirmationTimeout=setTimeout(showAccessDeniedMsg,MESSAGE_WAIT_TIMEOUT)}function isOnAllowedPage(){return checkFlipSnackDomain()&&["/my-flipbooks/","/app/myflipbooks/","/app/sell/","/app/my-purchases/"].some(function(page){return FlipSnackEmbed.referrer.indexOf(page)>0})}function showJSONErrorMessage(){$mainContainer.append($('<div class="fsw-embedmsg-container"></div>').append($('<p class="fsw-embed-message">There was an error loading the collection. Please try again later.</p>')))}function loadBg(path){$('<img id="fs_back_'+idSuffix+'"/>').load(function(){$backContainer.css("background","url("+path+")"+("image"===bgType?"no-repeat":"repeat")).css("background-color","#DEDEDE"),img=this,resizeBack()}).attr("src",path)}function resizeBack(){var dx,dy;if("image"===bgType)switch(collectionData.params.backgroundScaleType){case"scale":case"scaleCrop":var scale,_width=$backContainer.width(),_height=$backContainer.height();scale=img.width/_width<=img.height/_height?_width/img.width:_height/img.height,dx=Math.round((_width-scale*img.width)/2),dy=Math.round((_height-scale*img.height)/2),$backContainer.css("background-position",dx+"px "+dy+"px"),$backContainer.css("background-size",Math.round(scale*img.width)+"px "+Math.round(scale*img.height)+"px");break;case"center":dx=Math.round(($backContainer.width()-img.width)/2),dy=Math.round(($backContainer.height()-img.height)/2),$backContainer.css("background-position",dx+"px "+dy+"px");break;default:$backContainer.css("background-repeat","repeat")}}function removeLogo(){$logoImg&&($("#logoImage").off().remove(),$logoImg=null),$logoContainer&&($logoContainer.off().empty().remove(),$logoContainer=null)}function setLogoUrl(){$logoImg&&(logoUrl&&logoUrl.length?$logoImg.css("cursor","pointer").off("click").on("click",function(){window.open(logoUrl,"_blank")}):$logoImg.css("cursor","default").off("click"))}function repositionLogo(){var currentBottom=parseInt($logoContainer.css("bottom"),10),bottomMargins=[5,35],bottomMargin=isFullScreen()?bottomMargins[1]:bottomMargins[0];widget&&currentBottom!==bottomMargin&&(FSWidgetModel.gi().widgetSettings.get("skinType")!==WidgetSkinType.PLAYER&&$logoContainer.css("bottom",bottomMargin+"px"),widget.model.set("logo",{width:$logoImg.width(),height:$logoImg.height(),bottom:bottomMargin,right:17}))}function resizeLogo(){var originalSize=$logoImg.data(),originalLogoWidth=originalSize.oWidth,originalLogoHeight=originalSize.oHeight,wRatio=0,hRatio=0,maxWidth=LOGO_MAX_SIZE.WIDTH,maxHeight=LOGO_MAX_SIZE.HEIGHT,widgetSizePercent=1;embedWidth<LOGO_RESIZE_BRACKPOINT&&(widgetSizePercent=1-2*(1-(widgetSizePercent=embedWidth/LOGO_RESIZE_BRACKPOINT)),maxWidth=Math.max(LOGO_MIN_SIZE.WIDTH,maxWidth*widgetSizePercent),maxHeight=Math.max(LOGO_MIN_SIZE.HEIGHT,maxHeight*widgetSizePercent)),(originalLogoWidth>maxWidth||originalLogoHeight>maxHeight)&&(originalLogoWidth/originalLogoHeight>1?(wRatio=originalLogoWidth/maxWidth,$logoImg.width(maxWidth),$logoImg.height(originalLogoHeight/wRatio)):(hRatio=originalLogoHeight/maxHeight,$logoImg.height(maxHeight),$logoImg.width(originalLogoWidth/hRatio)))}function loadLogo(){var url=FlipSnackEmbed.urls.backgroundPath+logoImage+"?v="+collectionData.resourceVersion;$logoContainer=$('<div class="logo-container"></div>'),($logoImg=$("<img>").attr("id","logoImage").css({opacity:0})).on("load",function(){$logoImg.data({oWidth:$logoImg[0].width,oHeight:$logoImg[0].height}),resizeLogo(),$mainContainer.append($logoContainer),FSWidgetModel.gi().widgetSettings.get("skinType")===WidgetSkinType.PLAYER?$logoContainer.css({bottom:"60px",right:"30px"}):$logoContainer.css({bottom:"0px",right:"17px"}),logoDisplayed&&$logoImg.css("opacity",1),setLogoUrl(),repositionLogo()}),$logoContainer.append($logoImg),$logoImg.attr("src",url)}function checkLogoUrlScheme(url){var s=url.toLowerCase()||"";return s.length>0&&0!==s.indexOf("http://")&&0!==s.indexOf("https://")&&0!==s.indexOf("ftp://")&&0!==s.indexOf("sftp://")&&(url="https://"+url),url.replace(/[^A-Za-z0-9-._~:/?#\[\]@!$&%'\(\)*+,;=]+/g,"")}function setBackground(){var backgroundColor;$mainContainer.removeClass("theme-light").removeClass("theme-dark"),collectionData.params.transparentBackground?$backContainer.css("background","none"):(collectionData.params.backgroundImage&&collectionData.params.backgroundImage.length>0?(bgType="image",loadBg(FlipSnackEmbed.urls.backgroundPath+collectionData.params.backgroundImage+"?v="+collectionData.resourceVersion)):collectionData.params.bgPattern&&collectionData.params.bgPattern.length>0?(bgType="pattern",loadBg(FlipSnackEmbed.urls.patternPath+(download?"":collectionData.templateHash+"/")+collectionData.params.bgPattern)):(bgType="color",backgroundColor=FSUtils.colorToString(collectionData.params.color),$backContainer.css("background",backgroundColor),backgroundColor.replace("#","")!==defaultBackgroundColor.replace("#","")&&(isLightColor(backgroundColor)?$mainContainer.removeClass("theme-light").addClass("theme-dark"):$mainContainer.removeClass("theme-dark").addClass("theme-light"))),"color"!==bgType&&$backContainer.css("background-color",defaultBackgroundColor))}function reloadWidget(opts){FlipSnackEmbed.containers.$embed.find("#docView").turn.initialLoading=null,widget&&(widget.remove(),widget=null),removeLogo(),createWidgetContainer(),FlipSnackEmbed.containers.$embed=$embedContainer,$mainContainer.append($backContainer).append($embedContainer).append($preloader),widgetLoaded(opts)}function initTracking(data){download||"string"!=typeof data.trackingId||!data.trackingId.length||FlipSnackEmbed.isEditor||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=Date.now(),ga("create",collectionData.trackingId,"auto","clientTracker"),collectionData.ipAnonymization&&ga("clientTracker.set","anonymizeIp",!0),ga("set","checkProtocolTask",null),ga("clientTracker.send","pageview"))}function setSinglePage(){if(collectionData.shelfData&&collectionData.shelfData.shelfOpened||collectionData.params.contentLayout===ContentLayout.DOUBLE_PAGE)return!1;var screenDim;if(!FSUtils.isMobileDevice())return initialSinglePageSetting;screenDim=FSUtils.isIOS()&&!FSUtils.isChrome()?{w:FSUtils.isPortrait()?FSUtils.getScreenSize().width:FSUtils.getScreenSize().height,h:FSUtils.isPortrait()?FSUtils.getScreenSize().height:FSUtils.getScreenSize().width}:{w:FSUtils.getScreenSize().width,h:FSUtils.getScreenSize().height};var controlsWidth,newSinglePageDim,newDoublePageDim,pageDim={w:parseInt(collectionData.collection[0].pageData[0].width),h:parseInt(collectionData.collection[0].pageData[0].height)},controlWidth=pageDim.h/10;screenDim.w-=10,screenDim.h-=10,controlsWidth=(newSinglePageDim=FSUtils.calculatePageSize(screenDim.w,screenDim.h,pageDim.w,pageDim.h,Math.floor)).height/10*2,newSinglePageDim.width=newSinglePageDim.width-controlsWidth>pageDim.w?pageDim.w:newSinglePageDim.width-controlsWidth,newSinglePageDim.height=newSinglePageDim.height>pageDim.h?pageDim.h:newSinglePageDim.height,controlsWidth=(newDoublePageDim=FSUtils.calculatePageSize(screenDim.w,screenDim.h,2*pageDim.w+2*controlWidth,pageDim.h,Math.floor)).height/10*2,newDoublePageDim.width=newDoublePageDim.width-controlsWidth>pageDim.w?pageDim.w:(newDoublePageDim.width-controlsWidth)/2,newDoublePageDim.height=newDoublePageDim.height>pageDim.h?pageDim.h:newDoublePageDim.height;var singlePageAria=newSinglePageDim.width*newSinglePageDim.height;return singlePageAria-.3*singlePageAria>newDoublePageDim.width*newDoublePageDim.height}return function(options){var ret,slash,$body=$("body");if(_.extend(config,options),isDev=location.host.indexOf("site.flipsnack.net")>-1||location.host.indexOf("flipsnack-dev")>-1||location.host.indexOf("cdn.flipsnack.net")>-1||location.host.indexOf("devfiles.enterprise.flipsnack.net")>-1||location.host.indexOf(DEV_URLS.cloudFront)>-1||location.host.indexOf(DEV_NOCDN_URLS.cloudFront)>-1||location.host.indexOf(WHITELABEL.DEV.mainEmbedDomain)>-1||location.host.indexOf("192.168.0")>-1||location.host.indexOf("mobile-widget.flipsnack.io")>-1||location.host.indexOf("widget.flipsnack.io")>-1||location.host.indexOf("s3-eu-central-1.amazonaws.com")>-1&&0===location.pathname.indexOf("/flipsnack-dev"),domainName=location.host,FlipSnackEmbed.referrer=options.referrer,"widget"!==location.host&&"widgetjs"!==location.host||(domainName="site.flipsnack.net",isDev=!0),domainName.indexOf("files.flipsnack.net")>-1||domainName.indexOf("flipsnack-dev.s3.amazonaws.com")>-1||domainName.indexOf("cdn.flipsnack.com")>-1||domainName.indexOf("cdn.flipsnack.net")>-1){var matches=document.referrer.match(/^https?\:\/\/([^\/?#]+)(?:[\/?#]|$)/i);domainName=matches&&matches[1]||location.host}if("string"==typeof options.hash&&options.hash.length>0){if(hashId=options.hash,FlipSnackEmbed.impressionHash=FSUtils.generateImpressionHash(hashId),fullScreen=options.fullscreen&&"1"===options.fullscreen,randomVal="string"==typeof options.t&&options.t.length>0?options.t:"",forceWidget=void 0!==options.forceWidget&&null!==options.forceWidget,showWatermarkClip=!(options.rmm&&"1"===options.rmm),blockWatermarkVar=void 0!==options.bwd&&null!==options.bwd,isPublisherVar=void 0!==options.pbs&&null!==options.pbs,forcewm=void 0!==options.forcewm&&null!==options.forcewm,openFullScreenInNewTab=options.openfsnewtab||!1,openPayPalIndex="string"==typeof options.openpaypal&&options.openpaypal.length>0?options.openpaypal:void 0,isDetailsPage=options.details&&"1"===options.details,blockEvents=void 0!==options.be&&null!==options.be,version="string"==typeof options.v&&options.v.length>0?options.v:version,void 0!==options.novignette&&options.novignette,forceSmall=options.forceSmall&&"true"===options.forceSmall,nocdn=options.nocdn&&"1"===options.nocdn,disableFullScreen=options.dfs&&"1"===options.dfs,step2=!(!options.step2||"1"!==options.step2),download=!(!options.download||"1"!==options.download),exportName=options.exportName||"",isWhiteLabel=options.whitelabel,state=options.st,isInSellSettingsPage=Object.hasOwnProperty.call(options,"sellsettings"),exportVideo=!(!options.exportVideo||1!==parseInt(options.exportVideo,10)),resourcePath="string"==typeof options.resourcepath&&options.resourcepath.length?options.resourcepath:void 0,isApp=options.app&&"1"===options.app,options.p)try{startPage="number"==typeof options.p?options.p:parseInt(options.p)}catch(err){}if(options.b)try{startBook="number"==typeof options.b?options.b:parseInt(options.b)}catch(err){}var container,$superContainer,docElem;_.extend(config,options),container=config.container,$superContainer=$(container||"body"),($mainContainer=$("<div />").attr("id","fsw").appendTo($superContainer)).css({margin:0,padding:0,border:0,boxSizing:"border-box",fontSize:"100%",font:"inherit",verticalAlign:"baseline",width:"100%",height:"100%"}),$mainContainerParent=$mainContainer.parent(),$backContainer=$("<div />").attr("id","fsw_backContainer_"+idSuffix).css({backgroundColor:"transparent",width:"100%",height:"100%",position:"absolute",overflow:"hidden"}),createWidgetContainer(),$preloader=$("<div>").attr("id","fsw_preloader_"+idSuffix).css({position:"absolute",left:"50%",top:"50%",marginLeft:"-50px",marginTop:"-50px"}),$mainContainer.css("overflow","hidden").append($backContainer).append($embedContainer).append($preloader),FlipSnackEmbed.containers={$background:$backContainer,$embed:$embedContainer,$preLoader:$preloader,$main:$mainContainer},fullScreen?$mainContainer.addClass("full-screen"):$mainContainer.removeClass("full-screen"),FlipSnackEmbed.urls=(slash="/",download?(slash="",(ret=DOWNLOAD_URLS).htmlSources="",resourcePath&&resourcePath.length&&(ret.baseUrl=resourcePath+"/",ret.s3=resourcePath+"/",ret.s3secure=resourcePath+"/")):(ret=isDev?nocdn?isWhiteLabel?WHITELABEL.DEV_NOCDN:DEV_NOCDN_URLS:isWhiteLabel?WHITELABEL.DEV:DEV_URLS:nocdn?isWhiteLabel?WHITELABEL.LIVE_NOCDN:LIVE_NOCDN_URLS:isWhiteLabel?WHITELABEL.LIVE:LIVE_URLS).htmlSources="/widget/v2/",-1!==[DEV_URLS.cloudFront,DEV_NOCDN_URLS.cloudFront,LIVE_URLS.cloudFront,LIVE_NOCDN_URLS.cloudFront].indexOf(location.host)&&(ret.baseUrl="//"+location.host),ret.templateJS=ret.baseUrl+slash+"widget/",ret.labelsJSON=ret.baseUrl+slash+"widget/labels/jsonp/",ret.premiumLayouts=ret.baseUrl+slash+"templates/premium-layouts.gz.js",ret.backgroundPath=ret.baseUrl+slash+"collections/customize/",ret.uploadPath=ret.baseUrl+slash+"collections/uploads/",ret.patternPath=download?ret.backgroundPath:ret.baseUrl+slash+"templates/images/",ret.collectionXML=ret.baseUrl+slash+"collections/xml/",ret.collectionJSON=ret.s3secure+slash+"collections/json/",ret.items=ret.baseUrl+slash+"collections/items/",ret.icons=ret.baseUrl+slash+"resources/icons/",ret.textJS="/json/text.js",ret.linkJS="/json/links.js",ret.customDomain=void 0!==config.cd&&""!==config.cd?config.cd:"",ret),embedWidth=config.width=$mainContainer.width()||$body.width(),embedHeight=config.height=$mainContainer.height()||$body.height(),isFlipSnackDomain=!forcewm&&checkFlipSnackDomain(),!(isMobileDevice=FSUtils.isMobileDevice())||isMobileDevice&&FSUtils.isAndroid()?($(window).resize(function(){resize($embedContainer.width(),$embedContainer.height())}),isMobileDevice&&window.addEventListener("orientationchange",function(){updateSinglePageSetting()})):$(window).on("resize",function(e){var delay=FSUtils.isIOS()?33:250;setTimeout(function(){resize($embedContainer.width(),$embedContainer.height()),updateSinglePageSetting()},delay)}),checkSellAccess=isFlipSnackDomain||isMobileDevice&&window.isMobileApp,wheelPreloader=new WheelPreloader(40),$preloader.append(wheelPreloader.render().$el),$preloader.children().addClass("fswp-blue-style"),FlipSnackEmbed.embedContainer=$embedContainer,FlipSnackEmbed.isEditor=!1,FlipSnackEmbed.isPublish=!1,window.addEventListener("message",function(e){var params=[];(exportVideo||checkForValidMessageOrigin(e))&&(e.data&&("string"==typeof e.data.param&&void 0!==e.data.value?"true"===e.data.value?e.data.value=!0:"false"===e.data.value&&(e.data.value=!1):"string"!=typeof e.data&&Object.keys(e.data).length&&(params=Object.values(e.data))),params&&params.length?function(params){var paramObj={},sellData=_.clone(FSWidgetModel.gi().get("sell")),shouldReloadWidget=!1;params.forEach(function(param){switch(param.param){case"price":""!==param.value&&(sellData.price=param.value);break;case"previewPages":""!==param.value&&(sellData.previewPages=_.uniq(param.value).sort(function(a,b){return a-b}));break;case"sellEnabled":shouldReloadWidget=param.value&&sellData.enabled!==param.value,sellData.enabled=param.value,param.value&&(sellData.buyLink=FSUtils.getFlipbookBuyLink(FlipSnackEmbed.urls.siteURL,collectionData.userProfile,hashId));break;case"subscriptionPrice":FSWidgetModel.gi().get("isForSelling")&&""!==param.value&&((sellData=_.clone(FSWidgetModel.gi().get("sell"))).subscriptionPrice=param.value,FSWidgetModel.gi().set("sell",sellData));break;case"subscriptionFlipbooks":FSWidgetModel.gi().get("isForSelling")&&""!==param.value&&((sellData=_.clone(FSWidgetModel.gi().get("sell"))).subscriptionFlipbooks=param.value,FSWidgetModel.gi().set("sell",sellData))}}),paramObj.sell=sellData,shouldReloadWidget?(collectionData.sell={enabled:sellData.enabled,previewPages:sellData.previewPages,price:sellData.price,buyLink:sellData.buyLink},reloadWidget()):FSWidgetModel.gi().set(paramObj)}(params):function(paramObj){var sellData;switch(paramObj.param){case"exitFullScreen":isFullScreen()&&toggleFullScreen();break;case"transparentBackground":collectionData.params.transparentBackground=paramObj.value,setBackground();break;case"shelfColor":collectionData.params.shelfColor=paramObj.value,Backbone.Mediator.pub(WidgetEvent.CHANGE_SHELF_COLOR,paramObj.value);break;case"setItemWidth":collectionData.params.shelfItemWidth=paramObj.value,reloadWidget();break;case"color":collectionData.params.transparentBackground=!1,collectionData.params.backgroundImage=void 0,collectionData.params.bgPattern=void 0,collectionData.params.color=paramObj.value,setBackground();break;case"bgPattern":if(0===paramObj.value.length)return;collectionData.params.transparentBackground=!1,collectionData.params.backgroundImage=void 0,collectionData.params.bgPattern=paramObj.value,collectionData.params.color=void 0,setBackground();break;case"backgroundImage":if(0===paramObj.value.length)return;collectionData.params.transparentBackground=!1,collectionData.params.backgroundImage=paramObj.value,collectionData.params.bgPattern=void 0,collectionData.params.color=void 0,setBackground();break;case"backgroundScaleType":collectionData.params.backgroundScaleType=paramObj.value,setBackground();break;case"logoImage":collectionData.params[paramObj.param]=paramObj.value,logoImage=paramObj.value,hasWatermark||collectionData.security&&!FlipSnackEmbed.isEditor||(removeLogo(),logoImage.length>0&&loadLogo());break;case"logoUrl":collectionData.params[paramObj.param]=paramObj.value,logoUrl=checkLogoUrlScheme(paramObj.value||""),setLogoUrl();break;case"logoDisplayed":logoDisplayed=paramObj.value,$logoImg&&logoImage.length&&(logoDisplayed?$logoImg.css("opacity",1):$logoImg.css("opacity",0));break;case"showPageShadows":if(collectionData.params.contentLayout===ContentLayout.DOUBLE_PAGE)break;case"showThumbView":case"enableSounds":case"enableDownload":case"enablePrint":case"enableSearch":case"showFullScreenButton":case"sharePost":case"shareLink":case"shareFaceBook":case"shareTwitter":case"shareGooglePlus":case"sharePinterest":case"shareEmail":case"remoteControlled":case"autoFlip":case"autoFlipDelay":case"showControls":collectionData.params[paramObj.param]=paramObj.value,FSWidgetModel.gi().widgetSettings.set(paramObj.param,paramObj.value);break;case"tooltipLanguage":case"language":collectionData.params.language=paramObj.value,FSWidgetModel.gi().widgetSettings.set(paramObj.param,paramObj.value),loadLabels(collectionData.params.language);break;case"mergePdfs":case"arabicStyle":case"widgetType":collectionData.params[paramObj.param]=paramObj.value,reloadWidget();break;case"skinType":case"useHighlights":case"autoCreateLinks":case"enableToc":collectionData.params[paramObj.param]=paramObj.value,FSWidgetModel.gi().widgetSettings.set(paramObj.param,paramObj.value),loadCollectionData(!0);break;case"singlePageView":initialSinglePageSetting=paramObj.value,collectionData.params.singlePageView=paramObj.value,reloadWidget();break;case"enableHardCover":collectionData.params[paramObj.param]=paramObj.value,reloadWidget();break;case"security":""!==paramObj.value?collectionData.security=paramObj.value:void 0!==collectionData.security&&delete collectionData.security,reloadWidget();break;case"price":FSWidgetModel.gi().get("isForSelling")&&""!==paramObj.value&&((sellData=_.clone(FSWidgetModel.gi().get("sell"))).price=paramObj.value,FSWidgetModel.gi().set("sell",sellData));break;case"previewPages":FSWidgetModel.gi().get("isForSelling")&&""!==paramObj.value&&((sellData=_.clone(FSWidgetModel.gi().get("sell"))).previewPages=_.uniq(paramObj.value).sort(function(a,b){return a-b}),FSWidgetModel.gi().set("sell",sellData));break;case"sellEnabled":paramObj.value?(collectionData.sell={enabled:!0,previewPages:[1],price:"0.99 USD",buyLink:FSUtils.getFlipbookBuyLink(FlipSnackEmbed.urls.siteURL,collectionData.userProfile,hashId)},reloadWidget()):((sellData=_.clone(FSWidgetModel.gi().get("sell"))).enabled=paramObj.value,FSWidgetModel.gi().set("sell",sellData))}}(e.data))}),docElem=document.documentElement,(allowBrowserFullScreen="function"==typeof(docElem.requestFullScreen||docElem.webkitRequestFullScreen||docElem.mozRequestFullScreen||docElem.msRequestFullscreen))&&document.addEventListener&&(document.addEventListener("fullscreeneventchange",function(){isFullScreen()||($mainContainer.removeClass("full-screen"),exitNewShelfItemFullScreen()),widget&&widget.fullScreenChange&&widget.fullScreenChange(isFullScreen()),isFullScreen()&&$mainContainer.addClass("full-screen")}),document.addEventListener("fullscreenchange",function(){isFullScreen()||($mainContainer.removeClass("full-screen"),exitNewShelfItemFullScreen()),widget&&widget.fullScreenChange&&widget.fullScreenChange(isFullScreen()),isFullScreen()&&$mainContainer.addClass("full-screen")}),document.addEventListener("msfullscreenchange",function(){isFullScreen()||($mainContainer.removeClass("full-screen"),exitNewShelfItemFullScreen()),widget&&widget.fullScreenChange&&widget.fullScreenChange(isFullScreen()),isFullScreen()&&$mainContainer.addClass("full-screen")}),document.addEventListener("MSFullscreenChange",function(){isFullScreen()||($mainContainer.removeClass("full-screen"),exitNewShelfItemFullScreen()),widget&&widget.fullScreenChange&&widget.fullScreenChange(isFullScreen()),isFullScreen()&&$mainContainer.addClass("full-screen")}),document.addEventListener("mozfullscreenchange",function(){isFullScreen()||($mainContainer.removeClass("full-screen"),exitNewShelfItemFullScreen()),widget&&widget.fullScreenChange&&($embedContainer.width(),$embedContainer.height(),widget.fullScreenChange(isFullScreen()),resize($embedContainer.width(),$embedContainer.height())),isFullScreen()&&$mainContainer.addClass("full-screen")}),document.addEventListener("webkitfullscreenchange",function(e){isFullScreen()||($mainContainer.removeClass("full-screen"),exitNewShelfItemFullScreen()),widget&&widget.fullScreenChange&&(widget.fullScreenChange(isFullScreen()),resize($mainContainerParent.width(),$mainContainerParent.height())),isFullScreen()&&$mainContainer.addClass("full-screen")})),download||isWhiteLabel?loadCollectionData():$.get(FlipSnackEmbed.urls.premiumLayouts,premiumLayoutsLoaded,"json").fail(function(){loadCollectionData()})}}(options),$mainContainer}}(jQuery);
//# sourceMappingURL=maps/main.min.js.map
